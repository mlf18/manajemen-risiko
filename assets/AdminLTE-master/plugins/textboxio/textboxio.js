/*
 Textbox.io JavaScript Library
 Copyright (c) 2013-2017 Ephox Corp. All rights reserved.
 This software is provided "AS IS," without a warranty of any kind.

 Version: 2.4.2.99
 Client Build: 2.4.2.143
*/
(function(){function Vx(){return{major:"2",minor:"4",full:"2.4.2.99"}}function fT(){var a=g.none(),b=function(b){a=g.some(b.api)};return{add:function(c){var d=u(b,c);a.isNone()&&b(c);c.api.events.focus.addListener(d)},get:function(){return a},remove:function(b){a.is(b.api)&&(a=g.none())}}}function gT(a,b,c){var d=g.from(a.ui.editorName).map(J.error);c=c.map(J.value);d=d.or(c).getOrThunk(function(){return J.value(hT())});c=Wx.toolbar(a.platform.toolbar,b);b=Wx.mentions(a.mentions,b);return oa(a,{ui:{editorName:d},
platform:{toolbar:c},mentions:b})}function iT(){var a=[];return{get:function(b){return qa(a,function(a){return a.is(b)})},findAll:function(b){var c=Fa.all(b);return ka(a,function(a){return Xa(c,a.is)})},add:function(b){a.push(b)},remove:function(b){Gc(a,b).each(function(b){a.splice(b,1)})}}}function Xx(a,b,c,d,e){return a(c,d)?g.some(c):vb(e)&&e(c)?g.none():b(c,d,e)}function Tb(a,b){z(b,function(b,d){if(d>a.length-1){if(b.required())throw Error('missing parameter "'+b.name()+'"');}else b.validate(a[d])})}
function jT(a){var b=Ql.create(),c=eb(a,function(a){var c=kT.create();b.bind(a,c.eventTrigger);return c});a=eb(c,function(a){return a.eventRegistry});c=eb(c,function(a){return a.eventTrigger});return{registry:a,trigger:c,destroy:function(){b.unbindAll()}}}function lT(){var a={};return{getOrSetIndexed:function(b,c){if(void 0!==a[b])return a[b];c=c();return a[b]=c},waitForLoad:function(){var b=Ze(a);return Rl(b,Ga.nu)}}}function Yx(){var a=lT(),b=function(){return a.waitForLoad()};return{preload:function(){b().get(ca)},
addStylesheet:function(b,d){return a.getOrSetIndexed(b,function(){return mT.download(b,d)})},addScript:function(b,d){return a.getOrSetIndexed(b,function(){return nT.download(b).map(d)})},waitForLoad:b}}function oT(a){var b=function(b,c,f){Tb(arguments,[ba.func("filter"),ba.string("selector"),ba.func("callback")]);var d=b(c,Zx(f));a.filter().customFilters().addFilter(d)},c=function(b,c,f){Tb(arguments,[ba.func("filter"),ba.func("predicate"),ba.func("callback")]);var d=b(pT(c),Zx(f));a.filter().customFilters().addFilter(d)};
return{selector:{addInput:u(b,ij.inputSelector),addOutput:u(b,ij.outputSelector)},predicate:{addInput:u(c,ij.inputPredicate),addOutput:u(c,ij.outputPredicate)}}}function zq(a,b,c,d){return{term:function(){return new RegExp(a,d.getOr("g"))},prefix:b,suffix:c}}function qT(a,b,c){var d=Cb.sanitise(a),e=Cb.sanitise(b);return{patterns:function(){return[new RegExp(d+"(.*?)"+e,"gi")]},useCursor:Jb,generate:function(a,b){return c.generate(a,b.key(),b.value())},derive:function(a){var b=a[1];return c.get(b).map(function(c){return{startIndex:k(a.index),
finishIndex:k(a.index+a[0].length),key:k(b),value:k(c)}})}}}function $x(a,b,c){return qT(a,b,{get:function(a){a=c(a);return g.some(a)},generate:function(a,b,c){a=qe.fromHtml(c,a.dom());return Zd.species({elements:k(a),cursor:g.none,dictation:g.none,notify:g.none})}})}function ay(a,b){var c=function(a){try{return d(a)}catch(l){return g.none()}},d=function(b){return a(b)?g.from(b.dom().nodeValue):g.none()},e=aa.detect().browser,f=e.isIE()&&10===e.version.major?c:d;return{get:function(c){if(!a(c))throw Error("Can only get "+
b+" value of a "+b+" node");return f(c).getOr("")},getOption:f,set:function(c,d){if(!a(c))throw Error("Can only set raw "+b+" value of a "+b+" node");c.dom().nodeValue=d}}}function nb(){return{up:k({selector:L.ancestor,closest:L.closest,predicate:Ja.ancestor,all:A.parents}),down:k({selector:Y.descendants,predicate:ed.descendants}),styles:k({get:v.get,getRaw:v.getRaw,set:v.set,remove:v.remove}),attrs:k({get:m.get,set:m.set,remove:m.remove,copyTo:function(a,b){a=m.clone(a);m.setAll(b,a)}}),insert:k({before:y.before,
after:y.after,afterAll:P.after,append:y.append,appendAll:P.append,prepend:y.prepend,wrap:y.wrap}),remove:k({unwrap:G.unwrap,remove:G.remove}),create:k({nu:r.fromTag,clone:function(a){return r.fromDom(a.dom().cloneNode(!1))},text:r.fromText}),query:k({comparePosition:function(a,b){return a.dom().compareDocumentPosition(b.dom())},prevSibling:A.prevSibling,nextSibling:A.nextSibling}),property:k({children:A.children,name:D.name,parent:A.parent,isText:D.isText,isComment:D.isComment,isElement:D.isElement,
getText:Ya.get,setText:Ya.set,isBoundary:function(a){return D.isElement(a)?"body"===D.name(a)?!0:U(rT,D.name(a)):!1},isEmptyTag:function(a){return D.isElement(a)?U(["br","img","hr","input"],D.name(a)):!1}}),eq:N.eq,is:N.is}}function sT(a,b,c){var d=jT({loaded:a.events.loaded,focus:a.events.focus,change:a.events.change,dirty:a.events.dirty,internal:a.events.internal}),e=function(a,b){var c=A.owner(a);a=A.defaultView(a);c=Za.get(c);b=b();a.dom().scrollTo(c.left(),c.top());return b},f=u(Aq.getText,a),
h=Sl.makeReadOnly({content:{documentElement:u(Fd.documentElement,a),insertHtmlAtCursor:u(Fd.insertHtmlAtCursor,a),uploadImages:u(Fd.uploadImages,a),get:u(Fd.get,a),set:u(Fd.set,a),isDirty:u(Fd.isDirty,a),setDirty:u(Fd.setDirty,a),selection:{findTagAtCursor:u(Aq.findTagAtCursor,a),getText:f,getHtml:u(Aq.getHtml,a)},getSelectedText:f},mode:{set:u(by.set,a),get:u(by.get,a)},filters:oT(a),macros:{addSimpleMacro:u(cy.addSimpleMacro,a),removeMacro:u(cy.removeMacro,a)},message:u(tT.message,a),events:d.registry,
element:function(){return a.element().dom()},focus:a.focus,restore:gc(function(){return e(a.element(),function(){uT.blur();var b=Fd.get(a);d.destroy();a.destroy();return c.restore(b)})})});z(b,function(a){Bq.hookup(h,a)});return h}function vT(){var a=fT(),b=iT(),c=function(a){return a.api},d=function(c,d){var e=gT(d.options(),function(){return f.getOrDie("Internal Error")},g.from(m.get(c,"id"))),f=wT.one(c,d.constructors(),e).map(function(d){var f=sT(d.polish,e&&e.plugins?e.plugins:[],{restore:function(c){b.remove(h);
a.remove(h);return d.restore(c).dom()}}),h={is:function(a){return N.eq(c,a)},api:f};b.add(h);a.add(h);return f});return f};return{getOrCreate:function(a,f){return b.get(a).map(c).orThunk(function(){return d(a,f)})},get:function(a){a=b.findAll(a);return E(a,c)},getActiveEditor:a.get}}function Cq(a,b,c){var d=c||!1,e=function(){b();d=!0},f=function(){a();d=!1};return{on:e,off:f,toggle:function(){(d?f:e)()},isOn:function(){return d}}}function p(a){var b=O.apply(null,a),c=[];return{bind:function(a){if(void 0===
a)throw"Event bind error: undefined handler";c.push(a)},unbind:function(a){c=ka(c,function(b){return b!==a})},trigger:function(){var a=b.apply(null,arguments);z(c,function(b){b(a)})}}}function dy(a,b){var c=function(c){var d=b(c);return 0>=d||null===d?(c=v.get(c,a),parseFloat(c)||0):d},d=function(a,b){return hb(b,function(b,c){c=v.get(a,c);c=void 0===c?0:parseInt(c,10);return isNaN(c)?b:b+c},0)};return{set:function(b,c){if(!$e(c)&&!c.match(/^[0-9]+$/))throw a+".set accepts only positive integer values. Value was "+
c;b=b.dom();af.isSupported(b)&&(b.style[a]=c+"px")},get:c,getOuter:c,aggregate:d,max:function(a,b,c){a=d(a,c);return b>a?b-a:0}}}function Gd(a){return xT(a,function(){return{bind:t,unbind:t}})}function ey(a){a=na(a.dirty);var b=a.get,c=a.set,d=H.create({dirty:p([]),clean:p([])}),e=Hd.tap(function(a){var f=b();a!==f&&(c(a),!0===a?d.trigger.dirty():(e.control.block(),d.trigger.clean(),e.control.unblock()))});return{events:d.registry,isDirty:b,setDirty:e.instance,state:function(){return{dirty:b()}}}}
function fy(a,b,c){var d=[],e=u(b,"input"),f=u(b,"output"),h=u(c,"input"),l=u(c,"output");b=function(a){ij.cata(a,e,f,h,l);d.push(a)};z(a.customs,b);return{state:function(){return{customs:d.slice(0)}},addFilter:b}}function Dq(a){var b={};Ma(a,function(a,d){b[d]=a});return{get:function(){return Ze(b)},add:function(a){var c=Ha("macro");b[c]=a;return c},remove:function(a){delete b[a]},state:function(){return ua({},b)}}}function yT(){var a=t;return Eq({setAutocorrect:t,setSpelling:t,events:Gd(["analytics"]),
init:function(b){b.body().each(function(b){m.set(b,"spellcheck","false");a=function(){m.remove(b,"spellcheck")}})},ui:g.none,check:t,scanView:t,situation:Jg.noSituation,hasDropdown:k(!1),hasAutocorrect:k(!1),handle:t,assign:t,lock:xb,destroy:function(){a()},state:k({}),lookup:k(g.none()),name:k("spelling-disabled")})}function Q(a,b){var c=p(a),d=0,e=function(b){var d=E(a,function(a){return b[a]()});c.trigger.apply(null,d)};return{bind:function(a){c.bind(a);d++;1===d&&b.bind(e)},unbind:function(a){c.unbind(a);
d--;0===d&&b.unbind(e)},trigger:yb("Cannot trigger a source event.")}}function gy(a,b,c){var d=Ta.state(c),e=g.none(),f=g.none(),h=H.create({loaded:p([]),focus:p([]),dirty:Q([],d.laundry.events.dirty),change:p([]),internal:p(["command","data"]),paint:p(["dimensions"])}),l=T.div();ma.add(l,[B.resolve("source-container"),"ephox-textbox-font",B.resolve("layer-editor")]);c=function(){return l};var q=function(){return f.getOrDie("CodeMirror not added to DOM")},C=function(a){return V()?hy.beautify(a):a},
w=function(a){var b=q().doc;a=C(a);b.setValue(a);b.clearHistory()},I=function(a){var b=r.fromDom(a.getWrapperElement()),c=-1;a.on("changes",function(){var d=a.doc.lineCount();d!=c&&(c=d,d=a.getScrollInfo(),d=iy({width:Ia.get(b),docWidth:d.width,height:d.height,docHeight:d.height}),h.trigger.paint(d))})},F=function(){q().focus()},V=function(){return!0===a.content.prettyprint};return kj.internal({activateInline:Id.activateInline,blur:yb("blur is not supported in the API."),communication:Ta.communication,
connect:function(c){if(a.content&&!0===a.content.autoresize){var d=c.dom().clientHeight;sa.set(l,d)}y.append(c,l);b.updateUi(l);lj.detect(l);var e=Tl.use.codemirror()(l.dom(),{mode:"text/html",extraKeys:{"Ctrl-Space":"autocomplete"},lineWrapping:!0});Kf(function(){e.refresh();e.focus()},100);e.on("focus",function(){h.trigger.focus()});f=g.some(e);h.trigger.loaded();I(e);return!0},content:k({body:k(g.none()),doc:yb("content.doc is not supported in code view"),execCommand:yb("content.execCommand is not supported in code view"),
getSelectedText:function(){var a=q().getSelection();return void 0!==a&&null!==a&&0<a.length?g.some(a):g.none()},focus:F,isInline:k(!1)}),deactivateInline:Id.deactivateInline,destroy:function(){G.remove(l);G.empty(l);f=g.none()},element:c,events:h.registry,filter:d.filter,focus:F,fromTransfer:function(a){var b=function(a){w(a);e=g.some(a);f.each(function(a){a.on("changes",function(a,b){d.laundry.setDirty(!0);h.trigger.change()})})};Lf.cata(a,b,b)},fullscreen:Ta.fullscreen,getContent:function(){return q().doc.getValue()},
getMode:hc.code,insertHtmlAtCursor:function(a){q().replaceSelection(a)},isDirty:d.laundry.isDirty,isPrettyPrinting:V,keyboard:Id.keyboard,macros:d.macros,operations:Id.operations,setContent:function(a){w(a);d.laundry.setDirty(!1)},setDirty:d.laundry.setDirty,smartview:Id.smartview,state:function(){return d.getState({content:{}})},toTransfer:function(){var a=q().doc.getValue();return e.filter(function(b){return C(b)===a}).fold(function(){return Lf.changed(a)},Lf.unchanged)},ui:Id.ui,undo:k(Ta.undo()),
uploader:k(Ta.uploader()),viewport:c})}function AT(a){var b=T.span();n.add(b,va.resolve("toolbar-group"));var c=E(a,function(a){return a.component()});P.append(b,c);return jy.group({component:function(){return b},isVisible:function(){return Xa(c,mj.isShowing)},refreshUi:function(){z(a,function(a){a.refreshUi()})},destroy:function(){z(a,function(a){a.destroy()})}})}function Gq(a,b,c){n.add(a,lb.resolve("button"));var d=BT.disable(a);b=b.getOr(a);var e=null,f=n.toggler(a,lb.resolve("button-disabled")),
h=function(){f.isOn()||q.trigger.click()},l=K.bind(b,"click",h),q=H.create({click:p([])});return{element:function(){return a},name:function(){return c},destroy:function(){l.unbind();d.unbind();G.remove(a)},content:function(b){null!==e&&G.remove(e.element());y.append(a,b.element());e=b},enable:f.off,disable:f.on,disabled:f.isOn,click:h,events:q.registry}}function Oc(a){var b=r.fromTag("span");n.add(b,lb.resolve("independent-button"));return Gq(b,g.none(),a)}function bf(a){var b=T.span();m.set(b,"aria-hidden",
!0);ma.add(b,[lb.resolve("icon-content")].concat(a));return{element:function(){return b},destroy:function(){G.remove(b)}}}function Hq(a){var b=T.span();n.add(b,lb.resolve("statebutton"));var c=Gq(T.span(),g.some(b),a);n.add(c.element(),lb.resolve("dependent-button"));y.append(b,c.element());a=n.toggler(b,lb.resolve("statebutton-selected"));var d=n.toggler(b,lb.resolve("statebutton-disabled"));return{element:function(){return b},destroy:function(){c.destroy();G.remove(b)},name:c.name,content:c.content,
enable:function(){d.off();c.enable()},disable:function(){d.on();c.disable()},disabled:function(){return d.isOn()&&c.disabled()},click:c.click,events:c.events,select:a.on,deselect:a.off,selected:a.isOn}}function $d(a){var b=Hq(a),c=H.create({click:p([])}),d=function(){b.selected()?b.deselect():b.select();c.trigger.click()};b.events.click.bind(d);return{element:b.element,name:b.name,content:b.content,destroy:function(){b.events.click.unbind(d);b.destroy()},enable:b.enable,disable:b.disable,disabled:b.disabled,
click:b.click,events:c.registry,select:b.select,deselect:b.deselect,selected:b.selected}}function CT(a){var b=T.span();n.add(b,lb.resolve("dropbutton"));var c=T.span();n.add(c,lb.resolve("dropbutton-button"));var d=T.span();n.add(d,lb.resolve("dropbutton-arrow"));P.append(b,[c,d]);var e=Oc(),f=$d();f.content(bf(["ephox-pastry-arrow-icon"]));y.append(c,e.element());y.append(d,f.element());var h=H.create({click:p([]),open:p([]),close:p([])}),l=function(){h.trigger.click()},q=function(){(f.selected()?
h.trigger.open:h.trigger.close)()};e.events.click.bind(l);f.events.click.bind(q);return{element:function(){return b},name:function(){return a},content:e.content,events:h.registry,open:function(){f.select();h.trigger.open()},close:function(){f.deselect();h.trigger.close()},destroy:function(){e.events.click.unbind(l);f.events.click.unbind(q);e.destroy();f.destroy();G.remove(b)},isOpen:function(){return f.selected()}}}function DT(a){var b=T.span();n.add(b,lb.resolve("dropbutton"));var c=T.span();n.add(c,
lb.resolve("dropbutton-button"));var d=T.span();n.add(d,lb.resolve("dropbutton-arrow"));P.append(b,[c,d]);var e=$d(),f=$d();f.content(bf(["ephox-pastry-arrow-icon"]));y.append(c,e.element());y.append(d,f.element());var h=H.create({click:p([]),open:p([]),close:p([])}),l=function(){h.trigger.click()},q=function(){(f.selected()?h.trigger.open:h.trigger.close)()};e.events.click.bind(l);f.events.click.bind(q);return{element:k(b),name:k(a),content:e.content,events:h.registry,open:function(){f.select();
h.trigger.open()},close:function(){f.deselect();h.trigger.close()},destroy:function(){e.events.click.unbind(l);f.events.click.unbind(q);e.destroy();f.destroy();G.remove(b)},isOpen:function(){return f.selected()},click:e.click,enable:e.enable,disable:e.disable,disabled:e.disabled,select:e.select,deselect:e.deselect,selected:e.selected}}function Rc(a){var b=T.span();n.add(b,lb.resolve("text-content"));y.append(b,r.fromText(a));return{element:function(){return b},destroy:function(){G.remove(b)}}}function Ul(a){var b=
re.resolve(a);return{set:function(a){n.add(a,b)},up:function(a){return n.has(a,b)?g.some(a):L.ancestor(a,"."+b)},all:function(a){return Y.descendants(a,"."+b)},first:function(a){return L.descendant(a,"."+b)},is:function(a){return n.has(a,b)}}}function ky(a,b){b=void 0!==b?b:"info";var c=T.div();ma.add(c,[B.resolve("banner"),B.resolve("banner-"+b)]);b=T.div();n.add(b,B.resolve("banner-message"));y.append(b,r.fromText(a));var d=T.div();n.add(d,B.resolve("banner-buttons"));a=r.fromTag("span");n.add(a,
B.resolve("banner-close"));y.append(d,a);S.button(a,x.translate("banner.close"));P.append(c,[b,d]);var e=K.bind(a,"click",function(){f.trigger.close()}),f=H.create({close:p([])});return{element:function(){return c},action:function(a){y.prepend(d,a.element())},destroy:function(){e.unbind();G.remove(c)},events:f.registry}}function nj(a,b){b=void 0!==b?b:"error";var c=a.description();a=a.link();var d=ky(c,b),e=g.none(),f=function(a,b){return K.bind(a,"click",function(a){a.kill();window.open(b.url())})};
b=function(a){var b=r.fromTag("a");m.set(b,"href",a.url());m.set(b,"target","_blank");var c=r.fromText(a.text());e=g.some(f(b,a));y.append(b,c);d.action({element:k(b)})};null!==a&&a.url()&&a.text()&&b(a);return{element:d.element,action:d.action,destroy:function(){d.destroy();e.each(function(a){a.unbind()})},events:d.events}}function ET(a,b){var c=H.create({populate:p(["items"])}),d=function(b){var c=a(b.textkey);c=zb.item(FT,b.name+"-menu-trigger",c);n.add(c,va.resolve("menu-more"));b=oj.generate("ephox-chameleon-"+
b.name);P.prepend(c,b);S.menuItem(c,g.none(),g.some(!0));return c}(b),e=function(a){a=r.fromText(a);f(a)},f=function(a){L.child(d,".ephox-gopher-item-text").each(function(b){G.empty(b);y.append(b,a);n.remove(b,ly)})},h=Eh.control(d);return{element:k(d),populate:function(a){c.trigger.populate(a)},select:function(c){L.child(d,ib.tokenSelector()).each(G.remove);var f=ib.describe(d,b.describe(c));y.append(d,f);c=a(c.textkey());e(c)},selectElement:f,disable:h.disable,enable:h.enable,clear:function(){e(a(b.textkey));
L.child(d,".ephox-gopher-item-text").each(function(a){n.add(a,ly)})},destroy:function(){G.remove(d)},events:c.registry}}function GT(a,b){var c=b?a.slice(0):[],d=b,e=b?E(Ze(R),function(a){return a()}):[];return{swallowShortcuts:function(a){c=a.slice(0)},yieldShortcuts:function(a){c=Iq(c,a)},swallowChars:function(){d=!0},yieldChars:function(){d=!1},swallowKeys:function(a){e=a.slice(0)},yieldKeys:function(a){e=Iq(e,a)},process:function(a,b){a.fold(function(a){U(c,a)&&b()},function(a){U(e,a)&&b()},function(){d&&
b()})}}}function HT(a,b){var c=!1,d=GT(a,b);return{on:function(){c=!0},off:function(){c=!1},isOn:function(){return c},handle:function(a){return function(b){c&&a(b.raw())}},stop:function(b){var c=IT.identify(b,a);d.process(c,u(my.stop,b))},swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys}}function pj(a){var b=ua({shortcuts:[],swallow:!1},a),c=H.create({character:p(["character"]),space:p(["shift",
"stopper"]),left:p(["shift","stopper"]),right:p(["shift","stopper"]),backspace:p(["shift","stopper"]),tab:p(["shift","stopper"]),enter:p(["shift","stopper"]),capslock:p(["shift","stopper"]),escape:p(["shift","stopper"]),pageup:p(["shift","stopper"]),pagedown:p(["shift","stopper"]),end:p(["shift","stopper"]),home:p(["shift","stopper"]),down:p(["shift","stopper"]),up:p(["shift","stopper"]),insert:p(["shift","stopper"]),del:p(["shift","stopper"]),command:p(["command"])}),d=HT(b.shortcuts,b.swallow),
e=function(a){return qa(b.shortcuts,function(b){return ny.isCommand(a,b)})},f=function(a,b,d){l(a);c.trigger[b].apply(void 0,d)},h=function(a){return function(){d.isOn()&&my.stop(a)}};a=d.handle(function(a){e(a).fold(function(){var b=Kg.getSpecial(a.keyCode);Kg.noModifiers(a)&&null!==b&&(b=b.toLowerCase(),f(a,b,[a.shiftKey,h(a)]))},function(b){f(a,"command",[b])})});var l=function(a){d.isOn()&&d.stop(a)},q=d.handle(function(a){if(Kg.noModifiers(a))Kg.isCharCode(a)||null===Kg.getSpecial(a.keyCode)?
e(a).isSome()?l(a):a.which&&f(a,"character",[String.fromCharCode(a.which)]):l(a);else return!1});return{off:d.off,on:d.on,events:c.registry,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys,keypress:q,keydown:a}}function JT(a){var b=H.create({mouseover:p(["item"]),click:p(["item"])}),c=[],d=pj({shortcuts:a.shortcuts,swallow:a.swallow});a=a.tabs?[R.TAB()]:[];d.swallowKeys([R.UP(),R.DOWN(),
R.ENTER(),R.SPACE(),R.ESCAPE()].concat(a));var e=function(){z(c,function(a){a.mouseover().unbind();a.click().unbind();a.keydown().unbind()});c=[];d.off()};return{destroy:function(){e()},attach:function(a){e();c=E(a,function(a){var c=K.bind(a,"mouseover",function(a){Ic.up(a.target()).each(b.trigger.mouseover)}),e=K.bind(a,"click",function(a){Ic.up(a.target()).each(b.trigger.click)});a=K.bind(a,"keydown",function(a){d.keydown(a)});return{mouseover:k(c),click:k(e),keydown:k(a)}});d.on()},detach:e,simulateKey:function(a){d.keydown(a)},
events:b.registry,keys:d.events}}function KT(a,b){var c=H.create({select:p(["item"]),active:p(["item"]),show:p(["menu"]),hide:p(["menu"]),collapse:p(["menu"]),expand:p(["menu","trigger"]),escaped:p([])}),d=JT({shortcuts:[],swallow:[],tabs:b.tabs}),e={},f=function(b){Jd.activate(a,b)},h=function(){var b=Jd.inactive(a);z(b,function(a){Mf.submenu().is(a)&&c.trigger.hide(a)})},l=function(b){Ic.isEnabled(b)&&Jd.submenu(a,e,b).each(function(a){c.trigger.expand(a,b)})},q=function(a){Jd.up(a).each(function(b){f(b);
Kd.selectAll(b,[a]);c.trigger.active(a)})},C=function(b){Jd.active(a).bind(function(a){Kd.selected(a).orThunk(function(){return Jq.first(a)}).each(function(c){b(a,c)})})},w=function(a){C(function(b,c){Ic.isEnabled(c)&&a(b,c)})},g=function(b){C(function(d,f){b(d,f).each(function(b){N.eq(f,b)||(Jd.submenu(a,e,f).each(c.trigger.collapse),c.trigger.active(b))})})},F=u(g,Jq.prev),V=u(g,Jq.next),X=function(){Mf.main().first(a).each(function(a){f(a);Kd.selected(a).each(c.trigger.active)})},Hc=function(b){Z.active().fold(b.stopper(),
function(a){!1===U(["input"],D.name(a))&&b.stopper()()});w(function(b,d){Jd.submenu(a,e,d).fold(function(){Mf.submenu().is(b)&&(c.trigger.collapse(b),X())},function(a){c.trigger.expand(a,d);Kd.none(a);Kd.first(a).each(c.trigger.active);f(a)})})};g=function(a){Z.active().fold(a.stopper(),function(b){!1===U(["input"],D.name(b))&&a.stopper()()});w(function(a,b){Mf.submenu().is(a)&&(c.trigger.collapse(a),X())})};var m=function(a){w(function(b,d){b=Ic.get(d);e.hasOwnProperty(b)&&void 0!==e[b]?Hc(a):c.trigger.select(d)})},
n=function(a){a.shift()?F(a):V(a)};d.keys.up.bind(F);d.keys.down.bind(V);b.tabs&&d.keys.tab.bind(n);d.keys.enter.bind(m);d.keys.space.bind(m);d.keys.escape.bind(function(a){a.stopper()();C(function(a,b){Mf.submenu().is(a)?(c.trigger.collapse(a),X()):c.trigger.escaped()})});"ltr"===ae.getDirection(a)?(d.keys.left.bind(g),d.keys.right.bind(Hc)):(d.keys.right.bind(g),d.keys.left.bind(Hc));d.events.mouseover.bind(function(b){b=b.item();Kd.is(b)&&Jd.submenu(a,e,b).forall(sc.isVisible)||(q(b),h(),l(b))});
d.events.click.bind(function(a){a=a.item();var b=Ic.get(a);e.hasOwnProperty(b)&&void 0!==e[b]||!Ic.isEnabled(a)||c.trigger.select(a)});return{destroy:function(){d.destroy()},populate:function(a){e=ua({},a)},on:function(a){a=void 0!==a?a:[r.fromDom(document)];d.attach(a)},off:function(){d.detach()},selectFirst:function(){Jd.active(a).each(function(a){Kd.none(a);Kd.first(a).each(c.trigger.active)})},select:function(a){q(a);h()},setActiveMenu:f,simulateKey:d.simulateKey,state:function(){return Jd.active(a).bind(function(a){return Kd.selected(a).map(function(b){return{menu:k(a),
item:k(b)}})})},events:c.registry}}function Kq(a,b,c){var d=T.div();n.add(d,va.resolve("menu-"+b()+"-sandbox"));m.set(d,"tabindex",-1);y.append(a(),d);var e=g.none(),f=KT(d,{tabs:!0}),h=na({}),l=function(){f.off();w();C.trigger.close()},q=function(a){var b=Nf(h.get(),O("submenu","item")),c=m.get(a,"data-ephox-gopher-menu-value");return qa(b,function(a){return a.submenu()===c}).bind(function(b){return L.descendant(d,"[data-ephox-gopher-item-value="+b.item()+"]").map(function(b){return{menu:k(a),item:k(b)}})})};
a=function(a){var b=q(a.menu()).map(function(a){return a.item()});C.trigger.collapse(a.menu(),b)};var C=H.create({open:p([]),close:p([]),itemAction:p(["value","item"]),itemHover:Q(["item"],f.events.active),reveal:Q(["menu","trigger"],f.events.expand),collapse:p(["menu","item"]),escaped:Q([],f.events.escaped)});f.events.hide.bind(a);f.events.collapse.bind(a);f.events.escaped.bind(function(){f.state().fold(l,function(a){q(a.menu()).fold(function(){l()},function(a){C.trigger.collapse(a.menu(),g.some(a.item()));
f.select(a.item())})})});f.events.select.bind(function(a){a=a.item();var b=m.get(a,"data-ephox-gopher-item-value");C.trigger.itemAction(b,a)});f.events.active.bind(function(a){c.focusActive()&&Z.focusInside(a.item())});var w=function(){Ma(h.get(),function(a,b){L.descendant(d,'[data-ephox-gopher-menu-value="'+a+'"]').each(function(a){var c=L.descendant(d,'[data-ephox-gopher-item-value="'+b+'"]');C.trigger.collapse(a,c)})})};return{update:function(a){h.set(a);f.populate(a)},setActiveMenu:function(a){e=
g.from(a);f.setActiveMenu(a);f.selectFirst()},getActiveMenu:function(){return e},structure:h,destroy:function(){l();f.destroy()},open:function(a,b){Z.focus(b);f.on(a);C.trigger.open()},close:l,events:C.registry,sandbox:k(d),select:f.select,simulateKey:f.simulateKey}}function Fh(a,b){return{southeast:k(Ra(-a,b)),southwest:k(Ra(a,b)),northeast:k(Ra(-a,-b)),northwest:k(Ra(a,-b))}}function Vl(){return{northwest:function(){return Ra(-2,1)},northeast:function(){return Ra(0,1)},southwest:function(){return Ra(-2,
-2)},southeast:function(){return Ra(0,-2)}}}function oy(a,b,c){c=c||[r.fromDom(document)];var d=[],e=function(c){var d=b();c=c.target();N.member(c,d)||LT.anyAncestor(c,d)||a(c)};return{on:function(){z(c,function(a){d.push(K.bind(a,"mousedown",e).unbind)})},off:function(){z(d,xb)},mousedown:e}}function MT(a){var b=ua({layerClass:null,zindex:null},a),c=T.div();n.add(c,lb.resolve("panel"));v.setAll(c,{position:"fixed",display:"none",top:"0px"});b.zindex&&v.set(c,"z-index",b.zindex);b.layerClass&&n.add(c,
b.layerClass);a=void 0!==a.container?a.container:L.first("body").getOrDie();y.append(a,c);a=sc.displayToggler(c,"block");return{element:function(){return c},destroy:function(){G.remove(c)},content:function(a){G.empty(c);y.append(c,a)},show:a.on,hide:a.off,toggle:a.toggle}}function qj(a,b,c,d,e){var f=[],h=function(){var a=E(f,function(a){return a.popup().panel()}).concat(d);z(f,function(b){b.popup().setComponents(a)})},l=function(a){var b=Wl.get(f,a,Xl(a)).fold(function(){return C(a)},function(a){return a.popup()});
h();f=Wl.put(f,a,b,py,Xl(a));return b},q=function(a){Wl.get(f,a,Xl(a)).each(function(a){a.popup().close()});v.set(a,"display","none")},C=function(b){var c=NT.create(a,e);c.setContent(b);f=Wl.put(f,b,c,py,Xl(b));h();return c};return{initMenu:C,registerMenus:function(a){f=OT.triage(f);return E(a,l)},hideAll:function(){z(f,function(a){q(a.menu())})},hideMenu:q,expandMenu:function(d,e){var f=l(d),h=Db.descendant(d,"."+Yl.styles())?cf.expandable():cf.anchored();e=Lg.submenu(a,b,k(e),c.uiDirection(),h);
v.set(d,"display","block");f.open();e.recalculate(f);return{popup:f,anchorage:e}}}}function qy(a,b){var c=T.span();ma.add(c,[lb.resolve("righticon-content"),b]);y.append(c,a);return{element:function(){return c},destroy:function(){G.remove(c)}}}function PT(a,b){var c=Rc(a),d=qy(c.element(),b);return{element:d.element,destroy:function(){c.destroy();d.destroy()}}}function QT(a,b,c,d,e,f,h,l,q,C){var w=$d(c);h=Lq.control(w);ma.add(w.element(),[va.resolve("dropdown-button"),va.resolve(c+"-dropdown-button")]);
m.set(w.element(),"title",l(d));S.toolbarButton(w.element(),l(d),!0,q);var g=Kq(a.uiContainer,k("dropdown-"+c),rj.menu({focusActive:!0})),F=r.fromDom(document),V=zb.mainmenu(F,c+"-menu",[]),X=qj(g.sandbox,a.bounds,b,[w.element()],C).initMenu(V);c=Vl();var Hc=Lg.main(a.uiContainer,a.bounds,w.element,c,b.uiDirection(),cf.anchored());S.menu(V,l(e));var Fq=Ha("menu-control");m.set(V,"id",Fq);S.controls(w.element(),Fq);var jj=T.span();n.add(jj,va.resolve("dropdown-viewport"));w.content({element:k(jj)});
var Dh=function(a,b){b=b.map(oj.generate).getOr([]);P.prepend(a,b)};b=function(){v(l(d))};var v=function(a){G.empty(jj);y.append(jj,PT(a,"ephox-pastry-arrow-righticon").element())},x=function(){w.deselect();q&&ra.pressed(w);ra.collapsed(w.element());S.disown(w.element());X.close();g.close()},A=function(){w.select();q&&ra.pressed(w);ra.expanded(w.element());S.owns(w.element(),Fq);X.open();var b=[a.uiContainer()];g.open(b,w.element())},ry=H.create({select:Q(["value","item"],g.events.itemAction),itemHover:Q(["item"],
g.events.itemHover),escaped:Q([],g.events.escaped),open:p(["menu","popup","anchor"]),close:Q([],g.events.close)});w.events.click.bind(function(){(w.selected()?A:x)()});X.events.close.bind(x);g.events.open.bind(function(){ry.trigger.open(V,X,Hc);g.update({});RT()||g.setActiveMenu(V)});g.events.escaped.bind(x);b();return{element:k(w.element()),menu:X.element,list:k(V),click:w.click,populate:function(a){G.empty(V);z(a,function(a){a.label().each(function(a){a=Zl.generateSeparator(F,a,l);y.append(V,a)});
z(a.items(),function(a){var b=Zl.generateItem(F,a,f,l);S.menuItemCheckbox(b);Dh(b,a.icon());y.append(V,b)})})},enable:h.enable,disable:h.disable,close:x,uiStale:X.uiStale,recalculate:function(){Hc.recalculate(X)},clear:b,select:function(a){v(l(a.textkey()));Dh(jj,a.icon())},selectElement:function(a){a=qy(a,"ephox-pastry-arrow-righticon");w.content({element:a.element,destroy:t})},tick:u(Gh.tick,V),untick:u(Gh.untick,V),activate:u(Gh.activate,w.element()),deactivate:u(Gh.deactivate,w.element()),destroy:function(){g.destroy();
w.destroy()},events:ry.registry}}function ST(a){var b=sy.menu(a);return{widget:b.widget,menu:b.menu,general:b.general,"inline-widget":function(a){return b["inline-widget"]({instance:function(){return a.instance(Mq.menu())}})},"split-widget":b["split-widget"],dropdown:b.dropdown,palette:b.palette}}function TT(a,b,c,d,e,f,h){var l=sy.toolbar(f,c,h,Mg.editorContainer()),q=function(q){return u(q,l,a,b,c,d,e,f,h)};return{widget:q(Nq.widget),"inline-widget":q(Nq.inlineWidget),"split-widget":q(Nq.splitWidget),
cards:l.cards,general:q(UT.init),dropdown:q(VT.init),menu:q(WT.init),palette:l.palette}}function XT(a){var b=Hq("overflower");n.add(b.element(),va.resolve("more-button"));b.content(Rc(a("toolbar.more")));var c=Of.onButton(b);m.set(b.element(),"tabindex","-1");a=a("aria.label.more");m.set(b.element(),"title",a);var d=Ng.aria(b,a,!0,!0),e=Oq.toolbar([{component:b.element,destroy:b.destroy,refreshUi:t}]);return{group:e.component,select:function(){b.select();d.press()},deselect:function(){d.release();
b.deselect()},focus:function(){Z.focus(b.element())},destroy:function(){c.unbind();d.destroy();e.destroy()},events:b.events}}function ty(a){var b=[];return{add:function(c,d){d=d?a.indexOf(b,d).getOrDie():b.length;b.splice(d,0,c);return uy(c,d)},remove:function(c){var d=a.resolve(b,c).getOrDie();return Gc(b,d).bind(function(a){b.splice(a,1);return uy(d,a)})},get:function(){return b.slice(0)},itemAt:function(c){return a.resolve(b,c)}}}function vy(a){var b=function(a,b){return $e(b)?c(a,b):xa(b)?d(a,
b):ic(b)?e(a,b):J.error("Unsupported specifier type: "+b)},c=function(a,b){return 0===a.length?J.error("Items is empty"):0>b||b>=a.length?J.error("Item index: "+b+" is out of range (0-"+(a.length-1)+")"):J.value(a[b])},d=function(b,c){return qa(b,function(b){return a(b)===c}).fold(function(){return J.error("No item with value: ["+c+"]")},function(a){return J.value(a)})},e=function(a,b){return Gc(a,b).fold(function(){return J.error("Specified object is not a registered item: "+b)},function(a){return J.value(b)})};
return{resolve:b,indexOf:function(a,c){return b(a,c).bind(function(b){return Gc(a,b).fold(function(){return J.error("Item not found: "+c)},function(a){return J.value(a)})})},index:c,value:d,item:e}}function YT(a,b){b=H.create({grow:p([]),shrink:p([]),exit:p([])});var c=ty(vy(ca)),d=r.fromTag("div");v.set(d,"overflow-x","auto");n.add(d,va.resolve("toolstrip"));S.toolbarGroup(d);var e=r.fromTag("div");ma.add(e,[va.resolve("toolbar"),va.resolve("toolbar-primary")]);var f=r.fromTag("div");ma.add(f,[va.resolve("toolbar"),
va.resolve("toolbar-more")]);y.append(d,e);y.append(d,f);var h=function(){var a=c.get();return ia(a,function(a){return a.isVisible()?[a.component()]:[]})},l=function(){var b=h();b=a.build(b);G.empty(e);G.empty(f);P.append(e,b);v.reflow(e)};return{element:function(){return d},main:k(e),mores:k(f),destroy:function(){var a=c.get();z(a,function(a){a.destroy()})},focused:fd,enter:t,restore:t,refocus:t,refresh:u(Hh.preserve,l,d),repaint:u(Hh.preserve,l,d),add:function(a){c.add(a)},events:b.registry}}function wy(a){Pq(a);
var b=!1,c=K.bind(a,"transitionend",function(c){"height"===c.raw().propertyName&&(ma.remove(a,[xy,yy]),b&&v.remove(a,"height"))});return{visible:function(){return b},hide:function(){b=!1;Qq(a,sa.get(a));n.add(a,yy);Pq(a)},show:function(){zy(a);var c=sa.get(a);Pq(a);n.add(a,xy);zy(a);Qq(a,c);b=!0},destroy:function(){c.unbind()}}}function ZT(a,b){var c=H.create({grow:p([]),shrink:p([]),exit:p([])}),d=ty(vy(ca)),e=r.fromTag("div");S.toolbarGroup(e);n.add(e,va.resolve("toolstrip"));var f=r.fromTag("div");
ma.add(f,[va.resolve("toolbar"),va.resolve("toolbar-primary")]);var h=r.fromTag("div");ma.add(h,[va.resolve("toolbar"),va.resolve("toolbar-more")]);y.append(e,f);y.append(e,h);var l=wy(h);b.events.click.bind(function(){l.visible()?(l.hide(),b.deselect(),c.trigger.shrink()):(l.show(),b.select(),c.trigger.grow())});var q=function(){var a=d.get();return ia(a,function(a){return a.isVisible()?[a.component()]:[]})},C=function(){a.update();var c=q();c=a.build(c);v.set(f,"visibility","hidden");a.clearWidth();
G.empty(f);P.append(f,c);var d=a.width(f);y.append(f,b.group());c=$T.partition(d,c,Ia.getOuter,b.group());d=c.extra();var e=c.within();G.empty(f);G.empty(h);P.append(f,e);P.append(h,d);a.updateWidth(b,c);v.remove(f,"visibility")},w=function(){Hh.preserve(C,e)};return{element:function(){return e},main:k(f),mores:k(h),destroy:function(){var a=d.get();z(a,function(a){a.destroy()});b.destroy();l.destroy()},focused:fd,enter:t,restore:t,refocus:t,refresh:w,repaint:function(){a.shouldRefresh()&&w()},add:function(a){d.add(a)},
events:c.registry}}function Pf(a,b,c){var d=K.bind(a,"keydown",c.getOr(function(a){qa(b,function(b){return b.matches(a)}).each(function(b){b.run(a).each(function(b){a.kill()})})})),e=H.create({enter:p([]),exit:p([])});return gd({isFocused:u(fb.isFocused,a),element:k(a),clear:t,enter:function(){fb.set(a);e.trigger.enter()},refresh:t,isEnabled:Jb,exit:function(){e.trigger.exit()},events:e.registry,destroy:function(){d.unbind()}})}function Rq(a,b){var c=Pf(a,[ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),
function(){b.execute()(a);return g.some(!0)})],b.process());return gd({element:c.element,destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:Jb,refresh:t,enter:c.enter,exit:c.exit})}function sj(a,b){var c=u(b,-1,0),d=u(b,1,0),e=ae.onDirection(c,d);d=ae.onDirection(d,c);c=u(b,0,-1);b=u(b,0,1);var f=function(b){return b(a)()};e=u(f,e);d=u(f,d);return{west:e,east:d,north:c,south:b}}function aU(a,b){var c=XT(b),d=aa.detect().deviceType.isTouch()?YT(a,c):ZT(a,c);S.toolbar(d.main(),b("aria.label.toolbar"));
S.group(d.mores());var e=H.create({drawer:Q(["delta","total"],d.events.drawer),grow:Q([],d.events.grow),shrink:p([]),transitionend:p(["property"]),exit:p([])}),f=K.bind(d.element(),"transitionend",function(a){e.trigger.transitionend(a.raw().propertyName)}),h=g.none();a=Ba.sectors({first:g.none,trigger:Of.trigger});var l=ha.sectors(d.element(),bU,a);l.events.exit.bind(function(){h=g.none();e.trigger.exit()});l.events.active.bind(function(a){h=g.some(a.element())});var q=function(){return l.isFocused()},
C=function(){h.each(Z.focus)};d.events.shrink.bind(function(){Z.search(d.mores()).isSome()&&c.focus();e.trigger.shrink()});return{element:d.element,refresh:d.refresh,repaint:d.repaint,add:d.add,enter:function(){l.enter()},destroy:function(){l.exit();h=g.none();f.unbind();d.destroy();l.destroy()},focused:q,restore:C,refocus:function(){q()&&C()},events:e.registry}}function cU(){var a=T.div();n.add(a,B.resolve("bannerarium"));n.add(a,B.resolve("layer-above-editor"));var b=g.some([]),c=Ql.create(),d=
function(a){b=b.bind(function(b){b=ka(b,function(b){return b!==a});return g.some(b)});e(a)},e=function(a){a.destroy();c.unbind(a.events.close);G.remove(a.element())},f=H.create({close:p(["banner"])});return{element:function(){return a},display:function(e){b.fold(function(){e.destroy()},function(b){b.push(e);c.bind(e.events.close,function(){d(e);f.trigger.close(e)});y.append(a,e.element())})},hide:d,destroy:function(){G.remove(a);b=b.bind(function(a){z(a,e);return g.none()})},events:f.registry}}function Ay(){var a=
cU();a.events.close.bind(function(){b.trigger.resize()});var b=H.create({resize:p([])});return{element:a.element,display:function(c){a.display(c);b.trigger.resize()},hide:function(c){a.hide(c);b.trigger.resize()},destroy:a.destroy,events:b.registry}}function By(a,b,c){var d=-1;return{shouldRefresh:function(){return Ia.getOuter(b)!==d},updateWidth:u(function(a,b,c){d=Ia.getOuter(a)},b),updateHeight:t,clearWidth:t,build:ca,update:t,width:Ia.getOuter,init:function(a,b,c,d,q,C){a.refresh()},state:k({toolbar:{drag:g.none()}}),
integrate:function(a,b,c,d,q){var e=T.div();ma.add(e,[B.resolve("sticky-container"),B.resolve("layer-above-editor")]);P.append(e,[b.element(),c.element(),q]);P.append(a,[e,d])},destroy:t,events:Gd(["changed","dock","undock"])}}function dU(a){a=ua({layerClass:Cy.resolve("blocker")},a);var b=r.fromTag("div");m.set(b,"role","presentation");v.setAll(b,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"});n.add(b,Cy.resolve("blocker"));n.add(b,a.layerClass);return{element:function(){return b},
destroy:function(){G.remove(b)}}}function eU(){var a=g.none(),b=function(b,c){var d=a.map(function(a){return b.compare(a,c)});a=g.some(c);return d},c=H.create({move:p(["info"])});return{onEvent:function(a,e){e.extract(a).each(function(a){b(e,a).each(function(a){c.trigger.move(a)})})},reset:function(){a=g.none()},events:c.registry}}function fU(a){return{onEvent:function(a,c){},reset:t}}function gU(){var a=fU(),b=eU(),c=a;return{on:function(){c.reset();c=b},off:function(){c.reset();c=a},isOn:function(){return c===
b},onEvent:function(a,b){c.onEvent(a,b)},events:b.events}}function hU(a,b){var c=H.create({relocate:p(["x","y","deltaX","deltaY"]),dragend:p([])}),d=iU.both(a),e=tj.transform(d),f=K.bind(a,"mousedown",function(a){0!==a.raw().button||Db.closest(a.target(),b)||(e.on(),e.go(r.fromDom(document.body)))});e.events.stop.bind(function(){c.trigger.dragend();e.off()});d.events.relocate.bind(function(a){c.trigger.relocate(a.x(),a.y(),a.deltaX(),a.deltaY())});return{blocker:e.element,destroy:function(){f.unbind();
e.destroy()},events:c.registry}}function jU(){var a=H.create({dock:p([]),undock:p([])}),b=function(a,b,e,f,h,l){if("true"===m.get(e,"data-ephox-snap")){var c=bb.absolute(h),d=c.top()+l.top;if(Dy.isAllInside(b,d,d+f()))return c=a.locationToAbsolute(e,c.left(),d),g.some({position:"absolute",left:l.left+c.left()+"px",top:c.top()+"px"});a=l.top+c.top()-f()<=b.y()?b.fy():b.fy()+b.h()-f();h=bb.viewport(h).left()-c.left();l=l.left+c.left()+h;return g.some({position:"fixed",left:l+"px",top:a+"px"})}return g.none()};
return{update:function(c,d,e,f,h,l){b(c,d,e,f,h,l).each(function(b){var c=v.get(e,"position");v.setAll(e,b);"absolute"===b.position&&c!==b.position?a.trigger.dock():"fixed"===b.position&&c!==b.position&&a.trigger.undock()})},getState:function(a){return"true"===m.get(a,"data-ephox-snap")},events:a.registry}}function kU(a){var b=function(a,b,c){a=A.owner(a);a=Za.get(a);b-=a.left();c-=a.top();return Ra(b,c)},c=function(a,b,c){a=A.owner(a);a=Za.get(a);b+=a.left();c+=a.top();return Ra(b,c)};return{locationToFixed:b,
fixedToLocation:c,absoluteToFixed:function(b,c,f){var d=a();b=A.owner(b);b=Za.get(b);c-=b.left();return Ra(c,d.top()-f)},locationToAbsolute:function(b,c,f){b=a();return Ra(c,f).translate(-b.left(),-b.top())},absoluteToLocation:function(b,c,f){b=a();return Ra(c,f).translate(b.left(),b.top())},fromFixed:function(a,b,f){var d=Ra(b,f);a=c(a,b,f);return Ey(d,a)},fromLocation:function(a,c,f){a=b(a,c,f);c=Ra(c,f);return Ey(a,c)},boundToFixed:function(a,b,c,h,l,q,C){b=c<a.x()?a.fx():c>a.x()+a.w()?a.fx()+
a.w():l;a=h<a.y()?a.fy():h+C>a.y()+a.h()?a.fy()+a.h()-C:q;return Ra(b,a)}}}function Fy(a,b){var c=a.isInline()?a.element():b;return lU(function(){var a=Za.get();return{x:a.left,y:a.top,w:k(window.innerWidth),h:k(window.innerHeight),fx:k(0),fy:k(0)}},function(){return a.isInline()?Ra(0,0):bb.absolute(c)},function(){var a=L.descendant(b,".ephox-chameleon-toolbar").getOr(b);return sa.getOuter(a)},c)}function mU(a,b,c){var d=T.div();v.set(d,"position","relative");n.add(d,B.resolve("dragging-container"));
var e=T.div();n.add(e,B.resolve("draggable-container"));var f=a.isInline()?b:e;c=Fy(a,f);var h=Gy.transitions,l=Hy.except([".ephox-pastry-button","."+B.resolve("banner-buttons")+" *",".ephox-polish-ui-container",".ephox-polish-socket",".ephox-polish-widget-container"]),q=Iy.register(c,f,l,h),C=H.create({changed:Q([],q.events.dragend),dock:Q([],q.events.dock),undock:Q([],q.events.undock),appear:p(["container","wrapper"]),disappear:p(["container","wrapper"])});qd.initFade(e);q.events.appear.bind(function(){C.trigger.appear(f,
e)});q.events.disappear.bind(function(){C.trigger.disappear(f,e)});n.add(e,B.resolve("layer-above-editor"));ma.add(q.blocker(),[B.resolve("above-outside"),B.resolve("dragging")]);var w=T.span();S.hidden(w,!0);ma.add(w,[B.resolve("toolbar-drag-handle"),B.resolve("general-drag-handle"),"ephox-textbox-font",B.resolve("icon")]);c=aa.detect();c.browser.isIE()&&10===c.browser.version.major&&n.add(w,B.resolve("ie10"));return{shouldRefresh:k(!0),updateWidth:u(qd.updateWidth,f),updateHeight:t,clearWidth:u(qd.clearWidth,
f),build:function(a){return[w].concat(a)},width:u(qd.width,f),init:function(b,c,d,h,l,C){var w=v.preserve(f,function(){v.set(f,"visibility","hidden");v.remove(f,"display");b.refresh();return sa.get(b.element())});C.toolbar.drag.fold(function(){var b=qd.offsetFrom(a,f,w,l);q.init(b.left,b.top,g.from(l.toolbar.offset).getOr({top:-1*w,left:0}))},q.setState);P.append(e,[b.element(),c.element()])},update:function(){q.update()},state:function(){return{toolbar:{drag:q.state()}}},integrate:function(c,f,h,
l,q){y.append(e,f.element());a.isInline()?(P.append(d,[e,q,l]),y.append(b,d)):P.append(b,[e,q,l])},destroy:function(){q.destroy()},events:C.registry}}function nU(a,b,c){var d=T.div();v.set(d,"position","relative");n.add(d,B.resolve("floating-container"));!0===c.toolbar.sticky&&n.add(d,B.resolve("floating-container-sticky"));!0===c.autoresize&&n.add(d,B.resolve("floating-container-autoresize"));c=T.div();n.add(c,B.resolve("draggable-container"));var e=a.isInline()?b:c;c=Fy(a,a.isInline()?e:d);var f=
Iy.register(c,e,Hy.none,Gy.transitions),h=H.create({changed:Q([],f.events.dragend),dock:Q([],f.events.dock),undock:Q([],f.events.undock),appear:p(["container","wrapper"]),disappear:p(["container","wrapper"])});qd.initFade(e);f.events.appear.bind(function(){h.trigger.appear(e,e)});f.events.disappear.bind(function(){h.trigger.disappear(e,e)});n.add(e,B.resolve("layer-toolbar"));var l=function(){f.update()},q=function(){if(v.getRaw(e,"position").is("fixed")){var b=bb.absolute(a.element());v.getRaw(e,
"left").is(b.left()+"px")||v.set(e,"left",b.left()+"px")}b=Ia.get(a.element());(v.getRaw(e,"width").isNone()||b!==Ia.get(e))&&v.set(e,"width",b+"px");return b},C=function(){var b=sa.get(e)+"px";v.getRaw(a.element(),"margin-top").is(b)||v.set(a.element(),"margin-top",b)};return{shouldRefresh:function(){return!0},updateWidth:function(b,c){a.isInline()?qd.updateWidth(e,b,c):(q(),C(),l())},updateHeight:function(){a.isInline()||C()},clearWidth:function(){a.isInline()&&qd.clearWidth(e)},build:ca,width:function(b){return a.isInline()?
qd.width(e,b):Ia.get(a.element())},init:function(b,c,d,h,l,k){k=v.preserve(e,function(){v.set(e,"visibility","hidden");v.remove(e,"display");b.refresh();return sa.get(b.element())});d=qd.offsetFrom(a,e,k,l);a.isInline()||(q(),C());l=l.toolbar.sticky?{top:0,left:0}:g.from(l.toolbar.offset).getOr({top:-1*k,left:0});f.init(d.left,d.top,l);P.append(e,[b.element(),c.element(),h])},update:l,state:k({toolbar:{drag:g.none()}}),integrate:function(c,f,h,l,q){y.append(e,f.element());a.isInline()?P.append(d,
[q,l]):P.append(d,[e,l]);y.append(b,d)},destroy:function(){f.destroy()},events:h.registry}}function oU(a,b,c,d,e,f){var h=aa.detect(),l=r.fromTag("div"),q=c.uiContainer(),C=T.div();Jy(d,l);n.add(l,B.resolve("editor-main"));!0===e.autoresize&&n.add(l,be.autoresize());a.isInline()||h.deviceType.isTouch()?y.append(l,q):(Jy(d,C),n.add(C,B.resolve("external-ui")),d=ja.body(),y.append(d,C),y.append(C,q));var w=pU.setup(a,l,e,f),g=df.toolbar(w,x.translate);!1===e.toolbar.visible&&n.add(l,"ephox-polish-no-toolbar");
b.events.toolbar.bind(g.enter);g.events.exit.bind(a.focus);var F=Ay(),V=T.div();n.add(V,B.resolve("socket"));var X=T.div();n.add(X,B.resolve("widget-container"));w.integrate(l,g,F,V,X);Ky.build(l,e.sideBar,e.bottomBar);var Hc=a.isInline()?function(){v.set(F.element(),"min-width",Ia.getOuter(a.element())+"px")}:t;a.events.paint.bind(function(a){g.repaint();c.refresh();Hc()});w.events.changed.bind(function(){g.refresh()});a.isInline()||!0!==e.toolbar.sticky||(w.events.dock.bind(function(){v.set(q,"position",
"absolute");c.refresh()}),w.events.undock.bind(function(){v.set(q,"position","fixed");c.refresh()}));if(a.isInline()||!0===e.toolbar.sticky)w.events.appear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),q];qd.fadeIn(c,b.wrapper())}),w.events.disappear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),q];qd.fadeOut(c,b.wrapper())});g.events.transitionend.bind(w.updateHeight);return{element:k(l),socket:function(a){a.connect(V)},viewport:k(V),uiContainerParent:k(C),
connect:function(a){y.append(a,l);lj.detect(l);return!0},destroy:function(){g.destroy();w.destroy();F.destroy();G.remove(l);G.remove(C)},toolbar:g,position:function(){Hc();w.init(g,F,V,X,e,f)},refresh:function(){w.update();g.refresh()},banners:F.element,displayBanner:F.display,hideBanner:F.hide,state:w.state,dialogContainer:k(X)}}function qU(a){var b=g.none(),c=function(b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];d=a.get()[b];if(null===d||void 0===d)throw"can't find instance method: "+
b;return d.apply(null,c)}},d=function(){var a=b.getOrDie("Cannot reconnect the editor before it has been connected the first time.");c("connect")(a)&&e.trigger.connected()},e=H.create({connected:p([])});return kj.external({activateInline:c("activateInline"),deactivateInline:c("deactivateInline"),content:c("content"),keyboard:c("keyboard"),smartview:c("smartview"),macros:c("macros"),ui:c("ui"),filter:c("filter"),undo:c("undo"),operations:c("operations"),getMode:c("getMode"),element:c("element"),connect:function(a){b=
g.some(a);d()},reconnect:function(){var c=b.getOrDie("Cannot reconnect the editor before it has been connected the first time."),e=v.getRaw(c,"height");a.get().events.loaded.bind(function(){e.fold(function(){v.remove(c,"height")},function(a){v.set(c,"height",a)})});var l=v.get(c,"height");v.set(c,"height",l);d()},focus:c("focus"),getContent:c("getContent"),setContent:c("setContent"),insertHtmlAtCursor:c("insertHtmlAtCursor"),state:c("state"),communication:c("communication"),uploader:c("uploader"),
isDirty:c("isDirty"),setDirty:c("setDirty"),isPrettyPrinting:c("isPrettyPrinting"),events:e.registry})}function Ly(a){var b=Pb(J.error,a);return{invalidError:b,different:function(a,d,e,f,h){return 0===d.length?b(f):d===e?b(h):J.value(a)}}}function rU(a){var b=Ly(a);return{changeAlt:function(a,d,e,f){var c=m.get(a,"src");return b.different(a,d,c,e,f).map(function(a){m.set(a,"alt",d);return a})}}}function Sc(a,b,c,d){var e=N.eq(a,c)&&b===d;return{startContainer:k(a),startOffset:k(b),endContainer:k(c),
endOffset:k(d),collapsed:k(e)}}function My(a){var b=function(b){return a(b).isRtl()?$l.rtl:$l.ltr};return{delta:function(a,d){return b(d).delta(a,d)},edge:function(a){return b(a).edge(a)},positions:function(a,d){return b(d).positions(a,d)}}}function sU(a){var b=Ly(a);return{changeCaption:function(a,d,e,f){var c=m.get(a,"summary");return b.different(a,d,c,e,f).map(function(a){Qf.setCaption(a,d);return a})},changeSummary:function(a,d,e,f){var c=L.descendant(a,"caption").map(Ea.get).getOr("");return b.different(a,
d,c,e,f).map(function(a){Qf.setSummary(a,d);return a})},setHeaders:function(a,d,e,f){return(!0===e&&!0===f?Qf.addBothHeaders:!0===e?Qf.addRowHeader:!0===f?Qf.addColumnHeader:k(b.invalidError("a11y.t4b.repair.errors.none")))(a,d)},setScope:function(a,b){m.set(a,"scope",b);return J.value(a)}}}function tU(a){var b=Aa("id description prompts element severity url repair".split(" "),[]),c=Aa(["ui","repair"],[]),d=rU(a),e=sU(a),f={I1:g.some(c({ui:[jc.field("image-alt","a11y.i1.repair.info",k(""))],repair:function(a,
b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i1.repair.errors.empty","a11y.i1.repair.errors.duplicate")}})),I2:g.some(c({ui:[jc.field("image-alt","a11y.i2.repair.info",function(a){return m.get(a.element(),"alt")})],repair:function(a,b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i2.repair.errors.empty","a11y.i2.repair.errors.duplicate")}})),T1:g.some(c({ui:[jc.field("table-caption","a11y.t1.repair.info",k(""))],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),
"a11y.t1.repair.errors.empty","a11y.t1.repair.errors.duplicate")}})),T2:g.some(c({ui:[jc.field("table-summary","a11y.t2.repair.info",k(""))],repair:function(a,b,c){return e.changeSummary(b.element(),c["table-summary"](),"a11y.t2.repair.errors.empty","a11y.t2.repair.errors.duplicate")}})),T3:g.some(c({ui:[jc.field("table-caption","a11y.t3.repair.info",function(a){return m.get(a.element(),"summary")})],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),"a11y.t3.repair.errors.empty",
"a11y.t3.repair.errors.duplicate")}})),T4A:g.none(),T4B:g.some(c({ui:[jc.toggles("table-headers","a11y.t4b.repair.info",[jc.toggle("row-header","ephox-polish-row-header","a11y.t4b.repair.row"),jc.toggle("col-header","ephox-polish-column-header","a11y.t4b.repair.column")])],repair:function(a,b,c){var d=c["row-header"]();c=c["col-header"]();return e.setHeaders(a,b.element(),d,c)}})),T4C:g.some(c({ui:[jc.select("scope-type","a11y.t4c.repair.info",[jc.pair("row","a11y.t4c.repair.scope.row"),jc.pair("col",
"a11y.t4c.repair.scope.col"),jc.pair("rowgroup","a11y.t4c.repair.scope.rowgroup"),jc.pair("colgroup","a11y.t4c.repair.scope.colgroup")])],repair:function(a,b,c){return e.setScope(b.element(),c["scope-type"]())}})),D1:g.some(c({ui:[jc.select("heading-type","a11y.d1.repair.info",[jc.pair("h1","a11y.d1.repair.block.h1"),jc.pair("h2","a11y.d1.repair.block.h2"),jc.pair("h3","a11y.d1.repair.block.h3"),jc.pair("h4","a11y.d1.repair.block.h4"),jc.pair("h5","a11y.d1.repair.block.h5"),jc.pair("h6","a11y.d1.repair.block.h6")])],
repair:function(a,b,c){return Ny.convertToHeading(b.element(),c["heading-type"]())}})),D2:g.none(),D3:g.some(c({ui:[],repair:function(a,b,c){return Ny.joinLinks(a.content().isRoot,b.element())}})),D4:g.none(),D5:g.none(),O1:g.none(),O2:g.none()};return{convert:function(a,c){var d=function(b){var c=b.repair();return function(b,d){return a.undo().transaction(function(){return c(a,b,d)})}};return E(c,function(a){var c=a.rule(),e=c.id().toUpperCase(),h=void 0!==f[e]?f[e]:g.none(),l=c.desckey();return b({id:e,
description:l,prompts:h.map(function(a){return a.ui()}),element:r.fromDom(a.element()),url:c.url(),severity:c.severity(),repair:h.map(d).getOr(function(){return J.error("no repair")})})})}}}function uU(a){return{audit:function(b){return vU.audit(b,a.rules())}}}function wU(){var a=na([]),b=na(0),c=O("index","total","detail"),d=function(d){var e=a.get();if(0===e.length)return g.none();var h=b.get();var l=e.length-1;d=h+d;l=d>l?0:0>d?l:d;b.set(l);return g.some(c(l,e.length,e[l]))};return{load:function(d){if(0===
d.length)return g.none();b.set(0);a.set(d);return g.some(c(b.get(),d.length,d[0]))},backwards:function(){return d(-1)},current:function(){var d=a.get();return 0===d.length?g.none():g.some(c(b.get(),d.length,d[b.get()]))},resolve:function(){var d=a.get();if(0===d.length)return g.none();d=d.slice(0,b.get()).concat(d.slice(b.get()+1));var f=Math.min(d.length-1,b.get());b.set(f);a.set(d);return 0===d.length?g.none():g.some(c(b.get(),d.length,d[b.get()]))},forwards:function(){return d(1)}}}function xU(a,
b){var c=T.div();n.add(c,$a.resolve(b,"assistance"));var d=$a.resolve(b,"assistance-invalid"),e=g.none(),f=r.fromTag("p");n.add(f,$a.resolve(b,"repair-error"));m.set(f,"aria-live","polite");var h=function(){n.remove(c,d);G.remove(f)},l=H.create({execute:p([])}),q=ha.dynamic(c,Ba.dynamic({})),C=[q];return{element:k(c),keylayouts:k(C),markInvalid:function(a){n.add(c,d);ib.shout(c,a);Ea.set(f,a);y.append(c,f)},markValid:h,getChange:function(){return e.map(function(a){return a.get()})},destroy:function(){e.each(function(a){a.destroy()})},
update:function(d){h();d=d.detail();var f=d.prompts();e.each(function(a){a.destroy()});d=yU.generate(a,f,d,b);e=g.some(d);G.empty(c);P.prepend(c,d.elements());d.events.execute.bind(function(){l.trigger.execute()});q.set(d.keylayouts())},events:l.registry}}function zU(a,b){var c=T.div();n.add(c,$a.resolve(b,"commands"));var d=T.div();n.add(d,$a.resolve(b,"commands-buttons"));var e=ef.defaultActionButton(a,[$a.resolve(b,"repair")],Tc.repairLabel(),Tc.repairText(),b),f=ef.normalButton(a,[$a.resolve(b,
"ignore")],Tc.ignoreLabel(),Tc.ignoreText(),b),h=ef.defaultActionButton(a,[$a.resolve(b,"ok")],Tc.okLabel(),Tc.okText(),b),l=function(){P.append(d,[f.element(),e.element()])};l();a=Ba.button({execute:function(a){a.dom().click()}});a=[ha.button(f.element(),a),ha.button(e.element(),a),ha.button(h.element(),a)];y.append(c,d);var q=H.create({repair:Q([],e.events.click),ignore:Q([],f.events.click),done:Q([],h.events.click)});return{element:k(c),destroy:function(){e.destroy();f.destroy();h.destroy()},keylayouts:k(a),
focus:function(){var a=e.disabled()?e.element():f.element();Z.focus(a)},update:function(a){G.remove(h.element());a=a.detail();sc.isVisible(f.element())||l();a.prompts().fold(function(){e.disable();ra.disable(e.element())},function(a){e.enable();ra.enable(e.element());ib.speak(ja.body(),$a.translate(b,Tc.repairAvailable()))})},zero:function(a){G.empty(d);y.append(d,h.element());Z.focus(h.element())},events:q.registry}}function AU(a,b){var c=T.div();n.add(c,$a.resolve(b,"information"));m.set(c,"data-severity",
"info");a=T.div();n.add(a,$a.resolve(b,"icon"));var d=T.div();n.add(d,$a.resolve(b,"description"));y.append(d,r.fromText(""));var e=r.fromTag("a");n.add(e,$a.resolve(b,"help-icon"));m.set(e,"href","javascript:void(0)");P.append(c,[a,d,e]);var f=K.bind(e,"click",function(){var a=m.get(e,"data-url");window.open(a,"","height=700,width=820,resizable=yes,scrollbars=yes")});a=[ha.single(e,[],g.none())];return{element:k(c),destroy:function(){f.unbind()},keylayouts:k(a),update:function(a){a=a.detail();var f=
a.severity();m.set(c,"data-severity",f);ib.speak(ja.body(),$a.translate(b,Tc.severity(f)));f=$a.translate(b,a.description());Ea.set(d,f);ib.speak(ja.body(),f);m.set(e,"title",$a.translate(b,Tc.issueHelp()));m.set(e,"data-url",a.url());y.after(d,e)},zero:function(){m.set(c,"data-severity","success");var a=$a.translate(b,Tc.noIssue());Ea.set(d,a);ib.speak(ja.body(),a);G.remove(e)}}}function BU(a,b){a=T.div();var c=T.span();n.add(c,$a.resolve(b,"spin"));n.add(a,$a.resolve(b,"loading"));y.append(a,c);
return{element:k(a),destroy:t}}function CU(a,b){var c=am("titlebar",g.none(),b),d=am("title",g.none(),b),e=am("title-text",g.some(Tc.title()),b),f=am("issue",g.some(Tc.running()),b);P.append(d,[e,f]);var h=T.div();n.add(h,$a.resolve(b,"navigation"));e=ef.icon(a,$a.resolve(b,"previous"),Tc.previous(),b);a=ef.icon(a,$a.resolve(b,"next"),Tc.next(),b);var l=[e,a];a=H.create({previous:Q([],e.events.click),next:Q([],a.events.click)});P.append(h,E(l,function(a){return a.element()}));y.append(c,d);var q=
Ba.button({execute:function(a){a.dom().click()}});e=E(l,function(a){return ha.button(a.element(),q)});var C=function(a){a.disable();ra.disable(a.element())},w=function(a){a.enable();ra.enable(a.element())},I=function(){z(l,C)},F=function(){z(l,w)},V=function(){Hh.preserve(function(){y.after(d,h)},h)};return{element:k(c),update:function(a){var c=a.index()+1;a=a.total();c=$a.translate(b,Tc.issueCounter(),c,a);Ea.set(f,c);ib.speak(ja.body(),c);(1===a?I:F)();V()},zero:function(){Ea.set(f,"&nbsp;");V();
I()},keylayouts:k(e),destroy:function(){z(l,function(a){a.destroy()})},events:a.registry}}function DU(a,b){var c=T.div();n.add(c,$a.resolve(b,"widget"));var d=$a.resolve(b,"loading");n.add(c,d);var e=CU(a,b),f=AU(a,b),h=xU(a,b),l=zU(a,b),q=BU(a,b);P.append(c,[e.element(),q.element()]);var C=H.create({showcase:p(["detail"]),ignored:p(["detail"]),solved:p(["detail"]),done:p([])}),w=function(a){z([e,f,h,l],function(b){b.update(a)});C.trigger.showcase(a.detail());Hh.preserve(function(){y.after(e.element(),
f.element());y.after(f.element(),h.element());y.after(h.element(),l.element())},c)},g=function(a){a.fold(function(){y.after(e.element(),f.element());y.after(f.element(),l.element());G.remove(h.element());e.zero();f.zero();l.zero()},w)},F=na(wU());e.events.previous.bind(function(){F.get().backwards().each(w)});e.events.next.bind(function(){F.get().forwards().each(w)});a=function(){var a=h.getChange().getOr({});F.get().current().each(function(b){var c=b.detail();c.repair()(c,a).fold(function(a){h.markInvalid(a)},
function(a){h.markValid();a=F.get().resolve();C.trigger.solved(c);g(a);l.focus()})})};h.events.execute.bind(a);l.events.repair.bind(a);l.events.ignore.bind(function(){F.get().current().each(function(a){var b=F.get().resolve();C.trigger.ignored(a.detail());g(b)})});l.events.done.bind(function(){C.trigger.done()});a=Qb([e.keylayouts(),f.keylayouts(),h.keylayouts(),l.keylayouts()]);return{element:k(c),destroy:function(){z([e,f,h,l],function(a){a.destroy()})},load:function(a){G.remove(q.element());n.remove(c,
d);a=F.get().load(a);g(a)},open:function(){y.append(c,q.element());n.add(c,d)},skip:function(){var a=F.get().resolve();g(a)},keylayouts:k(a),events:C.registry}}function EU(a){var b=Sq.ignoreAttr(),c={prefix:k("accessibility-check"),translate:Oy.translate,tnames:k("a11y")},d=DU(FU,c);c=GU.all();c=HU({rules:c});var e=uU(c),f=tU(Oy.translate),h=Sq.manager(a.content()),l=function(c){c=e.audit(c.dom());c=f.convert(a,c);return ka(c,function(a){var c=a.element();c=ff.read(c,b);return!U(c,a.id())})};d.events.showcase.bind(function(b){a.content().body().each(function(c){c=
b.detail().element();ja.inBody(c)?(h.moveTo(c,b.detail().severity()),Og.elementIntoView(a.content(),c)):d.skip()})});d.events.ignored.bind(function(a){a=a.detail();h.ignore(a.element(),a.id(),a.severity())});d.events.solved.bind(function(a){a=a.detail();h.solve(a.element(),a.id(),a.severity())});c=H.create({done:Q([],d.events.done)});return{element:d.element,anchorName:k("a11y-widget-anchor"),textkey:k("action.a11ycheck"),dialogTextkey:k("a11y.widget.title"),destroy:function(){d.destroy()},keylayouts:d.keylayouts,
openWidget:function(){a.content().hideInlineSelection();d.open();a.content().body().each(function(a){a=l(a);h.start(a);d.load(a)})},closeWidget:function(){h.stop()},events:c.registry}}function IU(a,b){var c=H.create({open:p([]),close:p([])}),d=r.fromTag("div");n.add(d,va.resolve("layer-menus"));n.add(d,va.resolve("toolstrip"));y.append(a(),d);a=function(){v.getRaw(d,"opacity").isNone()&&(e.cancel(),v.remove(d,"display"),c.trigger.close())};var e=uj(a,1E3),f=K.bind(d,"transitionend",a);return{element:function(){return d},
destroy:function(){f.unbind();G.remove(d)},open:function(){v.set(d,"display","block");v.reflow(d);c.trigger.open();v.set(d,"opacity","1")},close:function(){v.remove(d,"opacity");e.throttle()},setContent:function(a){y.append(d,a)},events:c.registry}}function Py(a,b,c,d){var e=a.content(),f=a.ui().tabstrip.element(),h=[b.element()],l="."+B.resolve(c)+", ."+va.resolve("more-button"),q=function(){var a=Y.descendants(f,l);return h.concat(a)},C=hd.api(),g=H.create({abort:p([]),open:p([]),close:p([])}),
k=function(){e.events.mousedown.unbind(F);C.clear();V.off()},F=function(){C.isSet()&&(b.closeWidget(),C.run(function(a){a.close()}))},V=oy(F,q);b.events.done.bind(function(){F()});var X=ha.multiple(b.element(),b.keylayouts());X.events.exit.bind(function(){g.trigger.abort()});return{destroy:function(){k();X.destroy();b.destroy();V.off()},events:g.registry,open:function(){V.on();b.openWidget();var c=IU(a.ui().dialogContainer,q);c.setContent(b.element());n.add(c.element(),d);var f=c.element();ma.add(f,
[B.resolve(b.anchorName()),B.resolve("side-widget-anchor")]);S.dialog(f,x.translate(b.dialogTextkey()));c.open();c.events.close.bind(function(){e.focus();g.trigger.close();k()});C.set(c);X.enter();g.trigger.open();e.events.mousedown.bind(F)},close:F,isOpen:C.isSet}}function JU(a){var b=a.filter();Sq.configure(b);var c=hd.api(),d=function(){var b=EU(a);b=Py(a,b,"a11y-check",KU);b.events.abort.bind(b.close);b.events.close.bind(f);c.set(b);b.open()},e=function(){c.run(function(a){a.close()})},f=function(){c.clear()};
return{ui:wb.ui({"a11ycheck.general":{toggle:!1,hasPopup:!1,value:"a11y-check",textkey:x.key("action.a11ycheck"),action:function(){(c.isSet()?e:d)()},updateGeneral:function(a){n.add(a.element(),B.resolve("a11y-check"))},icon:!0,tooltip:qb.get}}),destroy:f}}function Tq(a){return{change:function(b,c){return(a.directionAt(b).isRtl()?Qy.rtl:Qy.ltr).change(b,c)}}}function LU(a){var b=a.property(),c=function(a,c){return b.parent(a).map(b.name).map(function(a){return!U(c,a)}).getOr(!1)};return{validateText:function(a){return b.isText(a)&&
c(a,MU)}}}function NU(a,b){return{is:function(c){return v.get(c,a)===b},remove:function(b){v.remove(b,a)},set:function(c){v.set(c,a,b)}}}function OU(a){var b=a.content(),c=a.keyboard(),d=a.shortcuts(),e=a.context(),f=H.create({analytics:p(["message","properties"])}),h=u(ce.indent,a),l=u(ce.outdent,a),q=u(ce.blockquote,a);d.events.indent.bind(h);d.events.outdent.bind(l);d.events.blockquote.bind(q);var C=function(a){var c=a.stopper();bm.context(b).bind(function(b){bm.cata(b,t,function(b){(a.shift()?
l:h)();c()})})},w=c.editor();w.on();w.events.tab.bind(C);e.events.preLinebreak.bind(function(b){Uq.atQuoteBreak(a.content()).each(function(c){ce.breakQuote(a,c.quote(),c.element());b.handler().handle()})});var I=O("value","icon","textkey");c=I("justifyleft",g.some(va.resolve("justifyleft")),x.key("alignment.left"));d=I("justifycenter",g.some(va.resolve("justifycenter")),x.key("alignment.center"));e=I("justifyright",g.some(va.resolve("justifyright")),x.key("alignment.right"));var F=I("justifyfull",
g.some(va.resolve("justifyfull")),x.key("alignment.justify")),V=I("justifyleft",g.some(va.resolve("justifyleft")),x.key("alignment.left")),X=I("justifycenter",g.some(va.resolve("justifycenter")),x.key("alignment.center"));I=I("justifyright",g.some(va.resolve("justifyright")),x.key("alignment.right"));var m=[c,d,e,F],n=[V,X,I],r=function(){return vc.detect(b.getSelection()).fold(function(){return m},function(a){return n})},Dh={justifyleft:u(ce.imageLeft),justifycenter:u(ce.imageCentre),justifyright:u(ce.imageRight)},
v={justifyleft:ce.justifyLeft,justifycenter:ce.justifyCentre,justifyright:ce.justifyRight,justifyfull:ce.justifyFull},z=function(a){return a.toLowerCase()},y=g.none();return{ui:wb.ui({"indent.general":{value:"indent",textkey:x.key("action.indent"),action:h,updateGeneral:ca,tooltip:qb.get,toggle:!1},"outdent.general":{value:"outdent",textkey:x.key("action.outdent"),action:l,updateGeneral:ca,tooltip:qb.get,toggle:!1},"blockquote.general":{value:"blockquote",textkey:x.key("action.blockquote"),action:q,
updateGeneral:function(a){Uq.read(b).quoted().fold(a.deselect,t,a.select)},tooltip:qb.get,toggle:!0},"alignment.dropdown":{name:"alignment",textkey:x.key("alignment.toolbar"),menuTextkey:x.key("alignment.menu"),action:function(c){var d=vc.detect(b.getSelection()).fold(k(v),k(Dh));(void 0!==d[c]?d[c]:t)(a)},updateDropdown:function(a){var c=r(),d=Uq.read(b).alignment().fold(function(){return 0<c.length?Da.on(c[0].value()):Da.off()},Da.unchanged,Da.on);a.populate([{label:g.none,items:k(c)}]);cm.updateMenu(a,
d.map(z),Da.on(),c,y)},values:m,render:y,tooltip:qb.get,toggle:!1,describe:function(a){return x.translate("alignment.describe",x.get(a.textkey()))}}}),events:f.registry,destroy:function(){w.off();w.events.tab.unbind(C);w.destroy()}}}function PU(a,b){var c=function(a,b,c){var d=r.fromText(b);a(c,d);return g.some({element:k(d),cleanup:function(){G.remove(d)},splits:k([])})},d=function(a){return{none:g.none,start:u(c,y.before,a),end:u(c,y.after,a),middle:function(b,d,e){return c(y.after,a,d)}}},e=function(a){var b=
function(a){return function(b,c){y.appendAt(b,c,a)}};return{prepend:u(c,y.prepend,a),before:u(c,y.before,a),after:u(c,y.after,a),insertAt:function(d,e){return c(b(e),a,d)},append:u(c,y.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,insertAfter:e(b).after}}}function Ry(a,
b,c,d){c=[b].concat(c);var e=u(Vq.nuTag,b),f=u(Pg.relatedTags,c),h=Jc.tagList(c),l=Pg.queriesTag(b),q={nu:e,matches:f,purifiers:k(h)},C=function(a){var b=r.fromText(mb());dm.atStartOf(a.startContainer(),a.startOffset(),b);return Ub.hare(b,0,b,1)},w=function(a,b,c){return D.isText(b)&&c===Ya.get(b).length?wc.after(b,a).fold(function(){return W.point(b,c)},function(a){return W.point(a,0)}):W.point(b,c)},I=function(a,b,c){return D.isText(b)&&0===c?wc.before(b,a).fold(function(){return W.point(b,c)},
function(a){return W.point(a,wa.getEnd(a))}):W.point(b,c)},F=function(a,b){return b.map(function(b){var c=w(a,b.start(),b.soffset());b=I(a,b.finish(),b.foffset());return Ub.fussy(c.element(),c.offset(),b.element(),b.offset())})};c={nu:e,purifiers:k(h),isStyled:k(!0)};var V=["font-size"],X=function(a){return a.getSelection().map(function(a){var c=cb(d);c=Iq(c,V);return ob(c,function(c){return Pg.queryStyleOn(c,d[c],[b],a)})}).getOr(!1)};return{run:function(a,c){var d=c.doc();return Wq.detect(c,l.queryOn).fold(function(){return g.none()},
function(b){b=C(b);de.doRemoveUpto(a,h,b,f);return g.some(Ub.fromHare(b))},function(a){a=C(a);var c=r.fromTag(b,d.dom());n.add(c,Rb.styleSpan());y.wrap(a.startContainer(),c);return g.some(Ub.fussy(a.startContainer(),1,a.startContainer(),1))},function(b){b=de.doRemoveUpto(a,h,b,f);return F(a,b)},function(b){return Xq.run(c.doc(),a,b,q)})},query:function(a){return l.query(a)||X(a)},deferred:k(c),name:k(a)}}function Sy(a,b){return{element:k(b),wrap:function(c){a.insert().append(b,c)}}}function em(a,
b,c,d,e,f){var h=u(Vq.nu,d,e,b),l=u(Pg.relatedStyle,d,e,c),q=Jc.cssAndTag(c,d,e),C=Pg.queriesStyle(d,e,c),w=k(!0),I=function(b,c){gf.generic(b,t,w,function(b){n.add(b,Rb.styleSpan());v.set(b,d,c);m.set(b,Rb.overrideSpan(),a);v.reflow(b)});return g.none()};b={nu:h,purifiers:k(q),isStyled:function(a){return"span"===D.name(a)&&vj.rawState(a,d,e)},matches:l};return{run:function(a,b){return Wq.detect(b,C.queryOn).fold(function(){return g.none()},function(a){return I(b,f)},function(a){return I(b,e)},function(b){return de.doRemoveUpto(a,
q,b,l)},function(c){return Xq.run(b.doc(),a,c,{nu:h,matches:l,purifiers:k(q)})})},query:function(b){var c="["+Rb.overrideSpan()+'="'+a+'"]';return b.getSelection().bind(function(a){return L.closest(a.startContainer(),c).bind(function(b){return L.closest(a.endContainer(),c).bind(function(a){return N.eq(b,a)?v.getRaw(b,d).map(function(a){return a===e}):g.none()})})}).getOrThunk(function(){return C.query(b)})},deferred:k(b),name:k(a)}}function QU(a){var b=a.content(),c=a.shortcuts(),d=a.undo(),e=H.create({analytics:p(["message",
"properties"])}),f=function(a,c){var d=RU.read(b);(void 0!==d[a]?d[a]():Da.unchanged()).fold(c.deselect,t,c.select)},h=function(c){var e=function(a){return c(b.isRoot,a)};return function(){Zb.cata(a.selections().get(),t,fm.multiple(b,d,e),fm.single(b,d,e));b.uiChanged()}},l=h(rd.bold),q=h(rd.italic),C=h(rd.underline),g=h(rd.strikethrough),k=h(rd.subscript),F=h(rd.superscript);h=h(rd.removeformat);c.events.bold.bind(l);c.events.italic.bind(q);c.events.underline.bind(C);return{ui:wb.ui({"bold.general":{toggle:!0,
value:"bold",textkey:x.key("action.bold"),action:l,updateGeneral:u(f,"bold"),icon:!0,tooltip:qb.get},"italic.general":{toggle:!0,value:"italic",textkey:x.key("action.italic"),action:q,updateGeneral:u(f,"italic"),icon:!0,tooltip:qb.get},"underline.general":{toggle:!0,value:"underline",textkey:x.key("action.underline"),action:C,updateGeneral:u(f,"underline"),icon:!0,tooltip:qb.get},"strikethrough.general":{toggle:!0,value:"strikethrough",textkey:x.key("action.strikethrough"),action:g,updateGeneral:u(f,
"strikethrough"),icon:!0,tooltip:qb.get},"removeformat.general":{toggle:!1,value:"removeformat",textkey:x.key("action.removeformat"),action:h,updateGeneral:ca,icon:!0,tooltip:qb.get},"subscript.general":{toggle:!0,value:"subscript",textkey:x.key("action.subscript"),action:k,updateGeneral:u(f,"subscript"),icon:!0,tooltip:qb.get},"superscript.general":{toggle:!0,value:"superscript",textkey:x.key("action.superscript"),action:F,updateGeneral:u(f,"superscript"),icon:!0,tooltip:qb.get}}),events:e.registry,
destroy:t}}function Ty(a){var b=function(b,d,e,f){var c=e.join(",");b=a.up().closest(b,c,f);d=a.up().closest(d,c,f);return b.isSome()&&d.isSome()?(f=b.getOrDie("Just checked it was some."),d=d.getOrDie("Just checked it was some."),a.eq(f,d)?qa(e,u(a.is,f)):g.none()):g.none()};return{query:function(a,d,e){d=d.concat(SU.tags());return b(a.startContainer(),a.endContainer(),d,e)},queryAll:b}}function Uy(a,b){var c=O("base","value","textkey","icon","styles","tag"),d=a.styles;a=b.map(u(TU,a.showDocumentStyles)).getOr([]);
d=d.concat(a);d=E(d,function(a){return{name:a.rule,text:g.from(a.text).map(x.raw),style:void 0===a.style?{}:a.style}});var e={};z(d,function(a){UU.decipher(a).each(function(b){e[a.name]=b})});d=Jb;a=fd;b=function(a,b,c,d){return function(e){return Rf.cata(e,a,b,c,d)}};var f=Ze(e),h=ka(f,b(a,a,a,d)),l=ka(f,b(a,a,d,a)),q=ka(f,b(a,d,a,a)),C=ka(f,b(d,a,a,a));d=function(){var a=h.concat(q).concat(l).concat(C);return E(a,function(a){return Rf.cata(a,function(a,b,c){return"."+a},function(a,b,c,d){return a+
"."+b},function(a,b,c){return a},function(a,b,c,d){return a+"."+b})})}();var w=function(a){return void 0!==e[a]?g.some(e[a]):g.none()},I=function(a){return Rf.cata(a,function(a,b,d){return c("span","."+a,b,g.none(),d,"span")},function(a,b,d,e){return c(a,a+"."+b,d,g.none(),e,"span")},function(a,b,d){return c(a,a,b,g.none(),d,a)},function(a,b,d,e){return c(a,a+"."+b,d,g.none(),e,a)})};a=function(){var a=Ze(e);return E(a,I)}();return{candidateByName:function(a){return w(a).map(I)},toCandidate:I,ruleByName:w,
divisions:function(){return{classblocks:k(h),blocks:k(l),objects:k(q),inlines:k(C)}},backup:function(a){return c(a,a,x.key("block."+a),g.none(),{},"span")},selectors:k(d),everything:k(a)}}function VU(a,b,c){var d=c(void 0===b||"default"===b?g.none():g.some(b)),e=r.fromTag("div");n.add(e,B.resolve("list-style-option"));c=void 0===b||"default"===b?WU(e,"ul"===a?"list.unordered.default":"list.ordered.default"):XU(a,b);y.append(e,c);a=x.translate(("ul"===a?"list.unordered.":"list.ordered.")+b);m.set(e,
"title",a);S.label(e,a);S.menuItemCheckbox(e);var f=ib.describe(e,x.translate("aria.widget.navigation"));y.append(e,f);var h=H.create({action:p(["type","element"])}),l=function(){ra.checked(e,!0);n.add(e,B.resolve("list-style-selected"))},q=function(){ra.checked(e,!1);n.remove(e,B.resolve("list-style-selected"))},C=K.bind(e,"click",function(a){h.trigger.action(d,g.some(e))});return{element:k(e),instance:d,style:b,update:function(a){(d.query(a)&&d.queryStyle(a)?Da.on(!0):Da.off()).fold(q,t,l)},select:l,
deselect:q,events:h.registry,destroy:function(){C.unbind();G.remove(e);G.remove(f)}}}function YU(a,b,c){var d=H.create({action:p(["type"])}),e=T.div();n.add(e,B.resolve("list-style-palette"));var f=E(a,function(a){return VU("bullist"===b?"ul":"ol",a,c)});z(f,function(a){a.events.action.bind(function(a){a.element().each(l);d.trigger.action(a.type())});y.append(e,a.element())});var h=function(){var a=Math.floor(f.length/4)+(0<f.length%4?1:0);return ha.grid(e,{cell:k("."+B.resolve("list-style-option"))},
a,4,Ba.grid({trigger:function(a){a.dom().click();return g.some(a)}}))}(),l=function(a){L.sibling(a,"["+gm+'="default"]').filter(function(b){return b!==a}).each(function(b){m.remove(b,gm);m.set(a,gm,"default")})};return{enter:h.enter,element:k(e),update:function(a){z(f,function(b){b.update(a)})},events:d.registry,destroy:function(a){h.isFocused()&&h.exit();h.destroy();z(f,function(a){a.destroy()});G.remove(e)},findDefault:function(){return qa(f,function(a){return m.has(a.element(),gm)}).map(function(a){return a.instance})}}}
function Vy(a){var b=a.region(),c=a.content(),d=a.undo(),e=a.keyboard(),f=a.listConstructor(),h=a.type(),l=a.styles(),q=a.textkey(),C=a.menuTextkey(),g=f("default"),I=aa.detect(),F=e.all();F.swallowKeys([R.ESCAPE()]);var V=H.create({abort:p([]),done:p([]),close:p([]),analytics:p(["message"])});F.events.escape.bind(function(a){V.trigger.abort()});var X=function(e,f){var h=Ih.list(function(a,c,d,h,l){return e.apply(a,c,d,h,l,Tq(b),f)},b,c,d,a.selections());V.trigger.done();c.focus();return h},m=function(){L.descendant(n.element(),
'[data-ephox-polish-list-style="default"]').each(function(a){Z.focus(a)})},n=YU(l,h,f);n.events.action.bind(function(a){X(a.type(),!1)});return{action:function(){var a=n.findDefault().getOr(g);X(a,!0)},element:n.element,shortcut:!1,textkey:k(q),menuTextkey:k(C),label:k(!1),name:k(h),tooltip:qb.get,toggle:!0,value:h,updateWidget:function(a){c.getSelection().each(function(b){var c=g.query(b)?Da.on(!0):Da.off();c.fold(a.deselect,t,a.select);c.fold(a.release,t,a.press);n.update(b)})},open:function(){I.deviceType.isTouch()||
m();F.on()},close:function(){F.off();V.trigger.close()},icon:!0,events:V.registry,enter:n.enter,destroy:function(){F.off();F.destroy();n.destroy()}}}function ZU(a,b,c){var d=function(b){if("p"===D.name(b))return Wy.replace(a,b,"li");var c=r.fromTag("li");y.before(b,c);y.append(c,b);return c},e=function(a){var d=r.fromTag(b);c.each(function(a){v.set(d,"list-style-type",a)});y.before(a[0],d);P.append(d,a);g.from(m.get(a[0],"dir")).each(function(a){m.set(d,"dir",a)});return d},f=function(a){var d=Pc.mutate(a,
b);c.fold(function(){v.remove(d,"list-style-type")},function(a){v.set(d,"list-style-type",a)});return d},h=function(a){var b=k(!0),c=k(!1);return a.fold(b,c,c)},l=function(a,b){return function(c){return wj.cata(c,function(c){var d=Y.descendants(c,"li");return 0<d.length?(c=d[0],d=d[d.length-1],c=kc.first(c).getOr(c),d=kc.last(d).getOr(d),Yq.outdent(a,c,0,d,wa.getEnd(d),b).map(function(a){return a.all()})):g.none()},g.none,g.none).getOr([])}},q=function(a){return wj.cata(a,function(a){return[a]},function(a){return[f(a)]},
function(a){a=E(a,d);e(a);return a})};return{apply:function(a,d,e){e=$U.categorise(e,b,c);a=ob(e,h)?l(a,d):q;return ia(e,a)}}}function aV(a,b){var c=H.create({analytics:p(["message"])}),d=Uy(b,g.none()),e=a.region(),f=a.content(),h=a.undo();f.events.stylesheetLoad.bind(function(a){d=Uy(b,g.some(a.sheets()));f.uiChanged()});var l=g.some(Xy.format),q=f.isRoot,C=function(a){bV.deviceType.isiOS()&&z(hm(ee(E(a,function(a){return L.ancestor(a,"ul,ol",q)})),function(a){return a.dom()}),function(a){var b=
v.get(a[0],"list-style-type");v.set(a[0],"list-style-type","none");setTimeout(function(){v.set(a[0],"list-style-type",b)},0)})},w=function(){return Zb.cata(a.selections().get(),k([]),function(a){return 0<a.length?Yy.groups(d,a[0]):[]},function(a,b){return Yy.groups(d,a.startContainer(),q)})},I=function(a){var b=se.hasSelection(f),c=cV.read(f,d),e=w();a.populate(e);cm.updateMenu(a,c.tag(),b.content(),d.everything(),g.none())},F=function(b){d.ruleByName(b).each(function(b){Rf.cata(b,function(b,c,d){Ih.inline(e,
f,h,a.selections(),b)},function(b,c,d,l){Ih.setClass(e,f,h,a.selections(),b,c)},function(b,c,d){Ih.transform(e,f,h,a.selections(),b).each(function(a){z(a,function(a){m.remove(a,"class")});C(a)})},function(b,c,d,l){Ih.transform(e,f,h,a.selections(),b).each(function(a){z(a,function(a){m.set(a,"class",c)});C(a)})});f.uiChanged()})},V=Aa("region content undo selections keyboard listConstructor type styles textkey menuTextkey".split(" "),[]),X=V({region:e,content:f,undo:h,selections:a.selections(),keyboard:a.keyboard(),
listConstructor:u(im.unordered,q),type:"bullist",styles:["default","disc","circle","square"],textkey:x.key("action.bullist"),menuTextkey:x.key("list.unordered.menu")});V=V({region:e,content:f,undo:h,selections:a.selections(),keyboard:a.keyboard(),listConstructor:u(im.ordered,q),type:"numlist",styles:"default decimal upper-alpha lower-alpha upper-roman lower-roman lower-greek".split(" "),textkey:x.key("action.numlist"),menuTextkey:x.key("list.ordered.menu")});var Hc=function(a){return x.translate("block.describe",
x.get(a.textkey()))};X=u(Vy,X);V=u(Vy,V);return{ui:wb.ui({"blocktag.dropdown":function(){return{name:"blocktag",textkey:x.key("block.styles"),menuTextkey:x.key("block.menu"),updateDropdown:I,action:F,values:d.everything(),render:l,tooltip:qb.get,toggle:!1,describe:Hc}},"bullist.widget":X,"numlist.widget":V,"bullist.general":k(Zy.ul(a)),"numlist.general":k(Zy.ol(a))},ca),events:c.registry,destroy:t}}function jb(a,b,c,d){return{context:a,profile:b,action:c,label:k(d)}}function dV(a){var b=a.content(),
c=hd.destroyable();return{ui:wb.ui({"bookmark.general":{toggle:!1,value:"bookmark",textkey:x.key("insert.bookmark"),action:function(){b.getSelection().each(function(a){var c=r.fromTag("span"),d=b.getSelectedText().fold(function(){return jm.generate("textbox-bookmark")},function(a){a=50<a.length?a.substr(0,50):a;return jm.generate(Ld.getAnchorValue(a,"textbox-bookmark"))});m.set(c,"id",d);a=id.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())?Sc(a.endContainer(),a.endOffset(),
a.endContainer(),a.endOffset()):Sc(a.startContainer(),a.startOffset(),a.startContainer(),a.startOffset());var h=r.fromText(mb());sd.insertAt(b,a,[c,h]).each(function(a){var c=A.nextSibling(a.element()).filter(function(a){return wa.isCursorPosition(a)&&!N.eq(h,a)}).getOrThunk(function(){var b=r.fromText(" ");y.after(a.element(),b);return b});b.win().each(function(a){Wa.setExact(a,c,0,c,0)})})})},updateGeneral:t,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:function(){c.clear()}}}function eV(a,
b){return{is:function(c){return m.get(c,a)===b},remove:function(b){m.remove(b,a)},set:function(c){m.set(c,a,b)}}}function fV(a){var b=a.content(),c=H.create({analytics:p(["message","properties"])}),d=function(a,c){$y.readDir(b).map(function(b){return b[a]}).fold(Da.unchanged,xb).fold(c.deselect,t,c.select)};return{ui:wb.ui({"ltrdir.general":{value:"ltrdir",textkey:x.key("directionality.ltrdir"),action:u(az.dirLtr,a),updateGeneral:u(d,"ltrdir"),toggle:!0},"rtldir.general":{value:"rtldir",textkey:x.key("directionality.rtldir"),
action:u(az.dirRtl,a),updateGeneral:u(d,"rtldir"),toggle:!0}}),events:c.registry,destroy:t}}function bz(a,b){return cz(document.createElement("canvas"),a,b)}function dz(a){return a.getContext("2d")}function cz(a,b,c){a.width=b;a.height=c;return a}function ez(a,b){return new (Kc.getOrDie("Blob"))(a,b)}function Zq(){return new (Kc.getOrDie("FileReader"))}function fz(a){return new (Kc.getOrDie("Uint8Array"))(a)}function gz(a){return new Md(function(b,c){function d(){l();b(h)}function e(){l();c("Unable to load data of type "+
a.type+": "+f)}var f=URL.createObjectURL(a),h=new Image,l=function(){h.removeEventListener("load",d);h.removeEventListener("error",e)};h.addEventListener("load",d);h.addEventListener("error",e);h.src=f;h.complete&&d()})}function hz(a){return new Md(function(b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="blob";d.onload=function(){200==this.status&&b(this.response)};d.onerror=function(){if(0===this.status){var a=Error("No access to download image");a.code=18;a.name="SecurityError"}else a=
Error("Error "+this.status+" downloading image");c(a)};d.send()})}function iz(a){var b=a.split(",");a=/data:([^;]+)/.exec(b[0]);if(!a)return g.none();a=a[1];b=km.atob(b[1]);for(var c=b.length,d=Math.ceil(c/1024),e=Array(d),f=0;f<d;++f){for(var h=1024*f,l=Math.min(h+1024,c),q=Array(l-h),C=0;h<l;++C,++h)q[C]=b[h].charCodeAt(0);e[f]=fz(q)}return g.some(ez(e,{type:a}))}function $q(a){return new Md(function(b,c){iz(a).fold(function(){c("uri is not base64: "+a)},b)})}function jz(a){return new Md(function(b){var c=
new Zq;c.onloadend=function(){b(c.result)};c.readAsDataURL(a)})}function ar(a,b,c){function d(b,c){return a.then(function(a){return jd.canvasToDataURL(a,b,c)})}return{getType:k(b.type),toBlob:function(){return Md.resolve(b)},toDataURL:function(){return c},toBase64:function(){return c.split(",")[1]},toAdjustedBlob:function(b,c){return a.then(function(a){return jd.canvasToBlob(a,b,c)})},toAdjustedDataURL:d,toAdjustedBase64:function(a,b){return d(a,b).then(function(a){return a.split(",")[1]})},toCanvas:function(){return a.then(Uc.clone)}}}
function kz(a){return jd.blobToDataUri(a).then(function(b){return ar(jd.blobToCanvas(a),a,b)})}function gV(a){var b=a.filter();b.addSelector(b.output(),"a[data-ephox-href]",Na.removeAttr("data-ephox-href"));b.addSelector(b.output(),"img[data-ephox-src]",Na.removeAttr("data-ephox-src"));var c=H.create({insertAssets:p(["assets"]),insertHtml:p(["html"])}),d=a.content(),e=g.none(),f=function(a){d.win().each(function(b){Wa.getAtPoint(b,a.x(),a.y()).each(function(a){Wa.setExact(b,a.start(),a.soffset(),
a.finish(),a.foffset())})})},h=function(a){f(a);c.trigger.insertAssets(a.assets())},l=function(b){f(b);b=b.html();a.undo().save();b=qe.fromHtml(b);sd.insertAtCursor(d,b)};d.events.ready.bind(function(a){var b=a.api(),c=g.none();e=g.some(hV.forImages(a.api().canvas(),c,!0));e.each(function(a){var c=function(a){var b=function(a,b,c){var d=m.get(a,c);d!==m.get(a,b)&&m.set(a,b,d);m.remove(a,c)};z(a,function(a){"a"===D.name(a)&&m.has(a,"data-ephox-href")?b(a,"href","data-ephox-href"):"img"===D.name(a)&&
m.has(a,"data-ephox-src")&&b(a,"src","data-ephox-src")})};b.events.mousedown.bind(function(){b.getSelection().each(function(d){var e=xj.findDescendants(d.startContainer(),d.startOffset(),d.endContainer(),d.endOffset(),"a,img"),f=0<e.length?e:xj.findAncestors(d.startContainer(),d.endContainer(),"a,img");if(0<f.length){lz.processLinksAndImages(b,f);var h=function(){b.events.mouseup.unbind(l);a.events.dragend.unbind(l);a.events.dragndropinternal.unbind(h)},l=function(){c(f);h()};b.events.mouseup.bind(l);
a.events.dragend.bind(l);a.events.dragndropinternal.bind(h)}})});a.events.dragndropimages.bind(h);a.events.dragndrophtml.bind(l);a.events.dragndropinternal.bind(function(){c(Fa.all("a[data-ephox-href],img[data-ephox-src]",b.body()))})})});return{events:c.registry,destroy:function(a){e.each(function(a){a.destroy()})}}}function lm(a,b){var c=void 0!==b?b:36E5,d=O("result","timestamp"),e={},f=function(a,b,c){e[a]=d(b,c)};b=function(a){var b=yj.now();eb(a,function(a,d){b-a.timestamp<c&&f(d,a.result,a.timestamp)})};
ic(a)&&b(a);return{set:f,get:function(a,b){return g.from(e[b]).filter(function(b){return a-b.timestamp()<c}).map(function(a){return a.result()})},dump:function(){return eb(e,function(a){return{result:a.result(),timestamp:a.timestamp()}})}}}function iV(a){return Ga.nu(function(b){var c=Zq();c.onload=function(a){b(a.target.result)};c.readAsText(a)})}function jV(a,b,c){var d=lm(c),e=mm.get("ephox.media.service.one",br.requestOne(),a+"/1/embed?url=${url}&maxWidth=${maxWidth}",b);return{checkOne:function(a,
b,c){var f=yj.now();c=nm.single(function(c,d){return e.execute({url:encodeURIComponent(a),maxWidth:b,fresh:d})},d,b+"&"+a,f,void 0!==c?c:!1);return hf.foldSync(c,mz.failed,mz.success)},dumpCache:d.dump}}function kV(a,b,c){var d=cr.embedChecking(),e=a.internalevents(),f=a.communication(),h=jV(c.url,f.newHeaders(),b.cache),l=a.undo(),q=a.content();a=a.filter();cr.configure(a);var C=["img","video","audio"],g=function(a,b){y.after(a,b);G.remove(a)},k=function(a,b){n.add(a,d);var e=h.checkOne(b,400);hf.handle(e,
function(b){n.remove(a,d)},function(e){n.remove(a,d);l.save();var f=lV(e.recommended().html().trim());U(C,D.name(f))||m.set(f,"data-ephox-embed-iri",b);var h=r.fromTag("div");y.append(h,f);c.inlineStyles&&q.doc().each(function(a){nz.inlinePrefixedStyles(a,h,".ephox-summary-card")});q.getSelection().fold(function(){g(a,f)},function(b){var c=N.eq(b.startContainer(),a)||N.contains(a,b.startContainer());g(a,f);var d=A.nextSibling(f).filter(wa.isCursorPosition).getOrThunk(function(){var a=r.fromTag("br");
y.after(f,a);return a});(c||A.parent(f).filter(function(a){return b.collapsed()&&(N.eq(b.startContainer(),a)||N.contains(a,b.startContainer()))}).isSome())&&q.setSelection(d,0,d,0)})})},F=function(a){var b=a.command(),c=a.data();m.has(c,rb.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==b||A.parent(c).each(function(a){var b=Vb.get(a).replace(mb(),""),d=m.get(c,"href");if(b===d||"http://"+b===d)k(c,d);else{var e=A.children(a),f=qa(kd(e),function(a){return"br"===D.name(a)&&om.documentPositionPreceding(c.dom(),
a.dom())}).map(function(a){a=Gc(e,a).getOr(-1);return e.slice(a+1,e.length)}).getOr(e);a=qa(e,function(a){return"br"===D.name(a)&&om.documentPositionPreceding(a.dom(),c.dom())}).map(function(a){a=Gc(f,a).getOr(0);return f.slice(0,a)}).getOr(f);a=hb(a,function(a,b){return a+Vb.get(b)},"").replace(mb(),"");a!==d&&"http://"+a!==d||k(c,d)}})};e.events.internal.bind(F);return{destroy:function(){e.events.internal.unbind(F)},state:function(){return{cache:h.dumpCache()}}}}function oz(a){var b=function(){return null===
a.project.apiKey?{}:{"textbox-api-key":a.project.apiKey}},c=function(a){var b=a+(-1===a.indexOf("?")?"?":"&")+"url=";return function(a){return g.some(b+encodeURIComponent(a))}};c=void 0===a.imageEdit.proxy?g.none:c(a.imageEdit.proxy);return{headers:function(){return{headers:b(),xhrFields:{withCredentials:!0}}},newHeaders:b,proxy:c,destroy:t}}function mV(a){var b="true"===m.get(a,"contenteditable");m.set(a,"contenteditable","true");var c=K.bind(a,"keydown",function(a){A.trigger.keydown(a)}),d=K.bind(a,
"keyup",function(a){A.trigger.keyup(a)}),e=K.bind(a,"keypress",function(a){A.trigger.keypress(a)}),f=K.bind(a,"mousedown",function(a){A.trigger.mousedown(a)}),h=K.bind(a,"mouseout",function(a){A.trigger.mouseout(a)}),l=K.bind(a,"mouseup",function(a){A.trigger.mouseup(a)}),q=K.bind(a,"contextmenu",function(a){A.trigger.contextmenu(a)}),C=K.bind(a,"cut",function(a){A.trigger.cut(a)}),w=K.bind(a,"copy",function(a){A.trigger.copy(a)}),I=K.bind(a,"paste",function(a){A.trigger.paste(a)}),F=K.bind(r.fromDom(document),
"selectionchange",function(a){A.trigger.selectionchange(a)}),V=function(){A.trigger.paint()},X=K.capture(a,"load",V);pz.bind(a,V);var Hc=qz.browser.isFirefox()?"focus":"focusin",u=K.bind(a,Hc,function(a){A.trigger.focus(a)}),v=K.bind(a,"focusout",function(a){A.trigger.focusOut(a)}),y=K.bind(a,"dblclick",function(a){A.trigger.dblclick(a)}),x=function(b){return N.eq(a,b)};Hc={loaded:Ga.pure(J.error("no iframe in inline mode")),stylesheetLoad:Ga.pure(g.none())};var A=H.create({keydown:p(["original"]),
keyup:p(["original"]),keypress:p(["original"]),mousedown:p(["original"]),mouseup:p(["original"]),mouseout:p(["original"]),contextmenu:p(["original"]),cut:p(["original"]),copy:p(["original"]),paste:p(["original"]),focus:p(["original"]),dblclick:p(["original"]),focusOut:p(["original"]),selectionchange:p(["original"]),paint:p([])}),B=k(g.from(document.baseURI).getOr(window.location.href));return{win:k(window),doc:k(r.fromDom(document)),body:k(a),baseURI:B,get:function(){return Ea.get(a)},set:function(b){Ea.set(a,
b)},focus:function(){qz.browser.isIE()?a.dom().setActive(!0):Z.focus(a)},focused:function(){return document.activeElement===a.dom()},blur:function(){a.dom().blur()},destroy:function(){b||m.remove(a,"contenteditable");z([c,d,e,f,l,h,q,C,w,I,u,v,y,F,X],function(a){a.unbind()});pz.unbind(a,V)},events:A.registry,futures:Hc,background:t,foreground:t,hasRange:function(a){return Ja.closest(a.startContainer(),x).isSome()&&Ja.closest(a.endContainer(),x).isSome()},isActive:function(){return n.has(a,be.active())}}}
function rz(a,b,c){var d=u(N.eq,b),e=function(c){var e=kb.freefallRtl(b).element();return L.ancestor(e,"table",d).filter(nV(a,c)).map(sz.above)},f=function(b,d,e,f,g){b.kill();Wa.setExact(a,d,e,f,g);c()};return function(c){var h=c.y();e(h).orThunk(function(){var c=kb.freefallLtr(b).element();return L.ancestor(c,"table",d).filter(oV(a,h)).map(sz.below)}).fold(function(){if("html"===D.name(c.target())){var e=c.x(),h=c.y();Wa.getAtPoint(a,e,h).each(function(a){var e=function(a){return L.closest(a,'[contenteditable="false"]',
d).isSome()},h=e(a.start());e=e(a.finish());(h||e)&&pm.browser.isIE()||Z.focus(b);if(pm.browser.isIE()&&1===A.childNodesCount(b)&&(h=A.children(b)[0],"p"===D.name(h)&&0===A.childNodesCount(h))){y.append(h,r.fromTag("br"));f(c,h,0,h,0);return}f(c,a.start(),a.soffset(),a.finish(),a.foffset())})}},function(a){var b=r.fromHtml("<p><br /></p>");a.fold(function(a){y.after(a,b)},function(a){y.before(a,b)});f(c,b,0,b,0)})}}function tz(a){var b=null,c=function(){b=null;$b.get(a.win()).each(function(b){b.collapsed()&&
a.focused()&&d.trigger.loiter(b.startContainer(),b.startOffset())})},d=H.create({loiter:p(["node","offset"])});return{reset:function(){null!==b&&(clearTimeout(b),b=null);b=setTimeout(c,1E3)},destroy:function(){null!==b&&(clearTimeout(b),b=null)},events:d.registry}}function uz(a,b){var c=g.none(),d=Hd.tap(function(){d.control.block();var f=a();f.filter(function(a){return ja.inBody(a.startContainer())}).each(function(a){var d=function(){e.trigger.nodeChanged(a.startContainer(),a.startOffset(),c.map(function(a){return a.startContainer()}))};
c.fold(d,function(c){var e=N.eq,f=a.startContainer(),h=a.endContainer(),l=c.startContainer(),q=c.endContainer(),g=c.startOffset()!==a.startOffset();c=c.endOffset()!==a.endOffset();(!e(l,f)||!e(q,h)||!D.isText(f)&&g||!D.isText(h)&&c)&&!1===pV([a.startContainer()],b)&&d()})});c=f;d.control.unblock()}),e=H.create({nodeChanged:p(["node","offset","prev"])});return{update:function(){d.instance()},clear:function(){c=g.none()},destroy:function(){c=g.none();d.control.block()},events:e.registry}}function qV(){var a=
g.none();return{get:function(){return a},restore:function(b){a.each(b)},update:function(b){a=b.or(a)},clear:function(){a=g.none()}}}function rV(a,b){var c=function(){return V().orThunk(f.get)},d=K.bind(a.body(),"click",rz(a.win(),a.body(),t)),e=uz(c,b),f=qV(),h=function(){e.update();F()},l=function(){f.restore(function(a){X(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})};e.events.nodeChanged.bind(function(a){x.trigger.nodeChanged(a.node(),a.offset(),a.prev());x.trigger.uiStale()});
a.events.keyup.bind(function(a){x.trigger.keyup(a.original());h();q.reset();x.trigger.interaction()});a.events.mouseout.bind(function(a){F()});a.events.mouseup.bind(function(a){x.trigger.mouseup(a.original());h();q.reset();x.trigger.interaction()});var q=tz(a);q.events.loiter.bind(function(a){x.trigger.loiter(a.node(),a.offset())});var C=function(){V().isNone()?l():F()},g=function(){a.isActive()&&(C(),vz.focus(a,c,n))},k=function(){x.trigger.domChanged()},F=function(){var a=V();f.update(a)},V=function(){return $b.get(window).filter(a.hasRange)},
X=function(a,b,c,d){try{$b.setExact(window,a,b,c,d)}catch(Goa){console.log("Skipping restoring invalid cursor position")}},m=function(b){v(function(c){a.isActive()&&b();h()},dr.build(a.focused,C,g,r.fromDom(document)))},n=function(a,b,c,d){m(function(){X(a,b,c,d)})},u=function(a,b){var c=$b.get(window);l();a=a(b);b.toOld();c.each(function(a){X(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());sV.browser.isEdge()&&(b.isSet()||b.toOld())});return a},v=function(a,b){a=a(b);b.toOld();
return a},z=function(b){var c=dr.build(a.focused,C,g,r.fromDom(document));return(V().isSome()?v:u)(b,c)};b=function(a){return function(){var b=arguments;return z(function(c){c.toEditor();return a(b)})}}(function(a){document.execCommand.apply(document,a);F()});var y=function(a,b){return Ra(a,b)},x=H.create({nodeChanged:p(["node","offset","prev"]),loiter:p(["node","offset"]),uiStale:p([]),domChanged:p([]),interaction:p([]),keyup:p(["original"]),mouseup:p(["original"]),keydown:Q(["original"],a.events.keydown),
keypress:Q(["original"],a.events.keypress),mousedown:Q(["original"],a.events.mousedown),contextmenu:Q(["original"],a.events.contextmenu),cut:Q(["original"],a.events.cut),copy:Q(["original"],a.events.copy),paste:Q(["original"],a.events.paste),focus:Q(["original"],a.events.focus),focusOut:Q(["original"],a.events.focusOut),dblclick:Q(["original"],a.events.dblclick),selectionchange:p(["original"]),paint:Q([],a.events.paint)});a.events.selectionchange.bind(function(a){V().each(function(){x.trigger.selectionchange(a.original())})});
return{win:a.win,doc:a.doc,body:a.body,baseURI:a.baseURI,canvas:a.body,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);f.clear();e.clear();b=kb.freefallLtr(a.body());n(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){dr.toEditor(a.focused,C,g,r.fromDom(document))},uiChanged:function(){z(function(){x.trigger.uiStale()})},domChanged:k,clearSelection:function(){$b.clearAll(window)},getSelection:c,setSelection:n,setRelativeSelection:function(a,b){m(function(){$b.setRelative(window,
a,b)})},backupSelection:F,replaceSelection:function(a){V().fold(function(){l();V().each(function(){$b.replace(window,a);h()})},function(b){$b.replace(window,a);h()})},execCommand:b,destroy:function(){a.destroy();q.destroy();d.unbind();e.destroy()},events:x.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:y,translateLocation:y}}function er(){var a=null,b=[],c=function(){return null!==a},d=function(){z(b,function(a){e(a)})},e=function(b){setTimeout(function(){b.apply(null,
a)},0)};return{get:function(a){c()?e(a):b.push(a)},set:function(){a=Array.prototype.slice.call(arguments);d();b=[]},isSet:c}}function tV(a,b,c){var d=r.fromTag("div");S.presentation(d);v.set(d,"display","none");var e=Ea.get(a);(function(b){var c=A.owner(a);z(b,function(a){uV.addLinkIfMissing(c,a)})})(b);b=er();var f=mV(a),h=rV(f,c);b.set(h);return{element:function(){return a},onCanvas:function(a){a(h.canvas())},initial:k(e),placeholder:function(){return d},tabindex:function(b){m.set(a,"tabindex",
b)},destroy:function(){G.remove(d);h.destroy()},loaded:b.get,isInline:k(!0)}}function vV(a,b){var c=a.doc();return{execCommand:function(a){var d=arguments,f=a.toLowerCase(),h=yb("This should not be in hare.");h={fontsize:h,forecolor:h,fontname:h,bgcolor:h,inserthtml:h,blockquote:h};(void 0!==h[f]?h[f]:function(){c.dom().execCommand.apply(c.dom(),d)})();b.update()}}}function wV(a){var b=function(){return $b.get(a.win())},c=function(b,c,f,h){b=Sc(b,c,f,h);$b.set(a.win(),b)};return{clearSelection:function(){$b.clearAll(a.win())},
getSelection:b,replaceSelection:function(b){$b.replace(a.win(),b)},setSelection:c,setRelativeSelection:function(b,c){$b.setRelative(a.win(),b,c)},restore:t,backup:t,nativeCall:xb,focus:function(){vz.focus(a,b,c)},destroy:t,clear:t}}function xV(a,b){var c=g.none(),d=K.bind(b,"blur",function(a){f()}),e=function(){c=g.none()},f=function(){$b.get(a.win()).fold(t,function(a){c=g.some(a)})},h=function(b,d){try{d(a.win(),b),c=g.some(b)}catch(F){wz()}},l=function(a){h(a,$b.set)},q=function(){c.each(l)},C=
function(a){var b=document.activeElement;a=a();null!==b&&void 0!==b&&b!==document.activeElement&&void 0!==b.focus&&b.focus();return a};return{clearSelection:function(){Z.hasFocus(b)&&$b.clearAll(a.win())},getSelection:function(){return Z.hasFocus(b)?$b.get(a.win()):c},replaceSelection:function(c){Z.hasFocus(b)||q();$b.replace(a.win(),c)},setSelection:function(a,c,d,e){C(function(){var f=Sc(a,c,d,e);Z.hasFocus(b)?l(f):h(f,t)})},setRelativeSelection:function(b,c){C(function(){e();try{$b.setRelative(a.win(),
b,c)}catch(F){wz()}f()})},restore:q,backup:f,nativeCall:function(a){return C(function(){Z.hasFocus(b)||q();return a()})},focus:function(){if(document.activeElement!==b.dom()){var d=c;a.focus();d.each(l)}else $b.get(a.win()).fold(q,t)},destroy:function(){d.unbind()},clear:e}}function yV(a,b,c){var d=aa.detect(),e=d.browser.isIE()||d.browser.isEdge()?xV(a,b):wV(a),f=K.bind(a.doc(),"click",rz(a.win(),a.body(),e.backup)),h=function(){return e.getSelection()},l=uz(h,c),q=vV(a,l);(d.browser.isChrome()||
d.browser.isSafari())&&q.execCommand("defaultParagraphSeparator",!1,"p");l.events.nodeChanged.bind(function(a){X.trigger.nodeChanged(a.node(),a.offset(),a.prev());X.trigger.uiStale()});a.events.keyup.bind(function(a){e.backup();l.update(a)});var C=jf(l.update,300);a.events.mouseup.bind(function(a){e.backup();C.throttle(a)});var g=tz(a);g.events.loiter.bind(function(a){X.trigger.loiter(a.node(),a.offset())});c=function(){g.reset();X.trigger.interaction()};a.events.keyup.bind(c);a.events.mouseup.bind(c);
a.events.paint.bind(function(a){return X.trigger.paint()});var k=function(){X.trigger.domChanged()},F=function(a,b,c,d){e.setSelection(a,b,c,d);l.update()},V=function(a,c){return bb.absolute(b).translate(a,c)},X=H.create({nodeChanged:p(["node","offset","prev"]),loiter:p(["node","offset"]),uiStale:p([]),domChanged:p([]),interaction:p([]),keydown:Q(["original"],a.events.keydown),keyup:Q(["original"],a.events.keyup),keypress:Q(["original"],a.events.keypress),mousedown:Q(["original"],a.events.mousedown),
mouseup:Q(["original"],a.events.mouseup),contextmenu:Q(["original"],a.events.contextmenu),cut:Q(["original"],a.events.cut),copy:Q(["original"],a.events.copy),paste:Q(["original"],a.events.paste),focus:Q(["original"],a.events.focus),focusOut:Q(["original"],a.events.focusOut),dblclick:Q(["original"],a.events.dblclick),selectionchange:Q(["original"],a.events.selectionchange),paint:p([])});return{win:a.win,doc:a.doc,body:a.body,baseURI:a.baseURI,canvas:a.doc,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);
e.clear();l.clear();b=kb.freefallLtr(a.body());F(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){e.focus()},uiChanged:function(){X.trigger.uiStale()},domChanged:k,clearSelection:function(){e.clearSelection()},getSelection:h,setSelection:F,setRelativeSelection:function(a,b){e.setRelativeSelection(a,b);l.update()},backupSelection:function(){e.backup()},replaceSelection:function(a){e.replaceSelection(a);l.update()},execCommand:function(){var a=arguments;e.nativeCall(function(){q.execCommand.apply(null,
a);X.trigger.uiStale()})},destroy:function(){e.destroy();a.destroy();g.destroy();f.unbind();l.destroy()},events:X.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:V,translateLocation:function(b,c){var d=Za.get(a.doc());return V(b,c).translate(-d.left(),-d.top())}}}function zV(a){return{background:t,foreground:t,focus:t,keydown:t,mousedown:g.some,mouseup:g.some,selectionchange:function(a){return jf(a,300).throttle}}}function AV(a,b){return{background:t,foreground:t,
focus:function(a,d,e){Za.preserve(r.fromDom(document),function(){Za.preserve(A.owner(e),function(){b.browser.isEdge()&&window.getSelection().removeAllRanges();e.dom().focus()})})},keydown:t,mousedown:g.some,mouseup:g.some,selectionchange:k(t)}}function BV(a){var b=function(a){return"body"===D.name(a.target())||"html"===D.name(a.target())?g.none():g.some(a)};return{background:function(a,b,e){A.owner(b).dom().defaultView.focus()},foreground:function(a,b,e){void 0!==a.focus&&a.focus()},focus:t,keydown:function(a){void 0!==
a.focus&&a.focus()},mousedown:function(a){return b(a)},mouseup:function(a){return b(a)},selectionchange:k(t)}}function CV(a,b){var c=a.dom().contentWindow,d=xz.doc(a),e=L.descendant(d,"body").getOrDie();ma.add(e,[be.base(),be.active()]);b.autoresize&&n.add(A.documentElement(e),be.autoresize());var f=DV.browser.isFirefox(),h=H.create({keydown:p(["original"]),keyup:p(["original"]),keypress:p(["original"]),mousedown:p(["original"]),mouseup:p(["original"]),contextmenu:p(["original"]),cut:p(["original"]),
copy:p(["original"]),paste:p(["original"]),focus:p(["original"]),dblclick:p(["original"]),focusOut:p(["original"]),paint:p([]),selectionchange:p(["original"])}),l=EV.get(h),q=function(){return ka(d.dom().styleSheets,function(a){try{return 0<=a.cssRules.length}catch(Hoa){return b.needStyles&&console.warn("Unable to access rules from "+a.href),!1}})},C={stylesheetLoad:Ga.nu(function(a){var b=0,d=setInterval(function(){50<b||0>=c.stillToLoad?(clearInterval(d),a(g.some(q()))):b++},100)})},w=K.bind(d,
"keydown",function(a){l.keydown(c);h.trigger.keydown(a)}),I=K.bind(d,"keyup",function(a){h.trigger.keyup(a)}),F=K.bind(d,"keypress",function(a){h.trigger.keypress(a)}),V=K.bind(d,"mousedown",function(a){l.mousedown(a).fold(function(){a.kill()},h.trigger.mousedown)}),X=K.bind(d,"mouseup",function(a){l.mouseup(a).fold(function(){a.kill()},h.trigger.mouseup)}),m=K.bind(d,"contextmenu",function(a){h.trigger.contextmenu(a)}),r=K.bind(d,"cut",function(a){h.trigger.cut(a)}),t=K.bind(d,"copy",function(a){h.trigger.copy(a)}),
u=K.bind(d,"paste",function(a){h.trigger.paste(a)}),v=K.bind(d,f?"focus":"focusin",function(a){h.trigger.focus(a)}),x=K.bind(d,"focusout",function(a){h.trigger.focusOut(a)}),y=K.bind(d,"dblclick",function(a){h.trigger.dblclick(a)}),B=l.selectionchange(function(a){h.trigger.mouseup(a)}),D=K.bind(d,"selectionchange",function(a){B(a);h.trigger.selectionchange(a)}),E=K.bind(d,"touchstart",function(a){h.trigger.mousedown(a)}),G=K.bind(d,"touchend",function(a){h.trigger.mouseup(a);O()}),J=function(){h.trigger.paint()},
N=K.capture(d,"load",J),M=function(){c.addEventListener("resize",J,!1);return{unbind:function(){c.removeEventListener&&c.removeEventListener("resize",J,!1)}}}(),O=function(){l.foreground(c,a,e)};f=k(g.from(d.baseURI).or(b.base).getOr(window.location.href));return{win:k(c),doc:k(d),body:k(e),baseURI:f,get:function(){return Ea.get(e)},set:function(a){Ea.set(e,a)},focus:function(){l.focus(c,a,e)},focused:function(){return document.activeElement===a.dom()},blur:function(){e.dom().blur()},destroy:function(){z([w,
I,F,V,X,m,r,t,u,v,x,D,y,E,G,N,M],function(a){a.unbind()})},events:h.registry,futures:C,background:function(){l.background(c,a,e)},foreground:O}}function FV(a){var b=r.fromTag("iframe");n.add(b,GV.resolve("content-iframe"));var c=g.none(),d=er(),e=K.bind(b,"load",function(){e.unbind();var f=HV(a);yz.write(b,f);f=zz.onShow(b,function(){c.each(xb);c=g.none();ja.inBody(b)&&d.set(CV(b,a))});c=g.some(f)});return{element:function(){return b},tabindex:function(a){m.set(b,"tabindex",a)},destroy:function(){G.remove(b);
e.unbind();c.each(xb)},loaded:d.get}}function IV(a,b){var c=FV(a),d=er(),e=t;c.loaded(function(f){var h=aa.detect().browser.isIE(),l=yV(f,c.element(),b),q=c.element(),C=A.parent(q).fold(function(){return 0},function(a){return parseInt(v.get(a,"min-height"))}),g=function(a){v.remove(l.body(),"min-height");a=sa.get(A.documentElement(l.body()));var b=sa.get(q);a!==b&&(b=parseInt(v.get(q,"margin-top")),b=C-b,a=a>b?a:b,v.set(q,"min-height",a+"px"),150>a?v.set(q,"height",a+"px"):v.remove(q,"height"))},
k=function(a){a=sa.get(l.body());var b=sa.get(c.element());a!==b&&sa.set(l.body(),b)},F=uj(g,0);h=h?F.throttle:g;h=a.autoresize?h:k;g=a.autoresize?g:k;l.events.uiStale.bind(u(h,"uiStale"));l.events.domChanged.bind(u(h,"domChanged"));l.events.paint.bind(u(h,"paint"));f.events.keyup.bind(u(g,"keyup"));f.events.mouseup.bind(u(g,"mouseup"));setTimeout(function(){d.set(l);e=l.destroy},0)});return{element:c.element,onCanvas:function(a){d.get(function(b){a(b.canvas())})},initial:k(""),placeholder:c.element,
tabindex:c.tabindex,destroy:function(){e();c.destroy()},loaded:d.get,isInline:k(!1)}}function JV(a){var b=g.none(),c=g.none(),d=function(){b.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())});c.each(function(a){a.restore()})},e=function(){b=g.none();c=g.none()};return{restore:function(){d();e()},save:function(){b=a.getSelection();c=a.doc().map(Za.capture)},get:function(){return b},clear:e,attempt:function(a){b=a.or(b)}}}function fr(){var a=H.create({fail:p(["url",
"image"]),success:p(["url","image"]),start:p(["url"])}),b=function(a,b,c){var d=a.dom();d.addEventListener(b,c,!1);return{unbind:function(){d.removeEventListener(b,c,!1)}}},c=function(c){var d=m.get(c,"src"),f=b(c,"load",function(){f.unbind();h.unbind();(!0===c.dom().complete?a.trigger.success:a.trigger.fail)(d,c)}),h=b(c,"error",function(){f.unbind();h.unbind();a.trigger.fail(d,c)})};return{go:function(b){a.trigger.start(b);var d=new Image;d.src=b;c(r.fromDom(d))},monitor:c,events:a.registry}}function KV(a){var b=
na({}),c=na([]),d={},e=g.none();return{structure:b.get,all:c.get,main:function(){return c.get()[0]},update:function(f){z(c.get(),function(a){G.remove(a)});e=g.some(f);var h=cb(d);Ma(d,function(a){a.assign(e)});var l=eb(d,function(a,b){return a.situation(f)}),q=LV.derive(a,h,l),C=MV.derive(a,h,l);h=Eb(h,function(a,b){return ua(a,l[b].submenus())},{});if(0===q.length)c.set([]);else{var w=zb.mainmenu(a,B.resolve("main-context-menu"),[]);P.append(w,q);S.menu(w,x.translate("aria.context.menu.generic"));
q=[w].concat(C);z(q,function(a){n.add(a,B.resolve("layer-menus"))});c.set(q);b.set(h)}},handle:function(a){var b=gr.type(a);b=d[b];void 0!==b&&b.handle(a)},register:function(a,b){d[a]=b}}}function NV(a,b,c,d,e,f){var h=[],l={register:function(a,b){h=h.concat([{name:a,feature:b}])},destroy:t};b.events.ready.bind(function(q){l=OV(a,b,c,d,e,f);z(h,function(a){l.register(a.name,a.feature)})});return{register:function(a,b){l.register(a,b)},destroy:function(){l.destroy()}}}function PV(a,b,c,d){var e=function(c){b.get().fold(t,
function(b){c.stopper();d.transaction(function(){z(b,QV)});a.domChanged();a.toEditing();qa(b,function(a){return Fa.is(a,te.lastSelectedSelector())}).bind(kc.first).each(function(b){a.setSelection(b,0,b,0)})},t)},f=c.editor();f.events.del.bind(e);f.events.backspace.bind(e);f.on();return{destroy:function(){f.off()}}}function RV(){var a=!0;return{isHandled:function(){return a},handle:function(){a=!1}}}function SV(a,b){var c=H.create({preLinebreak:p(["handler"]),postLinebreak:p([])});TV.listen(a);var d=
function(d){b.save();a.getSelection().each(function(b){var e=RV();c.trigger.preLinebreak(e);a.getSelection().each(function(b){e.isHandled()&&(Az.preLinebreak(a),(d?Bz.soft:Bz.hard)(b,a.isRoot).each(function(b){a.setRelativeSelection(b.start(),b.finish());a.domChanged();a.cursorIntoView()}));c.trigger.postLinebreak()})})},e=se.isTextArea;a.events.keydown.bind(function(a){fe.isEnter(a)&&!e(a.original().target())&&(a.original().raw().preventDefault(),d(a.original().raw().shiftKey))});return{linebreak:d,
destroy:t,events:c.registry}}function hr(a,b){return{find:function(b){return Y.descendants(b,a)},cleaner:b}}function UV(){var a=[];return{add:function(b){a.push(b)},get:function(){return a.slice(0)}}}function VV(){var a={},b=function(b){return g.from(a[b])};return{get:b,getOrInit:function(b){var c=a[b];void 0===c&&(a[b]=UV(),c=a[b]);return c},filterDom:function(a,d){b(a).each(function(a){qm.filterDom(d,a.get())})},filterHtml:function(a,d){return b(a).fold(function(){return d},function(a){return qm.filterHtml(d,
a.get())})}}}function WV(a,b){return{find:function(b){return ed.descendants(b,a)},cleaner:b}}function XV(a){var b=VV(),c=k("output"),d=k("input"),e=k("history"),f=k("internal"),h=k("paste"),l=[],q=function(a,c,d){a=b.getOrInit(a);c=hr(c,d);a.add(c)},C=function(a,c,d){a=b.getOrInit(a);c=WV(c,d);a.add(c)};a=fy(a,q,C);return{add:function(a,b,c){q(a,"."+b,c)},addSelector:q,addPredicate:C,filterHtml:b.filterHtml,filterDom:b.filterDom,internal:f,output:c,input:d,paste:h,history:e,customFilters:k(a),state:a.state,
destroy:t,addExcludedContext:function(a){l=l.concat(a)},includeContext:function(a){return!Xa(l,u(Fa.is,a))}}}function YV(a,b,c){var d=!1,e=H.create({maximize:p(["layout"]),restore:p(["layout"]),analytics:p(["message"]),select:p([]),deselect:p([])}),f=function(){e.trigger.maximize(c.alternate)},h=function(){e.trigger.restore(c.alternate)},l=function(a){d?a.select():a.deselect()},q=function(){e.trigger.analytics("fullscreen_"+(d?"off":"on"));a.focus();(d?h:f)()},C=function(a,b){a=x.key(d?"action.toggle.fullscreen":
"action.fullscreen");return qb.get(a,b)};b.events.fullscreen.bind(q);b=wb.ui({"fullscreen.general":function(){return{toggle:!0,value:"fullscreen",textkey:x.key("action.fullscreen"),tooltip:C,action:q,updateGeneral:l,icon:!0,shortcut:!0,selected:d}}},ca);var g=wb.actions({maximize:f,restore:h});return{ui:b,actions:g,select:function(){d=!0},deselect:function(){d=!1},destroy:t,events:e.registry}}function ZV(){var a={inputLinks:"insertLink"},b=H.create({internal:p(["command","data"])}),c=function(c,e){g.from(a[c]).fold(function(){throw Error("invalid internal event: "+
c);},function(a){z(e,function(c){b.trigger.internal(a,c)})})};return{input:function(a){a=Ld.many(a);c("inputLinks",a)},destroy:t,events:b.registry}}function $V(a,b,c){var d=pj(),e=[K.bind(b,"keydown",d.keydown),K.bind(b,"keypress",d.keypress),K.bind(c,"keydown",d.keydown),K.bind(c,"keypress",d.keypress)],f=function(a){d.keydown(a.original())},h=function(a){d.keypress(a.original())};a.events.keydown.bind(f);a.events.keypress.bind(h);return{off:d.off,on:d.on,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,
swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys,destroy:function(){z(e,function(a){a.unbind()});a.events.keydown.unbind(f);a.events.keypress.unbind(h)},events:d.events}}function aW(a){var b=pj(),c=function(a){b.keydown(a.original())},d=function(a){b.keypress(a.original())};a.events.keydown.bind(c);a.events.keypress.bind(d);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,
swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,events:b.events,destroy:function(){a.events.keydown.unbind(c);a.events.keypress.unbind(d)}}}function bW(a){var b=pj(),c=K.bind(a,"keydown",b.keydown),d=K.bind(a,"keypress",b.keypress);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,destroy:function(){c.unbind();d.unbind()},events:b.events}}function cW(a,b){return{all:function(){return $V(a,
b.element(),b.uiContainerParent())},container:function(a){return bW(a)},editor:function(){return aW(a)},destroy:t}}function Cz(a){return{backup:ca,restore:k(g.none()),element:k(a)}}function dW(a,b){var c=B.resolve("ops-eph-cursor");a.add(a.internal(),c,Na.remove);a.add(a.output(),c,Na.remove);a.addExcludedContext(["."+c]);var d=function(a){var d=function(d){d=Dz.diagnose(b.isRoot,d)(c,a);d.cursor().each(function(a){ja.inBody(a.startContainer())&&ja.inBody(a.endContainer())&&b.getSelection().each(function(c){b.setSelection(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})});return d.result()};return function(){return b.getSelection().fold(a,d)}};return{destroy:t,run:function(a){return d(a)()}}}function eW(a,b){var c=dW(a,b),d=function(a,c){a=a();var d=Ez.handle(c);b.getSelection().forall(function(a){return!N.eq(a.startContainer(),d.startContainer())||!N.eq(a.endContainer(),d.endContainer())||a.startOffset()!==d.startOffset()||a.endOffset()!==d.endOffset()})&&b.setSelection(d.startContainer(),d.startOffset(),d.endContainer(),
d.endOffset());return a},e=function(a){return D.isText(a)||"br"===D.name(a)};return{destroy:function(){},run:c.run,preserve:u(Og.preserve,b),lightweightWith:function(a,b){return e(b.startContainer())&&e(b.endContainer())||vc.detect(g.some(b)).isSome()?d(a,b):c.run(a)},adapt:function(a){b.getSelection().each(function(b){c.run(function(){a(b.startContainer(),b.endContainer())})})},pure:function(a){b.getSelection().each(function(b){a(b.startContainer(),b.endContainer())})},atomic:function(a){return c.run(a)}}}
function Fz(){var a=H.create({back:p([]),abort:p([])});return{ui:wb.ui({"back.general":{toggle:!1,value:"mobile-back",textkey:x.key("toolbar.backbutton"),action:function(){a.trigger.back()},updateGeneral:t,icon:!0,label:!0}}),events:a.registry,destroy:t}}function kf(a,b){return J.error({small:k(a),big:k(b)})}function fW(a,b,c,d,e){var f=function(a,b){return a()?b:{feature:g.none()}};c=f(function(){return!a&&xc.isLargeDesktop()},{feature:c.ui(),command:"fullscreen",type:"general",unsupported:"Fullscreen is not supported in inline mode"});
e=xc.choice([zj(xc.isLargeDesktop,{feature:d.fileupload().ui(),command:"fileupload",type:"general"}),zj(xc.isLargeTouch,{feature:d.fileupload().ui(),command:"fileupload",type:"menu"})],ir.make({feature:d.fileupload().ui(),command:"fileupload"},e.allowLocalImages?["camera"]:[]));var h=f(xc.isLargeDesktop,{feature:d.accessibility().ui(),command:"a11ycheck",type:"general"});f=f(xc.isLarge,{feature:d.specialchar().ui(),command:"specialchar",type:"general"});var l=xc.choice([zj(xc.isLarge,{feature:d.blocktag().ui(),
command:"bullist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"bullist",type:"general"}),q=xc.choice([zj(xc.isLarge,{feature:d.blocktag().ui(),command:"numlist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"numlist",type:"general"}),C={feature:d.formatting().ui(),command:"superscript",type:"general"},w={feature:d.formatting().ui(),command:"subscript",type:"general"},k={feature:d.formatting().ui(),command:"strikethrough",type:"general"},F={feature:d.font().ui(),command:"fontface",
type:"dropdown"},V=xc.choice([zj(xc.isTouch,{feature:d.font().ui(),command:"fontsize",type:"general"})],{feature:d.font().ui(),command:"fontsize",type:"inline-widget"}),X={feature:d.font().ui(),command:"fontcolor",type:"widget"},m={feature:d.spelling().hasAutocorrect()?d.macros().ui():g.none(),command:"autocorrect",type:"general"},n={feature:d.spelling().ui(),command:"spelling",type:d.spelling().hasDropdown()?"dropdown":"general"},r={feature:d.macros().ui(),command:"capitalisation",type:"general"},
p={feature:d.help().ui(),command:"help",type:"general"},t={feature:d.wordcount().ui(),command:"wordcount",type:"general"};return{link:{feature:d.link().ui(),command:"link",type:"general"},wordcount:t,media:{feature:d.media().ui(),command:"media",type:"general"},hr:{feature:d.horizontalrule().ui(),command:"horizontalrule",type:"general"},specialchar:f,fileupload:e,table:{feature:d.table().ui(),command:"table",type:"widget"},undo:{feature:b.ui(),command:"undo",type:"general"},redo:{feature:b.ui(),command:"redo",
type:"general"},styles:{feature:d.blocktag().ui(),command:"blocktag",type:"dropdown"},language:{feature:d.parlance().ui(),command:"parlance",type:"dropdown"},ltrdir:{feature:d.directionality().ui(),command:"ltrdir",type:"general"},rtldir:{feature:d.directionality().ui(),command:"rtldir",type:"general"},bold:{feature:d.formatting().ui(),command:"bold",type:"general"},italic:{feature:d.formatting().ui(),command:"italic",type:"general"},underline:{feature:d.formatting().ui(),command:"underline",type:"general"},
bookmark:{feature:d.bookmark().ui(),command:"bookmark",type:"general"},strikethrough:k,superscript:C,subscript:w,ul:l,ol:q,removeformat:{feature:d.formatting().ui(),command:"removeformat",type:"general"},alignment:{feature:d.alignindent().ui(),command:"alignment",type:"dropdown"},outdent:{feature:d.alignindent().ui(),command:"outdent",type:"general"},indent:{feature:d.alignindent().ui(),command:"indent",type:"general"},blockquote:{feature:d.alignindent().ui(),command:"blockquote",type:"general"},
"font-menu":{name:"font",textkey:x.key("font.menu-button"),menuTextkey:x.key("font.menu"),type:"submenu",contentFocus:!0,commands:[{category:"Font-menu",items:[F,V,X,C,w,k]}]},"font-face":F,"font-size":V,"font-color":X,fullscreen:c,find:{feature:d.findreplace().ui(),command:"find",type:"general"},accessibility:h,usersettings:{name:"usersettings",textkey:x.key("cog.menu-button"),menuTextkey:x.key("cog.menu"),type:"submenu",flatten:ir.never(),contentFocus:!0,commands:[{category:"a",items:[t]},{category:"b",
items:[n,m,r]},{caetgory:"",items:[p]}]}}}function Gz(){var a={id:"insert",label:x.key("insert.menu-button"),menuLabel:x.key("insert.menu"),items:[["link","bookmark","fileupload","media","table"],["specialchar","hr"]]};return{undo:{label:x.key("category.undo"),items:["undo","redo"]},insert:{label:x.key("category.insert"),items:[a]},style:{label:x.key("category.style"),items:["styles"]},language:{label:x.key("category.language"),items:["language","ltrdir","rtldir"]},emphasis:{label:x.key("category.emphasis"),
items:["bold","italic","underline"]},align:{label:x.key("category.align"),items:["alignment"]},listindent:{label:x.key("category.listindent"),items:["ul","ol","outdent","indent","blockquote"]},format:{label:x.key("category.format"),items:["font-menu","removeformat"]},tools:{label:x.key("category.tools"),items:["find","accessibility","fullscreen","usersettings"]},"table-tools":{label:x.key("category.table"),items:["table-tools"]},"image-tools":{label:x.key("category.image"),items:["image-tools","crop-tools"]}}}
function rm(a){return{closeMenus:function(b){b=b?b.target():a;Hz.target(b,"mousedown")}}}function gW(a){return function(b,c){var d=K.bind(a,"touchmove",b.move),e=K.bind(a,"touchend",b.drop);return{element:k(a),start:t,stop:t,destroy:function(){d.unbind();e.unbind()}}}}function Iz(a,b,c,d){var e=na(g.none());c=sm.mode({compare:jr.compare,extract:jr.extract,sink:c,mutate:function(a,c){e.get().each(function(a){jr.resize(b,a,c)})}});var f=tj.transform({},{mode:c}),h=K.bind(a,"touchstart",function(a){"img"===
D.name(a.target())&&2===a.raw().touches.length&&(e.set(g.some(a.target())),f.on(),f.go(b))});f.events.stop.bind(function(){e.get().each(function(a){v.remove(a,"transform")});d()});return{destroy:function(){h.unbind();f.destroy()}}}function hW(a,b,c){var d=c.toolbar.element(),e=Jz.tag(),f=[],h=r.fromDom(document),l=rm(d),q=null,C=hd.api(),w=g.none(),k=function(){C.run(function(a){a.toEditing()})},F=function(){l.closeMenus()},V=function(){a.getSelection().each(function(a){a=a.collapsed()?"0px":"23px";
v.set(d,"margin-top",a)})},X=function(a){v.set(d,"margin-top","0px")},m=function(){var c=[K.bind(d,"touchmove",l.closeMenus)];f=a.doc().map(function(a){return b||!0===iW?[]:[K.bind(a,"selectionchange",V),K.bind(h,"focusin",X)]}).getOr([]).concat(c)},p=function(){z(f,function(a){a.unbind()})};return{enter:function(){a.body().each(function(b){a.doc().each(function(c){a.win().each(function(d){Z.focus(b);q=Jh.onChange();var e=gW(c);e=Iz(c,b,e,t);w=g.some(e);d=jW.setup(window,d);C.set(d);a.events.toEditing.bind(k);
q.events.change.bind(F)})})});n.add(d,"ephox-polish-mobile-show");c.toolbar.refresh();e.maximize();m()},exit:function(){C.clear();a.events.toEditing.unbind(k);q.events.change.unbind(F);null!==q&&q.destroy();e.restore();p()},destroy:function(){w.each(function(a){a.destroy()});p()}}}function Kz(){var a=r.fromTag("div");n.add(a,B.resolve("disabled-mask"));var b=!1,c=T.div();n.add(c,B.resolve("content-container"));var d=T.div();S.hidden(d,!0);n.add(d,B.resolve("tap-icon"));y.append(c,d);var e=T.div();
n.add(e,B.resolve("disclosure"));y.append(e,r.fromText(x.translate("taptoedit")));y.append(c,e);y.append(a,c);S.textButton(a,c);var f=H.create({fullscreen:p([])}),h=function(b){var c=a.dom().getClientRects()[0];return ob(b,function(a){return a.pageY>=c.top&&a.pageY<=c.top+c.height&&a.pageX>=c.left&&a.pageX<=c.left+c.width})},l=[K.bind(a,"touchmove",function(a){b=!0}),K.bind(a,"touchend",function(a){var c=a.raw().changedTouches;h(c)&&!b&&(a.kill(),f.trigger.fullscreen())}),K.bind(a,"touchstart",function(a){b=
!1}),K.bind(a,"click",function(a){a.kill();f.trigger.fullscreen()})];return{element:k(a),events:f.registry,destroy:function(){z(l,function(a){a.unbind()});G.remove(d);G.remove(e);G.remove(c);G.remove(a)},show:function(){v.remove(a,"display")},hide:function(){v.set(a,"display","none")}}}function Lz(a,b,c,d,e,f){var h=f.element(),l=hW(a,e.fillscreen,f),q=function(){l.enter();d.actions().maximize()},C=function(){var a=Kz();y.append(f.element(),a.element());a.events.fullscreen.bind(function(a){d.actions().maximize()})};
return{init:function(){f.socket(a);a.events.scrollToCursor.bind(function(){Og.cursorIntoView(a)})},loaded:function(){var a=!0===e.fillscreen;(n.has(h,B.resolve("fullscreen-maximized"))||a?q:C)()},restoreEditor:function(){d.actions().restore();l.exit()},destroy:function(){a.body().each(Z.blur)}}}function kW(a,b,c,d,e){var f=d.toolbar.items,h=function(h){var l=Lz(a,b,c,e,d,h),C=Fz();h=Aj.config({items:[["back"]].concat(f),contextual:[]},{back:{feature:C.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});
C.events.back.bind(function(){l.restoreEditor()});return{init:l.init,loaded:l.loaded,config:h,destroy:function(){l.destroy();C.destroy()}}};return{tabbed:h,full:h,destroy:t}}function lW(a,b,c,d,e){var f=d.toolbar.items,h=function(h){var l=Lz(a,b,c,e,d,h);h=Aj.config({items:f,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:l.init,loaded:l.loaded,config:h,destroy:function(){l.destroy()}}};return{tabbed:h,full:h,destroy:t}}function mW(a,b,c,d){b=function(b){return{init:function(){b.socket(a);
a.events.scrollToCursor.bind(function(){Og.cursorIntoView(a)});a.events.toEditing.bind(a.focus)},loaded:t,config:Aj.config(d.toolbar,{},{allowLocalImages:d.allowLocalImages}),destroy:t}};return{tabbed:b,full:b,destroy:t}}function nW(a,b){var c=Jz.tag(),d=g.none(),e=Kz();return{maximize:function(){d=g.some(document.body.scrollTop);v.set(e.element(),"display","none");n.add(a,B.resolve("fullscreen-maximized"));Mz.clobberStyles(a,b);c.maximize()},restore:function(){Mz.restoreStyles();n.remove(a,B.resolve("fullscreen-maximized"));
c.restore();v.remove(e.element(),"display");d=d.bind(function(a){document.body.scrollTop=a;return g.none()})},destroy:function(){e.destroy()},mask:k(e)}}function oW(a,b){var c=a.document,d=r.fromTag("div");n.add(d,ue.resolve("unfocused-selections"));y.append(r.fromDom(c.documentElement),d);var e=K.bind(d,"touchstart",function(c){c.prevent();kr.resume(a,b);h()}),f=function(a){var b=r.fromTag("span");ma.add(b,[ue.resolve("layer-editor"),ue.resolve("unfocused-selection")]);v.setAll(b,{left:a.left+"px",
top:a.top+"px",width:a.width+"px",height:a.height+"px"});return b},h=function(){G.empty(d)};return{update:function(){h();var b=lr.getRectangles(a);b=E(b,f);P.append(d,b)},isActive:function(){return 0<A.children(d).length},destroy:function(){e.unbind();G.remove(d)},clear:h}}function pW(a){var b=na(lf.pure({}));return{start:function(c){var d=lf.nu(function(b){return a(c).get(b)});d.get(ca);b.set(d)},idle:function(a){b.get().get(function(){a()})}}}function qW(a){return function(b,c){var d=K.bind(a,"touchmove",
b.move),e=K.bind(a,"touchend",b.drop),f=K.bind(a,"gesturestart",function(a){"img"===D.name(a.target())&&a.prevent()});return{element:k(a),start:t,stop:t,destroy:function(){d.unbind();e.unbind();f.unbind()}}}}function rW(a,b,c,d,e,f,h,l){var q=[],C=f.toolbar.element(),k=f.banners(),I=f.viewport(),F=g.none(),V=rm(C),X=null,m=hd.api(),p=g.none(),t=Vc.event(I),u=Aa("cWin ceBody socket toolstrip toolbar contentElement cursor keyboardType isScrolling".split(" "),[]),x=function(){m.run(function(a){a.highlightSelection()})},
y=function(){m.run(function(a){a.refreshSelection()})},A=function(a){var b=bb.absolute(a).top()-I.dom().scrollTop;m.run(function(c){c.scrollIntoView(b,b+sa.get(a))})},D=function(){Nz.insertAtCursor(d,a,function(a){var b=a.absolute().top()-I.dom().scrollTop;m.run(function(c){c.scrollIntoView(b,b+a.height())})})},E=function(a){D();m.run(function(a){a.syncHeight()})},G=function(a){var b=sa.get(C);m.run(function(a){a.setViewportOffset(b)});y();E()},H=function(a){A(a.element())},J=jf(E,300),M=function(){V.closeMenus()},
O=function(){U();var a=setInterval(function(){0===window.pageYOffset&&(clearInterval(a),E())},100)},P=function(){m.run(function(a){a.clearSelection()})},Q=function(){P();J.throttle()},S=function(){m.run(function(a){a.toEditing()})},R=function(){m.run(function(a){a.toReading()})},T=function(a){m.run(function(b){b.onToolbarTouch(a)})},U=function(){(Jh.get().isPortrait()?n.remove:n.add)(f.element(),B.resolve("mobile-landscape"))},W=function(a){var b=v.get(a,"background-color");void 0!==b&&""!==b&&v.set(a,
"-webkit-tap-highlight-color",b)},Y=function(b){var c=a.win().getOrDie(),d=function(a){Z.focus(b);a=a.raw().changedTouches[0];Wa.getAtPoint(c,a.pageX,a.pageY).each(function(a){Wa.setExact(c,a.start(),a.soffset(),a.finish(),a.foffset())})},e=a.doc().map(function(a){var c=qW(a);c=Iz(a,b,c,E);p=g.some(c);var e=r.fromDom(a.dom().documentElement);return[K.bind(a,"touchend",function(a){(N.eq(e,a.target())||N.eq(b,a.target()))&&d(a)})]}).getOr([]),f=[K.capture(C,"touchstart",function(a){x();T(a)}),K.bind(b,
"touchstart",P),tm.handle(b,aa),K.bind(C,"touchmove",V.closeMenus)];q=e.concat(f)},aa=function(a){a.kill()};return{exit:function(){a.body().each(function(b){v.remove(k,"display");v.set(f.viewport(),"overflow","hidden");F=F.bind(function(a){a.unbind();return g.none()});n.remove(C,B.resolve("mobile-show"));m.clear();Z.blur(b);v.remove(b,"padding-top");z(q,function(a){a.unbind()});h.restore();a.events.keyup.unbind(Q);a.events.domChanged.unbind(J.throttle);a.events.scrollToCursor.unbind(J.throttle);a.events.scrollToElement.unbind(H);
a.events.domChanged.unbind(y);a.events.nodeChanged.unbind(y);a.events.toEditing.unbind(S);a.events.toReading.unbind(R);X.events.change.unbind(M);X.events.ready.unbind(O);f.toolbar.events.transitionend.unbind(G);null!==X&&X.destroy()})},enter:function(b){a.body().each(function(b){a.win().each(function(d){X=Jh.onChange();h.maximize();Y(b);Z.focus(b);F=g.some(Oz.exclusive(c,"."+Vc.scrollable()));v.getRaw(C,"overflow-x").is("auto")&&L.descendant(C,".ephox-chameleon-toolbar").each(function(a){Oz.markAsHorizontal(a);
Vc.register(a)});W(b);U();document.body.scrollTop=0;n.add(C,B.resolve("mobile-show"));f.toolbar.refresh();v.set(k,"display","block");L.descendant(C,".ephox-chameleon-toolbar").each(function(c){m.set(sW.setup(u({cWin:d,ceBody:b,socket:I,toolstrip:C,toolbar:c,contentElement:a.element(),cursor:a.cursor(),keyboardType:tW.stubborn,isScrolling:t.isScrolling})))});a.events.keyup.bind(Q);a.events.domChanged.bind(J.throttle);a.events.scrollToCursor.bind(J.throttle);a.events.scrollToElement.bind(H);a.events.domChanged.bind(y);
a.events.nodeChanged.bind(y);a.events.toEditing.bind(S);a.events.toReading.bind(R);X.events.change.bind(M);X.events.ready.bind(O);f.toolbar.events.transitionend.bind(G);E()})})},destroy:function(){p.each(function(a){a.destroy()});F.each(function(a){a.unbind()});t.destroy()}}}function Pz(a,b,c,d,e){var f=nW(e.element(),a),h=r.fromDom(document),l=a.element(),q=k(!0===d.fillscreen),C=rW(a,b,h,c,l,e,f,q),g=function(a){var b=A.children(a),c;if(!(c=0===b.length)){if(b=1===b.length)b=Ea.get(a),b=10===b.charCodeAt(0)&&
10===b.charCodeAt(1);c=b}c&&(b=r.fromHtml("<p><br></p>"),y.append(a,b));C.enter()},I=function(a){y.append(e.element(),f.mask().element());f.mask().events.fullscreen.bind(function(a){C.enter()})},F=function(a){(q()?g:I)(a)};return{init:function(){e.socket(a)},loaded:function(){a.body().each(F)},restoreEditor:function(){a.body().each(Z.blur);a.element().dom().focus();a.element().dom().blur();C.exit();Z.focus(f.mask().element())},destroy:function(){a.body().each(Z.blur);C.destroy();f.destroy()}}}function uW(a,
b,c,d){var e=d.toolbar.items;return{tabbed:function(f){var h=Pz(a,b,c,d,f),l=Fz();f=Aj.config({items:[["back"]].concat(e),contextual:[]},{back:{feature:l.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});l.events.back.bind(function(){h.restoreEditor()});return{init:h.init,loaded:h.loaded,config:f,destroy:function(){h.destroy();l.destroy()}}},full:yb("mobile does not support fullscreen layout"),destroy:t}}function vW(a,b,c,d){var e=d.toolbar.items;return{tabbed:function(f){var h=
Pz(a,b,c,d,f);f=Aj.config({items:e,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:h.init,loaded:h.loaded,config:f,destroy:function(){h.restoreEditor();h.destroy()}}},full:yb("mobile does not support fullscreen layout"),destroy:t}}function wW(a,b,c,d,e){return(Qz.deviceType.isiOS()?!0===e.fillscreen?vW:uW:Qz.deviceType.isAndroid()?!0===e.fillscreen?lW:kW:mW)(a,b,c,e,d)}function Bj(a,b){b=um.readOr(a,b);var c=na(b),d=function(a){c.set(a)};return{setAndCache:function(b){d(b);um.write(a,
b)},set:d,get:function(){return c.get()}}}function xW(a){var b=Bj("native.spelling",a.nativeSpelling),c=Bj("spelling",a.spelling),d=Bj("autocorrect",a.autocorrect),e=Bj("linkpreviews",a.linkpreviews),f=Bj("capitalisation",a.capitalisation);return{spelling:k(c),nativeSpelling:k(b),autocorrect:k(d),linkpreviews:k(e),capitalisation:k(f),state:function(){return{nativeSpelling:b.get(),spelling:c.get(),autocorrect:d.get(),linkpreviews:e.get(),capitalisation:f.get()}},destroy:t}}function yW(a,b,c){var d=
b.all();d.on();var e=[];d.events.backspace.bind(function(){mr.get(a,e,Cj.left).each(G.remove)});b=function(b){var d=b.stopper();mr.get(a,e,Cj.left).each(function(b){d();Rz.upOrLeft(a,c,b)})};d.events.right.bind(function(b){var d=b.stopper();mr.get(a,e,Cj.right).each(function(b){d();Rz.right(a,c,b)})});d.events.left.bind(b);d.events.up.bind(b);return{registerSkip:function(a){e.push(a)},destroy:function(){d.destroy()}}}function zW(a,b){(b.error?g.some(b.error):g.none()).map(function(a){return nj(mf.get(a.name,
[a]))}).each(a.displayBanner);return{destroy:t}}function Sz(a){return{elementFromPoint:function(b,c){return r.fromPoint(r.fromDom(a.document),b,c)},getRect:function(a){return a.dom().getBoundingClientRect()},getRangedRect:function(b,c,d,e){b=Lc.exact(b,c,d,e);return Wa.getFirstRect(a,b).map(function(a){return eb(a,xb)})},getSelection:function(){return Wa.get(a).map(function(b){return Kh.convertToRange(a,b)})},fromSitus:function(b){b=Lc.relative(b.start(),b.finish());return Kh.convertToRange(a,b)},
situsFromPoint:function(b,c){return Wa.getAtPoint(a,b,c).map(function(a){return{start:k(la.on(a.start(),a.soffset())),finish:k(la.on(a.finish(),a.foffset()))}})},clearSelection:function(){Wa.clear(a)},setSelection:function(b){Wa.setExact(a,b.start(),b.soffset(),b.finish(),b.foffset())},setRelativeSelection:function(b,c){Wa.setRelative(a,b,c)},selectContents:function(b){Wa.setToElement(a,b)},getInnerHeight:function(){return a.innerHeight},getScrollY:function(){return Za.get(r.fromDom(a.document)).top()},
scrollBy:function(b,c){Za.by(b,c,r.fromDom(a.document))}}}function AW(a,b,c,d){var e=g.none(),f=function(){e=g.none()};return{mousedown:function(a){d.clear(b);e=Tz(a.target(),c)},mouseover:function(f){e.each(function(e){d.clear(b);Tz(f.target(),c).each(function(f){Sf.identify(e,f,c).each(function(c){var h=c.boxes().getOr([]);if(1<h.length||1===h.length&&!N.eq(e,f))d.selectRange(b,h,c.start(),c.finish()),a.selectContents(f)})})})},mouseup:function(){e.each(f)}}}function BW(a){var b=function(b){return!a.isRoot(b)&&
(Dj.isBlock(b)||"li"===D.name(b))},c=function(a){return D.isText(a)&&0===Ya.get(a).trim().length},d=function(b,c,d,e){return Ja.closest(b,function(b){return A.parent(b).exists(a.isRoot)},a.isRoot).fold(function(){return W.point(b,c)},function(a){return d(a,b,c)?e(a):W.point(b,c)})},e=function(a,b){return"p"===D.name(a)&&1===A.childNodesCount(a)&&A.firstChild(a).filter(function(a){return"br"===D.name(a)}).isSome()?W.point(a,b):kb.toLeaf(a,b)},f=function(e,f){var h=function(b){return wc.before(b,a.isRoot).fold(function(){return W.point(e,
f)},function(a){return c(a)?h(a):W.point(a,wa.getEnd(a))})};return Ja.closest(e,function(a){return b(a)&&A.prevSibling(a).isSome()},a.isRoot).fold(function(){return d(e,f,Qg.isAtLeftEdge,h)},function(a){return b(e)||Qg.isAtLeftEdge(a,e,f)?h(a):W.point(e,f)})},h=function(e,f){var h=function(b){return wc.after(b,a.isRoot).fold(function(){return W.point(e,f)},function(a){return c(a)?h(a):W.point(a,0)})};return Ja.closest(e,function(a){return b(a)&&A.nextSibling(a).isSome()},a.isRoot).fold(function(){return d(e,
f,Qg.isAtRightEdge,h)},function(a){return b(e)||Qg.isAtRightEdge(a,e,f)?h(a):W.point(e,f)})},l=function(a,b){return N.eq(a.element(),b.element())?a.offset()<=b.offset():id.after(a.element(),a.offset(),b.element(),b.offset())};return{getSelection:function(a){return a.getSelection().bind(function(a){var b=a.startContainer();var c=a.endContainer();N.eq(b,c)?(c=A.child(b,a.startOffset()),b=A.child(b,a.endOffset()),b=c.filter(pa.isList).isSome()||b.filter(pa.isList).isSome()):b=!0;if(b){if(id.after(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset()))return b=e(a.startContainer(),a.startOffset()),a=e(a.endContainer(),a.endOffset()),b=wa.isStart(b.element(),b.offset())?f(b.element(),b.offset()):W.point(b.element(),b.offset()),a=wa.isEnd(a.element(),a.offset())?h(a.element(),a.offset()):W.point(a.element(),a.offset()),a=l(b,a)?g.some(Sc(b.element(),b.offset(),a.element(),a.offset())):g.some(Sc(a.element(),a.offset(),b.element(),b.offset())),a;b=e(a.startContainer(),a.startOffset());a=e(a.endContainer(),
a.endOffset());b=wa.isEnd(b.element(),b.offset())?h(b.element(),b.offset()):W.point(b.element(),b.offset());a=wa.isStart(a.element(),a.offset())?f(a.element(),a.offset()):W.point(a.element(),a.offset());a=l(b,a)?g.some(Sc(a.element(),a.offset(),b.element(),b.offset())):g.some(Sc(b.element(),b.offset(),a.element(),a.offset()));return a}return g.some(a)})}}}function CW(a,b,c){DW.configure(b);var d=BW(c),e=H.create({beforeScan:p([]),afterScan:p([])}),f=Uz.byClass(te);b=function(){c.body().each(function(a){c.getSelection().each(function(b){nf.sharedOne(sb.table,
[b.startContainer(),b.endContainer()]).fold(function(){f.clear(a)},t)})})};(Vz.browser.isChrome()||Vz.browser.isSafari())&&c.events.contextmenu.bind(b);c.events.nodeChanged.bind(b);var h=na([]);c.runOrOnLoaded(function(b){var d=A.defaultView(b).dom(),l=Wz.mouse(d,b,c.isRoot,f),q=Wz.keyboard(d,b,c.isRoot,f);h.set([vm.leftDown.bind(b,l.mousedown),vm.leftPressedOver.bind(b,l.mouseover),vm.leftUp.bind(b,l.mouseup),K.bind(b,"keyup",function(a){a.raw().shiftKey&&Nd.isNavigation(a.raw().which)&&c.getSelection().each(function(b){q.keyup(a,
b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset()).each(function(b){g(a,b)})},t)}),K.bind(b,"keydown",function(b){c.getSelection().each(function(c){e.trigger.beforeScan();var d=a.directionAt(c.endContainer()).isRtl()?Nd.rtl:Nd.ltr;q.keydown(b,c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d).each(function(a){g(b,a)});e.trigger.afterScan()})})]);var g=function(a,b){b.kill()&&a.kill();b.selection().each(function(a){c.setRelativeSelection(a.start(),a.finish())})}});
var l=function(a){return{win:a.win,doc:a.doc,execCommand:a.execCommand,getSelection:function(){return d.getSelection(a)},setSelection:a.setSelection,setRelativeSelection:a.setRelativeSelection,focus:a.focus}},q=function(a,b){return{doc:b.doc,win:b.win,execCommand:b.execCommand,focus:b.focus,setSelection:t,setRelativeSelection:t,getSelection:function(){return g.some(C(a))}}},C=function(a){return{startContainer:k(a),startOffset:k(0),endContainer:k(a),endOffset:k(wa.getEnd(a))}};return{get:function(){return c.on(function(a){return c.body().fold(Zb.none,
function(b){return Xz.retrieve(b,te.selectedSelector()).fold(function(){return a.getSelection().fold(Zb.none,function(b){b=d.getSelection(a).getOr(b);return Zb.single(b,l(a))})},function(b){var c=E(b,function(b){return q(b,a)});return Zb.multiple(b,c)})})}).getOrThunk(Zb.none)},surround:C,events:e.registry,destroy:function(){var a=h.get();z(a,function(a){a.unbind()})}}}function EW(a){a=ua({scopes:[r.fromDom(document)],shortcuts:[],swallow:!1},a);var b=pj(a),c=[],d=[];z(a.scopes,function(a){c.push(K.bind(a,
"keydown",b.keydown).unbind);d.push(K.bind(a,"keypress",b.keypress).unbind)});return{off:b.off,on:b.on,destroy:function(){z(c,xb);z(d,xb)},events:b.events,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys}}function FW(a,b){var c=H.create({undo:p([]),redo:p([]),context:p([]),toolbar:p([]),plaincode:p([]),bold:p([]),italic:p([]),underline:p([]),indent:p([]),outdent:p([]),link:p([]),
blockquote:p([]),search:p([]),help:p([]),fullscreen:p([])}),d=GW(c),e=[d.undo,d.redo,d.context,d.toolbar];d=[d.plaincode,d.bold,d.italic,d.underline,d.indent,d.outdent,d.link,d.search,d.blockquote,d.help,d.fullscreen];e=(b=!0===b.features)?e.concat(d):e;var f=ia(e,function(a){return a.keys()}),h=E(e,function(a){return HW(a.keys(),a.trigger())}),l=g.none();a.onCanvas(function(a){a=EW({scopes:[a],shortcuts:f});l=g.some(a);a.swallowShortcuts(f);a.events.command.bind(function(a){var b=a.command();yc(h,
function(a){return a(b)}).each(xb)});a.on()});return{isHelpShortcutEnabled:k(b),events:c.registry,destroy:function(){l.each(function(a){a.destroy()})}}}function IW(){var a=[],b=function(){a=ka(a,function(a){return sc.isVisible(a.popup().panel())})};return{recalculate:function(){b();E(a,function(a){a.anchor().recalculate(a.popup())})},dismiss:function(){b();E(a,function(a){a.anchor().isAnchored()||a.popup().close()})},update:function(b,d){a=JW.put(a,b,d,KW,function(a){return a.popup()===b})},destroy:function(){}}}
function LW(a,b,c,d){var e=IW(),f=a.isInline()?t:gc(function(){var b=function(b){e.dismiss();a.focus()},c=!0===d.autoresize?r.fromDom(document):a.doc().getOrDie();h=Yz.bind(c,b);!0!==d.autoresize&&!0===d.toolbar.sticky&&(l=Yz.bind(r.fromDom(document),b))}),h=null,l=null,q=T.div();ma.add(q,[B.resolve("ui-container"),B.resolve("layer-above-editor")]);d.editorName.each(function(a){m.set(q,"data-ephox-editor",a)});var g=K.bind(q,"keydown",function(a){var b;if(b=U(R.BACKSPACE(),a.raw().which))b=a.target(),
b=u(Fa.is,b),b=!Xa(["textarea","input",'[contenteditable="true"]'],b);b&&a.kill()});return{uiContainer:k(q),uiOrigin:function(){return Lh.relativeOrigin(q)},refresh:e.recalculate,bounds:b,show:function(a,b){f();e.update(a,b);b.place(a)},destroy:function(){null!==h&&h.unbind();null!==l&&h.unbind();e.destroy();g.unbind();G.remove(q)}}}function MW(a,b,c){a=ky(c,a);c=function(){var a=setTimeout(function(){clearTimeout(a);d.trigger.expired()},b);return{clear:function(){clearTimeout(a)}}};var d=H.create({expired:p([]),
close:p([])}),e=0<b?c():{clear:t};a.events.close.bind(function(){e.clear();d.trigger.close()});return{element:a.element,action:a.action,destroy:a.destroy,events:d.registry}}function NW(a,b,c,d,e,f,h,l){var q=h.layout.build(a,b,c,d,e,f,h,l);b=function(a){Db.closest(a.target(),'input,div[contenteditable="true"],textarea,.ephox-polish-dialog.ephox-polish-help-modal,select,.ephox-polish-bottom-bar,.ephox-polish-side-bar')||a.prevent()};var g=[K.bind(q.element(),"mousedown",b),K.bind(c.uiContainer(),"mousedown",
b)];(function(){var b=n.toggler(q.element(),B.resolve("content-ltr")),c=n.toggler(q.element(),B.resolve("content-rtl")),d=n.toggler(q.uiContainerParent(),B.resolve("content-ltr")),e=n.toggler(q.uiContainerParent(),B.resolve("content-rtl")),h=function(){b.off();d.off()},l=function(){b.on();d.on()},g=function(){c.off();e.off()},C=function(){c.on();e.on()},k=function(){var a=f.uiDirection().isRtl(),b=a?C:g;(a?h:l)();b()};a.events.uiStale.bind(function(){$y.readDir(a).fold(k,function(a){a.ltrdir().fold(h,
t,l);a.rtldir().fold(g,t,C);b.isOn()===c.isOn()&&k()})})})();return{element:q.element,connect:q.connect,viewport:q.viewport,uiContainerParent:q.uiContainerParent,socket:q.socket,showMessage:function(a,b,c){a=MW(a,b,c);b=u(q.hideBanner,a);a.events.expired.bind(b);q.displayBanner(a);return b},displayBanner:q.displayBanner,hideBanner:q.hideBanner,init:q.init,refocus:q.tabstrip.refocus,tabstrip:q.tabstrip,refresh:q.refresh,position:q.position,state:q.state,destroy:function(){q.destroy();z(g,function(a){a.unbind()})},
dialogContainer:q.dialogContainer}}function Ej(a){var b=void 0!==a?a.slice(0):[];return{pop:function(){return g.from(b.pop())},push:function(a){b.push(a)},peek:function(){return g.from(b[b.length-1])},pushAll:function(a){b=b.concat(a)},clear:function(){b=[]},isEmpty:function(){return 0===b.length},size:function(){return b.length},state:function(){return b.slice(0)}}}function Zz(a){var b=H.create({changed:p([]),reset:p([])}),c=a.initial,d=Ej(a.undo),e=Ej(a.redo),f=function(a){d.isEmpty()&&d.push(c);
d.push(a);b.trigger.changed()},h=function(a,b){b(d.peek().getOr(c),a)?(d.pop(),d.push(a)):(f(a),e.clear())};return{save:h,checkChanged:function(a,b){return!b(d.peek().getOr(c),a)},undo:function(a,c){h(a,c);return d.pop().bind(function(a){d.isEmpty()||(e.push(a),b.trigger.changed());return d.peek()})},redo:function(a,b){b(d.peek().getOr(c),a)||e.clear();return e.pop().bind(function(a){f(a);return d.peek()})},reset:function(a){c=a;d.clear();e.clear();b.trigger.reset()},state:function(){return{initial:c,
undo:d.state(),redo:e.state()}},rewrite:function(a){var f=a(c),h=E(d.state(),a);a=E(e.state(),a);c=f;d=Ej(h);e=Ej(a);d.isEmpty()&&e.isEmpty()||b.trigger.changed()},events:b.registry}}function OW(a,b,c,d,e){var f=PW.fromState($z(e,QW)),h=H.create({changed:Q([],f.events.changed),reset:Q([],f.events.reset),undo:p([]),redo:p([])}),l=function(b,c){var d;(d=""===b.raw()&&RW.isDefaultEmpty(c.raw()))||(b=a.filterHtml(a.internal(),b.raw()),c=a.filterHtml(a.internal(),c.raw()),d=b===c);return d},q=function(){var c=
a.filterHtml(a.history(),b.getContent()),d=a.filterHtml(a.history(),b.serialize());return wm(c,d)},g=function(a){return b.deserialize(a.marked())};e=function(){var a=q();f.undo(a,l).each(g);b.domChanged();b.toEditing();h.trigger.undo()};var w=function(){var a=q();f.redo(a,l).each(g);b.domChanged();b.toEditing();h.trigger.redo()},I=Hd.tap(function(a,b){a()&&(a=q(),f.save(a,b))}),F=function(){I.instance(function(){return b.getSelectionStart().exists(ja.inBody)},l)},V=function(a){var b=I.control.isBlocked();
I.control.block();a=a();b||I.control.unblock();return a},m=c.editor();m.events.enter.bind(F);m.on();d.events.undo.bind(e);d.events.redo.bind(w);b.events.undoChanged.bind(F);b.events.loiter.bind(F);c=wb.ui({"undo.general":{toggle:!1,value:"undo",textkey:x.key("action.undo"),action:e,shortcut:!0,updateGeneral:ca,tooltip:qb.get},"redo.general":{toggle:!1,value:"redo",textkey:x.key("action.redo"),action:w,shortcut:!0,updateGeneral:ca,tooltip:qb.get}});return{undo:e,redo:w,save:F,checkChanged:function(){var a=
q();return f.checkChanged(a,l)},reset:function(a){f.reset(wm(a,a))},destroy:function(){m.off();m.destroy()},state:function(){return $z(f.state(),SW)},rewrite:function(a,b){f.rewrite(function(c){return wm(c.raw().replace(a,b),c.marked().replace(a,b))})},transaction:function(a){F();a=V(a);F();return a},disable:V,replaceTop:function(){I.instance(k(!0),k(!0))},ui:c,events:h.registry}}function TW(a,b){var c=hd.unbindable(),d=H.create({onChange:p([])}),e=uj(function(){d.trigger.onChange()},1E3),f=function(){a.runOrOnLoaded(function(d){(b?
g.some(r.fromDom(document)):a.doc()).each(function(a){c.set(K.bind(a,"scroll",function(a){e.throttle()}));e.throttle()})})};a.isInline()||f();var h=function(){return a.body().bind(function(c){return(b?g.some(window):a.win()).map(function(d){var e=a.element().dom().getBoundingClientRect(),f=d.innerHeight,h=A.children(c);return Va(h,function(a){if(!D.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return(b?a.top+e.top:a.top)<f&&0<c}).map(function(a){var c=Va(h.slice(a+
1),function(a){if(!D.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return!((b?a.top+e.top:a.top)<f&&0<c)}).map(function(b){return a+1+b}).getOr(h.length);return h.slice(a,c)}).getOr([c])})}).getOr([])};return{sections:function(){return h()},setOn:f,setOff:function(){c.clear()},viewport:function(){return{assess:function(b){if(!D.isElement(b))return Rg.inView(b);var c=a.win().map(function(a){return a.innerHeight}).getOr(0),d=b.dom().getBoundingClientRect();
c=0>d.bottom?Rg.aboveView:d.top>c?Rg.belowView:Rg.inView;return c(b)}}},destroy:function(){c.clear();e.cancel()},events:d.registry}}function aA(){var a=bA.single(),b=H.create({upload:p(["assets"])});a.events.upload.bind(function(a){ve.multiple(a.files()).get(function(a){b.trigger.upload(a)})});return{element:a.element,open:a.open,destroy:a.destroy,events:b.registry}}function nr(a){var b=g.none(),c=function(c){d();c=nj(c);c.events.close.bind(function(){b=g.none()});b=g.some(c);a().displayBanner(c)},
d=function(){b.each(a().hideBanner);b=g.none()};return{show:c,showKey:function(a){var b=mf.get.apply(void 0,arguments);c(b)},hide:d,reset:function(){b=g.none()}}}function cA(a,b){a=ua({layerClass:void 0,zindex:void 0,padding:"0px"},a);var c=H.create({exiting:p([])}),d=r.fromTag("div");S.presentation(d);n.add(d,lc.resolve("modal"));n.add(d,lc.resolve("modal-hidden"));v.setAll(d,{position:"fixed",left:a.padding,top:a.padding,right:a.padding,bottom:a.padding});void 0!==a.background&&v.set(d,"background",
a.background);void 0!==a.zindex&&v.set(d,"z-index",a.zindex);void 0!==a.layerClass&&n.add(d,a.layerClass);var e=void 0!==b?b:L.first("body").getOrDie();y.append(e,d);return{element:function(){return d},content:function(a){G.empty(d);y.append(d,a)},show:function(){n.add(e,lc.resolve("modal-active"));n.remove(d,lc.resolve("modal-hidden"));n.add(d,lc.resolve("modal-show"))},hide:function(){n.remove(e,lc.resolve("modal-active"));n.add(d,lc.resolve("modal-hidden"));n.remove(d,lc.resolve("modal-show"))},
destroy:function(){G.remove(d);n.remove(e,lc.resolve("modal-active"))},events:c.registry}}function UW(a,b){var c=Jh.onChange(),d=H.create({exiting:p([])});a=ua({layerClass:null,zindex:null,padding:"0px",background:"rgba(0, 0, 0, 0.5)"},a);var e=r.fromTag("div");S.presentation(e);n.add(e,lc.resolve("moodal"));n.add(e,lc.resolve("moodal-hidden"));v.setAll(e,{left:a.padding,top:a.padding,right:a.padding,bottom:a.padding});a.background&&v.set(e,"background",a.background);a.zindex&&v.set(e,"z-index",a.zindex);
a.layerClass&&n.add(e,a.layerClass);var f=void 0!==b?b:L.first("body").getOrDie();y.append(f,e);var h=r.fromTag("div");S.presentation(h);n.add(h,lc.resolve("moodal-flexor"));y.append(e,h);var l=function(){v.setAll(h,{top:window.scrollY+"px",height:window.innerHeight+"px"})},q=function(){g.unbind();c.destroy();G.remove(e);n.remove(f,lc.resolve("modal-active"))},g=K.bind(e,"click",function(){d.trigger.exiting();q()});c.events.ready.bind(function(){l()});return{element:k(e),content:function(a){G.empty(h);
y.append(h,a)},show:function(){n.add(f,lc.resolve("moodal-active"));n.remove(e,lc.resolve("moodal-hidden"));n.add(e,lc.resolve("moodal-show"));l()},hide:function(){n.remove(f,lc.resolve("moodal-active"));n.add(e,lc.resolve("moodal-hidden"));n.remove(e,lc.resolve("moodal-show"))},destroy:q,events:d.registry}}function VW(a){var b=oa({layerClass:void 0,zindex:void 0,modal:{}},a);a=void 0!==a.container?a.container:L.first("body").getOrDie();var c=(aa.detect().os.isiOS()?UW:cA)(b.modal,a),d=c.element(),
e=H.create({exiting:Q([],c.events.exiting)});void 0!==b.zindex&&v.set(d,"z-index",b.zindex);void 0!==b.layerClass&&n.add(d,b.layerClass);n.add(d,lc.resolve("centered-dialog"));y.append(a,d);return{content:c.content,show:function(){c.show()},hide:function(){c.hide()},destroy:function(){G.remove(d);c.destroy()},events:e.registry}}function WW(){var a=function(a,b){n.add(a,B.resolve(b));return a},b=a(T.div(),"dialog"),c=a(T.div(),"top"),d=a(T.span(),"dialog-title"),e=a(T.span(),"dialog-close"),f=a(T.div(),
"dialog-content"),h=a(T.div(),"dialog-controls");m.set(b,"tabindex",-1);m.set(e,"tabindex",-1);S.button(e,x.translate("button.close"));var l=K.bind(e,"click",function(){q.trigger.close()});P.append(b,[c,f,h]);P.append(c,[d,e]);var q=H.create({close:p([])});return{element:function(){return b},focus:function(){Z.focus(b)},setTitle:function(a){G.empty(d);y.append(d,r.fromText(a));XW||(S.dialog(b,a),a=Ha("ephox-aria"),m.set(d,"id",a),S.labelledBy(b,a))},setContent:function(a){G.empty(f);y.append(f,a);
a=Ha("ephox-aria");m.set(f,"id",a);S.describedBy(b,a)},setControls:function(a){G.empty(h);y.append(h,a)},close:function(){q.trigger.close()},destroy:function(){G.remove(b);l.unbind()},events:q.registry}}function we(a){var b=WW(),c=g.none(),d=VW({container:a,layerClass:B.resolve("layer-dialog"),modal:{layerClass:B.resolve("layer-below-dialog")}});d.content(b.element());d.events.exiting.bind(function(){Vc.unlock([ja.body()]);b.close()});var e=function(){d.hide();Vc.unlock([ja.body()])};return{element:b.element,
destroy:function(){b.destroy();c.each(function(a){a.unbind()});e();d.destroy()},setTitle:b.setTitle,setContent:b.setContent,setControls:b.setControls,show:function(){d.content(b.element());d.show();b.focus();YW.deviceType.isTouch()&&(c=g.some(K.bind(b.element(),"click",function(a){a.stop()})));Vc.lock([ja.body()])},hide:e,events:b.events}}function dA(a,b,c,d,e,f){var h=td.okCancel("file-upload"),l=d(e),q=null,g=aa.detect(),k=H.create({close:p([]),analytics:p(["message"]),escaped:p([]),insertAssets:p(["assets"]),
opened:p([])}),I=function(){q.unbind();V.hide();k.trigger.close();k.trigger.analytics("insert_image_closed");F()},F=function(){l.reset();h.ok().disable()},V=we(c);V.setTitle(x.translate("fileupload.title"));V.setContent(l.element());V.setControls(h.element());V.events.close.bind(I);n.add(V.element(),B.resolve("imageupload-dialog"));var m=f(V.element(),l.keylayouts(),Ba.dialog({cancel:h.cancel().element(),ok:h.ok().element(),execute:Kb.click,index:0}));l.events.upload.bind(function(a){k.trigger.insertAssets(a.assets());
I()});l.events.dragndrop.bind(function(a){k.trigger.insertAssets(a.assets());I()});l.events.success.bind(function(a){h.ok().enable()});l.events.lookup.bind(function(a){h.ok().disable()});l.events.setActive.bind(function(a){F()});h.events.ok.bind(function(){l.selected().each(function(a){k.trigger.insertAssets([a]);I()})});h.events.cancel.bind(I);F();return{show:function(){g.deviceType.isiOS()&&(S.hidden(b.element(),!0),setTimeout(function(){l.focus();S.hidden(b.element(),!1)},250));V.show();m.enter();
k.trigger.analytics("insert_image_opened");k.trigger.opened();var c=r.fromDom(window);q=K.bind(c,"orientationchange",function(){a.foreground()})},element:V.element,events:k.registry,destroy:function(){m.exit();m.destroy();V.hide();V.destroy();l.destroy();h.destroy()}}}function ZW(a){var b=H.create({success:p(["assets"]),invalidUrl:p(["url"]),empty:p([]),lookup:p([])}),c=[],d=T.div(),e=n.toggler(d,Sb.resolve("url-indicator-loading")),f=fr();f.events.start.bind(function(){e.on()});f.events.fail.bind(function(a){e.off();
b.trigger.invalidUrl(a.url());c=[]});f.events.success.bind(function(a){e.off();var d=fa.get(C);a.url()===d?ve.fromImages([a.image()]).get(function(a){c=a;b.trigger.success(c)}):f.go(d)});var h=T.div();n.add(h,Sb.resolve("url-selector"));var l=r.fromTag("label");a=r.fromText(a("fileupload.web.url"));var q=Ha(Sb.resolve("input-id"));m.set(l,"for",q);n.add(l,Sb.resolve("url-input-label"));y.append(l,a);var C=r.fromTag("input");m.setAll(C,{id:q,type:"url",placeholder:"http://www.example.com/image.jpg"});
n.add(C,Sb.resolve("url-input"));eA.os.isAndroid()&&m.set(C,"autofocus","true");eA.browser.isSafari()&&m.setAll(C,{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});S.required(C);a=r.fromHtml("<span role=presentation>*</span>");n.add(a,Sb.resolve("url-input-required"));y.append(l,a);P.append(h,[l,C,d]);var w=jf(function(a){""!==a&&f.go(a)},1E3),I=K.bind(C,"input",function(){var a=fa.get(C);""===a.trim()?(b.trigger.empty(),w.throttle("")):(b.trigger.lookup(),w.throttle(a))});
return{element:k(h),input:k(C),events:b.registry,reset:function(){e.off();fa.set(C,"")},focus:function(){Z.focus(C)},selected:function(){return g.from(c[0])},destroy:function(){I.unbind()}}}function fA(a){var b=H.create({lookup:p([]),success:p([])}),c=T.span(),d=r.fromHtml('<div role=presentation><span role=presentation class="'+Sb.resolve("url-input-required")+'">*</span> '+a("fileupload.weburlhelp")+"</div>"),e=Ha(Sb.resolve("help-message"));m.set(d,"id",e);n.add(d,Sb.resolve("fileupload-weburl-help"));
var f=r.fromHtml("<div role=presentation><div role=presentation>"+a("fileupload.invalid1")+"</div><div role=presentation>"+a("fileupload.invalid2")+"</div><div role=presentation>"+a("fileupload.invalid3")+"</div></div>");n.add(f,Sb.resolve("fileupload-weburl-help"));n.add(f,Sb.resolve("fileupload-weburl-help-invalid"));var h=function(a){G.empty(w);y.append(w,a)},l=function(a){var b=r.fromTag("img");y.append(w,b);$W.previewAsset(a,b)},q=T.div();n.add(q,Sb.resolve("web-url-container"));var g=ZW(a),
w=T.div();n.add(w,Sb.resolve("image-preview-container"));a=Ha("ephox-hermes-url-state");S.live(w,a,"polite");S.controls(g.input(),a);S.describedBy(g.input(),e);e=T.div();n.add(e,Sb.resolve("hbox"));P.append(e,[g.element(),w,d]);y.append(q,e);g.events.lookup.bind(function(a){b.trigger.lookup();G.empty(w)});g.events.success.bind(function(a){z(a.assets(),l);b.trigger.success()});g.events.invalidUrl.bind(function(){h(f)});g.events.empty.bind(function(){h(c)});h(c);return{element:k(q),selected:g.selected,
input:g.input,events:b.registry,focus:g.focus,reset:function(){h(c);g.reset()},destroy:function(){g.destroy()}}}function aX(a){a=T.div();var b=fA(x.translate),c=H.create({upload:p(["assets"]),dragndrop:p(["assets"]),dragover:p([]),dragleave:p([]),drop:p([]),setActive:p(["item"]),lookup:Q([],b.events.lookup),success:Q([],b.events.success)}),d=[function(){var a=b.input();return ha.input(a,Ba.input({}))}()];y.append(a,b.element());return{element:k(a),events:c.registry,keylayouts:k(d),reset:function(){b.reset()},
focus:b.focus,selected:b.selected,destroy:function(){b.destroy()}}}function bX(a,b,c,d,e){var f=H.create({insertAsset:p(["asset"]),open:p([]),done:p([]),abort:p([])}),h=r.fromDom(document);d=zb.mainmenu(h,"file-upload-menu",[]);var l=function(a,b){a=zb.item(h,a,x.get(b)+"...");S.menuItem(a,g.some(x.get(b)),g.none());return a},q=l("from-url",x.key("image.from-url"));l=l("from-camera",x.key("image.from-camera"));q=!0===e.allowLocalImages?[q,l]:[q];var C=aA();C.events.upload.bind(function(a){g.from(a.assets()[0]).each(function(a){I();
f.trigger.insertAsset(a)})});var w=function(a){a=a.assets();z(a,function(a){f.trigger.insertAsset(a)})},I=function(){Hz.target(c.uiContainer(),"mousedown")};P.append(d,q);d={name:"image",textkey:x.key("image.menu-button"),menuTextkey:x.key("image.menu"),icon:g.none,tooltip:qb.get,contentFocus:!1,toggle:!1};q=[[{handlers:k({"from-url":function(d){f.trigger.open();var h=dA(a,b,c.uiContainer(),aX,e,ha.dialog);h.events.insertAssets.bind(w);d=function(){a.focus();h.destroy()};h.events.opened.bind(I);h.events.close.bind(d);
h.events.escaped.bind(d);h.show()},"from-camera":function(){f.trigger.open();C.open()}}),destroyer:t,refreshMenu:t,structure:k({}),submenus:k([]),items:k(q),events:f.registry}]];d=df.menu(d,q,x.get,rj.menu({focusActive:!0}));q={label:k(!1),hasDialog:!0};return ua(d,q)}function cX(a){var b=r.fromTag("button");m.set(b,"type","button");n.add(b,lb.resolve("independent-button"));return Gq(b,g.none(),a)}function dX(a){var b=bA.multiple(),c=T.div();n.add(c,Sb.resolve("drop-container"));var d=gA.register(c,
g.some(Sb.resolve("drop-active")),!1),e=cX();e.content(Rc(a("fileupload.chooseimage")));n.add(e.element(),Sb.resolve("default-action"));n.add(e.element(),Sb.resolve("file-selector-trigger"));var f=r.fromTag("p");n.add(f,Sb.resolve("help-text-drop-icon"));var h=r.fromTag("p");n.add(h,Sb.resolve("help-text-drop"));ra.disable(h);y.append(h,r.fromText(a("fileupload.dropimages")));P.append(c,[f,h,e.element(),b.element()]);return{container:k(c),dropper:k(d),picker:k(b),button:k(e),focus:function(){Z.focus(e.element())},
destroy:function(){b.destroy();d.destroy();e.destroy()}}}function eX(a){var b=dX(a);a=b.picker();var c=b.container(),d=b.dropper(),e=b.button(),f=H.create({upload:p(["assets"]),dragndrop:p(["assets"]),dragover:Q([],d.events.dragover),dragleave:Q([],d.events.dragleave),drop:Q([],d.events.drop)}),h=function(a){return function(b){ve.multiple(b.files()).get(function(b){a(b)})}};a.events.upload.bind(h(f.trigger.upload));d.events.dragndropimages.bind(h(f.trigger.dragndrop));e.events.click.bind(a.open);
return{element:k(c),button:k(e),input:a.element,focus:b.focus,events:f.registry,destroy:function(){b.destroy()}}}function hA(a,b,c){var d=[],e=O("view","item","container"),f=H.create({setActive:p(["item"])}),h=T.div();n.add(h,lb.resolve("tablayout-wrapper"));n.add(h,lb.resolve("tablayout-wrapper-"+a));void 0!==c&&n.add(h,c);var l=T.div();n.add(l,lb.resolve("tablayout-body"));var q=r.fromTag("div");n.add(q,lb.resolve("tablayout-menu"));P.append(h,[q,l]);var g=function(a){var b=Hq(a);b.content(Rc(a));
n.add(b.element(),lb.resolve("tablayout-item"));return b},w=[],I=E(b,function(a){var b=g(a.heading());m.set(b.element(),"data-ephox-pastry-tablayout-tab",a.heading());y.append(q,b.element());var c=r.fromTag("div");n.add(c,lb.resolve("tablayout-content"));m.set(c,"data-ephox-pastry-tablayout-view",a.heading());y.append(l,c);w.push(c);var f=e(a,b,c);d.push(f);b.events.click.bind(function(){F(f)});return b}),F=function(a){z(d,function(b){var c=b.view(),d=b.item(),e=b.container();b===a?(n.add(e,lb.resolve("tablayout-active")),
d.select(),c.renderer().render(e),f.trigger.setActive(d)):(n.remove(e,lb.resolve("tablayout-active")),d.deselect())})};F(d[0]);return{element:function(){return h},tabs:k(I),body:k(l),menu:k(q),tabContent:k(w),destroy:function(){z(I,function(a){a.destroy()})},events:f.registry}}function iA(a){return{render:function(b){G.empty(b);y.append(b,a)}}}function fX(a){var b=T.div(),c=eX(x.translate),d=fA(x.translate),e=function(a,b){a=x.translate(a);b=iA(b);return Sg(a,b)},f=e("fileupload.tabweburl",d.element());
a=(a.allowLocalImages?[e("fileupload.tablocal",c.element())]:[]).concat(f);var h=hA(or.top(),a,"file-upload");S.hidden(c.input(),!0);e=function(){var a=c.button();n.add(a.element(),B.resolve("dialog-button-default"));var b=aa.detect().browser.isFirefox(),d={execute:Kb.button};b=b?ua(d,{process:t}):d;b=Ba.button(b);return ha.button(a.element(),b)}();S.tabList(h.menu());f=function(){var a=d.input();return ha.input(a,Ba.input({}))}();var l=ha.flow(h.menu(),{item:k(".ephox-pastry-statebutton")},Ba.flow({trigger:Kb.button,
executeOnArrow:!0}));e=[l].concat(e).concat(f);var q=h.tabs();z(h.tabContent(),function(a){S.tabPanel(a)});z(a,function(a,b){var c=q[b];S.tabButton(c.element(),a.heading());n.add(c.element(),B.resolve("tab-button"));c.events.click.bind(function(){l.clickFocus(c.element())})});z(h.tabContent(),function(a,b){b=q[b];var c=Ha("ephox-aria");m.set(b.element(),"id",c);S.labelledBy(a,c)});a=H.create({upload:Q(["assets"],c.events.upload),dragndrop:Q(["assets"],c.events.dragndrop),dragover:Q([],c.events.dragover),
dragleave:Q([],c.events.dragleave),drop:Q([],c.events.drop),lookup:Q([],d.events.lookup),success:Q([],d.events.success),setActive:Q(["item"],h.events.setActive)});h.events.setActive.bind(function(a){a=m.get(a.item().element(),"data-ephox-pastry-tablayout-tab");a===x.translate("fileupload.tablocal")?c.focus():a===x.translate("fileupload.tabweburl")&&d.focus()});y.append(b,h.element());return{element:k(b),events:a.registry,focus:d.focus,keylayouts:k(e),reset:function(){d.reset()},selected:d.selected,
destroy:function(){h.destroy();c.destroy();d.destroy()}}}function ge(a,b,c){a=parseFloat(a);a>c?a=c:a<b&&(a=b);return a}function Tf(a,b){var c,d,e,f,h=[],l=Array(10);for(c=0;5>c;c++){for(d=0;5>d;d++)h[d]=b[d+5*c];for(d=0;5>d;d++){for(e=f=0;5>e;e++)f+=a[d+5*e]*h[e];l[d+5*c]=f}}return l}function pr(a,b){b=ge(b,0,1);return a.map(function(a,d){a=0===d%6?1-(1-a)*b:a*b;return ge(a,0,1)})}function xm(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=Uc.get2dContext(c),f=e.getImageData(0,0,c.width,
c.height),h=f.data,l,q=b[0],g=b[1],k=b[2],I=b[3],F=b[4],V=b[5],m=b[6],n=b[7],p=b[8],r=b[9],t=b[10],u=b[11],v=b[12],z=b[13],y=b[14],x=b[15],A=b[16],B=b[17],D=b[18],E=b[19];for(l=0;l<h.length;l+=4){var G=h[l];var H=h[l+1];var J=h[l+2];var K=h[l+3];h[l]=G*q+H*g+J*k+K*I+F;h[l+1]=G*V+H*m+J*n+K*p+r;h[l+2]=G*t+H*u+J*v+K*z+y;h[l+3]=G*x+H*A+J*B+K*D+E}e.putImageData(f,0,0);return xe.fromCanvas(c,d)})}function jA(a,b){return a.toCanvas().then(function(c){return gX(c,a.getType(),b)})}function gX(a,b,c){var d=
Uc.get2dContext(a);var e=d.getImageData(0,0,a.width,a.height);var f=d.getImageData(0,0,a.width,a.height);f=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var e,f,h,l,q,g;var k=Math.round(Math.sqrt(c.length));var m=Math.floor(k/2);var n=a.data;var p=b.data;var r=a.width;var t=a.height;for(e=0;e<t;e++)for(a=0;a<r;a++){for(g=f=h=l=0;g<k;g++)for(q=0;q<k;q++){var u=d(a+q-m,0,r-1);var v=d(e+g-m,0,t-1);u=4*(v*r+u);v=c[g*k+q];f+=n[u]*v;h+=n[u+1]*v;l+=n[u+2]*v}u=4*(e*r+a);p[u]=d(f,0,255);p[u+
1]=d(h,0,255);p[u+2]=d(l,0,255)}return b}(e,f,c);d.putImageData(f,0,0);return xe.fromCanvas(a,b)}function kA(a){return function(b,c){return b.toCanvas().then(function(d){var e=b.getType(),f=Uc.get2dContext(d),h,l=Array(256);for(h=0;h<l.length;h++)l[h]=a(h,c);h=f.getImageData(0,0,d.width,d.height);var q=h.data,g;for(g=0;g<q.length;g+=4)q[g]=l[q[g]],q[g+1]=l[q[g+1]],q[g+2]=l[q[g+2]];f.putImageData(h,0,0);return xe.fromCanvas(d,e)})}}function Mh(a){return function(b,c){return xm(b,a(of.identity(),c))}}
function lA(a){return function(b){return jA(b,a)}}function mA(a,b,c){var d=Nh.getWidth(a),e=Nh.getHeight(a);d=b/d;var f=c/e;e=!1;if(.5>d||2<d)d=.5>d?.5:2,e=!0;if(.5>f||2<f)f=.5>f?.5:2,e=!0;a=hX(a,d,f);return e?a.then(function(a){return mA(a,b,c)}):a}function hX(a,b,c){return new Md(function(d){var e=Nh.getWidth(a),f=Nh.getHeight(a),h=Math.floor(e*b),l=Math.floor(f*c),q=Uc.create(h,l);Uc.get2dContext(q).drawImage(a,0,0,e,f,0,0,h,l);d(q)})}function iX(a,b,c,d,e){var f=a.content(),h=a.smartview(),l=
a.ui().tabstrip,q=nr(a.ui),g=Fj.processResults(q.showKey),w=function(d){a.undo().save();d=jX.validate(d);(d.failure()?u(q.showKey,"fileupload.invalidimages"):q.hide)();c.assets(d.assets()).bind(nA.maybeDoRotate).map(g).get(function(a){qr.insertAssets(f,b,a)})},I=function(a){w(a.assets())};d.events.insertAssets.bind(function(a){e.allowLocalImages?w(a.assets()):mf.getOrLog("errors.dragdrop.images.disallowed")});var F=f.cursor();d=H.create({analytics:p(["message"])});return{ui:wb.ui({"fileupload.general":k({value:"image",
textkey:x.key("insert.image"),icon:!0,updateGeneral:ca,action:function(){var b=dA(f,l,h.uiContainer(),fX,e,ha.dialog);b.events.insertAssets.bind(I);b.events.close.bind(function(){f.focus();b.destroy()});b.events.escaped.bind(function(){f.focus();b.destroy()});a.content().hideInlineSelection();b.show()},hasDialog:!0}),"fileupload.menu":function(){var c=bX(f,l,h,a.ui(),e);c.events.insertAsset.bind(function(a){F.get().bind(function(c){qr.insertMobileAssets(f,c,b,[a.asset()])})});c.events.open.bind(function(a){f.getSelection().each(F.save)});
return c},"camera.general":function(){var a=aA();a.events.upload.bind(function(a){F.get().bind(function(c){qr.insertMobileAssets(f,c,b,a.assets())})});return{value:"image",textkey:x.key("image.from-camera"),icon:!0,updateGeneral:ca,action:function(){f.getSelection().each(F.save);f.toReading();a.open()},hasDialog:!0}}},ca),events:d.registry,destroy:function(){}}}function oA(a,b,c){var d=function(){b.counter.update(0,0)},e=function(e){e.all.fold(d,function(d){b.counter.update(e.pos+1,d.length);d=d[e.pos][0];
a.setSelection(d,0,d,0);c.element(d)})},f=function(){c.cursor();d()},h=function(a,b,c){pf.clear(a);pf.search(a,b,c).fold(f,e);return g.some(b)},l=function(a,b){a=(!0===b?pf.prev:pf.next)(a);a.fold(f,e);return a},q=function(b){a.body().each(function(c){pf.replace(c,b).fold(f,e);a.domChanged();a.undoChanged()})},C=g.none(),w=function(){C=g.none()};b.events.search.bind(function(b){a.body().each(function(a){h(a,b.term(),b.matchcase())})});b.events.next.bind(function(){a.body().each(function(a){l(a,!1)})});
b.events.prev.bind(function(){a.body().each(function(a){l(a,!0)})});b.events.replace.bind(function(a){q(a.value())});b.events.replaceAll.bind(function(b){a.body().each(function(c){pf.replaceAll(c,b.value()).fold(f,e);a.undoChanged()})});b.events.interactive.bind(function(b){a.body().each(function(a){C=h(a,b.term(),b.matchcase())})});b.events.encase.bind(function(b){a.body().each(function(a){C.each(function(c){h(a,c,b.matchcase())})})});b.events.clear.bind(function(b){a.body().each(function(a){pf.clear(a);
w()})});return{zeroCount:d,updateMatch:e,enterSearchAction:function(c,d){a.body().each(function(a){var e=b.getCase();C=C.filter(function(a){return c===a}).fold(function(){return h(a,c,e)},function(b){return l(a,d.isShift()).fold(function(){return h(a,c,e)},k(C))})});(0===c.length?b.counter.hide:b.counter.show)()},enterReplaceAction:q,clearLastSearch:w}}function pA(a){var b=a.content();a=function(a){b.elementIntoView(a)};var c=function(){b.cursorIntoView()};a={element:qA?a:u(Og.elementIntoView,b),
cursor:qA?c:u(Og.cursorIntoView,b)};return{get:k(a)}}function rA(){var a=T.div();n.add(a,B.resolve("search-widget"));var b=ym.searchField(),c=(xc.isSmallTouch()?ym.dummyCounter:ym.counter)(b.input()),d=ym.replaceDrawer(),e=d.element(),f=H.create({next:Q([],b.events.next),prev:Q([],b.events.previous),replace:p(["value"]),replaceAll:p(["value"]),search:p(["term","matchcase","isShift"]),interactive:p(["term","matchcase"]),encase:p(["matchcase"]),clear:p([])});ra.setPressed(d.matchcase.element(),d.matchcase.selected());
var h=wy(e);S.linkElements(b.moreToggle.element(),e);sA(h.visible(),b.moreToggle.element(),e);b.moreToggle.events.click.bind(function(){(h.visible()?h.hide:h.show)()});b.events.input.bind(function(){var a=fa.get(b.input()),d=sa.get(b.element());v.set(c.element(),"height",d+"px");3<=a.length?q.throttle(a):(f.trigger.clear(),c.hide(),c.update(0,0))});d.replace.events.click.bind(function(){var a=fa.get(d.input.element());f.trigger.replace(a)});d.replaceAll.events.click.bind(function(){var a=fa.get(d.input.element());
f.trigger.replaceAll(a)});d.matchcase.events.click.bind(function(){ra.setPressed(d.matchcase.element(),d.matchcase.selected());f.trigger.encase(l())});var l=function(){return d.matchcase.selected()},q=jf(function(a){c.show();f.trigger.interactive(a,l())},500),g=K.bind(e,"transitionend",function(a){"opacity"===a.raw().propertyName&&n.remove(e,"ephox-chameleon-toolbar-more-open");sA(h.visible(),b.moreToggle.element(),e)});P.append(a,[c.element(),b.element(),d.element()]);return{element:k(a),search:b,
focus:function(){b.focus()},drawer:d,counter:c,getCase:l,destroy:function(){g.unbind();b.destroy();d.destroy();c.destroy();h.destroy();G.remove(a)},events:f.registry}}function kX(a){var b=a.content(),c=rA();a=pA(a);var d=oA(b,c,a.get()),e=function(a){var c=a.endContainer();a=a.endOffset();b.setSelection(c,a,c,a)};a=Ba.button({execute:Kb.button});a=[ha.input(c.search.input(),Ba.input({execute:function(a,b){d.enterSearchAction(a,b)}})),ha.button(c.search.previous(),a),ha.button(c.search.next(),a),ha.button(c.search.moreToggle.element(),
a),ha.input(c.drawer.input.element(),Ba.input({execute:function(a,b){d.enterReplaceAction(a)}})),ha.button(c.drawer.matchcase.element(),a),ha.button(c.drawer.replace.element(),a),ha.button(c.drawer.replaceAll.element(),a)];var f=H.create({done:p([])});return{element:c.element,anchorName:k("search-widget-anchor"),textkey:k("action.search"),dialogTextkey:k("search.menu"),destroy:function(){c.destroy()},keylayouts:k(a),openWidget:function(){d.enterSearchAction(fa.get(c.search.input()),Od.shiftKeyState(!1))},
closeWidget:function(){b.body().each(function(a){b.getSelection().each(e);pf.clear(a)});d.clearLastSearch()},events:f.registry}}function lX(a,b){var c=a.content(),d=rA();a=pA(a);var e=oA(c,d,a.get());a=H.create({toEditor:p([])});b=Gj.text(d.search.element(),d.search.input());return{element:d.element,addEscape:function(a){y.append(d.search.element(),a.element())},open:function(){e.enterSearchAction(fa.get(d.search.input()),Od.shiftKeyState(!1));setTimeout(d.focus,250)},close:function(){c.body().each(function(a){pf.clear(a).fold(e.zeroCount,
e.updateMatch)});e.clearLastSearch()},execute:function(a){if(Z.hasFocus(d.search.input())){a=Od.shiftKeyState(!0===a.raw().shiftKey);var b=fa.get(d.search.input());e.enterSearchAction(b,a)}else a=fa.get(d.drawer.input.element()),e.enterReplaceAction(a)},type:k(b),events:a.registry,destroy:function(){d.destroy()}}}function zm(a,b){mX(b);var c=a.content(),d=a.ui().tabstrip.element();n.add(b.element(),B.resolve("slick-widget"));nX.browser.isSafari()&&z(Y.descendants(b.element(),"input,textarea"),function(a){m.setAll(a,
{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})});var e=function(){var a=Y.descendants(b.element(),"input,textarea");Va(a,Z.hasFocus).each(function(b){b=(b+1)%a.length;0<=b&&b<a.length&&Z.focus(a[b])})},f=Gj.cata(b.type(),function(a,c){n.add(a,B.resolve("slick-widget-field"));n.add(c,B.resolve("slick-widget-input"));var d=K.bind(b.element(),"keydown",function(a){var c={original:k(a)};fe.isEnter(c)?(b.execute(a),a.kill()):fe.isTab(c)?(e(),a.kill()):fe.isEscape(c)&&(w(),
a.kill())}),f=K.bind(c,"blur",function(a){g.from(a.raw().relatedTarget).each(function(a){!0===Ja.ancestor(r.fromDom(a),function(a){return n.has(a,"ephox-polish-mobile-toolbar-hide")}).isSome()&&rr.refreshInput(c)})});return{destroy:function(){d.unbind();f.unbind()}}});a=Oc("shizniz");var h=x.translate("toolbar.backbutton"),l=bf([va.resolve("icon")]);a.content(l);m.set(a.element(),"title",h);S.toolbarButton(a.element(),h,!1,!1);b.addEscape(a);var q=na(!1);y.prepend(d,b.element());var C=H.create({done:p([]),
abort:p([]),open:p([]),close:p([])}),w=function(){F();c.toEditing()};b.events.toEditor.bind(w);var I=gc(function(a){return Y.children(d,"."+va.resolve("toolbar"))}),F=function(){b.close();q.set(!1);z(I(),function(a){n.remove(a,B.resolve("mobile-toolbar-hide"))});n.remove(b.element(),B.resolve("mobile-toolbar-show"));n.add(b.element(),B.resolve("mobile-toolbar-hide"));C.trigger.close()};c.events.mousedown.bind(F);F();a.events.click.bind(function(){w();C.trigger.abort()});return{element:b.element,destroy:function(){c.events.mousedown.unbind(F);
f.destroy();b.destroy()},events:C.registry,open:function(){var a=K.bind(d,"transitionend",function(){b.open();C.trigger.open();a.unbind()});q.set(!0);z(I(),function(a){n.remove(a,B.resolve("mobile-toolbar-show"));n.add(a,B.resolve("mobile-toolbar-hide"))});n.remove(b.element(),B.resolve("mobile-toolbar-hide"));n.add(b.element(),B.resolve("mobile-toolbar-show"))},close:F,isOpen:function(){return q.get()}}}function oX(a){var b=a.filter();Od.configure(b);var c=H.create({analytics:p(["message"])}),d=
gc(function(){var b=pX(a);b.events.open.bind(function(){c.trigger.analytics("search_tool_open")});b.events.abort.bind(b.close);return b});b=function(){var a=d();(a.isOpen()?a.close:a.open)()};a.shortcuts().events.search.bind(b);return{ui:wb.ui({"find.general":{toggle:!1,hasPopup:!1,value:"search",textkey:x.key("action.search"),action:b,updateGeneral:function(a){n.add(a.element(),B.resolve("search"))},icon:!0,tooltip:qb.get}}),events:c.registry,destroy:function(){d().destroy()}}}function Hj(a,b){var c=
Oc();ma.add(c.element(),a);S.button(c.element(),x.translate(b));m.set(c.element(),"title",x.translate(b));return c}function qX(a,b){var c=rX(Am.configuration()),d=c.i18nNamespace(),e=c.cssNamespace();b=T.div();n.add(b,B.resolve("fontsize-widget"));var f=T.span();n.add(f,B.resolve("fontsize-widget-field"));var h=T.div();n.add(h,B.resolve("fontsize-widget-exit"));var l=r.fromTag("input");n.add(l,B.resolve("fontsize-widget-input"));S.label(l,x.translate(d+".stepper.input"));var q=function(b){n.remove(l,
B.resolve("slick-widget-invalid-input"));S.invalid(l,!1);fa.set(l,b);Uf.partialSize(a.content(),a.undo(),a.selections(),b);ib.speak(ja.body(),b)},g=function(){n.add(l,B.resolve("slick-widget-invalid-input"));S.invalid(l,!0);ib.speak(ja.body(),x.translate("aria.input.invalid"));Z.focus(l)},w=function(a){return function(){var b=fa.get(l);b=a(c.specials(),b);Vf.validate(b,c.tag(),c.property()).fold(g,q)}},I=w(Bm.decrease);w=w(Bm.increase);var F=function(a,b){return Hj([B.resolve(e+a),B.resolve("stepper-button")],
d+b)},m=F("-stepper-decrease",".stepper.decrease");F=F("-stepper-increase",".stepper.increase");m.events.click.bind(I);F.events.click.bind(w);P.append(f,[m.element(),l,F.element()]);y.append(b,f);y.append(b,h);f=Gj.text(f,l);var X=H.create({toEditor:p([]),size:p(["value"])}),Hc=function(){fa.set(l,"")},u=function(a){a=Vf.sanitise(a);Vf.validate(a,c.tag(),c.property()).fold(g,function(a){n.remove(l,B.resolve("slick-widget-invalid-input"));S.invalid(l,!1)});fa.set(l,a)};return{element:k(b),addEscape:function(a){y.append(h,
a.element())},open:function(){Z.focus(l)},close:t,execute:function(){var a=fa.get(l);Vf.validate(a,c.tag(),c.property()).fold(g,function(a){q(a);X.trigger.toEditor()})},destroy:t,type:k(f),represent:function(a){a.fold(Hc,u,u)},events:X.registry}}function sX(a,b){var c=a.content(),d=na(g.none()),e=function(){var c=qX(a,b),e=zm(a,c);c={represent:c.represent,refreshValue:c.refreshValue,open:e.open,close:e.close,isOpen:e.isOpen};d.set(g.some(c));return c},f={toggle:!1,value:"size",textkey:x.key("font.size"),
action:function(){var b=d.get().getOrThunk(e);if(b.isOpen())b.close();else{var f=Cm.getState(a.selections(),c);b.open();b.represent(f.readState.size())}},updateGeneral:t,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!1};return{general:k(f)}}function tA(a){var b=a.hex(),c=r.fromTag("span");n.add(c,B.resolve("palette-detail-action"));m.set(c,"title",x.get(a.name()));S.option(c,x.get(a.name()),!1,!1);var d=H.create({selected:p(["value"])}),e=K.bind(c,"click",function(){Z.focus(c);d.trigger.selected(b)});
return{element:function(){return c},value:k(b),destroy:function(){e.unbind();G.remove(c)},events:d.registry}}function tX(){var a=[],b=T.div(),c=r.fromTag("span");S.listBox(c);n.add(c,B.resolve("palette-detail-actions"));n.add(c,B.resolve("palette-color-options"));S.label(c,x.translate("aria.font.palette"));y.append(b,c);var d=Ql.create(),e=H.create({selected:p(["value"])});return{element:function(){return b},add:function(b){a.push(b.destroy);y.append(c,b.element());d.bind(b.events.selected,function(a){e.trigger.selected(a.value())})},
remove:function(a){G.remove(a.element());d.unbind(a.events.selected)},show:function(){n.add(b,B.resolve("palette-detail-active"));ra.showPanel(b);v.remove(b,"display")},hide:function(){n.remove(b,B.resolve("palette-detail-active"));ra.hidePanel(b);v.set(b,"display","none")},count:function(){return a.length},destroy:function(){z(a,xb);G.remove(b);a=[]},events:e.registry}}function Dm(a){var b=Ij.makeLayout(a,".ephox-polish-palette-detail-action.ephox-polish-palette-color-option:not(.ephox-polish-palette-color-option-spacer)",
{isValid:uA}),c=b.layout();return{isFocused:c.isFocused,enterGrid:c.enter,grid:c,refresh:b.refresh,destroy:c.destroy,clear:c.clear,isActive:function(){return uA(a)}}}function uX(){var a=r.fromTag("div");vX()?S.presentation(a):S.menuItem(a,g.none(),g.none());n.add(a,B.resolve("color-widget"));var b=r.fromTag("div");n.add(b,B.resolve("color-widget-controls"));S.tabList(b);var c=r.fromTag("div");n.add(c,B.resolve("color-widget-palettes"));S.toolbarGroup(c);var d=$d("text-color");n.add(d.element(),B.resolve("tab-button"));
d.content(Rc(x.translate("font.color")));S.tabButton(d.element(),x.translate("aria.font.color"));var e=$d("highlight-color");n.add(e.element(),B.resolve("tab-button"));e.content(Rc(x.translate("font.highlight")));S.tabButton(e.element(),x.translate("aria.font.highlight"));y.append(b,d.element());y.append(b,e.element());y.append(a,b);y.append(a,c);return{element:k(a),colorToggle:k(d),highlightToggle:k(e),content:k(c),controls:k(b),destroy:function(){d.destroy();e.destroy();G.remove(c);G.remove(b)}}}
function wX(a,b){var c=null;return{cancel:function(){null!==c&&(sr(c),c=null)},schedule:function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];c=Kf(function(){a.apply(null,d);c=null},b)}}}function xX(){var a={},b=function(a,b){return Jj(b).fold(function(){return g.none()},function(c){c=Kj(c);return a.bind(c).map(function(a){return yX(b,a)})})};return{registerId:function(b,d,e){Ma(e,function(c,e){var f=void 0!==a[e]?a[e]:{};var h=u.apply(void 0,[c.handler].concat(b));c=c.purpose();h=
{cHandler:h,purpose:k(c)};f[d]=h;a[e]=f})},unregisterId:function(b){Ma(a,function(a,c){a.hasOwnProperty(b)&&delete a[b]})},filterByType:function(b){return zc(a,b).map(function(a){return Nf(a,function(a,b){return{id:k(b),descHandler:k(a)}})}).getOr([])},find:function(c,d,e){var f=Kj(d)(a);return zX(e,function(a){return b(f,a)},c)}}}function AX(){var a=xX(),b={},c=function(a){var b=a.element();return Jj(b).fold(function(){var b=a.element(),c=Ha(BX+"uid-");m.set(b,vA,c);return c},function(a){return a})},
d=function(c){Jj(c.element()).each(function(c){b[c]=void 0;a.unregisterId(c)})};return{find:function(b,c,d){return a.find(b,c,d)},filter:function(b){return a.filterByType(b)},register:function(e){var f=c(e);if(ye(b,f)){var h=b[f];if(h===e)d(e);else throw Error('The tagId "'+f+'" is already used by: '+Tg(h.element())+"\nCannot use it for: "+Tg(e.element())+"\nThe conflicting element is"+(ja.inBody(h.element())?" ":" not ")+"already in the DOM");}a.registerId([e],f,e.events());b[f]=e},unregister:d,
getById:function(a){return Kj(a)(b)}}}function CX(a){var b=H.create({color:p(["color"]),close:p([])}),c=we(a),d=td.okCancel("custom-color"),e=r.fromTag("div");S.presentation(e);n.add(c.element(),B.resolve("dialog-narrow"));c.setTitle(x.translate("font.coloroption"));c.setContent(e);c.setControls(d.element());a=DX();var f=Lb.create("ephox-acid"),h=function(a){return f.resolve(a)},l=EX.makeFactory(x.translate,h),q=Em(l.sketch({dom:{tag:"div",classes:[h("color-picker-container")],attributes:{role:"presentation"}},
onValidHex:function(){d.ok().enable()},onInvalidHex:function(){d.ok().disable()}}));a.add(q);FX(e,a);e=Y.descendants(e,"input");h=e[e.length-1];e=[ha.input(e[0],Ba.input({})),ha.input(h,Ba.input({}))];var g=Kb.setup(c,d,e),k=function(){b.trigger.close();g.exit()};c.events.close.bind(function(){k()});d.events.ok.bind(function(){ze.getCurrent(q).fold(function(){console.error("Could not find colour picker hex.")},function(a){Wb.getValue(a).hex.each(function(a){b.trigger.color("#"+a)})});k()});d.events.cancel.bind(k);
return{element:a.element,events:b.registry,open:function(){c.show();g.enter()},destroy:function(){c.destroy();d.destroy();g.destroy()},close:k}}function GX(a,b){var c=CX(b),d=H.create({color:Q(["color"],c.events.color),close:p([])}),e=function(){d.trigger.close();f();a.focus()},f=function(){c.events.close.unbind(e);c.destroy()};c.events.close.bind(e);return{show:function(){a.toReading();c.open()},close:e,destroy:f,events:d.registry}}function HX(a,b,c){var d=Ij.create(c.colors.buttons),e=Ij.create(c.colors.buttons),
f=(c.colors.custom?Fm.create:Fm.stub)(a,b),h=H.create({color:p(["value"]),highlight:p(["value"]),abort:p([]),menuDone:Q([],f.events.menuDone)});d.events.selected.bind(function(a){h.trigger.color(a.value())});e.events.selected.bind(function(a){h.trigger.highlight(a.value())});var l=uX();f.events.selected.bind(function(a){a=a.color();I.isActive()?h.trigger.highlight(a):h.trigger.color(a)});var q=l.colorToggle(),g=l.highlightToggle();S.linkTabToPanel(q.element(),d.element());S.linkTabToPanel(g.element(),
e.element());y.append(l.content(),d.element());y.append(l.content(),e.element());P.append(l.content(),f.elements);var w=Dm(d.element()),I=Dm(e.element()),F=ha.flow(l.controls(),{item:k(".ephox-pastry-statebutton")},Ba.flow({trigger:function(a,b){return L.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})},executeOnArrow:!0})),m=ha.multiple(l.element(),[F,w.grid,I.grid].concat(f.layouts));m.events.exit.bind(function(a){h.trigger.abort()});var X=function(){e.hide();q.select();
g.deselect();ra.tabSelected(q.element(),[g.element()]);w.refresh();I.refresh();d.show()};q.events.click.bind(function(){F.clickFocus(q.element());X()});g.events.click.bind(function(){F.clickFocus(g.element());d.hide();q.deselect();ra.tabSelected(g.element(),[q.element()]);e.show()});return{element:l.element,destroy:function(){f.destroy();d.destroy();m.destroy();e.destroy();l.destroy()},open:function(){f.refresh();m.clear();m.refresh();q.click();X();m.enter()},close:function(){m.exit()},events:h.registry}}
function IX(){var a=g.none(),b=function(b){a.each(function(a){a[b]()})};return{enter:u(b,"enter"),exit:u(b,"exit"),destroy:u(b,"destroy"),set:function(b){a=g.some(b)}}}function JX(a,b){var c=b.i18nNamespace();b=b.cssNamespace();var d=H.create({plus:p([]),minus:p([]),validate:p([]),abort:p([])}),e=Oc(),f=Oc(),h=T.div(),l=T.div(),q=r.fromTag("input");S.label(q,x.translate(c+".stepper.input"));S.toolbarButton(e.element(),x.translate(c+".stepper.increase"),!1,!1);S.toolbarButton(f.element(),x.translate(c+
".stepper.decrease"),!1,!1);m.set(q,"tabindex","-1");m.set(e.element(),"tabindex","-1");m.set(f.element(),"tabindex","-1");n.add(l,B.resolve(b+"-stepper-input"));n.add(h,B.resolve(b+"-stepper-options"));n.add(e.element(),B.resolve("stepper-button"));e.content(bf([B.resolve(b+"-stepper-increase")]));n.add(f.element(),B.resolve("stepper-button"));f.content(bf([B.resolve(b+"-stepper-decrease")]));y.append(l,q);P.append(h,[e.element(),f.element()]);P.append(a,[l,h]);e.events.click.bind(function(){Z.focus(e.element());
d.trigger.plus()});f.events.click.bind(function(){Z.focus(f.element());d.trigger.minus()});var C=function(){q.dom().setSelectionRange(0,fa.get(q).length)},w=K.capture(a,"click",function(a){N.eq(a.target(),l)&&I.enter()}),I=IX(),F=n.toggler(q,B.resolve("invalid-"+b+"-size"));return{destroy:function(){e.destroy();f.destroy();I.destroy();w.unbind();G.remove(q)},highlight:function(){F.on();m.set(q,"title",x.translate("aria.stepper.input.invalid"));ib.shout(q,x.translate("aria.stepper.input.invalid"))},
dehighlight:function(){F.off();m.remove(q,"title")},input:k(q),focus:function(){Z.focus(q);C()},enter:I.enter,exit:I.exit,initLayout:function(){var b=ha.single(q,[ea.basic(R.ENTER()[0],function(){d.trigger.validate();return g.some(!0)})],g.none());b.events.enter.bind(C);var c=Ba.button({execute:function(a){a.dom().click();Z.focus(a);return g.some(a)}});b=ha.multiple(a,[b,ha.button(e.element(),c),ha.button(f.element(),c)]);b.events.exit.bind(function(){A.parent(l).each(Z.focus);d.trigger.abort()});
I.set(b)},events:d.registry}}function Gm(a){var b=KX(a),c=T.div(),d=JX(c,b);n.add(c,B.resolve(b.cssNamespace()+"-size-widget"));var e=function(){return fa.get(d.input())},f=function(a){var b=e();a=a(b);a=Vf.sanitise(a);fa.set(d.input(),a);h.trigger.action(a);d.dehighlight()};d.events.validate.bind(function(a){a=e();Vf.validate(a,b.tag(),b.property()).fold(function(){d.highlight()},function(a){fa.set(d.input(),a);h.trigger.action(a);d.dehighlight();h.trigger.close()})});d.events.plus.bind(function(a){f(u(Bm.increase,
b.specials()))});d.events.minus.bind(function(a){f(u(Bm.decrease,b.specials()))});var h=H.create({close:p([]),action:p(["value"]),abort:Q([],d.events.abort)}),l=K.bind(c,"click",function(a){(N.eq(a.target(),c)||N.eq(a.target(),d.input()))&&d.enter()});return{element:k(c),input:d.input,getCurrentValue:e,focus:d.focus,enter:d.enter,initLayout:d.initLayout,destroy:function(){l.unbind();d.destroy();G.remove(c)},updateInlineWidget:function(a,e){var f=function(a){Vf.validate(a,b.tag(),b.property()).each(function(a){fa.set(d.input(),
a);d.dehighlight()})};a.size().fold(function(){f(e);n.add(c,B.resolve("default-"+b.cssNamespace()+"-size"))},t,function(a){f(a);n.remove(c,B.resolve("default-"+b.cssNamespace()+"-size"))})},open:t,close:t,events:h.registry}}function LX(a,b,c,d){var e=c();c=td.okCancel("font-size");var f=we(b),h=null,l=H.create({close:p([]),open:p([]),analytics:p(["message"]),ok:p(["value"])});b=function(){h.unbind();f.hide();l.trigger.close()};f.setTitle(x.translate("font.size"));f.setContent(e.element());f.setControls(c.element());
f.events.close.bind(b);c.events.ok.bind(function(){l.trigger.ok(e.getCurrentValue())});c.events.cancel.bind(b);n.add(f.element(),B.resolve("widget-dialog"));return{show:function(){f.show();var b=r.fromDom(window);h=K.bind(b,"orientationchange",function(){a.foreground()});l.trigger.open()},element:f.element,contents:e,events:l.registry,destroy:function(){f.hide();f.destroy();e.destroy()}}}function MX(a,b){var c=a.content(),d=a.undo(),e={},f=function(a){return E(a.split(/,\s?/g),function(a){return a.trim().replace(/^['"](.*)['"]$/,
"$1")}).join(",")},h=(0===b.faces.length?g.none():g.some(b.faces)).fold(wA.faces,function(a){return E(a,function(a){var b=f(a.value);e[b]=a.value;return Oh.face(x.raw(a.text),b,g.none())})}),l=aa.detect().deviceType.isiOS(),q=H.create({analytics:p(["message","properties"])}),C=g.some(Xy.face),w=function(a){var b=f(a);a=qa(h,function(a){return a.value()===b});var c=Oh.face(x.raw(b),b,g.none());return a.getOr(c)},I=l?NX:OX;l=sX(a,b);return{ui:wb.ui({"fontface.dropdown":k({name:"fontface",textkey:x.key("font.face"),
menuTextkey:x.key("font.menu"),updateDropdown:function(b){var c=PX.face(a.selections()).map(w);b.populate([{label:g.none,items:k(h)}]);cm.updateMenu(b,c,Da.on(),h,C)},action:function(b){b=e.hasOwnProperty(b)?e[b]:b;Uf.face(c,d,a.selections(),b)},values:h,render:C,describe:function(a){return x.translate("font.describe",x.get(a.textkey()))},hasPopup:!0}),"fontcolor.widget":function(c){return QX.widget(a,b)},"fontsize.widget":function(b){return I.widget(a,b)},"fontsize.general":l.general},ca),events:q.registry,
destroy:t}}function xA(a,b,c){var d=hA(a,b,c);S.tabList(d.menu());E(d.tabs(),function(a){var b='.ephox-pastry-tablayout-content[data-ephox-pastry-tablayout-view="'+a.name()+'"]';m.set(a.element(),"tabindex","-1");n.add(a.element(),B.resolve("tab-button"));L.descendant(d.body(),b).each(function(b){var c=Ha("ephox-aria");m.set(a.element(),"id",c);S.tabButton(a.element(),a.name());S.tabPanel(b);S.linkTabToPanel(a.element(),b);S.labelledBy(b,c)})});return{element:d.element,tabs:d.tabs,body:d.body,menu:d.menu,
destroy:d.destroy,events:d.events}}function RX(a){var b=2===cb(a.integration).length,c=Wf.aboutTags(b,a.integration);return{content:function(a){return hb(c,function(a,b){return a.replace(b.str(),b.replace())},a)},dom:b?function(a){L.descendant(a,".ephox-polish-help-integration").each(function(a){v.set(a,"display","block")})}:t}}function Lj(a,b,c){var d=g.none(),e=g.none(),f=SX(c),h=function(a,c){c=b.content(c.trim());d=g.some(c);l(a,c)},l=function(a,c){c=r.fromHtml(c.trim());b.dom(c);G.empty(a);n.remove(a,
B.resolve("tablayout-loading"));q(c);var d=r.fromTag("div");S.document(d);y.append(d,c);y.append(a,d)},q=function(a){w();e=L.descendant(a,".ephox-license-link").map(function(a){return K.bind(a,"click",function(a){window.open(f,"","height=700,width=620,resizable=yes,scrollbars=yes")})})},k=function(b){a.get(function(a){a.fold(function(a){b("&nbsp;");console.error("Unable to download help article",a)},b)})},w=function(){e.each(function(a){a.unbind()})};return{render:function(a){d.fold(function(){n.add(a,
B.resolve("tablayout-loading"));k(u(h,a))},function(b){l(a,b)})},destroy:function(){w()}}}function TX(a){var b={content:ca,dom:t},c=aa.detect();if(!0===a.source){var d=a.baseUrl+"/help/"+qf.get()+"/";d={about:Ae.get(d+"about.html",Be.text(),he.xhr()),accessibility:Ae.get(d+"accessibility.html",Be.text(),he.xhr()),a11ycheck:Ae.get(d+"a11ycheck.html",Be.text(),he.xhr()),markdown:Ae.get(d+"markdown.html",Be.text(),he.xhr()),shortcuts:Ae.get(d+"shortcuts.html",Be.text(),he.xhr())}}else d=UX(a.baseUrl+
"/help_"+qf.get()+".js?"+Wf.resourceParam());c=!c.deviceType.isTouch();a=[Mj(c,Sg(x.translate("help.dialog.shortcuts"),Lj(d.shortcuts,b,a))),Mj(c,Sg(x.translate("help.dialog.accessibility"),Lj(d.accessibility,b,a))),Mj(!0,Sg(x.translate("help.dialog.markdown"),Lj(d.markdown,b,a))),Mj(c,Sg(x.translate("help.dialog.a11ycheck"),Lj(d.a11ycheck,b,a))),Mj(!0,Sg(x.translate("help.dialog.about"),Lj(d.about,RX(a),a)))];return ee(a)}function VX(a,b){var c=H.create({close:p([])}),d=we(a),e=TX(b),f=xA(or.left(),
e,"help");m.set(f.body(),"tabindex","-1");n.add(d.element(),B.resolve("help-modal"));a=A.children(f.element());z(a,Vc.register);d.setTitle(x.translate("cog.help"));d.setContent(f.element());var h=WX(f);a=XX(f);var l=ha.multiple(d.element(),[h,a]);f.events.setActive.bind(function(a){h.clickFocus(a.item().element())});var q=function(){d.hide()};d.events.close.bind(function(){l.exit();q()});l.events.exit.bind(function(){q();c.trigger.close()});return{element:d.element,open:function(){d.show();l.enter()},
destroy:function(){f.destroy();d.destroy();l.destroy();z(e,function(a){a.renderer().destroy()})},hide:q,events:c.registry}}function YX(a,b){var c=VX(a,b),d=function(){e.trigger.analytics("help_screen_hide");e.trigger.close();f()},e=H.create({close:p([]),analytics:p(["message"])});c.events.close.bind(d);var f=function(){c.events.close.unbind(d);c.destroy()};return{show:function(){e.trigger.analytics("help_screen_show");c.open()},destroy:f,events:e.registry}}function ZX(a,b){var c=a.content(),d=a.smartview(),
e=a.shortcuts(),f=H.create({analytics:p(["message"])}),h=hd.destroyable(),l=function(){var e=YX(d.uiContainer(),b);h.set(e);e.events.close.bind(function(){c.toEditing();h.clear()});e.events.analytics.bind(function(a){f.trigger.analytics(a.message())});c.toReading();a.content().hideInlineSelection();e.show()};e.events.help.bind(l);return{ui:wb.ui({"help.general":{toggle:!1,value:"help",textkey:x.key("cog.help"),action:l,updateGeneral:t,icon:!0,hasPopup:!1,hasDialog:!0,tooltip:qb.get}}),events:f.registry,
destroy:function(){h.clear()}}}function $X(a,b,c){var d=a.filter(),e=a.content(),f=a.operations();rf.configure(d);var h=void 0===c.external?[]:E(c.external,function(a){return aY(a.prefix,a.suffix,a.style)});z(h,function(a){var c=$x(a.prefix(),a.suffix(),function(b){var c=r.fromTag("span");ma.add(c,[rf.highlightClass()]);v.setAll(c,a.style());var d=r.fromTag("div");y.append(c,r.fromText(a.prefix()+b+a.suffix()));y.append(d,c);return Ea.get(d)});b.customMacros().add(c)});a=function(a){e.getSelection().each(function(b){a.prev().each(function(a){L.ancestor(a,
"."+rf.placeholderClass()).each(function(a){yA.rehighlight(f,h,a)})});L.ancestor(b.startContainer(),"."+rf.highlightClass()).each(function(a){yA.unhighlight(f,a)})})};return 0<h.length?(e.events.nodeChanged.bind(a),{run:function(){bY.run(e,h)},destroy:t}):{run:t,destroy:t}}function cY(a){var b=a.content();return{ui:wb.ui({"horizontalrule.general":{toggle:!1,value:"horizontalrule",textkey:x.key("insert.horizontalrule"),action:function(){sd.insertAtCursor(b,[r.fromTag("hr")]).each(function(a){a=la.after(a.element());
b.setRelativeSelection(a,a);b.toEditing()})},updateGeneral:t,icon:!0,shortcut:!1,hasPopup:!1}}),destroy:t}}function zA(a){var b=B.resolve("dialog-float-selected"),c=r.fromTag("fieldset");m.set(c,"role","radiogroup");a=r.fromHtml("<legend>"+x.translate(a)+"</legend>");var d=Ha("ephox-aria");m.set(a,"id",d);m.set(c,"aria-labelledby",d);var e=T.div();n.add(e,B.resolve("dialog-float-options"));P.append(c,[a,e]);var f=function(){z(h,function(a){n.remove(a.element(),b);ra.checked(a.element(),!1)})},h=E(["none",
"center","left","right"],function(a){var c=Oc(),d=x.translate("align."+a);m.setAll(c.element(),{tabindex:"-1","data-float-value":a,title:d,"aria-label":d,role:"radio"});a=T.div();d=T.div();var e=T.div(),h=T.div();S.hidden(a,!0);n.add(d,B.resolve("dialog-float-icon-inner-left"));n.add(e,B.resolve("dialog-float-icon-inner-center"));n.add(h,B.resolve("dialog-float-icon-inner-right"));P.append(a,[d,e,h]);c.events.click.bind(function(){f();n.add(c.element(),b);ra.checked(c.element(),!0);Z.focus(c.element())});
n.add(c.element(),B.resolve("dialog-float-container"));n.add(a,B.resolve("dialog-float-icon"));y.append(c.element(),a);return c});P.append(e,E(h,function(a){return a.element()}));var l=Kb.radio(c,"."+B.resolve("dialog-float-container"),"."+B.resolve("dialog-float-selected"));return{element:function(){return c},get:function(){return L.child(e,"."+b).map(function(a){return m.get(a,"data-float-value")})},select:function(a){f();a.each(function(a){L.child(e,'span[data-float-value="'+a+'"]').or(A.firstChild(e)).each(function(a){n.add(a,
b);ra.checked(a,!0)})});l.refresh()},keylayout:k(l),destroy:function(){z(h,function(a){a.destroy()})}}}function dY(){var a=T.div(),b=T.div(),c=T.div(),d=T.div();n.add(c,B.resolve("image-url-controls"));n.add(d,B.resolve("image-size-controls"));var e=zA("image.dialog.fields.align"),f=Wc.input("image-url","image.dialog.fields.url"),h=Wc.input("image-alt","image.dialog.fields.alt"),l=Wc.input("image-width","image.dialog.fields.width"),q=Wc.input("image-height","image.dialog.fields.height"),C=r.fromTag("input");
m.set(C,"type","hidden");var w=$d("lock");n.add(w.element(),B.resolve("dialog-button"));var I=bf([B.resolve("icon"),B.resolve("image-lock-button")]);m.set(w.element(),"title",x.translate("image.dialog.fields.constrain.on"));S.toolbarButton(w.element(),x.translate("image.dialog.fields.constrain.label"),!1,!0);ra.press(w.element());w.select();w.content(I);w.events.click.bind(function(){Z.focus(w.element());var a=w.selected()?"on":"off";m.set(w.element(),"title",x.translate("image.dialog.fields.constrain."+
a));(w.selected()?ra.press:ra.release)(w.element())});I=T.div();n.add(I,B.resolve("form-group"));n.add(I,B.resolve("form-group-lock"));var F=r.fromHtml("<label>"+x.translate("image.dialog.fields.constrain.label")+"</label>"),V="constrain"+Ha("");m.set(w.element(),"id",V);m.set(F,"for",V);var X=function(a){a.isLocal()?(m.set(f.input(),"disabled","disabled"),fa.set(f.input(),x.translate("image.dialog.fields.urllocal"))):(m.remove(f.input(),"disabled"),fa.set(f.input(),a.url()))},p=function(a,b,c){var d=
parseFloat(fa.get(C));a=fa.get(a);fa.set(b,c(d,a).getOrThunk(function(){return fa.get(b)}));Mc.dehighlight(b)};V=function(a){Mc.validateField(a.target(),"width",g.some("px")).fold(function(){Mc.highlight(a.target())},function(b){Mc.dehighlight(a.target());b=a.target();w.selected()&&(N.eq(b,l.input())?p(l.input(),q.input(),tr.fromWidth):N.eq(b,q.input())&&p(q.input(),l.input(),tr.fromHeight))})};var t=function(a){if(m.has(a.target(),"placeholder")){var b=m.get(a.target(),"placeholder");""===fa.get(a.target())&&
fa.set(a.target(),b)}},v=K.bind(l.input(),"input",V),z=K.bind(q.input(),"input",V),y=K.bind(l.input(),"focus",t),A=K.bind(q.input(),"focus",t);P.append(I,[F,w.element()]);P.append(b,[e.element()]);P.append(c,[f.element(),h.element()]);P.append(d,[l.element(),q.element(),I]);P.append(a,[c,d,b]);b=[ha.input(f.input(),Ba.input({})),ha.input(h.input(),Ba.input({})),ha.input(l.input(),Ba.input({})),ha.input(q.input(),Ba.input({})),ha.button(w.element(),Ba.button({execute:Kb.button})),e.keylayout()];return{element:k(a),
destroy:function(){w.destroy();v.unbind();z.unbind();y.unbind();A.unbind();e.destroy()},dehighlight:u(Mc.clearHighlights,a),highlight:Mc.highlight,keylayouts:k(b),set:function(a){X(a);fa.set(h.input(),a.alt());fa.set(l.input(),a.width());fa.set(q.input(),a.height());var b=a.computedWidth().bind(function(b){return a.computedHeight().bind(function(a){return tr.calculate(b,a)})}).getOr(1);a.computedWidth().each(u(m.set,l.input(),"placeholder"));a.computedHeight().each(u(m.set,q.input(),"placeholder"));
fa.set(C,b);e.select(a.align())},get:function(){return Mc.validate([Mc.rule(l.input(),"width",g.some("px")),Mc.rule(q.input(),"height",g.some("px"))]).map(function(a){return Hm.properties({url:fa.get(f.input()),alt:fa.get(h.input()),width:a.width(),height:a.height(),isLocal:m.has(f.input(),"disabled"),align:e.get()})})}}}function eY(a){var b=H.create({ok:p(["image","properties"]),close:p([])}),c=na(g.none()),d=we(a),e=td.okCancel("image-properties"),f=dY();d.setContent(f.element());n.add(d.element(),
B.resolve("dialog-narrow"));a=function(){var a=f.get();f.dehighlight();a.fold(function(a){f.highlight(a)},function(a){c.get().each(function(c){b.trigger.ok(c,a)})})};e.events.ok.bind(a);e.events.cancel.bind(function(){d.hide();b.trigger.close()});d.setTitle(x.translate("image.dialog.title"));d.setControls(e.element());d.events.close.bind(function(){b.trigger.close()});var h=Kb.setup(d,e,f.keylayouts());return{element:d.element,open:function(){d.show();h.enter()},hide:function(){h.exit();d.hide()},
destroy:function(){d.destroy();h.destroy();e.destroy();f.destroy()},represent:function(a){var b=Hm.divine(a);c.set(g.some(a));f.set(b)},execute:a,events:b.registry}}function fY(a,b){b=AA.image(a.content());var c=H.create({changed:p(["image"]),contextmenu:Q(["image"],b.events.contextmenu)}),d=function(b){var d=a.content(),e=eY(a.smartview().uiContainer()),l=BA.generate(a.keyboard(),e,["image","properties"]);l.events.ok.bind(function(a){Hm.apply(a.image(),a.properties());c.trigger.changed(a.image());
l.destroy();d.domChanged();d.focus();d.uiChanged()});l.events.close.bind(function(a){l.destroy();d.focus()});l.represent(b);l.open()};b.events.properties.bind(function(a){d(a.image())});return{destroy:t,situation:b.situation,handle:b.handle,assign:b.assign,events:c.registry}}function gY(a){var b=function(b){return Ae.get(b,Be.blob(),he.xhr(),a.newHeaders())},c=function(a){return!(ur.local(a)||ur.sameDomain(a,String(Xf.location)))};return{getImage:function(d){var e=m.get(d,"src");return(c(e)?a.proxy(e):
g.none()).fold(function(){return Ua.fromPromise(Nj.imageToBlob(d.dom()))},b)}}}function hY(a,b,c){var d=g.none();return{setTarget:function(a){d=g.some(a)},clearTarget:function(){d=g.none()},mutate:function(e,f){d.each(function(d){var h=Fb.delta({top:f,left:e}),q=Ug.updatePosition(c,function(b){return d(a,b,h)});Ug.drawAtOrigin(c,a);b.update(q)})}}}function iY(a){var b=H.create({reposition:p(["direction","delta"])}),c=Yf("top","n",g.none()),d=Yf("bottom","s",g.none()),e=Yf("right","e",g.none()),f=
Yf("left","w",g.none()),h=Yf("top-left","nw",g.some(a("image.crop.handle.nw"))),l=Yf("top-right","ne",g.some(a("image.crop.handle.ne"))),q=Yf("bottom-right","se",g.some(a("image.crop.handle.se"))),C=Yf("bottom-left","sw",g.some(a("image.crop.handle.sw"))),w=lf.nu(function(a){setTimeout(function(){v.reflow(c);var b=Ia.get(c),d=sa.get(c);a(k(3*b+2*d))},0)}),I=b.trigger.reposition;a=[c,d,e,f,l,h,q,C];I=[ha.single(h,Oj.navigation("nw",I),g.none()),ha.single(l,Oj.navigation("ne",I),g.none()),ha.single(q,
Oj.navigation("se",I),g.none()),ha.single(C,Oj.navigation("sw",I),g.none())];return{elements:k(a),keylayouts:k(I),events:b.registry,refresh:function(a,b){a=CA.calculate(a,b);Zf(c,a.n());Zf(d,a.s());Zf(e,a.e());Zf(f,a.w());Zf(h,a.nw());Zf(C,a.sw());Zf(q,a.se());Zf(l,a.ne());w.get(function(a){DA([c,d],b.width,a);DA([e,f],b.height,a)})}}}function jY(){var a=Im("left"),b=Im("top"),c=Im("right"),d=Im("bottom");return{elements:k([a,b,c,d]),refresh:function(e,f){e=kY.derive(e,f);Jm(a,e.leftRim());Jm(b,e.topRim());
Jm(c,e.rightRim());Jm(d,e.bottomRim())}}}function lY(a,b,c,d){var e=r.fromTag("div");n.add(e,EA.magicBox());Vg.base(e,d("image.crop.begin"));Km.effect(e,"execute");var f=r.fromTag("div");m.set(f,"role","row");var h=jY(),l=iY(d),q=function(a){v.setAll(e,{top:a.top()+"px",left:a.left()+"px"})};d=function(b){var c=a();q(c);h.refresh(c,b);l.refresh(c,b);C.trigger.updated(b)};P.append(f,Qb([h.elements(),[b],l.elements()]));y.append(e,f);var C=H.create({updated:p(["newBounds"]),reposition:Q(["direction",
"delta"],l.events.reposition)});d(c);b=l.keylayouts();return{element:k(e),bitsbox:k(f),keylayouts:k(b),move:q,update:d,destroy:function(){G.remove(e)},events:C.registry,tryMovement:function(a){return L.closest(a,"."+tb.resolve("corner-wrapper")).bind(function(a){a=m.get(a,"data-"+tb.resolve("direction"));return void 0!==Lm[a]?g.some(Lm[a]):g.none()})}}}function mY(a,b,c,d){var e=r.fromTag("div");ma.add(e,[tb.resolve("panel-central"),tb.resolve("side-panel")]);m.set(e,"tabindex","-1");Vg.cell(e,d("image.crop.handle.shade"));
Km.grab(e,!1);var f=nY(a());Ug.writePosition(e,f);Ug.drawAtOrigin(e);var h=lY(a,e,f,d);y.append(b,h.element());var l=hY(a(),h,e),q=tj.transform(l),C=K.bind(e,"dblclick",function(){t.trigger.apply()}),w=oY.bind(h.element(),function(a){h.tryMovement(a).orThunk(function(){return L.closest(a,"."+tb.resolve("panel-central")).map(function(){return Lm.translate})}).each(I)}),I=function(a){q.off();l.clearTarget();l.setTarget(a);q.on();q.go(c)},F=function(b,c){var d=Ug.updatePosition(e,function(d){return Lm[b](a(),
d,c)});Ug.drawAtOrigin(e);h.update(d)};d=Qb([h.keylayouts(),[ha.single(e,Oj.navigation("translate",F),g.none())]]);var V=function(){var c=a();return K.bind(A.defaultView(b),"resize",function(){var b=a();if(b.height()!==c.height()||b.width()!==c.width())t.trigger.cancel();else if(b.top()!==c.top()||b.left()!==c.left())h.move(b),c=b})}();f=function(a){return function(){Z.active(A.owner(b)).each(function(b){Km.grab(b,a)})}};var X=f("true"),n=f("false");z(d,function(a){a.events.enter.bind(X);a.events.exit.bind(n)});
h.events.reposition.bind(function(a){F(a.direction(),a.delta())});var t=H.create({updated:Q(["newBounds"],h.events.updated),apply:p([]),cancel:p([])});return{element:h.element,keylayouts:k(d),destroy:function(){q.destroy();V.unbind();w.unbind();C.unbind();h.destroy()},boxes:function(){return{box:a,magic:h.element,shade:k(e)}},get:function(){return Ug.readPosition(e)},events:t.registry}}function pY(a,b,c,d,e){var f=u(qY,a),h=mY(f,b,c,e);return{element:h.element,keylayouts:h.keylayouts,crop:function(){var b=
h.get();var c=Ia.get(a),e=sa.get(a);b=rY({cropX:b.left(),cropY:b.top(),cropWidth:b.width(),cropHeight:b.height(),displayWidth:c,displayHeight:e});return d.animate(h.boxes().magic(),a,h.boxes(),b)},destroy:function(){h.destroy()},events:h.events}}function sY(a){var b=a.content(),c=H.create({ok:p(["cropAction","image","cleanup"])}),d=hd.value(),e=hd.value(),f=function(a){var f=b.body().getOrDie();ib.speak(ja.body(),x.translate("image.crop.announce"));var h=A.documentElement(a),g=pY(a,h,h,tY.slide(),
x.translate),k=jf(function(a,b){ib.speak(ja.body(),x.translate("aria.image.crop.size",a,b))},500);g.events.updated.bind(function(a){a=a.newBounds();k.throttle(a.width(),a.height())});var I=function(){d.clear();r.exit();r.destroy();t.unbindAll();p.clear()},F=function(){I();e.clear();g.destroy()},m=function(){F();ie.select(b,a)},X=function(){I();g.crop().get(function(b){p.clear();ib.speak(ja.body(),x.translate("image.crop.apply"));var d=Wg.crop(b.cropX(),b.cropY(),b.cropWidth(),b.cropHeight()),e=vr.changedBounds(a);
c.trigger.ok(function(a){return Fj.resampleAction(e,a,d)},a,function(a){F();return a})})};d.set(X);e.set(F);uY(b,a);var n=function(){ib.speak(ja.body(),x.translate("image.crop.cancel"));m()},p=hd.unbindable();setTimeout(function(){p.set(K.bind(f,"focus",function(a){n()}))});var r=ha.inlineDialog(h,g.keylayouts(),Ba.inlineDialog({ok:X,cancel:n}));r.enter();var t=Ql.create();t.bind(b.events.domChanged,m);t.bind(b.events.nodeChanged,function(a){ja.inBody(a.node())&&m()});t.bind(g.events.apply,X);t.bind(g.events.cancel,
m)};return{apply:function(){d.on(xb)},open:function(){vc.detect(b.getSelection()).each(function(a){f(a.image())})},destroy:function(){e.on(xb)},isActive:d.isSet,events:c.registry}}function vY(a){a=wY.parse(a.preferredWidth,a.preferredHeight);var b=a.fold(xY,Fj.instance),c=a.fold(yY,function(){return zY(b)});return{assets:function(a){return Ce(a,b)},correlated:function(a){return Ce(a,c)}}}function AY(a,b,c){var d=gY(a.communication()),e=nr(a.ui),f=a.content(),h=function(c){return function(d){d.fold(function(a){a=
wr.diagnoseImageEdit(a,m.get(c,"src"));e.show(a.bannerMessage());console.error("Image edit operation failed: ",a.consoleMessage())},function(c){b.uploadAssets([c]);f.focus();a.undo().save();f.domChanged()});ie.select(f,c);return d}},l=function(b,c){a.undo().save();var e=xr.applyEdit(b);return xr.run(d,c,e)(b)},q=sY(a);q.events.ok.bind(function(a){var b=a.image(),c=a.cropAction();a=a.cleanup();var d=sf.updater(sf.keepCrop,b);l(b,c).map(d).map(a).get(h(b))});var g=function(){return vc.detectForEditing(f.getSelection(),
f.imageExcludes)},w=function(a,b){return function(){g().each(function(c){c=c.image();var d=ca,e=sf.updater(b,c);l(c,a).map(e).map(d).get(h(c))})}},I=[Ph.make("crop-begin","image.crop.begin",q.open),Ph.make("rotate-left","image.toolbar.rotateleft",w(Wg.rotateLeft,sf.keepRotate)),Ph.make("rotate-right","image.toolbar.rotateright",w(Wg.rotateRight,sf.keepRotate)),Ph.make("flip-horizontal","image.toolbar.fliphorizontal",w(Wg.flipHorizontal,sf.keepFlip)),Ph.make("flip-vertical","image.toolbar.flipvertical",
w(Wg.flipVertical,sf.keepFlip))],F=[Ph.make("crop-apply","image.crop.apply",q.apply)];w=wb.ui({"edit.palette":u(FA.edit,a.ui().refresh,g,q.isActive,I),"crop.palette":u(FA.crop,a.ui().refresh,q.isActive,F)},ca);I=AA.imageEdit(q.isActive,F,I,f.imageExcludes);c=vY(c);return{destroy:function(){q.destroy()},ui:w,insertResample:k(c),situation:I.situation,handle:I.handle,assign:I.assign,name:k("imageEdit")}}function BY(a,b){var c=B.resolve("cursor-pointer"),d=b.os.isOSX(),e=g.none(),f=function(b){return a.isInline()?
bb.absolute(b).top():0},h=function(b){var c=m.get(b,"href");if("top"===m.get(b,rb.bookmarkAnchorDataAttr()))a.doc().each(function(b){a.body().each(function(a){var c=Za.get(b);Za.to(c.left(),f(a),b)})});else if("bottom"===m.get(b,rb.bookmarkAnchorDataAttr()))a.win().each(function(b){a.doc().each(function(c){a.body().each(function(a){var d=f(a),e=Za.get(c);a=d+sa.get(a)-b.innerHeight;Za.to(e.left(),a,c)})})});else if(/^#/.test(c)){var d=c.substr(1);a.body().each(function(b){Ld.anchorTarget(b,d).each(function(b){a.win().each(function(a){Za.setToElement(a,
b)})})})}else window.open(c)},l=function(a,b){var c=d?R.META():R.CTRL();U(c,a)&&b()};b=r.fromDom(window);var q=g.none();a.events.ready.bind(function(a){a=a.api().body();var b=tm.handle(a,function(a){var b=a.target();(d?a.raw().metaKey:a.raw().ctrlKey)&&L.closest(b,"a[href]").each(function(b){a.prevent();h(b)})});q=g.some(b);e=g.some(n.toggler(a,c))});var k=function(){e.each(function(a){a.on()})},w=function(){e.each(function(a){a.off()})},I=function(a){l(a.original().raw().which,w)};a.events.keyup.bind(I);
var F=K.bind(b,"keyup",function(a){l(a.raw().which,w)}),V=function(a){l(a.original().raw().which,k)};a.events.keydown.bind(V);var X=K.bind(b,"keydown",function(a){l(a.raw().which,k)});return{follow:h,destroy:function(){q.each(function(a){a.unbind()});a.events.keyup.unbind(I);a.events.keydown.unbind(V);F.unbind();X.unbind()}}}function CY(a,b,c,d){var e=r.fromTag("div");S.dialog(e,x.get(d));ma.add(e,[B.resolve("expandable-inline-popup")]);d=T.div();n.add(d,B.resolve("inline-popup-content"));var f=T.div();
ma.add(f,[B.resolve("inline-popup-content-expand"),Pj]);var h=T.div();n.add(h,B.resolve("inline-popup-controls"));var l=T.div();n.add(l,B.resolve("inline-popup-expand-button-wrapper"));var q=r.fromTag("span");ma.add(q,[B.resolve("inline-popup-expand-button"),B.resolve("icon")]);var g=x.translate("aria.label.more");m.set(q,"title",g);S.button(q,g);S.group(f);S.linkElements(q,f);y.append(l,q);g=T.div();n.add(g,B.resolve("inline-popup-body"));P.append(g,[d,f,l]);P.append(e,[g,h]);P.append(d,a);P.append(f,
b);P.append(h,c);n.add(e,Pj);var w="0px",I=function(){n.remove(e,Pj);n.add(f,B.resolve("expand-close"));S.hidden(f,!0);v.setAll(f,{opacity:"0",height:"0px",visibility:"hidden"});ra.collapsed(q)},F=K.bind(f,"transitionend",function(a){ma.remove(f,[B.resolve("expand-close"),B.resolve("expand-open")])}),V=K.bind(q,"click",function(a){n.has(e,Pj)?I():(n.add(e,Pj),n.add(f,B.resolve("expand-open")),S.hidden(f,!1),v.setAll(f,{opacity:"1",height:w,visibility:"visible"}),ra.expanded(q))});a=[ha.button(q,Ba.button({execute:Kb.click}))];
return{element:k(e),keylayouts:k(a),destroy:function(){G.remove(e);V.unbind();F.unbind()},show:function(){w=sa.getOuter(f)+"px";I();v.reflow(e);n.add(e,B.resolve("enable-transition"))}}}function DY(a){var b=EY();a.url().each(function(a){fa.set(b.input(),a)});var c=Wc.input("text-to-display","link.properties.text.label"),d=na(!1);n.add(c.element(),B.resolve("text-to-display"));m.setAll(c.input(),{placeholder:x.translate("link.properties.text.placeholder"),autocomplete:"off",autocorrect:"off"});a.text().each(function(a){fa.set(c.input(),
a)});var e=Wc.input("title-text","link.properties.title.label");n.add(e.element(),B.resolve("title-container"));m.setAll(e.input(),{placeholder:x.translate("link.properties.title.placeholder"),autocomplete:"off",autocorrect:"off"});a.title().each(function(a){fa.set(e.input(),a)});var f=FY.target(a),h=K.bind(c.input(),"input",function(){d.set(!0)});return{url:k(b),text:k(c),textChanged:d.get,title:k(e),target:k(f),keylayouts:function(){return[ha.input(b.input(),Ba.input({})),ha.input(c.input(),Ba.input({})),
ha.input(e.input(),Ba.input({})),ha.button(f.input(),Ba.button({execute:Kb.click,process:t}))]},destroy:function(){h.unbind()}}}function GY(a){var b=$e(a)?a:1E4,c=um.access("local.linkCache");a=c.read();var d=function(a){return 0>b-a.length?a.slice(0,b):a}(Mb(a)?a:[]),e=function(a){d.splice(a,1)},f=function(){return d.slice(0)};return{add:function(a){"#"!==a.charAt(0)&&(d.length>=b&&d.pop(),Gc(d,a).each(e),d.unshift(a))},state:f,destroy:function(){c.write(f())}}}function HY(a,b){return{position:function(c,
d){c=c.isRtl()?Qh.allRtl():Qh.all();var e=Fh(0,0);d=Lh.element(a,d);Mm.simple(d,b,e,c,{})}}}function IY(a,b,c,d){var e=H.create({change:p([])}),f=function(){var a=b.body().map(Ld.all).getOr([]);a=ia(a,function(a){var b=m.get(a,"href");return Gb(b,"#")||m.has(a,rb.bookmarkAnchorDataAttr())?[]:[b]});a=d.state().concat(a);a=JY(a);return E(a,function(a){var b=g.none();return KY(a,k(!1),b,t)})},h=function(a,b,c){var d=Ld.getAnchorValue(a,jm.generate("textbox-heading"));return g.some(GA("#"+d,c,function(){m.set(b,
"id",d)}))},l=function(a){var b="h1"!==D.name(a),c=Vb.get(a);return m.has(a,"id")||m.has(a,"name")?(a=m.has(a,"id")?m.get(a,"id"):m.get(a,"name"),g.some(GA("#"+a,b,t))):0===c.trim().length?g.none():h(c,a,b)},q=function(a){m.remove(a,rb.bookmarkAnchorDataAttr())},C=function(a){var b=rb.reservedUrls()[a.toLowerCase()];return function(a){m.set(a,rb.bookmarkAnchorDataAttr(),b)}},w=function(){var a=b.body().map(Ld.findLinkTargets).getOr([]),c=1E3<a.length;a=E(a,function(a){return l(a).map(function(b){var d=
(c?Ld.linkTargetFastText:Ld.linkTargetText)(50,a);return yr(b.url(),b.indent(),b.action(),d.before(),d.innerText(),d.after())})});a=ee(a);var d=C(rb.topAnchorUrl());d=yr(rb.topAnchorUrl(),!1,d,"","\u2014 "+rb.topAnchorUrl()+" \u2014","");var e=C(rb.bottomAnchorUrl());e=yr(rb.bottomAnchorUrl(),!1,e,"","\u2014 "+rb.bottomAnchorUrl()+" \u2014","");return[d].concat(a).concat([e])};return{predict:function(b,d,h){var l=gc(function(){var a=f(),d=w();a=Nm.config({container:c,translate:x.translate,sections:[Nm.section({id:"recent",
highlight:"strong",contentLimit:50,items:a,itemLimit:10,render:HA.anchors,extractors:[Qj.title,Qj.url]}),Nm.section({id:"anchors",highlight:"strong",contentLimit:50,items:d,render:HA.standard,extractors:[Qj.innerText,Qj.url]})]});var e=Nm.init(b,a);ma.add(e.element(),[B.resolve("layer-menus"),B.resolve("tarot-inline")]);e.events.click.bind(function(a){e.hide();I(b,a.item())});a=Ia.get(b);v.setAll(e.element(),{"min-width":a+"px","box-sizing":"border-box"});return e}),k=na(g.none()),I=function(a,b){var c=
b.url();fa.set(a,c);LY&&a.dom().click();k.set(g.some(b));e.trigger.change()},F=h.container(b);F.swallowKeys([R.UP(),R.DOWN()]);F.events.up.bind(function(a){a.stopper()();a=l();m(a);a.moveup()});F.events.down.bind(function(a){a.stopper()();a=l();m(a);a.movedown()});F.events.escape.bind(function(a){var b=l();b.isShowing()&&(b.hide(),a.stopper()())});F.events.enter.bind(function(a){l().getSelectedData().each(function(c){a.stopper()();var d=l();d.hide();d.reset();I(b,c)})});F.on();var m=function(c){if(!c.isShowing()){var d=
fa.get(b);""===d?c.resetFull():c.filter(d);c.isShowing()||c.show(a.uiDirection())}},V=[K.bind(b,"input",function(c){e.trigger.change();c=l();k.set(g.none());var d=fa.get(b);0<d.length?(c.filter(d),c.isShowing()||c.show(a.uiDirection())):(c.reset(),c.hide())}),K.bind(b,"focus",function(a){l()}),K.bind(b,"blur",function(a){var c=l().hide;Z.active().fold(c,function(a){N.eq(a,b)||c()})}),K.bind(c,"click",function(a){l().hide()}),K.bind(d,"click",function(a){a.stop();a=l();a.isShowing()?a.hide():m(a)})];
return{destroy:function(){l().destroy();F.destroy();z(V,function(a){a.unbind()})},getSelectedValue:function(){return k.get().fold(function(){var a=fa.get(b),c=rb.isReservedUrl(a)?C(a):q;return IA(a,c)},function(a){return IA(a.url(),a.action())})}}},events:e.registry}}function MY(a,b,c,d,e,f,h){var l=GY(1337),q=DY(f),k=h();h=[q.url().element()];var w=[q.text().element(),q.title().element(),q.target().element()],I=CY(h,w,k.elements(),k.dialogTitle());n.add(I.element(),B.resolve("inline-link-dialog"));
var F=df.popup(d.uiContainer,d.bounds,a,[],Mg.editorContainer()).initMenu(I.element());n.add(F.element(),B.resolve("bubble-box"));h=F.element();h=IY(a,c,h,l);var V=h.predict(q.url().input(),q.url().dropArrow(),b);f.invalid()&&(q.url().showInvalid(),h.events.change.bind(function(){q.url().hideInvalid()}));var X={before:function(){v.set(F.panel(),"visibility","hidden");F.open()},after:function(){v.remove(F.panel(),"visibility");v.remove(F.panel(),"display")}},r=H.create({remove:Q([],k.events().remove),
cancel:p([]),execute:Q([],k.events().execute)}),u=function(a){var b=a.command();a=a.data();m.has(a,rb.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==b||(b=m.get(a,"href"),l.add(b))};e.events.internal.bind(u);b=function(){r.trigger.cancel()};k.events().cancel.bind(b);F.events.close.bind(b);b=Qb([q.keylayouts(),I.keylayouts(),k.keylayouts()]);var z=ha.inlineDialog(I.element(),b,Ba.inlineDialog({ok:k.execute.click,cancel:t}));z.events.exit.bind(function(){F.close();r.trigger.cancel()});
return{showPopup:function(b){X.before();Hh.preserve(function(){b.showExpandable(a,c,d,F,I);X.after();I.show();z.enter()},I.element())},hide:function(){F.closed()||z.exit()},getValues:function(){var a=V.getSelectedValue(),b=fa.get(q.text().input()).trim(),c=fa.get(q.title().input());return Rh.properties({url:""===a.url()?g.none():g.some(a.url()),textChanged:q.textChanged(),text:g.some(b),title:g.some(c),target:zr.getValue(q.target().input()),action:g.some(a.action()),invalid:!1})},destroy:function(){l.destroy();
e.events.internal.unbind(u);V.destroy();q.destroy();z.destroy();k.destroy();F.destroy();I.destroy()},events:r.registry}}function NY(a,b){var c=a.filter(),d=a.content(),e=a.smartview(),f=JA.enabled(d),h=a.internalevents(),l=aa.detect();Rh.configure(c);var q=BY(d,l);c=function(){d.getSelection().each(function(a){d.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})};var k=l.browser.isIE()?c:t,w=H.create({insert:p(["properties"]),update:p(["properties"]),unlink:p([])}),
I=hd.destroyable(),F=function(b,c){b=MY(a.region(),a.keyboard(),d,e,h,b,c);b.events.remove.bind(function(a){w.trigger.unlink();V()});b.events.cancel.bind(function(a){d.focus();V();k()});I.set(b);d.events.mousedown.bind(V);return b},V=function(){I.clear();d.events.mousedown.unbind(V)},X=function(a){var b=F(a,KA.update);b.events.execute.bind(function(a){w.trigger.update(b.getValues());V()});b.showPopup(Ar)};f.events.properties.bind(function(a){a=a.link();var b=m.has(a,rb.bookmarkAnchorDataAttr())?rb.getReservedUrl(m.get(a,
rb.bookmarkAnchorDataAttr())):m.get(a,"href"),c=g.from(Vb.get(a).trim());a=Rh.properties({url:g.from(b),textChanged:!1,text:c,title:g.from(m.get(a,"title")),target:g.from(m.get(a,"target")),action:g.none(),invalid:n.has(a,De.validationHighlight())});X(a)});f.events.follow.bind(function(a){d.focus();setTimeout(function(){q.follow(a.link())},0)});f.events.ignore.bind(function(a){b.ignore(a.link())});f.events.remove.bind(function(){w.trigger.unlink()});return{showContext:X,showInsert:function(a){var b=
F(a,KA.insert);b.events.execute.bind(function(a){w.trigger.insert(b.getValues());V()});b.showPopup(Ar)},situation:f.situation,handle:f.handle,assign:f.assign,events:w.registry,destroy:function(){V();q.destroy()}}}function OY(a){var b=na(g.none());a=T.div();n.add(a,B.resolve("link-widget"));var c=T.span();n.add(c,B.resolve("link-widget-field"));var d=r.fromTag("input");n.add(d,B.resolve("link-widget-input"));S.label(d,x.translate("link.properties.url.placeholder"));y.append(c,d);m.set(d,"type","url");
m.set(d,"placeholder",x.translate("link.dialog.tooltip"));var e=Gj.text(c,d),f=Hj([B.resolve("link-widget-insert")],"insert.link"),h=Hj([B.resolve("link-widget-update")],"link.dialog.update"),l=Hj([B.resolve("link-widget-remove")],"link.dialog.remove");y.append(a,c);var q=H.create({insert:p(["properties"]),update:p(["properties"]),unlink:p([]),toEditor:p([])}),C=function(a,b){return Rh.properties({url:g.some(a),textChanged:b.isSome(),text:b,title:g.none(),target:g.none(),action:g.none(),invalid:!1})},
w=function(){var a=fa.get(d),c=b.get().fold(function(){return C(a,a)},function(b){return b.text().fold(function(){return C(a,g.some(a))},function(b){b=g.from(b).filter(function(a){return""!==a.trim()});return C(a,b)})});q.trigger.insert(c);b.set(g.none());q.trigger.toEditor()},I=function(){var a=fa.get(d);q.trigger.update(C(a,g.none()));b.set(g.none());q.trigger.toEditor()};f.events.click.bind(w);h.events.click.bind(I);l.events.click.bind(function(){q.trigger.unlink();q.trigger.toEditor()});return{element:k(a),
addEscape:function(a){y.append(c,a.element())},type:k(e),execute:function(){sc.isVisible(f.element())?w():sc.isVisible(h.element())&&I()},open:function(){Z.focus(d)},close:t,destroy:t,represent:function(a){z([f.element(),h.element(),l.element()],G.remove);a.url().fold(function(){fa.set(d,"http://");y.after(d,f.element())},function(a){P.after(d,[h.element(),l.element()]);fa.set(d,a)});b.set(g.some(a))},events:q.registry}}function PY(a){var b=OY(a),c=zm(a,b);a=JA.disabled();var d=H.create({insert:p(["properties"]),
update:p(["properties"]),unlink:p([])});b.events.insert.bind(function(a){d.trigger.insert(a.properties())});b.events.update.bind(function(a){d.trigger.update(a.properties())});b.events.unlink.bind(function(a){d.trigger.unlink()});return{showContext:function(a){b.represent(a);c.open()},showInsert:function(a){b.represent(a);c.open()},situation:a.situation,handle:a.handle,assign:a.assign,events:d.registry,destroy:function(){c.close();c.destroy()}}}function QY(a,b){var c=a.content(),d=a.undo(),e=a.shortcuts(),
f=aa.detect().deviceType.isTouch()?PY(a):NY(a,b),h=H.create({analytics:p(["message"])});f.events.insert.bind(function(b){d.transaction(function(){var d=Br.insert(c,b.properties());a.internalevents().input(d)});c.domChanged();c.cursorIntoView();h.trigger.analytics("link_inserted")});f.events.update.bind(function(a){d.transaction(function(){var b=a.properties();Br.update(c,b)});c.domChanged();c.cursorIntoView()});f.events.unlink.bind(function(a){d.save();Br.unlink(c);c.domChanged();c.cursorIntoView()});
b=function(){c.getSelection().each(function(a){Ld.sharedLinkOrClosest(a,c.isRoot).fold(function(){c.selectWord();var a=c.getSelectedText().map(function(a){return a.trim()});f.showInsert(Rh.properties({url:g.none(),textChanged:!1,text:a,title:g.none(),target:g.none(),action:g.none(),invalid:!1}))},function(a){var b=g.from(Vb.get(a).trim());f.showContext(Rh.properties({url:g.from(m.get(a,"href")),textChanged:!1,text:b,title:g.from(m.get(a,"title")),target:g.from(m.get(a,"target")),action:g.none(),invalid:n.has(a,
De.validationHighlight())}))})})};var l=wb.ui({"link.general":{toggle:!1,value:"link",textkey:x.key("insert.link"),action:b,updateGeneral:t,icon:!0,shortcut:!0,hasPopup:!1,hasDialog:!0}});e.events.link.bind(b);return{ui:l,situation:f.situation,handle:f.handle,assign:f.assign,events:h.registry,destroy:function(){f.destroy()}}}function RY(a,b,c){var d=lm(c),e=mm.get("ephox.link.service.one",LA.one(),a+"/1/check?url=${url}&fresh=${fresh}",b),f=mm.post("ephox.link.service.many",LA.many(),a+"/1/check",
b),h=function(a){return{url:a.url,result:MA.derive(a.url,a.result)}};return{checkOne:function(a,b){var c=yj.now();b=nm.single(function(b,c){return e.execute({url:encodeURIComponent(a),fresh:c})},d,a,c,void 0!==b?b:!1);return hf.mapSync(b,h)},checkMany:function(a,b){var c=yj.now();a=nm.multiple(function(a,b){return f.execute({urls:a})},d,a,function(a){return SY(a.results,"url")},function(a){return a.url},c,void 0!==b?b:!1);return hf.mapSync(a,function(a){return eb(a,h)})},dumpCache:d.dump}}function TY(a){var b=
a.slice(0),c=function(a){var c=m.get(a,"href");if(Gb(c,"#")||m.has(a,rb.bookmarkAnchorDataAttr()))a=J.error(a);else{var d=A.owner(a).dom().baseURI;d=g.from(d).getOr(window.location);d=Cr.resolve(d,a.dom().href);if(U(b,d))a=J.error(a);else{var h=Sh.parse(d).protocol;a="https"===h||"http"===h?J.value(UY(c,d)):J.error(a)}}return a};return{extract:c,ignore:function(a){c(a).each(function(a){b.push(a.resolved())})},state:function(){return b.slice(0)}}}function VY(a,b,c){var d=a.content(),e=a.filter(),f=
a.communication(),h=a.undo(),l=a.viewablearea(),q=l.viewport(),k=TY(b.ignore),w=De.validationHighlight(),I=De.invalidLink(),F=De.unknownLink();De.configure(e);var m=RY(c.url,f.newHeaders(),b.cache),X=function(a){a=E(a,function(a){return Rg.cata(q.assess(a),g.none,Pb(g.some,k.extract),g.none)});a=ee(a);a=Rj.partition(a);z(a.errors,y);var b=WY.generate(a.values);a=cb(b);a=E(a,function(a){return{url:a}});a=m.checkMany(a);r(a,function(a){Ma(a,function(a){var c=b[a.url];void 0===c?console.warn("Link validator response from server was unknown: ",
a.url,a.result):z(c,function(b){A(a.result,b)})})})};a=function(){var a=l.sections();a=Ld.many(a);a=ka(a,function(a){return!n.has(a,cr.embedChecking())});X(a)};var p=jf(a,500).throttle;l.events.onChange.bind(p);d.events.domChanged.bind(p);var r=function(a,b){hf.handle(a,function(a){console.error("Link Validation server failure: ",a)},function(a){b(a)})},u=function(a){return d.body().map(function(b){return Ld.hrefUrl(b,a)})},v=function(a,b){u(a).each(function(a){z(a,function(a){n.has(a,De.validationHighlight())||
ma.add(a,[w,b])})})},y=function(a){n.has(a,De.validationHighlight())&&ma.remove(a,De.allClasses())},x=function(a){u(a).each(function(a){z(a,y)})},A=function(a,b){MA.cata(a,function(a){v(b,I)},function(a){v(b,F)},function(a){x(b)})};h.events.undo.bind(a);h.events.redo.bind(a);return{destroy:t,refresh:p,ignore:function(a){h.save();k.ignore(a);p();d.focus();d.domChanged();d.cursorIntoView()},state:function(){return{ignore:k.state(),cache:m.dumpCache()}}}}function XY(a,b,c){return{patterns:function(){return[/(\W)(\w+)(\W*)$/gi,
/(^)(\w+)(\W*)$/gi]},useCursor:k(!0),generate:function(a,b){a=r.fromText(b.text());return Zd.species({elements:k([a]),cursor:g.none,dictation:k(g.some(function(){return c(b.text())})),notify:g.none})},derive:function(a){var c=a.index+a[1].length,d=c+a[2].length;return b(a[2]).map(function(a){return{startIndex:k(c),finishIndex:k(d),text:k(a)}})},label:a}}function Dr(a,b){var c=Cb.sanitise(a);return{patterns:function(){return[new RegExp("("+c+")","gi")]},useCursor:k(!0),generate:function(a,c){a=r.fromTag("span",
a.dom());a.dom().innerHTML=b;return Zd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){var b=a.index;a=b+a[0].length;return g.some({startIndex:k(b),finishIndex:k(a)})}}}function Xg(a,b,c){var d=Cb.sanitise(b);return{patterns:function(){return[new RegExp("^("+d+"\\s)(.+)","gi")]},useCursor:fd,generate:function(b,d){var e=r.fromTag(a,b.dom());v.set(e,"list-style-type",c);var f=r.fromTag("li",b.dom()),q=r.fromTag("li",b.dom());y.append(q,r.fromTag("br",b.dom()));
P.append(e,[f,q]);P.append(f,d.clones());return Zd.species({elements:k([e]),cursor:k(g.some(W.point(q,0))),dictation:g.none,notify:g.none})},derive:function(a){var b=a[1];return g.some({startIndex:k(a.index),finishIndex:k(a.index+b.length)})}}}function Om(a,b,c,d){var e=Cb.sanitise(b),f=Cb.sanitise(c);return{patterns:function(){return[new RegExp(e+"([^\\s].*?[^\\s])"+f,"gi"),new RegExp(e+"([^\\s])"+f,"gi")]},useCursor:Jb,generate:function(a,b){a=r.fromTag(d,a.dom());b=r.fromText(b.text());y.append(a,
b);return Zd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){return g.some({startIndex:k(a.index),finishIndex:k(a.index+a[0].length),text:k(a[1])})}}}function YY(a,b){var c=Cb.sanitise(a);return{patterns:function(){return[new RegExp("("+c+")","gi")]},useCursor:Jb,generate:function(a,c){return Zd.species({elements:k([r.fromTag(b,a.dom())]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){return g.some({startIndex:k(a.index),finishIndex:k(a.index+
a[0].length)})}}}function ZY(a,b,c){var d=c.allowed.fold($Y,function(a){return function(b,c){return U(a,b)?c:[]}}),e=function(a){return{derive:a.derive,generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,allowed:k(!0)}},f=function(a,b){return{derive:a.derive,generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,allowed:function(a){return!1===Db.closest(a,b)}}};c=d("headings",[e(Th.spaced("######","h6")),e(Th.spaced("#####","h5")),e(Th.spaced("####","h4")),e(Th.spaced("###","h3")),
e(Th.spaced("##","h2")),e(Th.spaced("#","h1"))]);var h=d("lists",[e(Xg("ul","*","disc")),e(Xg("ol","1.","decimal")),e(Xg("ol","a.","lower-alpha")),e(Xg("ol","i.","lower-roman")),e(Xg("ol","1)","decimal")),e(Xg("ol","a)","lower-alpha")),e(Xg("ol","i)","lower-roman"))]),l=d("semantics",[e(Om("bold","**","**","strong")),e(Om("bold","__","__","strong")),e(Om("italic","*","*","em")),e(Om("italic","_","_","em"))]),q=d("entities",[e(Dr("(c)","&copy;")),e(Dr("--","&mdash;")),e(Dr("-","&mdash;"))]),g=[e(NA.normalise()),
e(NA.capitalise())],w=function(a){return x.translate("aria.autocorrect.announce",a)};a=a.hasAutocorrect()?[e(XY("autocorrect",a.lookup,w))]:[];w=d("hr",[e(YY("---","hr"))]);var I=gc(function(a){a.runOrOnLoaded(function(b){var c=gc(function(){A.owner(b).dom().execCommand("AutoUrlDetect",!1,!1)});a.events.focus.bind(function(){c()})});return d("link",[f(aZ,"a")])});return{headings:k(c),semantics:k(l),entities:k(q),cases:k(g),lists:k(h),dynCustoms:function(){var a=b.get();return E(a,e)},link:I,hr:k(w),
corrections:k(a)}}function bZ(a,b,c,d,e,f,h,l){var q=g.none(),k=g.none(),w=ZY(e,f,l),I=Qb([w.link(b),w.hr(),w.semantics(),w.entities()]),F=function(){return Qb([I,a.autocorrect().get()?w.corrections():[],a.capitalisation().get()?w.cases():[],w.dynCustoms()])},m=w.headings().concat(w.lists()),X=function(a,b,c,d){var e=OA.descend(b,c),f=cZ.get(e.element(),e.offset());c=ka(d,function(a){return a.allowed(b)});return yc(c,function(b){return a(f,b,e.element(),e.offset())})},n=function(a,c){b.undoOperation(function(){a(function(){return c.execute(b,
h)}).each(function(a){b.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.domChanged()})};return{spaceDown:function(){b.getSelection().map(function(a){a.collapsed()&&(q=X(Er.inline,a.startContainer(),a.startOffset(),F()))})},spaceUp:function(){var a=u(n,d.run);q.each(a);q=g.none()},enterDown:function(){b.getSelection().map(function(a){a.collapsed()&&(k=X(Er.block,a.startContainer(),a.startOffset(),m.concat()));k=k.orThunk(function(){return X(Er.inline,a.startContainer(),a.startOffset(),
F())})})},enterUp:function(){var a=u(n,xb);k.each(a);k=g.none()}}}function dZ(a,b,c,d){var e=a.profile(),f=a.content(),h=a.undo(),l=a.context(),q=a.operations(),g=a.internalevents(),w=H.create({analytics:p(["message"])}),I=Dq(c.customs),F=bZ(e,f,h,q,b,I,g,d);f.events.keydown.bind(function(a){fe.isSpace(a)&&F.spaceDown()});f.events.keyup.bind(function(a){fe.isSpace(a)&&F.spaceUp()});l.events.preLinebreak.bind(function(a){F.enterDown()});l.events.postLinebreak.bind(function(a){F.enterUp()});var m=function(a){return function(){var b=
a.get();a.setAndCache(!b)}},X=function(a){return function(b){(!0===a.get()?b.select:b.deselect)()}};b=function(a,b,c){return{toggle:!0,value:a,textkey:x.key(b),action:m(c),updateGeneral:X(c),icon:!1,tooltip:qb.get}};return{ui:wb.ui({"capitalisation.general":b("capitalisation","cog.capitalisation",a.profile().capitalisation()),"autocorrect.general":b("autocorrect","cog.autocorrect",a.profile().autocorrect())}),destroy:t,events:w.registry,customMacros:k(I),state:function(){return{customs:I.state()}}}}
function eZ(){var a=H.create({insert:p(["embed"]),input:p(["raw"])}),b=r.fromTag("span"),c=Wc.textarea("media-embed","media.embed"),d=x.translate("media.placeholder"),e=ib.describe(c.textarea(),d);y.append(c.element(),e);e=T.span();S.hidden(e,!0);n.add(e,B.resolve("media-icon"));m.set(e,"alt",x.translate("media.insert"));var f=Oc(),h=x.translate("media.insert");f.content(Rc(h));n.add(f.element(),B.resolve("media-insert"));td.makeDefault(f.element());S.button(f.element(),h);m.set(c.textarea(),"placeholder",
d);PA(f);a.registry.input.bind(function(){var a=fa.get(c.textarea());f.disabled()?""!==a&&(f.enable(),ra.enable(f.element())):""===a&&PA(f)});var l=K.bind(c.textarea(),"input",a.trigger.input);P.append(b,[e,c.element(),f.element()]);var q=function(){var b=fa.get(c.textarea());a.trigger.insert(b);fZ&&Z.blur(c.textarea())};d=[ha.input(c.textarea(),Ba.input({})),ha.button(f.element(),Ba.button({execute:Kb.click}))];f.events.click.bind(function(){q()});return{element:k(b),execute:q,empty:function(){fa.set(c.textarea(),
"")},keylayouts:k(d),events:a.registry,destroy:function(){l.unbind();f.destroy();G.remove(b)}}}function gZ(a){var b=a.region(),c=a.content(),d=a.smartview(),e=eZ(),f=ha.inlineDialog(e.element(),e.keylayouts(),Ba.inlineDialog({ok:e.execute,cancel:t}));S.dialog(e.element(),x.translate("insert.media"));var h=df.popup(d.uiContainer,d.bounds,b,[],Mg.editorContainer()).initMenu(e.element());ma.add(e.element(),[B.resolve("media-embed-dialog"),B.resolve("inline-dialog")]);f.events.exit.bind(function(){l()});
var l=function(){h.closed()||(h.close(),e.empty(),c.focus(),f.exit())};a=H.create({insert:Q(["embed"],e.events.insert)});return{element:e.element,showPopup:function(a){h.open();a.show(b,c,d,h,e);f.enter()},isClosed:h.closed,events:a.registry,destroy:function(){l();f.destroy();e.destroy();h.destroy()}}}function hZ(a){a=T.div();n.add(a,B.resolve("media-widget"));var b=T.span();n.add(b,B.resolve("media-widget-field"));var c=r.fromTag(xc.isLarge()?"textarea":"input");n.add(c,B.resolve("media-widget-input"));
var d=x.translate("media.placeholder");m.set(c,"placeholder",d);m.set(c,"title",d);y.append(b,c);d=Hj([B.resolve("media-widget-insert")],"insert.media");y.append(b,d.element());y.append(a,b);var e=Gj.text(b,c),f=H.create({insert:p(["embed"]),toEditor:p([])}),h=function(){var a=fa.get(c);a=iZ?a.replace(/=\u201c([^\u201d]*)\u201d/g,'="$1"'):a;f.trigger.insert(a);f.trigger.toEditor()};d.events.click.bind(function(){h()});return{element:k(a),addEscape:function(a){y.append(b,a.element())},open:function(){fa.set(c,
"");Z.focus(c)},close:t,execute:function(){h()},destroy:t,type:k(e),events:f.registry}}function jZ(a){var b=a.content(),c=function(){var c=hd.destroyable(),d=function(){c.clear();b.events.mousedown.unbind(d)};return{open:function(){var e=gZ(a);e.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);b.cursorIntoView();d()});e.showPopup(Ar);b.events.mousedown.bind(d);c.set(e)},destroy:function(){d()}}},d=function(){var c=hZ(a);c.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);
b.cursorIntoView()});return zm(a,c)},e=(aa.detect().deviceType.isTouch()?d:c)();return{ui:wb.ui({"media.general":{toggle:!1,value:"media",textkey:x.key("insert.media"),action:e.open,updateGeneral:t,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:function(){e.destroy()}}}function kZ(a,b){var c=r.fromTag("div");n.add(c,B.resolve("mentions-business-card"));var d=a.initMenu(c),e=null,f=function(a,b,e){G.empty(c);y.append(c,e);d.open();a(b,d)};return{showFull:function(a){return function(b,c){clearTimeout(e);
e=setTimeout(function(){f(a,b,c)},500)}}(b.showUnder),showMini:u(f,b.showAtSide),hide:function(){clearTimeout(e);d.close()},destroy:function(){clearTimeout(e);d.destroy()}}}function lZ(a){var b=g.none();return{fetch:function(b,d){a.fetch(b,function(a,b){a=QA("fetch()",a,b);d(a)})},fetchExtra:function(b,d,e){a.menuExtra(b,d,function(a,b){a=QA("menuExtra()",a,b);e(a)})},menuHover:function(c,d){b=g.some(c.userid);a.menuHover(c,function(a){a=Fr("menuHover() callback",a);b.is(c.userid)&&d(a)})},hover:function(b,
d){a.hover(b.dom(),function(a){a=Fr("hover() callback",a);d(a)})},menuComplete:function(b){b=a.menuComplete(b);return Fr("menuComplete result",b)},hoverSelector:function(){return a.hoverSelector},isTrigger:function(a){return 64===a}}}function mZ(a){var b=zb.mainmenu(r.fromDom(document),B.resolve("mentions-list"),[]),c=na({}),d=function(a){return a.userid},e=function(a){return a.name},f=function(a,b){L.child(a,".ephox-gopher-item-text").each(function(a){Ea.set(a,b)})},h=function(a){return E(a,function(a){var b=
zb.item(r.fromDom(document),a.userid,a.name);f(b,a.name);return b})},l=function(a){return Eb(a,function(a,b){var c={};c[b.userid]=b;return ua(a,c)},{})},q=function(a,b){a=h(a);b=E(b,function(a){return zb.item(r.fromDom(document),a.key,a.value)});return a.concat(b)},C=function(a){var b=m.get(a,"data-ephox-gopher-item-value"),d=c.get();return void 0!==d[b]?Gr.fetched(d[b].userid,d[b].name,d[b].rawname,d[b],a):U([RA,SA],b)?Gr.none(a):Gr.extra(b,a)};return{element:k(b),selected:function(){return L.descendant(b,
".ephox-gopher-item-selected")},setData:function(d,e){var f=l(d);c.set(ua(c.get(),f));d=0===d.length?[{userid:SA,name:a.get("mentions.lookahead.noresults")}]:d;e=q(d,e);G.empty(b);P.append(b,e)},getInfo:C,getUserId:function(a){return C(a).fold(g.none,g.none,Pb(g.some,d))},setLoading:function(){var c=[{userid:RA,name:a.get("mentions.lookahead.searching")}];c=q(c,[]);G.empty(b);P.append(b,c)},getName:function(a){return C(a).fold(g.none,g.none,Pb(g.some,e))},refind:function(a){a=m.get(a,"data-ephox-gopher-item-value");
return void 0!==a&&null!==a?L.descendant(b,'[data-ephox-gopher-item-value="'+a+'"]'):g.none()},isOpen:function(){return sc.isVisible(b)}}}function nZ(a,b,c){var d=function(a){ib.speak(ja.body(),a)},e=mZ(c);a.setView(e.element());var f=na(""),h=function(b){q(b.rawData(),b.extra());a.reposition(g.none())},l=function(a){var b=e.selected();a();return b.bind(e.refind)},q=function(b,f){d(c.get("mentions.lookahead.open"));a.updateItems(l,function(){e.setData(b,f)})},k=function(a){return e.isOpen()&&2<=a.length?
Hr.refetch(a):2<=a.length?Hr.open(a):Hr.nothing()},w=function(a){a.fold(F,h)},I=H.create({accept:p(["information"]),menuHover:p(["element","info"]),none:p([])}),F=function(){a.cancel()};return{setData:q,isOpen:function(){return e.isOpen()},lookup:function(c,d){c=Gb(c,"@")?c.substring(1):c;f.set(c);var h=t;k(c).fold(h,function(a){b.fetch(a,w)},function(c){e.setLoading();a.open(d);b.fetch(c,w)})},close:function(){a.close()},onClick:function(a){e.getInfo(a).fold(function(){I.trigger.none()},function(a,
c){b.fetchExtra(a,f.get(),w)},function(a,b,d,e,f){ib.speak(ja.body(),c.get("mentions.lookahead.selected",d));I.trigger.accept(e)})},onHover:function(a){d(Vb.get(a));e.getInfo(a).fold(t,t,function(a,b,c,d,e){I.trigger.menuHover(e,d)})},events:I.registry}}function oZ(a,b,c,d){var e=r.fromTag("div");n.add(e,B.resolve("mentions-lookahead-container"));var f=c.initMenu(e),h=na(g.none()),l=H.create({close:p([])}),q=function(){return sc.isVisible(e)};c=function(){h.set(g.none());f.close()};f.events.close.bind(function(){b.close();
l.trigger.close()});a.events.mousedown.bind(c);return{element:k(e),destroy:function(){h.set(g.none());f.destroy()},setView:function(a){G.empty(e);y.append(e,a)},updateItems:function(a,c){a(c).fold(function(){b.setActiveMenu(e)},function(a){b.select(a)})},reposition:function(a){a.isSome()&&h.set(a);q()&&h.get().each(function(a){d.showUnder(a,f)})},open:function(c){a.body().each(function(a){f.open();d.showUnder(c,f);h.set(g.some(c));b.open([b.sandbox()],a)})},isOpen:q,cancel:function(){h.set(g.none());
l.trigger.close()},close:c,events:l.registry}}function pZ(a,b,c,d,e,f){var h=oZ(a,b,c,d),l=nZ(h,e,f);a=H.create({menuHover:Q(["element","info"],l.events.menuHover),accept:Q(["information"],l.events.accept),close:Q([],h.events.close)});l.events.none.bind(h.close);return{onHover:l.onHover,onClick:l.onClick,close:function(){l.isOpen()&&l.close();h.isOpen()&&h.cancel()},isOpen:h.isOpen,lookup:function(a,b){h.reposition(g.some(b));l.lookup(a,b)},destroy:function(){h.destroy()},events:a.registry}}function qZ(a,
b){var c=na([]),d=null,e=null,f=H.create({contentHover:p(["target"]),stopHover:p([]),menuHover:p(["info"])});a.runOrOnLoaded(function(a){c.set([K.bind(a,"mouseover",function(a){k(a)}),K.bind(ja.body(),"mouseover",function(a){L.closest(a.target(),Ir).each(l)}),K.bind(a,"mouseout",function(a){w(a)}),K.bind(ja.body(),"mouseout",function(a){I(a)})])});var h=function(a){clearTimeout(d);clearTimeout(e);d=setTimeout(function(){f.trigger.contentHover(a)},300)},l=function(){clearTimeout(e)},q=function(){clearTimeout(d);
e=setTimeout(function(){f.trigger.stopHover()},300)},k=function(a){L.closest(a.target(),b).each(function(a){h(a);f.trigger.contentHover(a)})},w=function(a){if(!Db.closest(a.target(),b))return!1;g.from(a.raw().relatedTarget||a.raw().toElement).map(r.fromDom).filter(function(a){return Db.closest(a,b)}).isNone()&&q()},I=function(a){if(!Db.closest(a.target(),Ir))return!1;g.from(a.raw().relatedTarget||a.raw().toElement).map(r.fromDom).filter(function(a){return Db.closest(a,Ir)}).isNone()&&q()};return{destroy:function(){z(c.get(),
function(a){a.unbind()})},events:f.registry}}function rZ(a){return{get:function(b){var c=a[b];return xa(c)?sZ(c,Array.prototype.slice.call(arguments,1)):x.translate.apply(void 0,arguments)}}}function TA(a){return{show:function(b,c,d,e,f){c=Fh(0,0);b=b.directionAt(a);b=Pm.mainmenu(d,k(a),c,b);d.show(e,b);e.setComponents([a,f.element()])},showWith:function(b,c,d,e,f){b=b.directionAt(a);b=Pm.submenu(d,k(a),b);d.show(e,b);e.setComponents([a,f.element()])}}}function tZ(a,b,c,d){return{showAtSide:function(d,
f){TA(d).showWith(a,b,c,f,{element:k(f.element())})},showUnder:function(d,f){TA(d).show(a,b,c,f,{element:k(f.element())})}}}function uZ(a,b){var c=rZ(b.aria),d=a.content(),e=a.smartview(),f=a.region(),h=a.operations(),l=lZ(b),q=df.menuSystem(e.uiContainer,k("mentions"),rj.menu({focusActive:!1}));v.set(q.sandbox(),"z-index",String(void 0!==b.zIndex?b.zIndex:1E6));b=df.popup(q.sandbox,e.bounds,f,[],Mg.editorContainer());e=tZ(f,d,e,q.sandbox());var g=pZ(d,q,b,e,l,c),w=kZ(b,e);vZ.configure(a.filter());
var I=qZ(d,l.hoverSelector());g.events.menuHover.bind(function(a){l.menuHover(a.info(),function(b){b.fold(t,function(b){sc.isVisible(a.element())&&w.showMini(a.element(),b)})})});I.events.contentHover.bind(function(a){l.hover(a.target(),function(b){b.fold(t,function(b){g.close();w.showFull(a.target(),b)})})});I.events.stopHover.bind(function(a){w.hide()});q.events.itemHover.bind(function(a){a=a.item();g.onHover(a);d.backupSelection();Z.focus(a);d.focus()});q.events.itemAction.bind(function(a){g.onClick(a.item())});
d.events.nodeChanged.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&(Uh.detectOn(b,l).fold(g.close,g.close,t,g.close),a.prev().each(function(a){Jr.validatePrevious(a,b.startContainer())}))})});d.events.keyup.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&(U(m,a.original().raw().which)||Uh.withinIncomplete(b.startContainer()).each(function(a){var b=ed.descendants(a,D.isText);b=E(b,Ya.get).join("");g.lookup(b,a);w.hide()}))})});d.events.keypress.bind(function(a){var b=
a.original();l.isTrigger(b.raw().which)&&d.getSelection().each(function(a){UA.isValidMention(a.startContainer(),a.startOffset())&&(a=function(){var a=Jr.create();sd.insertAtCursor(d,[a]).each(function(a){d.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.kill();ib.speak(ja.body(),c.get("mentions.initiated"))},Uh.detect(d,l).fold(a,a,t,t))})});var m=Qb([R.ENTER(),R.DOWN(),R.UP()]);a.context().events.preLinebreak.bind(function(a){V(function(b,c){g.isOpen()?a.handler().handle():p()},t)});
d.events.keydown.bind(function(a){var b=a.original().raw().which;U(R.ESCAPE(),b)?V(function(){p();a.original().kill()},t):U(m,b)&&g.isOpen()&&(q.simulateKey(a.original()),a.original().kill())});var V=function(a,b){Uh.detect(d,l).fold(b,b,a,b)},X=function(a){V(function(b,c){l.menuComplete(a).each(function(a){y.after(c,a);G.remove(c);var b=r.fromText(mb());y.after(a,b);d.setRelativeSelection(la.after(b),la.after(b));n()})},n)},n=function(){w.hide();g.close()},p=function(){V(function(a,b){ib.speak(ja.body(),
c.get("mentions.lookahead.cancelled"));h.atomic(function(){Jr.cancel(b)});n()},n)};g.events.close.bind(p);g.events.accept.bind(function(a){X(a.information())});return{destroy:function(){g.destroy();w.destroy();I.destroy();q.destroy()}}}function wZ(a){var b=function(a){var b={zh:"zh_cn",pt:"pt_br"};b=void 0===b[a]?a:b[a];b=x.has("parlance."+b)?x.key("parlance."+b):x.raw(b);return xZ(b,a,g.none())},c=E(a.languages,b);return{build:function(d){return d.filter(function(b){return!U(a.languages,b)}).fold(function(){return c},
function(a){return c.concat([b(a)])})}}}function yZ(a,b,c){var d=a.content(),e=a.undo(),f=wZ(c),h=function(){return d.on(function(a){return Yg.language(a).fold(Da.off,Da.on)}).getOrThunk(Da.unchanged)};return{ui:wb.ui({"parlance.dropdown":k({name:"parlance",textkey:x.key("parlance.set"),menuTextkey:x.key("parlance.menu"),updateDropdown:function(a){var b=h(),c=b.fold(g.none,g.none,g.some);c=f.build(c);a.populate([{label:g.none,items:k(c)}]);b.fold(a.deactivate,t,a.activate);b.fold(a.untick,t,a.tick)},
action:function(c){var f=function(a){return rd.language(d.isRoot,a,c)};b.lock(function(){Zb.cata(a.selections().get(),t,fm.multiple(d,e,f),fm.single(d,e,f));d.getSelection().each(function(a){b.check(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})});setTimeout(function(){d.uiChanged()},0)},values:f.build(g.none()),render:g.none(),toggle:!1,describe:function(){return x.key("parlance.set")}})},ca),destroy:t}}function zZ(){var a=r.fromTag("textarea");S.label(a,x.translate("plaincode.dialog.editor"));
S.textarea(a);return{element:k(a)}}function AZ(a){var b=H.create({execute:p(["html"]),close:p([])}),c=we(a);n.add(c.element(),B.resolve("plaincode-modal"));c.setTitle(x.translate("plaincode.dialog.title"));var d=function(){e();b.trigger.close()},e=function(){c.hide()},f=zZ();c.setContent(f.element());a=td.okCancel("plaincode");a.events.ok.bind(function(){b.trigger.execute(fa.get(f.element()));d()});a.events.cancel.bind(function(){d()});c.events.close.bind(function(){h.exit();d()});c.setControls(a.element());
var h=Kb.setup(c,a,[ha.single(f.element(),[ea.rule(ea.is(R.ENTER()[0]),function(a){a.raw().stopPropagation();return g.none()})],g.none())]);return{element:c.element,open:function(){c.show();h.enter()},setHtml:function(a){fa.set(f.element(),a)},destroy:function(){c.destroy();h.destroy()},hide:e,events:b.registry}}function BZ(a){var b=AZ(a),c=function(){d.trigger.close();b.events.close.unbind(c);b.events.execute.unbind(e);b.destroy()},d=H.create({execute:p(["html"]),close:p([])}),e=function(a){d.trigger.execute(a.html())};
b.events.close.bind(c);b.events.execute.bind(e);return{show:function(){b.open()},setHtml:b.setHtml,events:d.registry}}function CZ(a,b){var c=a.content(),d=a.shortcuts(),e=a.smartview(),f=b.setContent,h=b.getContent;d.events.plaincode.bind(function(){l()});var l=function(){var a=BZ(e.uiContainer());a.events.close.bind(function(){c.toEditing()});a.events.execute.bind(function(a){f(a.html())});c.toReading();a.setHtml(h());a.show()};return{destroy:t}}function DZ(){var a=H.create({grow:p(["x","y"])}),
b=1,c=1,d=g.none(),e=function(a){return v.getRaw(a,"width").bind(function(a){return je(a,"px")?g.some(parseInt(a,10)):g.none()}).getOrThunk(function(){return Ia.get(a)})};return{setTarget:function(a){d=g.some(a);c=Ia.get(a)/(sa.get(a)+0)},setMultiplier:function(a){b=a},clearTarget:function(){d=g.none()},mutate:function(f,h){d.each(function(d){var l=e(d)+b*f,g=1===l?1:Math.floor(l/c);5<=l&&5<=g&&(Ia.set(d,l),sa.set(d,g));a.trigger.grow(f,h)})},events:a.registry,destroy:t}}function EZ(a){var b=g.none(),
c=DZ();c.events.grow.bind(function(){f()});var d=tj.transform(c,{layerClass:B.resolve("layer-below-dialog")});n.add(d.element(),B.resolve("resize-eph-block"));var e=FZ.create();e.events.click.bind(function(e){b.each(function(b){c.setMultiplier(e.multiplier());a.body().each(function(a){d.go(A.documentElement(a));var c=function(){d.events.stop.unbind(c);h.trigger.stop(b)};d.events.stop.bind(c)})})});var f=function(){e.clear();b.each(Kr.clean);b=g.none()},h=H.create({stop:p(["target"])});return{showHandles:function(a){var f=
A.documentElement(a);c.setTarget(a);b=g.some(a);d.on();e.refresh(f,a)},hideHandles:f,handlesShowing:function(){return b.isSome()},events:h.registry,destroy:function(){e.destroy();c.destroy();d.destroy();b=g.none()}}}function GZ(a){var b=a.content(),c=a.undo();a=a.filter();Kr.configure(a);var d=EZ(b),e=function(a){vc.detect(b.getSelection()).each(function(d){c.save();ie.remove(b,d.image());b.domChanged();c.save();a.original().kill()})},f=function(a){vc.detect(b.getSelection()).each(function(c){b.setRelativeSelection(la.before(c.image()),
la.before(c.image()));a.original().kill()})},h=function(a){vc.detect(b.getSelection()).each(function(c){b.setRelativeSelection(la.after(c.image()),la.after(c.image()));a.original().kill()})},l=function(){vc.detectForEditing(b.getSelection(),b.imageExcludes).fold(function(){d.hideHandles()},function(a){a=a.image();d.showHandles(a);ie.reselect(b,a)})};b.events.loaded.bind(l);b.events.domChanged.bind(l);b.events.paint.bind(l);b.events.nodeChanged.bind(l);b.events.selectionchange.bind(function(a){vc.detect(b.getSelection()).fold(l,
function(){HZ||d.handlesShowing()||l()})});var q=g.none();b.events.ready.bind(function(a){a=a.api().body();q=g.some(tm.handle(a,function(a){"img"===D.name(a.target())&&ie.select(b,a.target())}))});b.events.mousedown.bind(function(a){a=a.original().target();"img"===D.name(a)&&Kr.disableNativeResize(a)});b.events.keydown.bind(function(a){fe.isDel(a)||fe.isBackspace(a)?e(a):fe.isLeftOrUp(a)?f(a):fe.isRightOrDown(a)&&h(a)});d.events.stop.bind(function(a){a=a.target();IZ?(d.showHandles(a),ie.select(b,
a)):(d.showHandles(a),ie.reselect(b,a))});return{destroy:function(){d.destroy();q.each(function(a){a.unbind()})}}}function JZ(a,b){var c=a.content(),d=a.filter(),e=a.selections(),f=u(d.filterDom,d.output());c.events.ready.bind(function(a){a=a.api();var b=KZ(a,d),h=function(a,h){Zb.cata(e.get(),t,function(c){LZ(c,f).each(function(d){b(a,d.text,d.html,u(h,function(){MZ(c)}))})},function(e,f){NZ(e,f,d).each(function(d){b(a,d.text,d.html,u(h,function(){c.insertHtmlAtCursor("")}))})})};a.events.cut.bind(function(a){h(a.original(),
xb)});a.events.copy.bind(function(a){h(a.original(),t)})});return{destroy:t}}function OZ(a,b){var c=function(a,b,c){a(c,b);return g.some({element:k(b),cleanup:function(){G.remove(b)},splits:k([])})},d=function(a){return{none:g.none,start:u(c,y.before,a),end:u(c,y.after,a),middle:function(b,d,e){return c(y.after,a,d)}}},e=function(a){var b=function(a){return function(b,c){y.appendAt(b,c,a)}};return{prepend:u(c,y.prepend,a),before:u(c,y.before,a),after:u(c,y.after,a),insertAt:function(d,e){return c(b(e),
a,d)},append:u(c,y.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,insertAfter:e(b).after}}}function PZ(a){var b=Qm.fromUnsafe(a),c=r.fromTag("span"),d=r.fromTag("span");z([c,d],a.markAsEphemeral);var e=OZ(c,d);return{backup:function(){a.getSelection().each(function(f){f.collapsed()?
(sd.insertAtCursor(a,[c]),G.unwrap(d),b.begin()):VA.both(e,f.startContainer(),f.startOffset(),f.endContainer(),f.endOffset())})},insert:function(e,h,l){a.setRelativeSelection(la.after(c),ja.inBody(d)?la.before(d):la.after(c));sd.insertAtCursorWith(a,e,h,l).each(function(b){!Db.ancestor(b.element(),"table")||"td"!==D.name(b.element())&&"th"!==D.name(b.element())?a.setRelativeSelection(la.after(b.element()),la.after(b.element())):a.setSelection(b.element(),0,b.element(),0)});b.end();Og.cursorIntoView(a);
z([c,d],G.unwrap)},cancel:function(){z([c,d],G.unwrap)}}}function WA(a,b,c){return function(c,e,f){var d=function(a){c.receive(a)},l=function(a,b,c){c=void 0!==c?c:a.type()===Ab.END_ELEMENT_TYPE;return Ab.token(b,c,{})},g={emit:d,emitTokens:function(a){z(a,d)},receive:function(b){a(g,b,l)},document:window.document};b(g);return g}}function Lr(a,b,c){return{pred:a,action:b,label:k(c)}}function XA(a,b,c){var d=YA(a+" :: FALLBACK --- ",c);c=function(c,f,h){qa(b,function(a){return a.pred(f,h)}).fold(k(d),
function(b){var c=b.label();return void 0===c?b.action:YA(a+" :: "+c,b.action)})(c,f,h)};c.toString=function(){return"Handlers for "+a};return c}function QZ(a,b){var c=mc.state(0,void 0,[],[]),d=function(c){z(c.result(),function(c){c=c(b);a.emit(c)})};return{closeAllLists:function(){var a=ZA.closeAllLists(c,0);c=a.state();d(a)},openItem:function(a,b,h){h&&("UL"===h.tag&&RZ[a-1]===h.type&&(h={tag:"UL"}),a=ZA.openItem(c,a,b,h),c=a.state(),d(a))},getCurrentListType:function(){return c.type()},getCurrentLevel:function(){return c.level()}}}
function $A(a,b){var c=H.create({cancel:p([]),error:p(["message"]),insert:p(["elements","assets","correlated","isInternal"])}),d=function(d,e,l){d=aB.choose(a,b,d);d.capture()&&l();l=E(d.steps(),function(a){return a(e)});aB.run(l,d.input()).get(function(a){var b=a.bundle().isInternal().getOr(!1);db.cata(a.response(),function(a){c.trigger.error(a)},function(a,d){c.trigger.insert(a,bB(d),d,b)},function(){c.trigger.cancel()},function(a,d,e){c.trigger.insert(a,bB(d),d,b);c.trigger.error(e)})})},e=Hd.tap(function(a){Wa.getExact(a.target.ownerDocument.defaultView).each(function(b){n.has(b.start(),
cB.bin())||(b=SZ.fromEvent(a),dB.willBlock()&&(e.control.block(),a.preventDefault()),d(b,e.control,function(){a.preventDefault()}))})});return{paste:e.instance,pasteCustom:function(a){var b=Hd.tap(t);d(a,b.control,t)},isBlocked:e.control.isBlocked,destroy:t,events:c.registry}}function Sj(){return function(a,b){return La.sync(function(a){var c=function(){La.call(a,{response:b.response(),bundle:b.bundle()})},e=function(c,d){Ce(c,TZ).get(function(c){La.call(a,{response:d(c),bundle:b.bundle()})})};db.cata(b.response(),
c,function(a,b){e(b,function(b){return db.paste(a,b)})},c,function(a,b,c){e(b,function(b){return db.incomplete(a,b,c)})})})}}function Mr(a){return function(b,c){return La.sync(function(b){var d=function(){La.call(b,{response:c.response(),bundle:c.bundle()})},f=function(a){var d=UZ(a),e=Ce(d,function(a){return a.asset()}),f=E(d,function(a){return a.image()});e.get(function(d){d=tf.updateSources(d,f);La.call(b,{response:db.paste(a,d),bundle:c.bundle()})})},h=function(e,h,g){!1===a.allowLocalImages?
(h=ka(eB(e),fB),z(h,G.remove),La.call(b,{response:0<h.length?VZ(e):c.response(),bundle:c.bundle()})):0===h.length?f(e):d()};db.cata(c.response(),d,h,d,h)})}}function gB(a){var b=a.translations,c=H.create({insert:p(["elements","correlated"]),incomplete:p(["elements","correlated","message"])});return{events:c.registry,processRtf:function(a,e,f,h){f=uf.images(f);var d=Tj.find(a);WZ.convert(d,f,function(b,d){var f=A.children(a);b=b.concat(e);d?c.trigger.incomplete(f,b,"errors.imageimport.failed"):c.trigger.insert(f,
b);h()},b)}}}function XZ(a,b){var c=H.create({insert:p(["elements","correlated"]),incomplete:p(["elements","correlated","message"])}),d=gB(b);d.events.incomplete.bind(function(a){c.trigger.incomplete(a.elements(),a.correlated(),a.message())});d.events.insert.bind(function(a){c.trigger.insert(a.elements(),a.correlated())});return{events:c.registry,gordon:function(e,f){var h=function(a){d.processRtf(e,f,a.rtf(),a.hide())},l=function(a){var b=Tj.find(e);z(b,G.remove);c.trigger.incomplete(A.children(e),
f,a)},g=function(){var a=Tj.find(e);z(a,G.remove);c.trigger.insert(A.children(e),f)},k=function(a){l(a.message())};if(!0===b.allowLocalImages&&!0===b.enableFlashImport){var w=a(b);w.events.response.bind(h);w.events.cancel.bind(g);w.events.failed.bind(k);w.events.error.bind(k);w.open()}else l("errors.local.images.disallowed")}}}function hB(a,b){var c=XZ(a,b),d=na(g.none()),e=function(a){d.get().each(function(b){La.call(b,{response:a,bundle:Xb.nu({})})})};c.events.insert.bind(function(a){e(db.paste(a.elements(),
a.correlated()))});c.events.incomplete.bind(function(a){e(db.incomplete(a.elements(),a.correlated(),a.message()))});return function(a,b){return La.sync(function(a){var e=function(){La.call(a,{response:b.response(),bundle:b.bundle()})},f=function(b,f,h){d.set(g.some(a));var l=r.fromTag("div");P.append(l,b);Tj.exists(l)?c.gordon(l,f,h):e()};db.cata(b.response(),e,f,e,f)})}}function YZ(a,b){var c=b.translations,d=function(a,b,c){c(g.some(ua(b,{officeStyles:a,htmlStyles:a})))},e=function(b,e){var f=r.fromTag("div");
n.add(f,ud.resolve("styles-dialog-content"));var h=r.fromTag("p"),k=qe.fromHtml(c("cement.dialog.paste.instructions"));P.append(h,k);y.append(f,h);h={text:c("cement.dialog.paste.clean"),tabindex:0,className:ud.resolve("clean-styles"),click:function(){w.destroy();d(!1,b,e)}};k={text:c("cement.dialog.paste.merge"),tabindex:1,className:ud.resolve("merge-styles"),click:function(){w.destroy();d(!0,b,e)}};var w=a(!0);w.setTitle(c("cement.dialog.paste.title"));w.setContent(f);w.setButtons([h,k]);w.events.close.bind(function(){e(g.none());
w.destroy()});w.show()};return{get:function(a,c){a=b[a?"officeStyles":"htmlStyles"];"clean"===a?d(!1,b,c):"merge"===a?d(!0,b,c):e(b,c)},destroy:t}}function ZZ(a){return{play:function(b,c,d){var e=r.fromTag("div"),f=r.fromTag("iframe");v.setAll(e,{display:"none"});var h=K.bind(f,"load",function(){h.unbind();yz.write(f,b);var a=f.dom().contentWindow.document;if(void 0===a)throw"sandbox iframe load event did not fire correctly";var g=r.fromDom(a);a=a.body;if(void 0===a)throw"sandbox iframe does not have a body";
a=r.fromDom(a);g=c(g,a);G.remove(e);setTimeout(u(d,g),0)});y.append(e,f);y.append(a,e)}}}function $Z(a,b,c,d,e){return function(f,h){var l=Xc.asEvent(f).getOrDie("Must pass through event type").nativeEvent(),g=e(),k=h.response();return La.sync(function(e){var f=a(c);f.events.after.bind(function(a){a=a.container();if(Nr.browser.isSafari()&&Db.descendant(a,'img[src^="webkit-fake-url"]'))a=Nr.deviceType.isWebView()?"webview.imagepaste":"safari.imagepaste",La.call(e,{response:db.error(a),bundle:Xb.nu({})});
else{b(a);n.add(a,iB.binStyle());var c=a_.isWord(Nr,a),f=A.children(a),h=d.findClipboardTags(f).isSome();f=b_(f);La.call(e,{response:k,bundle:Xb.nu({isWord:c,isGoogleDocs:f,isInternal:h,proxyBin:a,backgroundAssets:g})})}});g.convert(l);f.run()})}}function c_(a,b){var c=gB(a),d=na(g.none()),e=function(a){d.get().each(function(b){La.call(b,{response:a,bundle:Xb.nu({})})})};c.events.insert.bind(function(a){e(db.paste(a.elements(),a.correlated()))});c.events.incomplete.bind(function(a){e(db.incomplete(a.elements(),
a.correlated(),a.message()))});return function(f,h){var l=Xc.asWord(f).getOrDie("Word input required for rtf data"),q=function(a){return La.sync(function(b){var f=function(){La.call(b,{response:h.response(),bundle:h.bundle()})},l=function(f,h){d.set(g.some(b));var l=r.fromTag("div");P.append(l,f);a.fold(function(){var a=function(){z(c,G.remove);var a=A.children(l);e(db.incomplete(a,h,"errors.local.images.disallowed"))},b=function(){var a=A.children(l);e(db.paste(a,h))},c=Tj.find(l);return 0<c.length?
a():b()},function(a){c.processRtf(l,h,a,t)})};db.cata(h.response(),f,l,f,l)})};return Rm.match(l.rtf(),{getFromFlash:function(a){return b(f,h)},disabled:function(){return q(g.none())},fromClipboard:function(b){return q(!0===a.allowLocalImages?g.some(b.rtf()):g.none())}})}}function d_(a,b,c){var d=function(a){return ob(b,function(b){return vb(a[b])})},e=!0,f=Or(function(){var b=a.dom();vb(b.PercentLoaded)&&100===b.PercentLoaded()&&d(b)&&(h(),c())},500),h=function(){e&&(Vh(f),e=!1)};return{stop:h}}
function e_(a){var b=H.create({response:p(["rtf"]),spin:p([]),cancel:p([]),error:p(["message"]),reset:p([]),hide:p([]),failed:p(["message"])}),c=!1,d=r.fromTag("div");n.add(d,ud.resolve("flashbin-target"));var e=f_.responsive();e.events.crashed.bind(function(){b.trigger.failed("flash.crashed")});e.events.timeout.bind(function(){b.trigger.failed("flash.crashed")});var f=function(){m.stop();if(!c){c=!0;try{var a=w.dom();Ma(k,function(b,c){var d=a[c];if(void 0===d)throw'Flash object does not have the method "'+
c+'"';d.call(a,b)});b.trigger.reset();sr(X);n.remove(d,ud.resolve("flash-activate"));I();V()}catch(Dh){ld.log("Flash dialog - Error during load: ",Dh)}}},h=$f.permanent(f),l=function(){return!ja.inBody(w)},g=function(){return!w.dom().SetVariable},k={setSpinCallback:$f.permanent(function(){e.start(1E3,10,l,g);b.trigger.spin()}),setPasteCallback:$f.permanent(function(a){e.stop();Kf(function(){""===a?b.trigger.error("flash.crashed"):b.trigger.response(unescape(a))},0)}),setEscapeCallback:$f.permanent(b.trigger.cancel),
setErrorCallback:$f.permanent(function(a){e.stop();b.trigger.error(a)}),setStartPasteCallback:$f.permanent(t)},w=function(){var b=a.replace(/^https?:\/\//,"//"),c='    <param name="allowscriptaccess" value="always">    <param name="wmode" value="opaque">    <param name="FlashVars" value="onLoad='+h+'">';if(Pr.browser.isIE()&&10===Pr.browser.version.major){var d=Ha("flash-bin");return r.fromHtml('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="'+d+'"><param name="movie" value="'+b+
'">'+c+"</object>")}return r.fromHtml('<object type="application/x-shockwave-flash" data="'+b+'">'+c+"</object>")}(),I=function(){v.setAll(w,{width:"2px",height:"2px"})};I();var m=d_(w,cb(k),f);y.append(d,w);var V=function(){Pr.browser.isFirefox()&&Zg.getSelection().removeAllRanges();Z.focus(w)},X=null,u=function(){n.add(d,ud.resolve("flash-activate"));v.remove(w,"height");v.remove(w,"width");b.trigger.hide()},x=function(){v.set(d,"display","none");g_.each(function(a){z(a,function(a){a.unbind()})})};
return{focus:V,element:function(){return d},activate:function(){X=Kf(u,3E3);b.trigger.spin();v.set(d,"display","block");V()},deactivate:x,destroy:function(){x();z(Ze(k),function(a){$f.unregister(a)});$f.unregister(h);m.stop()},events:b.registry}}function h_(a,b,c){var d=r.fromTag("div"),e="flashbin-wrapper-"+(i_.os.isOSX()?"cmd":"ctrl");n.add(d,ud.resolve(e));try{var f=void 0!==j_.plugins["Shockwave Flash"]}catch(h){f=!1}a=(f?k_:l_)(d,a,b,c.translations);return{element:k(d),reset:a.reset}}function m_(a,
b){var c=b.translations,d=H.create({response:p(["rtf","hide"]),cancel:p([]),error:p(["message"]),failed:p(["message"])});return{open:function(){var e=e_(b.swf);e.deactivate();var f=r.fromDom(Zg),h=K.bind(f,"mouseup",e.focus),l=function(){w()};f=function(){w();d.trigger.cancel()};e.events.cancel.bind(f);e.events.response.bind(function(a){d.trigger.response(a.rtf(),l)});e.events.error.bind(function(a){w();d.trigger.error(a.message())});e.events.failed.bind(function(a){w();d.trigger.failed(a.message())});
var g=a();g.setTitle(c("cement.dialog.flash.title"));var k=h_(e,g.reflow,b);k.reset();g.setContent(k.element());g.events.close.bind(f);g.show();e.activate();var w=function(){h.unbind();e.destroy();g.destroy()}},events:d.registry}}function Qr(a,b,c,d){var e=N.eq(a,c)&&b===d;return{startContainer:k(a),startOffset:k(b),endContainer:k(c),endOffset:k(d),collapsed:k(e)}}function n_(a){var b=r.fromTag("br"),c=g.none();return{cleanup:function(){G.remove(b)},toOn:function(b,e){var d=A.owner(e).dom().defaultView;
c.each(function(c){var e=A.childNodesCount(b),f=N.eq(b,c.startContainer())&&e<c.startOffset()?e:c.startOffset;e=N.eq(b,c.endContainer())&&e<c.endOffset()?e:c.endOffset;c=Qr(c.startContainer(),f,c.endContainer(),e);a.set(d,c)})},toOff:function(d,e){d=A.owner(e).dom().defaultView;y.append(e,b);c=a.get(d,Qr);a.set(d,Qr(b,0,b,0))}}}function o_(a,b){var c=r.fromTag("div");m.setAll(c,b);m.setAll(c,{contenteditable:"true","aria-hidden":"true"});v.setAll(c,{position:"fixed",top:"0px",width:"100px",height:"100px",
overflow:"hidden",opacity:"0"});ma.add(c,[jB,kB]);var d=function(a){return n.has(a,kB)};return{attach:function(a){G.empty(c);v.set(c,"left",p_(a));y.append(a,c)},focus:function(){L.ancestor(c,"body").each(function(b){a.toOff(b,c)})},contents:function(){q_.consolidate(c,d);var a=O("elements","html","container"),b=A.children(c),h=Ea.get(c);return a(b,h,c)},container:function(){return c},detach:function(){G.remove(c)}}}function r_(a,b,c){var d=o_(a,c),e=function(){a.cleanup();var b=d.contents();d.detach();
h.trigger.after(b.elements(),b.html(),d.container())},f=Hd.tap(function(){h.trigger.before();d.attach(b);d.focus();dB.run(A.owner(b),f,e)}),h=H.create({before:p([]),after:p(["elements","html","container"])});c=t;return{instance:k(function(){f.instance()}),destroy:c,events:h.registry}}function s_(a){return function(b){var c=H.create({after:p(["container"])}),d=n_(t_),e=r_(d,b,a);e.events.after.bind(function(a){d.toOn(b,a.container());c.trigger.after(a.container())});return{run:function(){e.instance()()},
events:c.registry}}}function u_(){return $A([ag.text()],ag.discard())}function v_(a,b){return function(c){var d=H.create({close:p([])}),e=we(a);e.events.close.bind(function(){d.trigger.close()});n.add(e.element(),B.resolve("external-dialog"));c&&n.add(e.element(),B.resolve("dialog-vertical-controls"));var f=r.fromTag("div"),h=na([]),l=function(a){var b=Oc();if(void 0===a.text)throw"dialog button did not specify text";b.content(Rc(a.text));S.button(b.element(),a.text);void 0!==a.tabindex&&m.set(b.element(),
"tabindex",a.tabindex);void 0!==a.className&&n.add(b.element(),a.className);void 0!==a.click&&b.events.click.bind(a.click);n.add(b.element(),B.resolve("dialog-button"));return b};return{element:e.element,events:d.registry,setTitle:e.setTitle,setContent:e.setContent,setButtons:function(a){G.empty(f);a=E(a,l);P.append(f,E(a,function(a){return a.element()}));h.set(a);e.setControls(f)},reflow:t,show:function(){b.hideInlineSelection();e.show();var a=E(h.get(),function(a){return ha.button(a.element(),Ba.button({execute:Kb.click}))}),
c=ha.multipleAll(e.element(),a);c.events.exit.bind(function(){d.trigger.close()});setTimeout(function(){c.enter()},0)},destroy:function(){z(h.get(),function(a){a.destroy()});h.set([]);e.destroy()}}}}function w_(a,b,c){var d={"errors.imageimport.unsupported":"errors.images.import.unsupported","errors.imageimport.invalid":"errors.images.import.invalid"};return{baseUrl:c.baseUrl,enableFlashImport:c.enableFlashImport,swf:c.swf,officeStyles:c.officeStyles,htmlStyles:c.htmlStyles,translations:function(b){var c=
Array.prototype.slice.call(arguments,1);return a.translate.apply(void 0,[void 0!==d[b]?d[b]:b].concat(c))},allowLocalImages:c.allowLocalImages,intraFlag:b}}function x_(a,b,c,d){var e=a.filter(),f=a.content(),h=a.undo(),l=a.smartview(),q=a.region(),k=a.internalevents(),w=!0===d.forceText?u_:y_(l,e,d,f),I=g.none(),F=H.create({analytics:p(["message"])}),n=function(a){var b=U(["flash.clipboard.no.rtf","safari.imagepaste"],a.message())?"info":"error";X(a.message(),b)},X=function(b,c){mf.getOrLog(b,[]).each(function(b){b=
nj(b,c);a.ui().displayBanner(b)});t()},t=function(){Vc.unblock();f.focus()};e.add(e.history(),iB.binStyle(),Na.remove);e.addSelector(e.history(),"[data-ephox-polish-cement-inserted]",Na.removeAttr("data-ephox-polish-cement-inserted"));f.events.ready.bind(function(a){var d=Rr.get(f,l,a.api().doc()),C=z_.rules(f,q,d),V=PZ(f),p=a.api(),u=w(p.body());I=g.some(u);p.events.paste.bind(function(a){p.getSelection().filter(function(a){return ob(Uj.ignoreSelectors(),function(b){return!1===Db.closest(a.startContainer(),
b,f.isRoot)})}).each(function(b){u.isBlocked()||(V.backup(),Vc.block());u.paste(a.original().raw())})});u.events.cancel.bind(function(){t();V.cancel()});var v=Fj.processResults(X);u.events.error.bind(n);u.events.insert.bind(function(a){c.correlated(a.correlated()).bind(nA.maybeDoRotate).map(v).get(function(c){t();h.save();var d=r.fromTag("div");P.append(d,a.elements());e.filterDom(e.input(),d);d=A.children(d);z(d,function(a){D.isElement(a)&&m.set(a,"data-ephox-polish-cement-inserted",!0)});V.insert(d,
[C.collapsed()],[C.ranged()]);f.body().each(function(a){a=Y.descendants(a,"[data-ephox-polish-cement-inserted]");z(a,function(a){m.remove(a,"data-ephox-polish-cement-inserted")});k.input(a)});f.domChanged();F.trigger.analytics("paste_action");b.pasteUpload();b.uploadAssets(c)})})});return{destroy:function(){I.each(function(a){a.destroy()})},events:F.registry}}function A_(a,b,c,d){var e=JZ(a,d.copy),f=x_(a,b,c,d.paste);return{destroy:function(){e.destroy();f.destroy()}}}function B_(){var a={latin:[{start:"A",
finish:"Z"},{start:"a",finish:"z"},{start:"\u00c0",finish:"\u00ff"}],punctuation:[{start:"!",finish:"/"},{start:":",finish:"@"},{start:"[",finish:"`"},{start:"{",finish:"~"},{start:"\u00a1",finish:"\u00bf"},{start:"\u2010",finish:"\u2027"},{start:"\u2030",finish:"\u205e"}],currency:[bg("$"),{start:"\u00a2",finish:"\u00a5"},{start:"\u20a0",finish:"\u20bd"},bg("\u5186"),bg("\u5143"),bg("\u5713"),bg("\u5706")],"extended-latin-a":[{start:"\u0100",finish:"\u017f"}],"extended-latin-b":[{start:"\u0180",
finish:"\u024f"}],arrows:[{start:"\u2190",finish:"\u21ff"},bg("\u2794"),{start:"\u2798",finish:"\u27af"},{start:"\u27b1",finish:"\u27be"}],mathematical:[{start:"\u2795",finish:"\u2797"},{start:"\u2200",finish:"\u22ff"}],miscellaneous:[{start:"\u2701",finish:"\u275e"},{start:"\u2761",finish:"\u2793"},bg("\u27b0"),bg("\u27bf")]},b={};Ma(a,function(a,d,e){b[d]=ia(a,C_)});return b}function D_(a){var b=H.create({insert:p(["string"]),close:p([])}),c=we(a);a=B_();a=E_.generateItems(a);var d=Wc.input("specialchar",
"specialchar.selects"),e=xA(or.left(),a,B.resolve("specialchars"));n.add(e.body(),B.resolve("specialchar-body"));n.add(c.element(),B.resolve("specialchar-dialog"));z(A.children(e.element()),Vc.register);var f=K.bind(c.element(),"click",function(a){a=a.target();L.closest(a,"[data-ephox-polish-special-char]").each(function(a){Z.focus(a);a=m.get(a,"data-ephox-polish-special-char");var b=d.input(),c=fa.get(b);fa.set(b,c+a)})}),h=F_.controls("specialchar");c.setTitle(x.translate("specialchar.dialog"));
c.setContent(e.element());c.setControls(h.element());y.after(e.element(),d.element());a=function(){c.hide();fa.set(d.input(),"");b.trigger.close()};var l=G_(e),g=H_(e),k=Kb.setup(c,h,[l,g,ha.input(d.input(),Ba.input({}))]);e.events.setActive.bind(function(a){l.clickFocus(a.item().element())});c.events.close.bind(function(){k.exit();b.trigger.close()});h.events.cancel.bind(a);c.events.close.bind(a);h.events.insert.bind(function(){b.trigger.insert(fa.get(d.input()))});return{element:c.element(),events:b.registry,
open:function(){c.show();k.enter()},destroy:function(){f.unbind();c.destroy();e.destroy();h.destroy();k.destroy()},close:function(){c.hide();fa.set(d.input(),"")}}}function I_(a,b){var c=D_(b),d=H.create({insert:Q(["string"],c.events.insert),close:p([])}),e=function(){d.trigger.close();c.close()};c.events.close.bind(e);return{show:function(){a.toReading();c.open()},close:e,destroy:function(){c.events.close.unbind(e);c.destroy()},events:d.registry}}function J_(a){var b=a.content(),c=a.smartview(),
d=function(a){a=r.fromText(a.string());sd.insertAtCursor(b,[a]).each(function(a){a=la.after(a.element());b.setRelativeSelection(a,a);b.focus();b.toEditing()})},e=hd.destroyable(),f=function(){e.clear()};return{ui:wb.ui({"specialchar.general":{toggle:!1,value:"specialchar",textkey:x.key("specialchar.open"),action:function(){var h=I_(b,c.uiContainer());e.set(h);h.events.close.bind(function(){b.focus();f()});h.events.insert.bind(function(a){d(a);f()});a.content().hideInlineSelection();h.show()},updateGeneral:t,
icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:f}}function K_(a,b,c,d,e){var f=a.content(),h=a.profile().nativeSpelling(),l=function(a){m.set(a,"spellcheck","false")},q=function(a){m.set(a,"spellcheck","true")};f.runOrOnLoaded(function(){var a=h.get()?q:l;f.body().each(a)});a=wb.ui({"spelling.general":{toggle:!0,value:"spellcheck",textkey:x.key("cog.spellcheck"),action:function(){var a=!h.get();h.setAndCache(a);a=a?q:l;f.body().each(a)},updateGeneral:function(a){(h.get()?a.select:a.deselect)()},
icon:!0,tooltip:qb.get}});return Eq({events:Gd(["analytics"]),init:t,hasDropdown:k(!1),hasAutocorrect:k(!1),check:t,scanView:t,lock:xb,situation:Jg.noSituation,handle:t,assign:t,destroy:function(){f.body().each(function(a){m.remove(a,"spellcheck")})},state:k({}),ui:a,lookup:k(g.none()),name:k("spelling-disabled")})}function L_(a,b,c){var d=H.create({change:p(["language"])});a=c?M_(a,d):N_(a,b,d);return{ui:wb.ui(a),hasDropdown:k(c),events:d.registry}}function O_(){var a=[],b=!1,c=function(){b=!0;g.from(a.shift()).fold(function(){b=
!1},function(a){a.f()(a.area(),c)})};return{enqueue:function(d,e){a.push(P_(d,e));b||c()},destroy:function(){a=[]}}}function Q_(a,b){var c=na(a),d=O_(),e=function(a,d,e,g){e=Sm.cata(e,function(a){return ja.inBody(a)?Tm.single(a,c.get(),b):Tm.empty()},function(a,d,e,f){return ja.inBody(a)&&ja.inBody(e)?Tm.range(a,d,e,f,c.get(),b):Tm.empty()});d(a,e,c.get(),g)};return{run:function(a,b,c){e(a,b,c,ca)},setLang:c.set,schedule:function(a,b,c,g){d.enqueue(c,function(c,d){void 0!==g&&g()?d():e(a,b,c,d)})},
destroy:function(){d.destroy()}}}function R_(a,b){var c=function(b){return E(b,function(b){var c=lB.getInCache(a,b.lang(),b.words());return{zone:k(b),words:k(c),lang:b.lang}})},d=function(a,b,c){z(b,function(b){S_.highlight(a,b.zone(),b.words(),c)})};return{local:function(a,b,h,l){b=b.zones();b=c(b);d(a,b,h);l()},remote:function(c,f,h,l){f=f.zones();T_.scan(a,b,f).get(function(a){d(c,a,h);l()})},destroy:t}}function U_(a,b,c){var d=mB.initCaches(c),e=mm.post("ephox.spelling.service.many",V_.many(),
a,b);return{checkMany:function(a,b,c){c=yj.now();return mB.execute(e,d,a,b,c)},dumpCache:function(){return eb(d,function(a){return a.dump()})}}}function W_(a,b,c,d,e){var f=X_.spelling(b),h=U_(f+"correction",a.newHeaders(),e),l=H.create({failed:p(["resource"])}),g=Ae.get(f+"autocorrect?language="+c,Be.json(),he.xhr(),a.newHeaders()),C=lf.nu(function(a){g.get(function(b){b.fold(function(){a(b)},function(b){h.checkMany(c,["startup"],!0).get(a)})})});C.get(function(a){a.fold(function(a){console.error("Unable to communicate with the spelling service:",
wr.consoleMessage(a));l.trigger.failed(b)},t)});return{correction:function(a,b,e,f){C.get(function(l){l.fold(f,function(){h.checkMany(d?b:c,a.words).get(function(a){a.fold(function(a){console.error("Error response from the spelling service:",wr.consoleMessage(a));f(a)},function(a){e(a)})})})})},autocorrect:k(g),events:l.registry,state:function(){return h.dumpCache()}}}function Y_(a){var b=a.content(),c=a.profile(),d=W_(a.communication(),a.url(),a.language(),a.multilingual(),a.fromServiceState()),
e=a.autocorrectOn()?nB.active(d):nB.inactive(),f=H.create({failed:p(["resource"])}),h=function(a){f.trigger.failed(a.resource())};d.events.failed.bind(h);var l=Q_(a.language(),a.viewable().viewport()),g=R_(a.cache(),d),k=function(a){b.body().each(function(b){qm.filterDom(b,[hr("."+a,Na.unwrap)])})},w=function(){return!vf.isOn(c.spelling().get())},I=function(){k("ephox-cram-annotation-wrap")};return{run:function(a,b){var d=c.spelling().get();vf.isOn(d)&&(l.setLang(d),l.run(a,g.local,b),l.schedule(a,
g.remote,b,w))},refresh:function(){var a=c.spelling().get();vf.isOn(a)||I()},clear:I,lookup:e.lookup,destroy:function(){d.events.failed.unbind(h);l.destroy();g.destroy()},state:d.state,events:f.registry}}function Z_(){var a=H.create({incorrect:p(["substitution"])}),b=g.none(),c={};c[Ee.spelling()]=function(c){b.each(function(b){b=Sr.substitute(b,m.get(c,Ee.value()));a.trigger.incorrect(b)})};return{assign:function(a){b=a},run:function(a){var b=m.get(a,Ee.type());b=c[b];void 0!==b&&b(a)},events:a.registry}}
function $_(a,b,c){var d=Z_();d.events.incorrect.bind(function(c){b.save();a.focus();a.domChanged();c.substitution().each(function(b){oB.selectEnd(a,b)})});var e=u(function(a,b,c,d){return a.marker(d).bind(a.detail).bind(function(a){return c(a).map(function(a){return E(a,function(a){var c={};c[Ee.type()]=b;c[Ee.value()]=a;return a0(a,a,c)})})})},Sr,Ee.spelling(),function(a){return c.suggestions(a.lang(),a.word())});return{assign:d.assign,handle:function(a){d.run(a)},situation:function(a){a=e(a).getOr([]);
return b0.generate(a,4)},destroy:t}}function c0(a,b){var c=H.create({lookup:p(["element"])}),d=function(){a.getSelection().each(function(a){c.trigger.lookup(a.startContainer())})};a.events.keyup.bind(function(a){fe.isSpace(a)&&d()});a.events.nodeChanged.bind(function(a){a.prev().each(c.trigger.lookup)});return{events:c.registry,destroy:t}}function d0(a,b,c,d,e,f,h,l,g){var q=$_(b,e,l),k=c0(b,c),m=function(a){b.getSelection().each(function(b){var c=kb.toLeaf(b.endContainer(),b.endOffset()),e=kb.toLeaf(b.startContainer(),
b.startOffset()),f;(f=b.collapsed())||(f=!pB.isIE())||(f=id.after(b.endContainer(),b.endOffset(),b.startContainer(),b.startOffset()));b=f&&!pB.isFirefox()?Sc(e.element(),e.offset(),c.element(),c.offset()):b;return(f?d.lightweightWith:xb)(a,b)})},F=Hd.tap(function(a){a=a.element();"body"!==D.name(a)&&(a=Sm.single(a),n(a))});k.events.lookup.bind(function(a){F.instance(a)});var n=function(a){g.run(m,a)};return{destroy:function(){q.destroy();k.destroy()},scan:n,situation:q.situation,lock:function(a){var b=
F.control.isBlocked();F.control.block();a();b||F.control.unblock()},assign:q.assign,handle:q.handle}}function e0(a,b,c,d,e){e=b.language.getOr(e);var f=a.communication(),h=a.profile(),l=a.filter(),q=a.content(),C=a.operations(),w=a.undo(),I=a.smartview(),F=a.shortcuts(),n=a.context(),X=a.viewablearea();Tr.configure(l);a.profile().spelling().set(e);var r=f0(b.words),u=Y_(g0({communication:f,profile:h,content:q,undo:w,viewable:X,cache:r,url:c.url,autocorrectOn:c.autocorrect,language:d,fromServiceState:b.service,
multilingual:c.multilingual})),v=g.none();b=H.create({analytics:p(["message"])});u.events.failed.bind(function(b){b=mf.get("error.code.spelling.not.found",[b.resource()]);b=nj(b);a.ui().displayBanner(b)});q.events.ready.bind(function(a){q.body().each(function(a){m.set(a,"spellcheck",!1)});a=a.api().doc();a=d0(a,q,n,C,w,F,I,r,u);u.refresh();v=g.some(a)});d=L_(a,d,c.menu);d.events.change.bind(function(a){(vf.isOn(a.language())?x:u.clear)();q.uiChanged();q.domChanged()});var y=function(a){z(a,function(a){a=
Sm.single(a);B(a)})},x=c.scanView?function(){var a=X.sections();y(a)}:u.clear;c.scanView&&X.events.onChange.bind(x);var B=function(a){v.each(function(b){b.scan(a)})};return Eq({events:b.registry,destroy:function(){q.body().each(function(a){m.remove(a,"spellcheck")});v.each(function(a){a.destroy()});r.destroy();u.destroy()},state:function(){return{words:r.state(),service:u.state(),language:g.some(a.profile().spelling().get())}},init:t,hasDropdown:d.hasDropdown,hasAutocorrect:k(c.autocorrect),ui:d.ui,
check:function(a,b,c,d){a=Tr.isWrap(a)?kb.toLeaf(a,b):W.point(a,b);c=Tr.isWrap(c)?kb.toLeaf(c,d):W.point(c,d);c=Sm.range(a.element(),a.offset(),c.element(),c.offset());B(c)},scanView:x,situation:function(a){var b={primary:k([]),secondary:k([]),submenus:k({})};return v.fold(k(b),function(b){return b.situation(a)})},lock:function(a){return v.fold(function(){return a()},function(b){return b.lock(a)})},assign:function(a){v.each(function(b){b.assign(a.bind(A.firstChild).or(a))})},handle:function(a){v.each(function(b){b.handle(a)})},
lookup:u.lookup,name:k("spelling")})}function h0(a,b,c,d,e){return(!0===c.service?e0:K_)(a,b,c,d,e)}function qB(a){var b=$d(a);n.add(b.element(),B.resolve("choice-button"));var c=T.span();m.set(b.element(),"title",x.translate("table."+a));m.set(b.element(),"tabindex","-1");S.button(b.element(),x.translate("table."+a),!1);var d=ib.describe(b.element(),x.translate("aria.table.headerdescription"));y.append(b.element(),d);b.events.click.bind(function(){Z.focus(b.element());ra.pressed(b)});ma.add(c,[B.resolve(a),
"ephox-pastry-icon-content","ephox-polish-icon"]);b.content({element:k(c)});return b}function i0(a,b){var c=!1,d=function(a,b,c){var d=c.full();d.row()===b.rows()&&d.column()===b.columns()||a.setSize(d.row(),d.column());a=a.setSelection(c.selection().row(),c.selection().column());Z.focus(a)};return{on:function(){c=!0},off:function(){c=!1},mousemove:function(e,f,h,l){if(c){var g=Ia.get(e.element());var k=sa.get(e.element());g=Oa.dimensions(g,k);k=bb.absolute(e.element());k=Oa.coords(k.left(),k.top());
h=Oa.coords(h,l);h=a.pickerCell(k,g,f,h);h=rB.resize(h,b);d(e,f,h)}},manual:function(a,f,h,l){c&&(h=rB.grow(f,h,l,b),d(a,f,h))}}}function j0(a,b,c){var d=H.create({select:p(["rows","cols","rowHeaders","columnHeaders"])}),e=r.fromTag("table");S.presentation(e);S.hidden(e,!0);n.add(e,$g.table());var f=r.fromTag("tbody");y.append(e,f);var h=0,l=0,g=function(a,b){h=b;l=a;C()},C=function(){G.empty(f);var a=c.ids();ke.repeat(l,function(b){var c=r.fromTag("tr");n.add(c,$g.row());var d=ke.repeat(h,function(c){var d=
r.fromTag("td");n.add(d,vd.resolve("cell-"+c+"-"+b));n.add(d,$g.cell());var e=r.fromTag("button");m.set(e,"type","button");m.set(e,"aria-labelledby",a[b][c]);n.add(e,$g.button());y.append(d,e);return d});P.append(c,d);y.append(f,c)})},w=function(a,b){var c=cg.cells(e);z(c,function(a){n.remove(a,vd.resolve("picker-selected"))});c=cg.rows(e).slice(0,a);z(c,function(a,c){a=cg.cells(a).slice(0,b);z(a,function(a,b){var d=cg.grid(e,"data-picker-header-row","data-picker-header-col");b=c<d.rows()||b<d.columns()?
[vd.resolve("picker-selected"),vd.resolve("picker-header")]:[vd.resolve("picker-selected")];ma.add(a,b)})});m.set(e,"data-picker-col",b-1);m.set(e,"data-picker-row",a-1);a=cg.cells(c[c.length-1]).slice(0,b);return cg.button(a[a.length-1])},I=function(){var a=parseInt(m.get(e,"data-picker-col"),10)+1,b=parseInt(m.get(e,"data-picker-row"),10)+1;return Oa.grid(b,a)},F={element:k(e),setSelection:w,setSize:g},V=i0(a,b),X=K.bind(e,"mousemove",function(a){V.mousemove(F,Oa.grid(l,h),a.raw().pageX,a.raw().pageY)}),
t=function(a,b){V.manual(F,I(),a,b)},v=vm.realClick.bind(e,function(a){x();a.raw().preventDefault()}),x=function(){var a=cg.grid(e,"data-picker-row","data-picker-col"),b=cg.grid(e,"data-picker-header-row","data-picker-header-col");d.trigger.select(a.rows()+1,a.columns()+1,b.rows(),b.columns())};return{element:function(){return e},destroy:function(){v.unbind();X.unbind();G.remove(e)},setSize:g,setHeaders:function(a,b){m.set(e,"data-picker-header-row",a);m.set(e,"data-picker-header-col",b)},setSelection:w,
on:V.on,off:V.off,reset:function(){g(b.minRows,b.minCols);var a=w(1,1);Z.focus(a)},refresh:function(){var a=I();C();return w(a.rows(),a.columns())},events:d.registry,sendLeft:u(t,a.isRtl()?1:-1,0),sendRight:u(t,a.isRtl()?-1:1,0),sendUp:u(t,0,-1),sendDown:u(t,0,1),sendExecute:x}}function k0(a,b){var c=Vg.createHelp(b.maxRows,b.maxCols,{row:function(a){return x.translate("table.picker.rows",a)},col:function(a){return x.translate("table.picker.cols",a)}}),d=j0(a,b,c);S.label(d.element(),x.translate("table.picker.label"));
b=ib.describe(d.element(),x.translate("table.picker.describepicker"));var e=r.fromTag("div");m.set(e,"tabIndex","-1");S.group(e);ma.add(e,[B.resolve("insert-table"),B.resolve("toolbar-menu")]);a=r.fromTag("div");n.add(a,B.resolve("table-controls"));S.toolbarGroup(a,x.translate("table.picker.header"));var f=qB("row-header"),h=qB("column-header");P.append(a,[f.element(),h.element()]);P.append(e,[a,d.element(),b,c.help()]);var l=function(){d.setHeaders(f.selected()?1:0,h.selected()?1:0);var a=Z.active(),
b=d.refresh();a.each(function(a){Z.hasFocus(a)||Z.focus(b)})};c=function(a,b){return function(){b();return g.some(!0)}};c=ha.single(d.element(),[ea.basic(R.LEFT()[0],c("left",d.sendLeft)),ea.basic(R.RIGHT()[0],c("right",d.sendRight)),ea.basic(R.UP()[0],c("up",d.sendUp)),ea.basic(R.DOWN()[0],c("down",d.sendDown)),ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),c("execute",d.sendExecute))],g.none());c.events.enter.bind(function(){Z.focus(d.element())});var q=ha.flow(a,{item:k(".ephox-pastry-statebutton")},
Ba.flow({trigger:function(a){return L.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})}})),C=ha.multiple(e,[c,q]);f.events.click.bind(function(){q.clickFocus(f.element());l()});h.events.click.bind(function(){q.clickFocus(h.element());l()});c=H.create({select:Q(["rows","cols","rowHeaders","columnHeaders"],d.events.select),exit:Q([],C.events.exit)});return{element:function(){return e},destroy:function(){C.destroy();f.destroy();h.destroy();d.destroy()},setSize:d.setSize,
setSelection:d.setSelection,on:function(){d.on();C.enter()},off:function(){d.off();C.isFocused()&&C.exit()},reset:function(){d.setHeaders(0,0);f.deselect();ra.release(f.element());h.deselect();ra.release(h.element());d.reset()},events:c.registry}}function l0(a,b){var c=H.create({enabled:p(["enabled"]),select:p(["rows","cols","rowHeaders","columnHeaders"]),insert:p(["table"]),done:p([]),abort:p([])});b=ua({minCols:7,maxCols:10,minRows:4,maxRows:10},b);var d=k0(a,b);d.events.select.bind(function(a){aa.detect().browser.isIE()?
(c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()),c.trigger.done(),e()):(e(),c.trigger.done(),c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()))});d.events.exit.bind(function(){e();c.trigger.abort()});var e=function(){d.off()};return{element:d.element,open:function(){d.reset();d.on()},close:e,destroy:function(){d.destroy()},events:c.registry}}function m0(){var a=r.fromTag("fieldset"),b=r.fromHtml("<legend>"+x.translate("table.border")+"</legend>");y.append(a,
b);var c=Ha("");b=function(a){var b=r.fromTag("input");m.setAll(b,{type:"radio",id:"tableborder"+a+c,value:a,name:c});return b};var d=b("1"),e=b("0");P.append(a,[d,r.fromHtml('<label for="tableborder1'+c+'">'+x.translate("border.on")+"</label>"),e,r.fromHtml('<label for="tableborder0'+c+'">'+x.translate("border.off")+"</label>")]);var f=Kb.radio(a,'input[type="radio"]',"input:checked");return{element:function(){return a},get:function(){return Vj.find(a).map(function(a){return fa.get(a)})},select:function(a){Vj.set(e,
!1);Vj.set(d,!1);a.each(function(a){"0"===a?Vj.set(e,!0):"1"===a&&Vj.set(d,!0)});f.refresh()},keylayout:k(f),destroy:function(){G.remove(a)}}}function n0(){var a=T.div();n.add(a,B.resolve("table-size-controls"));var b=Wc.input("table-width","table.width"),c=Wc.input("table-height","table.height");E([b,c],function(a){m.set(a.input(),"placeholder","Auto")});P.append(a,[b.element(),c.element()]);var d=[ha.input(b.input(),Ba.input({})),ha.input(c.input(),Ba.input({}))],e=function(a){var b=a.target();
Mc.validateField(b,"width",g.some("px")).fold(function(){Mc.highlight(b)},function(a){Mc.dehighlight(b)})},f=[K.bind(b.input(),"input",e),K.bind(c.input(),"input",e)];return{element:function(){return a},get:function(){return Mc.validate([Mc.rule(b.input(),"width",g.some("px")),Mc.rule(c.input(),"height",g.some("px"))])},set:function(a){a.width().bind(u(fa.set,b.input()));a.height().bind(u(fa.set,c.input()))},keylayouts:k(d),highlight:Mc.highlight,dehighlight:u(Mc.clearHighlights,a),destroy:function(){G.remove(a);
z(f,function(a){a.unbind()})}}}function o0(a,b){var c=H.create({ok:p(["properties"]),close:p([])}),d=we(b);d.setTitle(x.translate("table.dialog"));n.add(d.element(),B.resolve("dialog-narrow"));b=T.div();var e=zA("table.float"),f=Wc.input("tablesummary","table.summary"),h=Wc.input("tablecaption","table.caption"),l=n0(),q=m0();P.append(b,[h.element(),f.element(),q.element(),l.element(),e.element()]);var C=td.okCancel("table");C.events.ok.bind(function(){F()});C.events.cancel.bind(function(){d.hide();
c.trigger.close()});d.events.close.bind(function(){d.hide();c.trigger.close()});d.setContent(b);d.setControls(C.element());var w=Kb.setup(d,C,[ha.input(h.input(),Ba.input({})),ha.input(f.input(),Ba.input({})),q.keylayout()].concat(l.keylayouts()).concat([e.keylayout()])),m=function(){return l.get().map(function(a){a={width:k(g.some(a.width())),height:k(g.some(a.height()))};return Ur.properties({floatval:e.get(),caption:fa.get(h.input()).trim(),summary:fa.get(f.input()).trim(),border:q.get(),dimensions:a})})},
F=function(){m().fold(function(a){l.highlight(a)},function(a){c.trigger.ok(a)})};return{element:d.element,events:c.registry,open:function(){d.show();w.enter()},represent:function(b){b=Ur.divine(a,b);e.select(b.floatval());void 0!==b.summary()&&fa.set(f.input(),b.summary());void 0!==b.caption()&&fa.set(h.input(),b.caption());l.set(b.dimensions());q.select(b.border())},execute:F,destroy:function(){e.destroy();l.destroy();q.destroy();C.destroy();d.destroy();w.destroy()},hide:function(){w.exit();d.hide()}}}
function p0(a,b,c,d,e,f,h,l){var q=g.none(),C={"tablemenu-delete-table":Ac.erase,"delete-row":Ac.execute(b,nc.eraseRows,t,l),"delete-column":Ac.execute(b,nc.eraseColumns,t,l),"make-header-column":Ac.execute(b,nc.makeColumnHeader,t,l),"make-header-row":Ac.execute(b,nc.makeRowHeader,t,l),"unmake-header-column":Ac.execute(b,nc.unmakeColumnHeader,t,l),"unmake-header-row":Ac.execute(b,nc.unmakeRowHeader,t,l),"insert-row-before":Ac.execute(b,nc.insertRowBefore,t,l),"insert-row-after":Ac.execute(b,nc.insertRowAfter,
t,l),"insert-column-before":Ac.execute(b,nc.insertColumnBefore,Vr.halve,l),"insert-column-after":Ac.execute(b,nc.insertColumnAfter,Vr.halve,l),"tablemenu-table-properties":function(b,d,l){b=o0(a,h);var k=BA.generate(e,b,["properties"]);k.events.ok.bind(function(a){c.activate();q.each(function(b){sb.table(b.element(),c.isRoot).each(function(b){Pd.runTransaction(c,f,function(){Ur.apply(b,a.properties())})})});k.destroy()});k.events.close.bind(function(a){k.destroy();c.activate();c.focus()});c.deactivate();
k.represent(d);k.open();return g.none()},"cell-merge":Ac.execute(b,nc.mergeCells,t,l),"cell-unmerge":Ac.execute(b,nc.unmergeCells,t,l),"cell-split-cols":Ac.execute(b,nc.splitCellIntoColumns,Vr.halve,l),"cell-split-rows":Ac.execute(b,nc.splitCellIntoRows,t,l)},w=O("value","text","attrs"),I=Uz.byClass(te);return{handle:function(a){c.doc().each(function(b){q.each(function(b){var d=b.element();sb.table(d,c.isRoot).each(function(d){var e=m.get(a,"data-ephox-gopher-item-value"),h=C[e];void 0!==h&&Pd.runTransaction(c,
f,function(){h(c,d,b).each(function(a){c.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());I.clear(d)})})})})})},assign:function(a){q=a.bind(function(a){return sb.cell(a,c.isRoot).bind(function(a){return L.ancestor(a,"table").map(function(b){return Um.forMenu(d,b,a)})}).orThunk(function(){return sb.notCell(a,c.isRoot).map(function(a){return Um.notCell(a)})})})},situation:function(a){a=q.map(function(a){var b=a.element();b=sb.cell(b,c.isRoot).isSome();return Qb([b?[w("tablemenu-row",
x.translate("table.context.row.menu"),{})]:[],b?[w("tablemenu-column",x.translate("table.context.column.menu"),{})]:[],[w("tablemenu-table",x.translate("table.context.table.menu"),{})],a.mergable().isSome()?[w("cell-merge",x.translate("table.context.cell.merge"),{})]:[],a.unmergable().isSome()?[w("cell-unmerge",x.translate("table.context.cell.unmerge"),{})]:[],b&&1===a.selection().length&&a.mergable().isNone()&&a.unmergable().isNone()?[w("cell-split-cols",x.translate("table.context.cell.split-cols"),
{}),w("cell-split-rows",x.translate("table.context.cell.split-rows"),{})]:[]])}).getOr([]);var b=q.map(function(a){var b=a.element();a=function(a,c,d){var e=a+"-menu",f="th"===D.name(b)?"unmake":"make",h="make"===f?"header":"normal";c=[w("insert-"+a+"-before",x.translate("table.context."+a+"."+c),{}),w("insert-"+a+"-after",x.translate("table.context."+a+"."+d),{}),w("delete-"+a,x.translate("table.context.common.delete"),{}),w(f+"-header-"+a,x.translate("table.context.common."+h),{})];return{textkey:k(x.key("table.context."+
a+".title")),value:k(e),items:k(c)}};var c={textkey:k(x.key("table.context.table.title")),value:k("table-menu"),items:k([w("tablemenu-table-properties",x.translate("table.context.table.properties"),{}),w("tablemenu-delete-table",x.translate("table.context.common.delete"),{})])};return Qb([[a("row","insertabove","insertbelow")],[a("column","insertleft","insertright")],[c]])}).getOr([]);return{primary:k(a),secondary:k(b),submenus:k({"tablemenu-row":"row-menu","tablemenu-column":"column-menu","tablemenu-table":"table-menu"})}},
destroy:t}}function q0(){var a=H.create({drag:p(["xDelta","yDelta"])});return{mutate:function(b,c){a.trigger.drag(b,c)},events:a.registry}}function r0(){var a=H.create({drag:p(["xDelta","yDelta","target"])}),b=g.none(),c=q0();c.events.drag.bind(function(c){b.each(function(b){a.trigger.drag(c.xDelta(),c.yDelta(),b)})});return{assign:function(a){b=g.some(a)},get:function(){return b},mutate:c.mutate,events:a.registry}}function s0(a,b,c){var d=r0(),e=tj.transform(d,{}),f=g.none(),h=function(a,b){return g.from(m.get(a,
b))};d.events.drag.bind(function(a){h(a.target(),"data-row").each(function(b){b=Qd.getInt(a.target(),"top");v.set(a.target(),"top",b+a.yDelta()+"px")});h(a.target(),"data-column").each(function(b){b=Qd.getInt(a.target(),"left");v.set(a.target(),"left",b+a.xDelta()+"px")})});var l=function(a,b){var c=Qd.getInt(a,b);a=parseInt(m.get(a,"data-initial-"+b),10);return c-a};e.events.stop.bind(function(){d.get().each(function(d){f.each(function(e){h(d,"data-row").each(function(a){var b=l(d,"top");m.remove(d,
"data-initial-top");F.trigger.adjustHeight(e,b,parseInt(a,10))});h(d,"data-column").each(function(a){var b=l(d,"left");m.remove(d,"data-initial-left");F.trigger.adjustWidth(e,b,parseInt(a,10))});Fe.refresh(a,e,c,b)})})});var q=function(b,c){F.trigger.startAdjust();d.assign(b);m.set(b,"data-initial-"+c,parseInt(v.get(b,c),10));n.add(b,t0);v.set(b,"opacity","0.2");e.go(a.parent())},k=K.bind(a.parent(),"mousedown",function(a){Fe.isRowBar(a.target())&&q(a.target(),"top");Fe.isColBar(a.target())&&q(a.target(),
"left")}),w=function(b){return N.eq(b,a.view())},I=K.bind(a.view(),"mouseover",function(d){"table"===D.name(d.target())||Db.closest(d.target(),"table",w)?(f="table"===D.name(d.target())?g.some(d.target()):L.ancestor(d.target(),"table",w),f.each(function(d){Fe.refresh(a,d,c,b)})):ja.inBody(d.target())&&Fe.destroy(a)}),F=H.create({adjustHeight:p(["table","delta","row"]),adjustWidth:p(["table","delta","column"]),startAdjust:p([])});return{destroy:function(){k.unbind();I.unbind();e.destroy();Fe.destroy(a)},
refresh:function(d){Fe.refresh(a,d,c,b)},on:e.on,off:e.off,hideBars:u(Fe.hide,a),showBars:u(Fe.show,a),events:F.registry}}function u0(a,b){var c=Wj.height;a=s0(a,b,c);var d=H.create({beforeResize:p(["table"]),afterResize:p(["table"]),startDrag:p([])});a.events.adjustHeight.bind(function(a){d.trigger.beforeResize(a.table());var b=c.delta(a.delta(),a.table());Wr.adjustHeight(a.table(),b,a.row(),c);d.trigger.afterResize(a.table())});a.events.startAdjust.bind(function(a){d.trigger.startDrag()});a.events.adjustWidth.bind(function(a){d.trigger.beforeResize(a.table());
var c=b.delta(a.delta(),a.table());Wr.adjustWidth(a.table(),c,a.column(),b);d.trigger.afterResize(a.table())});return{on:a.on,off:a.off,hideBars:a.hideBars,showBars:a.showBars,destroy:a.destroy,events:d.registry}}function v0(a,b){var c=a.content(),d=a.keyboard(),e=a.undo(),f=a.smartview(),h=function(){return v.getOr(Xr.only(c.element()))},l=p0(a.filter(),a.region(),c,a.selections(),d,e,f.uiContainer(),h),q=function(a,b,d){e.save();z(b,function(b){a(b,d)});e.save();c.focus()},C=u(q,sB.setBackgroundColor);
q=u(q,sB.setBorderColor);b=wb.ui({"table.widget":u(w0.widget,a,b),"cell.palette":k({items:[{type:"widget",build:u(tB.widget,a,b,{action:C,shortname:"background",name:"cellbackgroundcolor",textkey:"table.cell.color.background",menuTextkey:"table.cell.color.background"})},{type:"widget",build:u(tB.widget,a,b,{action:q,shortname:"border",name:"cellbordercolor",textkey:"table.cell.color.border",menuTextkey:"table.cell.color.border"})},{type:"widget",build:u(x0.widget,a)},{type:"dropdown",build:u(y0.widget,
a)}],updatePalette:function(b){var d=wf.selectedCells(a.selections(),c.isRoot),e=u(b.show,g.some(x.translate("table.context.palette.show")));b=u(b.hide,g.some(x.translate("table.context.palette.hide")));(0<d.length?e:b)()&&a.ui().refresh()}})},ca);var w=function(b){var d=b.stopper();bm.context(c).bind(function(e){bm.cata(e,function(e){sb.cell(e.startContainer(),c.isRoot).each(function(e){(b.shift()?uB.backward:uB.forward)(a.region(),c,e,h).fold(d,function(a){d();c.setSelection(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})})},t)})},m=function(a){vB.upOrLeft(c)},F=function(a){vB.right(c)},n=d.editor();n.on();n.events.tab.bind(w);n.events.left.bind(m);n.events.up.bind(m);n.events.right.bind(F);var p=c.cursor(),r=g.none(),v=g.none();c.events.ready.bind(function(b){b=Rr.get(c,f,b.api().doc());v=g.some(b);var d=My(a.region().directionAt),h=u0(b,d);h.events.beforeResize.bind(e.save);h.events.afterResize.bind(function(){c.focus();e.save();c.domChanged();p.restore()});h.on();
h.events.startDrag.bind(p.save);r=g.some(h);b=a.selections();b.events.beforeScan.bind(function(){h.hideBars()});b.events.afterScan.bind(function(){h.showBars()})});return{ui:b,destroy:function(){l.destroy();r.each(function(a){a.destroy()});n.off();n.events.tab.unbind(w);n.events.left.unbind(m);n.events.up.unbind(m);n.events.right.unbind(F);n.destroy()},handle:l.handle,assign:l.assign,situation:l.situation,name:k("table")}}function z0(){var a=H.create({pasteUpload:p([]),uploadAssets:p(["assets"])});
return{destroy:t,events:a.registry,pasteUpload:a.trigger.pasteUpload,uploadAssets:a.trigger.uploadAssets}}function A0(a,b){a=a().uiContainer();var c=H.create({close:p([])}),d=we(a);d.setTitle(x.translate("wordcount.dialog"));ma.add(d.element(),[B.resolve("dialog-wordcount"),B.resolve("dialog-narrow")]);var e=b().body().getOrDie();a=Wh.toText(e,k(!1));e=Vb.get(e);b=b().getSelectedText().getOr("");a=wB.count(a);e=e.length;b=wB.count(b);var f=r.fromHtml(xB('<table class="ephox-polish-tabular ephox-polish-wordcount-table" tabindex="-1">    <thead>        <tr>            <th scope="col"> ${headerCounts}&nbsp;</th>            <th scope="col"> ${headerDocument}&nbsp;</th>            <th scope="col"> ${headerSelection}&nbsp;</th>        </tr>    </thead>    <tbody>        <tr>            <td>${wordCountLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-words">${documentCountWords}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-words">${selectionCountWords}&nbsp;</td>        </tr>        <tr>            <td>${wordCountCharsNoSpacesLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-charsnospaces">${documentCharactersNoSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-charsnospaces">${selectionCharactersNoSpaces}&nbsp;</td>        </tr>        <tr>            <td>${wordcountCharsLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-chars">${documentCountCharsWithSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-chars">${selectionCountCharsWithSpaces}&nbsp;</td>        </tr>    </tbody></table>',
{headerCounts:x.translate("wordcount.counts"),headerDocument:x.translate("wordcount.document"),headerSelection:x.translate("wordcount.selection"),wordCountLabel:x.translate("wordcount.words"),wordCountCharsNoSpacesLabel:x.translate("wordcount.charactersnospaces"),wordcountCharsLabel:x.translate("wordcount.characters"),documentCountWords:a.words(),selectionCountWords:b.words(),documentCharactersNoSpaces:a.characters().withoutSpaces(),selectionCharactersNoSpaces:b.characters().withoutSpaces(),documentCountCharsWithSpaces:e,
selectionCountCharsWithSpaces:b.characters().withSpaces()}));d.setContent(f);var h=ha.multiple(d.element(),[]);b=function(){l();c.trigger.close()};var l=function(){d.hide()};d.events.close.bind(b);h.events.exit.bind(b);return{element:d.element,events:c.registry,open:function(){d.show();h.enter();Z.focus(f)},destroy:function(){h.destroy();d.destroy()},hide:l}}function B0(a,b){var c=A0(a,b),d=H.create({close:p([])});c.events.close.bind(function(){d.trigger.close();c.destroy()});return{show:function(){c.open()},
events:d.registry}}function C0(a){var b=a.content,c=a.smartview;return{ui:wb.ui({"wordcount.general":{toggle:!1,value:"wordcount",textkey:x.key("wordcount.open"),action:function(){var d=B0(c,b);d.events.close.bind(function(){a.ui().tabstrip.focused()||b().focus()});a.content().hideInlineSelection();d.show()},updateGeneral:t,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:t}}function Vm(a,b,c){var d=function(a,b,c,d){return b.bundled?a.apply(void 0,d.concat([b])):c()},e=D0(a,b,c);b=d(QU,a.formatting,
Ta.basic,[e]);var f=d(OU,a.alignindent,Ta.basic,[e]),h=d(dV,a.bookmark,Ta.basic,[e]),l=d(fV,a.directionality,Ta.basic,[e]),q=d(v0,a.table,Ta.table,[e]),C=d(aV,a.blocktag,Ta.basic,[e]),w=d(MX,a.font,Ta.basic,[e]),I=d(C0,a.wordcount,Ta.basic,[e]),F=d(jZ,a.media,Ta.basic,[e]),n=d(J_,a.specialchar,Ta.basic,[e]),r=d(VY,a.linkvalidator,Ta.linkvalidator,[e,c.linkvalidator]),u=d(QY,a.link,Ta.basic,[e,r]),v=d(cY,a.horizontalrule,Ta.basic,[e]),x=d(ZX,a.help,Ta.dialog,[e]),y=function(b,c,d,f){var h=a.ui.locale.code;
h=void 0!==h?h:qf.get();return(!0===c.bundled?vf.determine(h):g.none()).fold(function(){return d()},function(a){var d=e.profile().spelling().get(),h=!0===c.menu||d===vf.offKey();return b.apply(void 0,f.concat([c,a,h&&!1!==d?d:a]))})}(h0,a.spelling,Ta.spelling,[e,c.spelling]),B=d(yZ,a.parlance,Ta.basic,[e,y]),D=d(GZ,a.resize,Ta.basic,[e]),G=d(dZ,a.macros,Ta.macros,[e,y,c.macros]),J=d($X,a.highlighter,Ta.highlighter,[e,G]),K=d(gV,a.draganddrop,Ta.draganddrop,[e]),L=z0(),M=d(AY,a.imageEdit,Ta.imageEdit,
[e,L]),N=d(fY,a.image,Ta.image,[e]),O=d(iX,a.fileupload,Ta.dialog,[e,L,M.insertResample(),K]),P=d(A_,a.smartclipboard,Ta.basic,[e,L,M.insertResample()]),S=d(uZ,a.mentions,Ta.basic,[e]),R=d(oX,a.findreplace,Ta.basic,[e]),T=d(JU,a.accessibility,Ta.basic,[e]),U=d(kV,a.embed,Ta.basic,[e,c.embed]);c=function(){var a=e.content();return a.body().fold(a.getContent,function(a){a=Pc.deep(a);return Xj.output(e.filter(),a)})};var W=function(a){var b=e.filter(),c=e.content();a=b.filterHtml(b.input(),a);c.resetContent(a);
J.run();r.refresh();y.scanView();return a};d=d(CZ,{getContent:c,setContent:W,bundled:a.plaincodeview.bundled},Ta.basic,[e]);e.contextmenu().register("table",q);e.contextmenu().register("imageEdit",M);e.contextmenu().register("image",N);e.contextmenu().register("spelling",y);e.contextmenu().register("link",u);var Z=E0({formatting:b,alignindent:f,bookmark:h,directionality:l,table:q,font:w,imageEdit:M,parlance:B,blocktag:C,wordcount:I,specialchar:n,media:F,link:u,linkvalidator:r,horizontalrule:v,help:x,
fileupload:O,findreplace:R,accessibility:T,plaincodeview:d,macros:G,spelling:y});e.content().events.ready.bind(function(){e.ui().init(e.keyboard(),e.undo(),Z);y.init(e.content());J.run();r.refresh()});e.content().events.loaded.bind(function(){setTimeout(function(){Y.trigger.loaded();aa()},0)});var Y=H.create({loaded:p([]),ready:Q([],e.content().events.ready),focus:p([]),change:p([]),dirty:Q([],e.laundry().events.dirty),internal:p(["command","data"]),paint:p(["dimensions"])}),aa=e.content().isInline()?
t:function(){e.content().body().each(function(a){a=A.documentElement(a);var b=e.content().element();Y.trigger.paint(iy({width:Ia.get(b),docWidth:Ia.get(a),height:sa.get(b),docHeight:sa.get(a)}))})};e.undo().events.changed.bind(function(){Y.trigger.change()});e.undo().events.reset.bind(function(){Y.trigger.change()});e.content().events.paint.bind(aa);e.content().events.nodeChanged.bind(aa);e.content().events.focus.bind(function(){Y.trigger.focus()});e.internalevents().events.internal.bind(function(a){var b=
a.command();"insertLink"===b&&(a=m.get(a.data(),"href"),Y.trigger.internal(b,a))});d=e.content().isInline()?function(){var a=e.ui(),b=e.content(),c=a.state();c=void 0!==c.toolbar&&void 0!==c.toolbar.drag?c.toolbar.drag.isSome():!1;b.activate();b.focus();e.viewablearea().setOn();c||a.position();a.refresh()}:t;b=e.content().isInline()?function(){e.content().deactivate();e.content().blur();e.viewablearea().setOff()}:t;return kj.internal({activateInline:d,deactivateInline:b,element:e.ui().element,viewport:e.ui().viewport,
connect:e.ui().connect,focus:e.content().focus,blur:e.content().blur,getContent:c,toTransfer:Pb(Lf.changed,c),setContent:function(a){var b=e.undo();b.disable(function(){var c=W(a);b.reset(c)});e.laundry().setDirty(!1)},insertHtmlAtCursor:e.insertFilteredHtmlAtCursor,isDirty:e.laundry().isDirty,setDirty:e.laundry().setDirty,fromTransfer:function(a){var b=e.undo();Lf.cata(a,function(a){b.disable(function(){W(a)});b.replaceTop()},function(a){W(a);b.save()})},uploader:k(L),state:function(){var a=e.state();
return ua(a,{spelling:y.state(),macros:G.state(),filters:e.filter().customFilters().state(),linkvalidator:r.state(),embed:U.state()})},destroy:function(){e.content().deactivate();var a=E(Ze(Z),xb);z(a.concat([U,N,M,y,D,G,J,L,P,S,e,K]),function(a){a.destroy()})},events:Y.registry,communication:e.communication,fullscreen:e.fullscreen,content:e.content,ui:e.ui,undo:e.undo,smartview:e.smartview,keyboard:e.keyboard,filter:e.filter,operations:e.operations,macros:k(G),getMode:hc.pencil,isPrettyPrinting:function(){return!0===
a.content.prettyprint}})}function F0(a,b){var c=Ta.state(b),d=na(null),e=r.fromTag("div"),f=function(){Ea.set(e,'<div class="e-p-s-img"></div>');h()},h=void 0===a.content.inline?t:function(){if(!1===a.ui.toolbar.visible)v.set(e,"display","none");else{var b={isInline:k(!0),element:k(a.content.inline)};b=qd.offsetFrom(b,e,sa.get(e),a.ui);v.setAll(e,{position:"absolute",left:b.left+"px",top:b.top-4+"px"})}},l=null;b=yb("API unavailable while the editor is loading");var q={body:k(g.none()),doc:b,execCommand:b,
getSelectedText:b,focus:b,deactivate:t,blur:t},C=void 0===a.content.inline?d.get:function(){return Ea.get(a.content.inline)};return kj.internal({activateInline:h,blur:b,communication:k(oz(a)),connect:function(a){l=setTimeout(f,1E3);y.append(a,e);Yr.add();return!1},content:k(q),deactivateInline:t,destroy:function(){clearTimeout(l);Yr.remove();G.remove(e)},element:k(e),events:Id.events(),failure:function(){clearTimeout(l);Yr.remove();Ea.set(e,"<p>Unable to load editor. See browser console for details.</p>")},
filter:c.filter,focus:b,fromTransfer:function(a){Lf.cata(a,d.set,d.set)},fullscreen:Ta.fullscreen,getContent:C,getMode:b,insertHtmlAtCursor:b,isDirty:c.laundry.isDirty,isPrettyPrinting:function(){return!0===a.content.prettyprint},keyboard:Id.keyboard,macros:c.macros,operations:Id.operations,setContent:function(b){void 0===a.content.inline?d.set(b):Ea.set(a.content.inline,b);c.laundry.setDirty(!1)},setDirty:c.laundry.setDirty,smartview:Id.smartview,state:function(){var a=xf.isEmpty(C())?{}:{content:{}};
return c.getState(a)},toTransfer:Pb(Lf.unchanged,C),ui:Id.ui,undo:k(Ta.undo()),uploader:k(Ta.uploader()),viewport:k(e)})}function G0(a,b){return(!0===b.bundled?H0:I0)(a,b)}function J0(a,b){var c=H.create({change:p(["type"])}),d=yf.removeClasses([B.resolve(hc.none()),B.resolve(hc.wait()),B.resolve(hc.pencil()),B.resolve(hc.code())]),e=T.div();S.hidden(e,"true");ma.add(e,[B.resolve("html-switch-wrapper"),B.resolve("layer-editor")]);var f=T.div();ma.add(f,[B.resolve("html-switch"),B.resolve("icon")]);
y.append(e,f);var h=function(a){d(f);n.add(f,B.resolve(a));m.set(f,"data-icon",a);m.remove(f,"title")},l=function(a,b){var c=m.get(f,"data-icon");a!==c&&(r=c,h(a),m.set(f,"title",b))},g=function(a){b.showButton&&a!==hc.none()?l(a,x.translate("toolbar.switch-"+a)):h(hc.none());w.control.unblock()},k=hd.unbindable(),w=Hd.tap(function(){c.trigger.change(m.get(f,"data-icon"))});b.showButton&&k.set(K.bind(e,"click",w.instance));var I=function(a){y.append(a,e)},F=ae.onDirection("right","left"),r=hc.none();
g(r);return{render:I,destroy:function(){G.remove(e);k.clear()},switchto:g,spin:function(){l(hc.wait(),x.translate("loading.wait"));w.control.block()},stopSpin:function(){"spin"!==r&&g(r)},init:function(b){var c=a.get();I(c.viewport());c.events.paint.bind(function(a){var b=a.dimensions();a=F(c.element());b="left"===a&&(yB.isFirefox()||yB.isChrome())?0:b.width()-b.docWidth();v.set(e,a,b+"px")});g(hc.none())},events:c.registry}}function K0(a,b,c,d,e,f){var h=r.fromTag("div"),l=c.uiContainer(),g=T.div();
d.updateUi(h);d=[Mg.editorContainer(),"ephox-textbox-font",B.resolve("layer-editor"),B.resolve("editor-main"),B.resolve("fullscreen-maximized")];ma.add(h,d);m.set(h,"lang",qf.get());Zr.addClasses(h);y.append(h,l);var C=By(a,h,{}),w=df.toolbar(C,x.translate);b.events.toolbar.bind(w.enter);w.events.exit.bind(a.focus);var I=Ay(),F=ja.body(),p=T.div();n.add(p,B.resolve("socket"));var X=E(["dragover","drop"],function(a){return K.bind(p,a,function(a){a.kill()})}),t=T.div();n.add(t,B.resolve("widget-container"));
C.integrate(h,w,I,p,t);Ky.build(h,e.sideBar,e.bottomBar);var u=cA({layerClass:B.resolve("layer-below-editor"),background:"rgba(255, 255, 255, 0.92)"}),v=B.resolve("body-fullscreen");a.events.paint.bind(function(a){w.repaint();c.refresh()});return{element:k(h),socket:function(a){y.append(p,a.element())},viewport:k(p),uiContainerParent:k(g),connect:function(a){u.show();n.add(F,v);y.append(a,h);lj.detect(h);return!0},destroy:function(){z(X,function(a){a.unbind()});w.destroy();n.remove(F,v);G.remove(h);
G.remove(g);u.destroy();I.destroy()},banners:I.element,displayBanner:I.display,hideBanner:I.hide,position:function(){C.init(w,I,p,t,e,f)},refresh:function(){C.update();w.refresh()},toolbar:w,dialogContainer:k(t)}}function L0(a){var b=g.none(),c=g.none(),d=H.create({maximize:p([]),restore:p([])}),e=function(c){b=A.parent(a.get().element());b.getOrDie("maximize called on editor that is not in the DOM.");a.swap(Vm,{ui:{layout:M0,isFullScreen:!0,autoresize:!1},fullscreen:{layout:void 0!==c.layout()?c.layout():
$r},content:{autoresize:!1}}).destroy();var e=a.get();e.fullscreen().select();e.connect(ja.body());e.events.ready.bind(function(){e.focus();d.trigger.maximize()})},f=function(c){a.swap(Vm,{ui:{layout:void 0!==c.layout()?c.layout():$r,isFullScreen:!1}}).destroy();var e=a.get();e.fullscreen().deselect();c=b.getOrDie("restore called on editor that was not previously in the DOM.");a.get().connect(c);e.events.ready.bind(function(){e.focus();d.trigger.restore()})};return{init:function(b){if(Wm.goingToDesign(b)){b=
a.get();var d=a.get().element();c.each(function(a){if(N.eq(a,d))throw"Fullscreen init called twice on the same instance";});c=g.some(d);b.fullscreen().events.maximize.bind(e);b.fullscreen().events.restore.bind(f)}},destroy:function(){},events:d.registry}}function N0(){var a=[];return{setCallback:function(b){vb(b)&&a.push(b)},done:function(b){z(a,function(a){a.apply(null,[b])});a=[]}}}function O0(a){var b=function(){var b=a.url,c=b.lastIndexOf("/");b=0<c?b.substr(0,c):b;b=void 0===a.basePath?b:a.basePath;
return je(b,"/")?b:b+"/"}(),c=function(c,e,f){var d=Yj.getFilename(c,e);e=!0===a.credentials?he.xhr():he.none();c=zB.file(Yj.buildData("image",c,d));Ae.post(a.url,c,Be.text(),e).map(function(a){a.fold(function(a){f(J.error(Yj.failureObject(a.message(),a.status(),a.responseText())))},function(a){try{var c=Nb.parse(a);if(xa(c.location))var e=c.location;else{f(J.error(Yj.failureObject("JSON response did not contain a string location",500,a)));return}}catch(I){e=a}a=e.split(/\s+/);a=Cr.resolve(b,1===
a.length&&""!==a[0]?a[0]:d);f(J.value({location:a}))})})};return{upload:function(a,b,f){a=a.imageresult();Yc.imageResultToBlob(a).then(function(a){c(a,b,f)})}}}function P0(a){var b=function(b,d,e,f){var c=function(a){f(J.error(a))},l=function(a){xa(a)?f(J.value({location:a})):(console.error("Image upload result was not a string"),c(""))},g=Yj.getFilename(b,e),k=Q0(e,g,b,d);setTimeout(function(){a(k,l,c)},0)};return{upload:function(a,d,e){var c=a.imageresult();Yc.imageResultToBlob(c).then(function(a){b(a,
Yc.imageResultToDataURL(c),d,e)})}}}function R0(){var a={},b=function(a){dg.revokeObjectURL(a.objurl())};return{add:function(b,d,e){d=S0(b,d,e);return a[b]=d},get:function(b){return g.from(a[b])},remove:function(c){var d=a[c];delete a[c];void 0!==d&&b(d)},lookupByData:function(b){return T0(a,function(a){return Yc.imageResultToDataURL(a.imageresult())===b})},destroy:function(){Ma(a,b);a={}}}}function U0(){var a=[],b=[],c=H.create({complete:p(["response"])}),d=function(d){a=ka(a,function(a,b){return a!==
d});!1===e()&&(c.trigger.complete(b),b=[])},e=function(){return 0<a.length};return{findById:V0,findAll:W0,register:function(b,c){m.set(b,Xm,c);a.push(c)},report:function(a,c,e){z(c,function(a){m.remove(a,Xm);b.push({success:e,element:a.dom()})});d(a)},inProgress:e,isActive:function(b){return U(a,b)},events:c.registry}}function X0(a,b){var c=R0(),d=N0(),e=U0(),f=nr(a.ui),h=Y0.choose(b,f,a.communication()),l=h.uploader(),q=h.errors(),k=Z0.instance(b,c),w=H.create({begin:p([]),finish:p([])}),m=function(a){w.trigger.finish();
d.done(a)};e.events.complete.bind(function(a){m(a.response())});var F=function(a,b,d,f){Zj.handleUpload(l,e,c,a,b,d,function(a){a.fold(function(a){f(a)},r)})},n=function(d){a.content().body().each(function(a){var e=q.instance(),f=Zj.registerAssets(c,a,d.assets());f=Rj.partition(f);z(f.errors,function(a){console.error(a)});0<f.values.length&&!0===b.immediate&&(w.trigger.begin(),z(f.values,function(b){t(a,b,e)}))})},r=function(b,c,d){a.undo().rewrite(d.objurl(),b.location)},t=function(a,c,d){!1!==b.bundled&&
Zj.prepareForUpload(e,c.blobInfo().id(),c.image()).each(function(b){F(a,b,c.blobInfo(),d)})},u=function(a){z(a,function(a){e.report(a,g.none(),!1)})},v=function(a,b){b=Rj.partition(b);var c=b.values;u(b.errors);var d=q.instance();k(c).get(function(b){b=Rj.partition(b);0<b.errors.length&&(f.showKey("imageedit.generic"),console.error("Image resample on upload errors: ",b.errors),u(b.errors));z(b.values,function(b){t(a,b,d)})})},y=function(f){vb(f)&&d.setCallback(f);w.trigger.begin();!0!==b.bundled?
m([]):a.content().body().fold(function(){m([])},function(a){var b=Zj.findBlobs(e,c,a);0!==b.length||e.inProgress()?v(a,b):m([])})};return{init:function(d){Wm.goingToDesign(d)&&(d=a.filter(),$0.configure(d,c),a.uploader().events.uploadAssets.bind(n),a.uploader().events.pasteUpload.bind(function(){!0===b.immediate&&y()}));f.reset()},events:w.registry,reconstitute:y,destroy:function(){c.destroy()}}}function a1(a,b,c,d){var e=L0(a),f=X0(b,c.imageupload),h=G0(a,c.codeview),l=J0(a,c.codeview),g=[e,f,l],
k=g.concat([h]);e.events.restore.bind(function(){d.restore();m(k,hc.code())});e.events.maximize.bind(function(){d.save();m(g,hc.code())});f.events.begin.bind(l.spin);f.events.finish.bind(l.stopSpin);h.events.change.bind(function(c){a.get().events.loaded.bind(function(){b.focus()});b.reconnect()});l.events.change.bind(function(a){w(a.type())});h.events.ready.bind(function(a){l.switchto(a.type())});var w=function(b){f.reconstitute(function(){a.get().getMode()!==b&&(l.spin(),h.setMode(b))})},m=function(a,
b){z(a,function(a){a.init(b)})};b.events.connected.bind(function(){m(k,Wm.alternate(b.getMode()))});return{setMode:w,uploadImages:f.reconstitute,destroy:function(){l.destroy();a.destroy();z(k,function(a){a.destroy()})}}}function b1(a){var b=c1(a);return{directionAt:function(a){return"rtl"===(D.isText(a)?A.parent(a):g.some(a)).map(ae.getDirection).getOr("ltr")?AB:BB},uiDirection:function(){return b?AB:BB},updateUi:function(a){m.set(a,"dir",b?"rtl":"ltr")},destroy:t}}function d1(a,b){var c=H.create({create:p(["instance"]),
loaded:p([]),focus:p([]),dirty:p([]),change:p([]),internal:p(["command","data"])}),d=gc(function(){c.trigger.loaded()}),e=function(a){a.events.focus.bind(function(){c.trigger.focus()});a.events.dirty.bind(function(){c.trigger.dirty()});a.events.change.bind(function(){c.trigger.change()});a.events.internal.bind(function(a){c.trigger.internal(a.command(),a.data())});a.events.loaded.bind(d)};e(a);var f=a,h=Pb(b1,qf.get);return{get:function(){return f},swap:function(a,d){var l=f;d=oa(b,d);var g=l.state();
a=a(d,h(),g);e(a);c.trigger.create(a);f=a;return{old:k(l),nu:k(a),destroy:function(){l.destroy()}}},destroy:function(){f.destroy()},events:c.registry}}function as(a,b){var c=e1(a);ak.setLanguage(c.ui.locale.code);a=oa(CB.state(),b);b=Vc.capture(r.fromDom(document),window);var d=F0(c,a),e=d1(d,c),f=qU(e);a=a1(e,f,c,b);b=H.create({loaded:Q([],e.events.loaded),focus:Q([],e.events.focus),dirty:Q([],e.events.dirty),change:Q([],e.events.change),connected:Q([],f.events.connected),internal:Q(["command","data"],
e.events.internal)});ak.waitForLoad().get(function(a){a=ak.getFailures(a);if(0===a.length){a=e.swap("code"===c.codeview.mode?gy:Vm);f.reconnect();var b=function(a){xf.isEmpty(a)||f.setContent(a)},h=a.old().toTransfer();Lf.cata(h,b,b);a.destroy()}else z(a,function(a){console.error(a)}),console.error("Required resources are not available. Cancelling editor load."),d.failure()});return kj.external({activateInline:f.activateInline,communication:Id.communication,connect:f.connect,content:f.content,deactivateInline:f.deactivateInline,
element:f.element,events:b.registry,filter:f.filter,focus:f.focus,getContent:f.getContent,getMode:f.getMode,insertHtmlAtCursor:f.insertHtmlAtCursor,isDirty:f.isDirty,isPrettyPrinting:f.isPrettyPrinting,keyboard:f.keyboard,macros:f.macros,operations:f.operations,setContent:f.setContent,setDirty:f.setDirty,smartview:f.smartview,state:f.state,ui:f.ui,undo:f.undo,setMode:a.setMode,uploadImages:a.uploadImages,destroy:a.destroy})}function f1(a,b,c){n.add(b,be.base());return{toolbarShow:function(){n.add(b,
be.active());v.set(a(),"display","block")},toolbarHide:function(){n.remove(b,be.active());v.set(a(),"display","none")},isVisible:function(){return n.has(b,be.active())},restore:function(){ma.remove(b,[be.base(),be.active()]);m.setAll(b,c)}}}function g1(a){var b=!1;return{submit:function(){b=!0;a.submit[0]?a.submit[0].click():a.submit.click?a.submit.click():a.submit();b=!1},inprogress:function(){return b}}}function h1(a){var b=function(b,d){var c=gc(function(){var b=oa,c=void 0!==d?d:{};var e=oa;var g=
i1(c),k=void 0===c.privateapi?{}:c.privateapi;c=Ob(k.ui,[ba.func("bounds"),ba.bool("showHelpHint"),ba.domElement("bottomBar"),ba.domElement("sideBar")]);var w=Ob(k.integration,[ba.string("type"),ba.string("version")]),m=Ob(void 0===k.content?{}:k.content,[ba.string("base"),ba.arrayOfStrings("imageExcludes")]),F=DB.paramList(),n=Ob(k.mentions,F),p=cb(n).length;k=Ob(k.output,[ba.bool("prettyprint")]);if(0<p){if(p!==F.length)throw Error("Missing @mentions configuration. Expected "+F.length+" objects, was "+
p);n.bundled=!0}c={ui:c,help:{integration:w},content:ua(m,k),mentions:n};e=e(g,c);b=b(e,a);return EB.setupResources(b)});return{constructors:k(b),options:c}};return{classic:function(a){return b(j1,a)},inline:function(a){a=oa({ui:{toolbar:{draggable:!0}}},a);return b(k1,a)}}}function l1(a){var b=vT(),c=h1(a),d=function(a,c){a=xa(a)?Fa.one(a).getOrThunk(yb("Selector did not match any elements: "+a)):r.fromDom(a);return b.getOrCreate(a,c)},e=function(a,b){xa(a)?console.error("Selector did not match a "+
b+": ",a):console.error("Element was not a "+b+": ",a);throw Error("Unable to create textbox.io editor");},f=aa.detect(),h=function(a){xa(a)||Tb(a,[ba.domElement("element")]);return xa(a)?Fa.all(a):E(a,r.fromDom)},l=function(a,c){a=h(a);a=E(a,function(a){return b.getOrCreate(a,c)});return ee(a)};return Sl.makeReadOnly({replace:function(a,b){Tb(arguments,[ba.stringOrDom("element"),Ym.object("options")]);return d(a,c.classic(b)).getOrThunk(u(e,a,"div or textarea"))},replaceAll:function(a,b){Tb(arguments,
[ba.stringOrArray("elements"),Ym.object("options")]);return l(a,c.classic(b))},inline:function(a,b){if(f.deviceType.isTouch())throw Error("Mobile does not not support inline editing");Tb(arguments,[ba.stringOrDom("element"),Ym.object("options")]);return d(a,c.inline(b)).getOrThunk(u(e,a,"supported tag for inline editing"))},inlineAll:function(a,b){if(f.deviceType.isTouch())throw Error("Mobile does not not support inline editing");Tb(arguments,[ba.stringOrArray("elements"),Ym.object("options")]);return l(a,
c.inline(b))},get:function(a){Tb(arguments,[ba.string("selector")]);return b.get(a)},getActiveEditor:function(){return b.getActiveEditor().getOr(null)},definePlugin:function(a,b){Tb(arguments,[ba.string("namespace"),ba.object("code")]);Bq.get(a).each(function(){throw Error("namespace "+a+" is already defined");});if(void 0===b.initialize||!vb(b.initialize))throw Error("plugin does not have an initialize function");return Bq.register(a,b)},version:Vx,isSupported:Jb})}var t=function(){for(var a=0;a<
arguments.length;a++);},Pb=function(a,b){return function(){for(var c=0;c<arguments.length;c++);return a(b.apply(null,arguments))}},k=function(a){return function(){return a}},ca=function(a){return a},u=function(a){for(var b=1;b<arguments.length;b++);var c=Array(arguments.length-1);for(b=1;b<arguments.length;b++)c[b-1]=arguments[b];return function(){for(var b=0;b<arguments.length;b++);b=Array(arguments.length);for(var e=0;e<b.length;e++)b[e]=arguments[e];b=c.concat(b);return a.apply(null,b)}},zf=function(a){return function(){for(var b=
0;b<arguments.length;b++);return!a.apply(null,arguments)}},yb=function(a){return function(){throw Error(a);}},xb=function(a){return a()},fd=k(!1),Jb=k(!0),bk=fd,bs=Jb,ah=function(){return cs},cs=function(){var a=function(a){return a.isNone()},b=function(a){return a()},c=function(a){return a};a={fold:function(a,b){return a()},is:bk,isSome:bk,isNone:bs,getOr:c,getOrThunk:b,getOrDie:function(a){throw Error(a||"error: getOrDie called on none.");},getOrNull:function(){return null},getOrUndefined:function(){},
or:c,orThunk:b,map:ah,ap:ah,each:function(){},bind:ah,flatten:ah,exists:bk,forall:bs,filter:ah,equals:a,equals_:a,toArray:function(){return[]},toString:k("none()")};Object.freeze&&Object.freeze(a);return a}(),Zm=function(a){var b=function(){return a},c=function(){return e},d=function(b){return b(a)},e={fold:function(b,c){return c(a)},is:function(b){return a===b},isSome:bs,isNone:bk,getOr:b,getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:c,orThunk:c,map:function(b){return Zm(b(a))},ap:function(b){return b.fold(ah,
function(b){return Zm(b(a))})},each:function(b){b(a)},bind:d,flatten:b,exists:d,forall:d,filter:function(b){return b(a)?e:cs},equals:function(b){return b.is(a)},equals_:function(b,c){return b.fold(bk,function(b){return c(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return e},g={some:Zm,none:ah,from:function(a){return null===a||void 0===a?cs:Zm(a)}},Xh=function(a){return function(b){if(null===b)b="null";else{var c=typeof b;b="object"===c&&Array.prototype.isPrototypeOf(b)?
"array":"object"===c&&String.prototype.isPrototypeOf(b)?"string":c}return b===a}},xa=Xh("string"),ic=Xh("object"),Mb=Xh("array"),$m=Xh("boolean"),vb=Xh("function"),$e=Xh("number"),FB=function(){var a=Array.prototype.indexOf,b=function(b,c){return a.call(b,c)},c=function(a,b){a:{for(var c=0,d=a.length;c<d;++c)if(a[c]===b){a=c;break a}a=-1}return a};return void 0===a?c:b}(),Gc=function(a,b){a=FB(a,b);return-1===a?g.none():g.some(a)},U=function(a,b){return-1<FB(a,b)},Xa=function(a,b){return Va(a,b).isSome()},
m1=function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));return c},n1=function(a,b){for(var c=[],d=0;d<a.length;d+=b){var e=a.slice(d,d+b);c.push(e)}return c},E=function(a,b){for(var c=a.length,d=Array(c),e=0;e<c;e++)d[e]=b(a[e],e,a);return d},z=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c,a)},o1=function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c,a)},p1=function(a,b){for(var c=[],d=[],e=0,f=a.length;e<f;e++){var h=a[e];(b(h,e,a)?c:d).push(h)}return{pass:c,fail:d}},ka=function(a,b){for(var c=
[],d=0,e=a.length;d<e;d++){var f=a[d];b(f,d,a)&&c.push(f)}return c},hm=function(a,b){if(0===a.length)return[];for(var c=b(a[0]),d=[],e=[],f=0,h=a.length;f<h;f++){var l=a[f],g=b(l);g!==c&&(d.push(e),e=[]);c=g;e.push(l)}0!==e.length&&d.push(e);return d},Eb=function(a,b,c){o1(a,function(a){c=b(c,a)});return c},hb=function(a,b,c){z(a,function(a){c=b(c,a)});return c},qa=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b(e,c,a))return g.some(e)}return g.none()},Va=function(a,b){for(var c=0,d=
a.length;c<d;c++)if(b(a[c],c,a))return g.some(c);return g.none()},q1=Array.prototype.push,Qb=function(a){for(var b=[],c=0,d=a.length;c<d;++c){if(!Array.prototype.isPrototypeOf(a[c]))throw Error("Arr.flatten item "+c+" was not an array, input: "+a);q1.apply(b,a[c])}return b},ia=function(a,b){a=E(a,b);return Qb(a)},ob=function(a,b){for(var c=0,d=a.length;c<d;++c)if(!0!==b(a[c],c,a))return!1;return!0},GB=Array.prototype.slice,kd=function(a){a=GB.call(a,0);a.reverse();return a},Iq=function(a,b){return ka(a,
function(a){return!U(b,a)})},xT=function(a,b){for(var c={},d=0,e=a.length;d<e;d++){var f=a[d];c[String(f)]=b(f,d)}return c},HB=function(a){return[a]},ds=vb(Array.from)?Array.from:function(a){return GB.call(a)},Xf="undefined"!==typeof window?window:Function("return this;")(),bh=function(a,b){a=a.split(".");b=void 0!==b&&null!==b?b:Xf;for(var c=0;c<a.length&&void 0!==b&&null!==b;++c)b=b[a[c]];return b},es=function(a,b){a=a.split(".");var c=void 0!==b?b:Xf;for(b=0;b<a.length;++b){var d=a[b];if(void 0===
c[d]||null===c[d])c[d]={};c=c[d]}return c},Kc={getOrDie:function(a,b){b=bh(a,b);if(void 0===b||null===b)throw a+" not available on this browser";return b}},ck={isPrototypeOf:function(a){var b=bh("ownerDocument.defaultView",a);return Kc.getOrDie("HTMLElement",b).prototype.isPrototypeOf(a)}},dk=function(a,b,c,d,e,f){return{name:k(a),output:k(f||a),required:k(d),validate:function(d){if(!c(d))throw d=e(a,b),Error(d);}}},ek=function(a,b){return'value of "'+a+'" is not a '+b},ch=function(a,b){return'value of "'+
a+'" is not an '+b},Af=function(a,b,c){return function(d,e){return dk(d,a,b,!0,c,e)}},IB=function(a){return ck.isPrototypeOf(a)},r1=function(a){return xa(a)||Mb(a)||ic(a)},fs=Af("array",Mb,ch),s1=Af("boolean",$m,ek),t1=Af("function",vb,ek),u1=Af("number",$e,ek),v1=Af("object",ic,ch),w1=Af("string",xa,ek),x1=Af("DOM element",IB,ek),y1=Af("string or an array",function(a){return xa(a)||Mb(a)},ch),z1=Af("string or a DOM element",function(a){return xa(a)||IB(a)},ch),ba={arrayOfStrings:function(a){return dk(a,
"array of strings",function(b){fs(a,void 0).validate(b);return ob(b,xa)},!0,ch,void 0)},arrayOfObjects:function(a){return dk(a,"array of objects",function(b){fs(a,void 0).validate(b);return ob(b,ic)},!0,ch,void 0)},arrayOfToolbarGroups:function(a){return dk(a,"array of toolbar groups",function(b){fs(a,void 0).validate(b);return ob(b,r1)},!0,ch,void 0)},bool:s1,domElement:x1,func:t1,number:u1,object:v1,string:w1,stringOrArray:y1,stringOrDom:z1,param:dk},DB={paramList:function(){return[ba.object("aria"),
ba.func("fetch"),ba.func("menuComplete"),ba.func("menuExtra"),ba.func("menuHover"),ba.string("hoverSelector"),ba.func("hover")]},encodeWithEditorApi:function(){return["menuComplete"]}},A1=Object.prototype.hasOwnProperty,JB=function(a){return function(){for(var b=Array(arguments.length),c=0;c<b.length;c++)b[c]=arguments[c];if(0===b.length)throw Error("Can't merge zero objects");c={};for(var d=0;d<b.length;d++){var e=b[d],f;for(f in e)A1.call(e,f)&&(c[f]=a(c[f],e[f]))}return c}},oa=JB(function(a,b){return ic(a)&&
ic(b)?oa(a,b):b}),ua=JB(function(a,b){return b}),cb=Object.keys,Ma=function(a,b){for(var c=cb(a),d=0,e=c.length;d<e;d++){var f=c[d];b(a[f],f,a)}},eb=function(a,b){return B1(a,function(a,d,e){return{k:d,v:b(a,d,e)}})},B1=function(a,b){var c={};Ma(a,function(d,e){d=b(d,e,a);c[d.k]=d.v});return c},C1=function(a,b){var c={},d={};Ma(a,function(a,f){(b(a,f)?c:d)[f]=a});return{t:c,f:d}},Nf=function(a,b){var c=[];Ma(a,function(a,e){c.push(b(a,e))});return c},T0=function(a,b){for(var c=cb(a),d=0,e=c.length;d<
e;d++){var f=c[d],h=a[f];if(b(h,f,a))return g.some(h)}return g.none()},Ze=function(a){return Nf(a,function(a){return a})},gs=function(a,b,c){return E(a,function(a){return b(a,c)})},hs=function(a,b){if(xa(a))return a;if(Mb(a))return gs(a,hs,b);if(ic(a)&&void 0!==a.action)return b=Pb(a.action,b),ua(a,{action:b});b=gs(a.items,hs,b);return oa(a,{items:b})},Wx={mentions:function(a,b){var c=DB.encodeWithEditorApi();return eb(a,function(a,e){return U(c,e)?function(c){return a(b(),c)}:a})},toolbar:function(a,
b){return void 0===a.items?a:{items:gs(a.items,hs,b)}}},an=function(a){return{is:function(b){return a===b},isValue:Jb,isError:fd,getOr:k(a),getOrThunk:k(a),getOrDie:k(a),or:function(b){return an(a)},orThunk:function(b){return an(a)},fold:function(b,c){return c(a)},map:function(b){return an(b(a))},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return g.some(a)}}},is=function(a){return{is:fd,isValue:fd,isError:Jb,
getOr:ca,getOrThunk:function(a){return a()},getOrDie:function(){return yb(String(a))()},or:function(a){return a},orThunk:function(a){return a()},fold:function(b,c){return b(a)},map:function(b){return is(a)},each:t,bind:function(b){return is(a)},exists:fd,forall:Jb,toOption:g.none}},J={value:an,error:is},hT=function(){var a=(new Date).getTime();return String(a).slice(-6)},bn=window.Node,D1=window.URL,E1=window.Window,Hb=window.document,j_=window.navigator,Zg=window.window,Vh=window.clearInterval,sr=
window.clearTimeout,Or=window.setInterval,Kf=window.setTimeout,ld=window.console,fk=function(a){if(null===a||void 0===a)throw Error("Node cannot be null or undefined");return{dom:k(a)}},r={fromHtml:function(a,b){b=(b||Hb).createElement("div");b.innerHTML=a;if(!b.hasChildNodes()||1<b.childNodes.length)throw ld.error("HTML does not have a single root node",a),"HTML must have a single root node";return fk(b.childNodes[0])},fromTag:function(a,b){a=(b||Hb).createElement(a);return fk(a)},fromText:function(a,
b){a=(b||Hb).createTextNode(a);return fk(a)},fromDom:fk,fromPoint:function(a,b,c){a=a.dom();return g.from(a.elementFromPoint(b,c)).map(fk)}},KB=bn.COMMENT_NODE,js=bn.DOCUMENT_NODE,gk=bn.ELEMENT_NODE,LB=bn.TEXT_NODE,Fa={all:function(a,b){b=void 0===b?Hb:b.dom();return b.nodeType!==gk&&b.nodeType!==js||0===b.childElementCount?[]:E(b.querySelectorAll(a),r.fromDom)},is:function(a,b){a=a.dom();if(a.nodeType!==gk)return!1;if(void 0!==a.matches)return a.matches(b);if(void 0!==a.msMatchesSelector)return a.msMatchesSelector(b);
if(void 0!==a.webkitMatchesSelector)return a.webkitMatchesSelector(b);if(void 0!==a.mozMatchesSelector)return a.mozMatchesSelector(b);throw Error("Browser lacks native selectors");},one:function(a,b){b=void 0===b?Hb:b.dom();return b.nodeType!==gk&&b.nodeType!==js||0===b.childElementCount?g.none():g.from(b.querySelector(a)).map(r.fromDom)}},MB=function(a){return a.dom().nodeName.toLowerCase()},ks=function(a){return a.dom().nodeType},ls=function(a){return function(b){return ks(b)===a}},F1=ls(gk),G1=
ls(LB),H1=ls(js),D={name:MB,type:ks,value:function(a){return a.dom().nodeValue},isElement:F1,isText:G1,isDocument:H1,isComment:function(a){return ks(a)===KB||"#comment"===MB(a)}},wT={one:function(a,b,c){var d=D.name(a);return g.from(b[d]).map(function(b){return b.replace(a,c)})}},om={documentPositionPreceding:function(a,b){var c=Kc.getOrDie("Node").DOCUMENT_POSITION_PRECEDING;return 0!==(a.compareDocumentPosition(b)&c)},documentPositionContainedBy:function(a,b){var c=Kc.getOrDie("Node").DOCUMENT_POSITION_CONTAINED_BY;
return 0!==(a.compareDocumentPosition(b)&c)}},gc=function(a){var b=!1,c;return function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];b||(b=!0,c=a.apply(null,d));return c}},NB=function(){return ms(0,0)},ms=function(a,b){return{major:a,minor:b}},cn={nu:ms,detect:function(a,b){b=String(b).toLowerCase();if(0===a.length)a=NB();else{a:{for(var c=0;c<a.length;c++){var d=a[c];if(d.test(b)){a=d;break a}}a=void 0}a=a?ms(Number(b.replace(a,"$1")),Number(b.replace(a,"$2"))):{major:0,minor:0}}return a},
unknown:NB},Yh=function(a,b){return function(){return b===a}},OB=function(a){var b=a.current;return{current:b,version:a.version,isEdge:Yh("Edge",b),isChrome:Yh("Chrome",b),isIE:Yh("IE",b),isOpera:Yh("Opera",b),isFirefox:Yh("Firefox",b),isSafari:Yh("Safari",b)}},I1=function(){return OB({current:void 0,version:cn.unknown()})};k("Edge");k("Chrome");k("IE");k("Opera");k("Firefox");k("Safari");var dh=function(a,b){return function(){return b===a}},PB=function(a){var b=a.current;return{current:b,version:a.version,
isWindows:dh("Windows",b),isiOS:dh("iOS",b),isAndroid:dh("Android",b),isOSX:dh("OSX",b),isLinux:dh("Linux",b),isSolaris:dh("Solaris",b),isFreeBSD:dh("FreeBSD",b)}},J1=function(){return PB({current:void 0,version:cn.unknown()})};k("Windows");k("iOS");k("Android");k("Linux");k("OSX");k("Solaris");k("FreeBSD");var QB=function(a,b){var c=String(b).toLowerCase();return qa(a,function(a){return a.search(c)})},RB={detectBrowser:function(a,b){return QB(a,b).map(function(a){var c=cn.detect(a.versionRegexes,
b);return{current:a.name,version:c}})},detectOs:function(a,b){return QB(a,b).map(function(a){var c=cn.detect(a.versionRegexes,b);return{current:a.name,version:c}})}},K1=function(a){return""===a?g.none():g.some(a.substr(0,1))},L1=function(a){return""===a?g.none():g.some(a.substring(1))},SB=function(a,b,c){return""===b?!0:a.length<b.length?!1:a.substr(c,c+b.length)===b},xB=function(a,b){return a.replace(/\$\{([^{}]*)\}/g,function(a,d){d=b[d];var c=typeof d;return"string"===c||"number"===c?d.toString():
a})},hk=function(a,b){return Gb(a,b)?a.substring(b.length):a},ik=function(a,b){return je(a,b)?a.substring(0,a.length-b.length):a},Bb=function(a,b){return-1!==a.indexOf(b)},ns=function(a){return K1(a).bind(function(b){return L1(a).map(function(a){return b.toUpperCase()+a})}).getOr(a)},Gb=function(a,b){return SB(a,b,0)},je=function(a,b){return SB(a,b,a.length-b.length)},Zh=function(a){return a.replace(/^\s+|\s+$/g,"")},os=/.*?version\/ ?([0-9]+)\.([0-9]+).*/,eg=function(a){return function(b){return Bb(b,
a)}},M1=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return Bb(a,"edge/")&&Bb(a,"chrome")&&Bb(a,"safari")&&Bb(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,os],search:function(a){return Bb(a,"chrome")&&!Bb(a,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return Bb(a,"msie")||Bb(a,"trident")}},{name:"Opera",versionRegexes:[os,/.*?opera\/([0-9]+)\.([0-9]+).*/],
search:eg("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/ ?([0-9]+)\.([0-9]+).*/],search:eg("firefox")},{name:"Safari",versionRegexes:[os,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(Bb(a,"safari")||Bb(a,"mobile/"))&&Bb(a,"applewebkit")}}],N1=[{name:"Windows",search:eg("win"),versionRegexes:[/.*?windows nt ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return Bb(a,"iphone")||Bb(a,"ipad")},versionRegexes:[/.*?version\/ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,
/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:eg("android"),versionRegexes:[/.*?android ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:eg("os x"),versionRegexes:[/.*?os x ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:eg("linux"),versionRegexes:[]},{name:"Solaris",search:eg("sunos"),versionRegexes:[]},{name:"FreeBSD",search:eg("freebsd"),versionRegexes:[]}],TB={browsers:k(M1),oses:k(N1)},O1={detect:function(a){var b=TB.browsers(),c=TB.oses();b=RB.detectBrowser(b,a).fold(I1,OB);c=RB.detectOs(c,
a).fold(J1,PB);var d=c.isiOS()&&!0===/ipad/i.test(a),e=c.isiOS()&&!d,f=c.isAndroid()&&3===c.version.major,h=c.isAndroid()&&4===c.version.major;f=d||f||h&&!0===/mobile/i.test(a);var l=(h=c.isiOS()||c.isAndroid())&&!f;a=b.isSafari()&&c.isiOS()&&!1===/safari/i.test(a);a={isiPad:k(d),isiPhone:k(e),isTablet:k(f),isPhone:k(l),isTouch:k(h),isAndroid:c.isAndroid,isiOS:c.isiOS,isWebView:k(a)};return{browser:b,os:c,deviceType:a}}},aa={detect:gc(function(){return O1.detect(navigator.userAgent)})},UB=function(a,
b){return a.dom()===b.dom()},P1=function(a,b){a=a.dom();b=b.dom();return a===b?!1:a.contains(b)},Q1=function(a,b){return om.documentPositionContainedBy(a.dom(),b.dom())},R1=aa.detect().browser.isIE()?Q1:P1,N={eq:UB,isEqualNode:function(a,b){return a.dom().isEqualNode(b.dom())},member:function(a,b){return Xa(b,u(UB,a))},contains:R1,is:Fa.is},VB=function(a){a=a.dom().body;if(null===a||void 0===a)throw"Body is not available yet";return r.fromDom(a)},ja={body:gc(function(){return VB(r.fromDom(Hb))}),
getBody:VB,inBody:function(a){a=D.isText(a)?a.dom().parentNode:a.dom();return void 0!==a&&null!==a&&a.ownerDocument.body.contains(a)}},WB=function(a,b,c){a=a.dom();for(c=vb(c)?c:k(!1);a.parentNode;){a=a.parentNode;var d=r.fromDom(a);if(b(d))return g.some(d);if(c(d))break}return g.none()},XB=function(a,b){return qa(a.dom().childNodes,Pb(b,r.fromDom)).map(r.fromDom)},YB=function(a,b){var c=function(a){for(var d=0;d<a.childNodes.length;d++){if(b(r.fromDom(a.childNodes[d])))return g.some(r.fromDom(a.childNodes[d]));
var f=c(a.childNodes[d]);if(f.isSome())return f}return g.none()};return c(a.dom())},Ja={first:function(a){return YB(ja.body(),a)},ancestor:WB,closest:function(a,b,c){return Xx(function(a){return b(a)},WB,a,b,c)},sibling:function(a,b){var c=a.dom();return c.parentNode?XB(r.fromDom(c.parentNode),function(c){return!N.eq(a,c)&&b(c)}):g.none()},child:XB,descendant:YB},wd={any:function(a){return Ja.first(a).isSome()},ancestor:function(a,b,c){return Ja.ancestor(a,b,c).isSome()},closest:function(a,b,c){return Ja.closest(a,
b,c).isSome()},sibling:function(a,b){return Ja.sibling(a,b).isSome()},child:function(a,b){return Ja.child(a,b).isSome()},descendant:function(a,b){return Ja.descendant(a,b).isSome()}},O=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];if(a.length!==b.length)throw Error('Wrong number of arguments to struct. Expected "['+a.length+']", got '+b.length+" arguments");var e={};z(a,function(a,c){e[a]=k(b[c])});
return e}},ZB=function(a,b){throw Error("All required keys ("+a.slice(0).sort().join(", ")+") were not specified. Specified keys were: "+b.slice(0).sort().join(", ")+".");},$B=function(a){throw Error("Unsupported keys for object: "+a.slice(0).sort().join(", "));},ps=function(a,b){if(!Mb(b))throw Error("The "+a+" fields must be an array. Was: "+b+".");z(b,function(b){if(!xa(b))throw Error("The value "+b+" in the "+a+" fields was not a string.");})},aC=function(a){var b=a.slice(0).sort();qa(b,function(a,
d){return d<b.length-1&&a===b[d+1]}).each(function(a){throw Error("The field: "+a+" occurs more than once in the combined fields: ["+b.join(", ")+"].");})},Aa=function(a,b){var c=a.concat(b);if(0===c.length)throw Error("You must specify at least one required or optional field.");ps("required",a);ps("optional",b);aC(c);return function(d){var e=cb(d);ob(a,function(a){return U(e,a)})||ZB(a,e);var f=ka(e,function(a){return!U(c,a)});0<f.length&&$B(f);var h={};z(a,function(a){h[a]=k(d[a])});z(b,function(a){h[a]=
k(Object.prototype.hasOwnProperty.call(d,a)?g.some(d[a]):g.none())});return h}},bC={toArray:function(a,b){var c=[],d=function(a){c.push(a);return b(a)};a=b(a);do a=a.bind(d);while(a.isSome());return c}},qs=function(a){a=a.dom();return g.from(a.parentNode).map(r.fromDom)},cC=function(a){a=a.dom();return g.from(a.previousSibling).map(r.fromDom)},dC=function(a){a=a.dom();return g.from(a.nextSibling).map(r.fromDom)},dn=function(a){a=a.dom();return E(a.childNodes,r.fromDom)},rs=function(a,b){a=a.dom().childNodes;
return g.from(a[b]).map(r.fromDom)},eC=O("element","offset"),A={owner:function(a){return r.fromDom(a.dom().ownerDocument)},defaultView:function(a){a=a.dom().ownerDocument.defaultView;return r.fromDom(a)},documentElement:function(a){return r.fromDom(a.dom().ownerDocument.documentElement)},parent:qs,findIndex:function(a){return qs(a).bind(function(b){b=dn(b);return Va(b,function(b){return N.eq(a,b)})})},parents:function(a,b){b=vb(b)?b:k(!1);var c=a.dom();for(a=[];null!==c.parentNode&&void 0!==c.parentNode;){c=
c.parentNode;var d=r.fromDom(c);a.push(d);if(!0===b(d))break}return a},siblings:function(a){return qs(a).map(dn).map(function(b){return ka(b,function(b){return!N.eq(a,b)})}).getOr([])},prevSibling:cC,offsetParent:function(a){a=a.dom();return g.from(a.offsetParent).map(r.fromDom)},prevSiblings:function(a){return kd(bC.toArray(a,cC))},nextSibling:dC,nextSiblings:function(a){return bC.toArray(a,dC)},children:dn,child:rs,firstChild:function(a){return rs(a,0)},lastChild:function(a){return rs(a,a.dom().childNodes.length-
1)},childNodesCount:function(a){return a.dom().childNodes.length},hasChildNodes:function(a){return a.dom().hasChildNodes()},leaf:function(a,b){var c=dn(a);return 0<c.length&&b<c.length?eC(c[b],0):eC(a,b)}},fC=function(a){a.dom().focus()},ss=function(a){a=void 0!==a?a.dom():Hb;return g.from(a.activeElement).map(r.fromDom)},Z={hasFocus:function(a){var b=A.owner(a).dom();return a.dom()===b.activeElement},focus:fC,blur:function(a){a.dom().blur()},active:ss,search:function(a){return ss(A.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},
focusInside:function(a){var b=A.owner(a);ss(b).filter(function(b){return wd.closest(b,u(N.eq,a))}).fold(function(){fC(a)},t)}},en=function(a,b){A.parent(a).each(function(c){c.dom().insertBefore(b.dom(),a.dom())})},jk=function(a,b){a.dom().appendChild(b.dom())},y={before:en,after:function(a,b){A.nextSibling(a).fold(function(){A.parent(a).each(function(a){jk(a,b)})},function(a){en(a,b)})},prepend:function(a,b){A.firstChild(a).fold(function(){jk(a,b)},function(c){a.dom().insertBefore(b.dom(),c.dom())})},
append:jk,appendAt:function(a,b,c){A.child(a,c).fold(function(){jk(a,b)},function(a){en(a,b)})},wrap:function(a,b){en(a,b);jk(b,a)}},P={before:function(a,b){z(b,function(b){y.before(a,b)})},after:function(a,b){z(b,function(c,d){y.after(0===d?a:b[d-1],c)})},prepend:function(a,b){z(b.slice().reverse(),function(b){y.prepend(a,b)})},append:function(a,b){z(b,function(b){y.append(a,b)})}},ts=function(a){a=a.dom();null!==a.parentNode&&a.parentNode.removeChild(a)},G={empty:function(a){a.dom().textContent=
"";z(A.children(a),function(a){ts(a)})},remove:ts,unwrap:function(a){var b=A.children(a);0<b.length&&P.before(a,b);ts(a)}},gC=function(a,b,c){if(xa(c)||$m(c)||$e(c))a.setAttribute(b,c+"");else throw ld.error("Invalid call to Attr.set. Key ",b,":: Value ",c,":: Element ",a),Error("Attribute value was not simple");},hC=function(a,b,c){gC(a.dom(),b,c)},iC=function(a,b){a=a.dom().getAttribute(b);return null===a?void 0:a},us=function(a,b){return(a=a.dom())&&a.hasAttribute?a.hasAttribute(b):!1},m={clone:function(a){return hb(a.dom().attributes,
function(a,c){a[c.name]=c.value;return a},{})},set:hC,setAll:function(a,b){var c=a.dom();Ma(b,function(a,b){gC(c,b,a)})},get:iC,has:us,remove:function(a,b){a.dom().removeAttribute(b)},hasNone:function(a){a=a.dom().attributes;return void 0===a||null===a||0===a.length},transfer:function(a,b,c){D.isElement(a)&&D.isElement(b)&&z(c,function(c){us(a,c)&&!us(b,c)&&hC(b,c,iC(a,c))})}},af={isSupported:function(a){return void 0!==a.style}},vs=function(a,b,c){if(!xa(c))throw ld.error("Invalid call to CSS.set. Property ",
b,":: Value ",c,":: Element ",a),Error("CSS value must be a string: "+c);af.isSupported(a)&&a.style.setProperty(b,c)},ws=function(a,b,c){a=a.dom();vs(a,b,c)},jC=function(a,b){return af.isSupported(a)?a.style.getPropertyValue(b):""},fn=function(a,b){a=a.dom();b=jC(a,b);return g.from(b).filter(function(a){return 0<a.length})},S1=function(a,b,c){fn(a,c).each(function(a){fn(b,c).isNone()&&ws(b,c,a)})},v={copy:function(a,b){a=a.dom();b=b.dom();af.isSupported(a)&&af.isSupported(b)&&(b.style.cssText=a.style.cssText)},
set:ws,preserve:function(a,b){var c=m.get(a,"style");b=b(a);(void 0===c?m.remove:m.set)(a,"style",c);return b},setAll:function(a,b){var c=a.dom();Ma(b,function(a,b){vs(c,b,a)})},setOptions:function(a,b){var c=a.dom();Ma(b,function(a,b){a.fold(function(){af.isSupported(c)&&c.style.removeProperty(b)},function(a){vs(c,b,a)})})},remove:function(a,b){var c=a.dom();af.isSupported(c)&&c.style.removeProperty(b);m.has(a,"style")&&""===Zh(m.get(a,"style"))&&m.remove(a,"style")},get:function(a,b){var c=a.dom(),
d=Zg.getComputedStyle(c).getPropertyValue(b);a=""!==d||ja.inBody(a)?d:jC(c,b);return null===a?void 0:a},getRaw:fn,getAllRaw:function(a){var b={};a=a.dom();if(af.isSupported(a))for(var c=0;c<a.style.length;c++){var d=a.style.item(c);b[d]=a.style[d]}return b},isValidValue:function(a,b,c){a=r.fromTag(a);ws(a,b,c);return fn(a,b).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(a,b,c){D.isElement(a)&&D.isElement(b)&&z(c,function(c){S1(a,b,c)})}},uT={blur:function(){var a=r.fromHtml('<input type="text" />');
v.setAll(a,{"z-index":"-666",background:"transparent",border:"0px",height:"50px",position:"absolute",top:"25%",left:"50%"});y.append(r.fromDom(Hb.body),a);Z.focus(a);G.remove(a)}},T1=function(a){return[eb(a,function(a){return a()})]},kT={create:function(){var a=[];return{eventRegistry:{addListener:function(b){Tb(arguments,[ba.func("handler")]);a.push(b)},removeListener:function(b){Gc(a,b).each(function(b){a.splice(b,1)})}},eventTrigger:function(b){z(a,function(a){var c=T1(b);a.apply(null,c)})}}}},
Ql={create:function(){var a=[],b=[];return{bind:function(c,d){if(U(a,c))throw"Invalid key, key already exists.";a.push(c);b.push(d);c.bind(d)},unbind:function(c){Gc(a,c).fold(function(){throw"Invalid key, does not exist.";},function(d){a.splice(d,1);d=b.splice(d,1)[0];c.unbind(d)})},unbindAll:function(){z(a,function(a,d){a.unbind(b[d])});a.splice(0,a.length);b.splice(0,b.length)}}}},kC=function(a){Object.freeze(a);Ma(a,function(a){ic(a)&&kC(a)});return a},Sl={makeReadOnly:kC},xs=function(a){var b=
g.none(),c=[],d=function(a){e()?f(a):c.push(a)},e=function(){return b.isSome()},f=function(a){b.each(function(b){setTimeout(function(){a(b)},0)})};a(function(a){b=g.some(a);z(c,f);c=[]});return{get:d,map:function(a){return xs(function(b){d(function(c){b(a(c))})})},isReady:e}},lf={nu:xs,pure:function(a){return xs(function(b){b(a)})}},U1=function(a){return function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var d=this;setTimeout(function(){a.apply(d,b)},0)}},kk=function(a){var b=function(b){a(U1(b))};
return{map:function(a){return kk(function(c){b(function(b){b=a(b);c(b)})})},bind:function(a){return kk(function(c){b(function(b){a(b).get(c)})})},anonBind:function(a){return kk(function(c){b(function(b){a.get(c)})})},toLazy:function(){return lf.nu(b)},get:b}},Ga={nu:kk,pure:function(a){return kk(function(b){b(a)})}},Rl=function(a,b){return b(function(b){var c=[],e=0,f=function(d){return function(f){c[d]=f;e++;e>=a.length&&b(c)}};0===a.length?b([]):z(a,function(a,b){a.get(f(b))})})},Ce=function(a,
b){a=E(a,b);return Rl(a,Ga.nu)},lC={install:function(a){var b=u(es,a);es("callbacks",b());var c=function(a){var b=void 0===a.count?0:a.count;a.count=b+1;return"callback_"+b},d=function(d,h){var f=b(),g=c(f);f.callbacks[g]=function(){h||e(g);d.apply(null,arguments)};return a+".callbacks."+g},e=function(a){a=a.substring(a.lastIndexOf(".")+1);var c=b();void 0!==c.callbacks[a]&&delete c.callbacks[a]};return{ephemeral:function(a){return d(a,!1)},permanent:function(a){return d(a,!0)},unregister:e}}},V1=
function(a,b,c,d,e,f,h){return{target:k(a),x:k(b),y:k(c),stop:d,prevent:e,kill:f,raw:k(h)}},W1=function(a,b){return function(c){if(a(c)){var d=r.fromDom(c.target),e=function(){c.stopPropagation()},f=function(){c.preventDefault()},h=Pb(f,e);d=V1(d,c.clientX,c.clientY,e,f,h,c);b(d)}}},mC=function(a,b,c,d,e){c=W1(c,d);a.dom().addEventListener(b,c,e);return{unbind:u(X1,a,b,c,e)}},X1=function(a,b,c,d){a.dom().removeEventListener(b,c,d)},ys={bind:function(a,b,c,d){return mC(a,b,c,d,!1)},capture:function(a,
b,c,d){return mC(a,b,c,d,!0)}},nC=k(!0),K={bind:function(a,b,c){return ys.bind(a,b,nC,c)},capture:function(a,b,c){return ys.capture(a,b,nC,c)}},Y1=lC.install("ephox.henchman.features"),nT={download:function(a){return lf.nu(function(b){var c=function(){e.unbind();f.unbind()},d=r.fromTag("script");m.set(d,"src",a);m.set(d,"type","text/javascript");m.set(d,"async","async");m.set(d,"data-main",Y1.ephemeral(function(a){b(J.value(a))}));var e=K.bind(d,"error",function(){c();b(J.error("Error loading external script tag "+
a))}),f=K.bind(d,"load",c);y.append(r.fromDom(document.head),d)})}},oC={addStylesheet:function(a,b){var c=b||r.fromDom(Hb);b=r.fromTag("link",c.dom());m.setAll(b,{rel:"stylesheet",type:"text/css",href:a});a=r.fromDom(c.dom().head);y.append(a,b);return b}},mT={download:function(a,b){return lf.nu(function(c){var d=function(b){z(f,function(a){a.unbind()});c(b.fold(function(b){return J.error(b+'Unable to download editor stylesheets from "'+a+'"')},J.value))},e=oC.addStylesheet(a),f=[K.bind(e,"load",function(a){a:{try{var c=
a.target().dom().sheet.cssRules;var e=ic(c)&&0===c.length;break a}catch(C){}e=!1}e?d(J.error("")):b(d)}),K.bind(e,"error",u(d,J.error("")))]})}},pC=Yx(),gn={addStylesheet:function(a,b){return pC.addStylesheet(a,b)},addScript:function(a,b){return pC.addScript(a,b)}},hn=O("str","replace"),qC=function(a,b){return"2.4.2"!==a?g.some(b+(void 0===a?"":" version "+a)+" appears to be cached, as it does not match editor version 2.4.2."):g.none()},Wf={aboutTags:function(a,b){var c=[hn("@@FULL_VERSION@@","2.4.2.99"),
hn("@@CLIENT_VERSION@@","2.4.2.143")];a=a?[hn("@@INTEGRATION_TYPE@@",b.type),hn("@@INTEGRATION_VERSION@@",b.version)]:[];return Qb([c,a])},strictMatch:qC,weakMatch:function(a,b){return qC(a,b).map(function(a){return a+" This may produce unexpected results."})},resourceParam:k("version=2.4.2"),fullParam:k("version=2.4.2.99")},na=function(a){var b=a;return{get:function(){return b},set:function(a){b=a},clone:function(){return na(b)}}},Z1=function(a){a.each(function(a){Wf.weakMatch(a.version,"Code view").each(function(a){console.warn(a)});
rC.set(a.codemirror());sC.set(a.jsbeautify())});return a},rC=na(null),sC=na(null),Tl={use:{codemirror:rC.get,jsbeautify:sC.get},load:{codeview:function(a){a=a+"/codeview.js?"+Wf.resourceParam();return gn.addScript(a,Z1)}}},hy={beautify:function(a){return Tl.use.jsbeautify().html(a,{indent_size:"2",indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,
jslint_happy:!1,end_with_newline:!1,wrap_line_length:0,indent_inner_html:!1,comma_first:!1,e4x:!1})}},$1=function(a){return a.map(function(a){return a.dom()}).getOr(null)},Fd={documentElement:function(a){if(a.content().isInline())throw Error("documentElement called on inline mode");return $1(a.content().doc())},insertHtmlAtCursor:function(a,b){Tb(arguments,[ba.object("polish"),ba.string("html")]);a.content().focus();a.insertHtmlAtCursor(b)},uploadImages:function(a,b){Tb(arguments,[ba.object("polish"),
ba.func("callback")]);return a.uploadImages(b)},get:function(a){var b=null!==Tl.use.jsbeautify()&&a.isPrettyPrinting();a=a.getContent();return b?hy.beautify(a):a},set:function(a,b){Tb(arguments,[ba.object("polish"),ba.string("html")]);a.setContent(b)},isDirty:function(a){Tb(arguments,[ba.object("polish")]);return a.isDirty()},setDirty:function(a,b){Tb(arguments,[ba.object("polish"),ba.bool("state")]);a.setDirty(b)}},ta={generate:function(a){if(!Mb(a))throw Error("cases must be an array");if(0===a.length)throw Error("there must be at least one case");
var b=[],c={};z(a,function(d,e){var f=cb(d);if(1!==f.length)throw Error("one and only one name per case");var h=f[0],l=d[h];if(void 0!==c[h])throw Error("duplicate key detected:"+h);if("cata"===h)throw Error("cannot have a case named cata (sorry)");if(!Mb(l))throw Error("case arguments must be an array");b.push(h);c[h]=function(){var c=arguments.length;if(c!==l.length)throw Error("Wrong number of arguments to case "+h+". Expected "+l.length+" ("+l+"), got "+c);var d=Array(c);for(c=0;c<d.length;c++)d[c]=
arguments[c];return{fold:function(){if(arguments.length!==a.length)throw Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[e].apply(null,d)},match:function(a){var c=cb(a);if(b.length!==c.length)throw Error("Wrong number of arguments to match. Expected: "+b.join(",")+"\nActual: "+c.join(","));if(!ob(b,function(a){return U(c,a)}))throw Error("Not all branches were specified when using match. Specified: "+c.join(", ")+"\nRequired: "+b.join(", "));
return a[h].apply(null,d)},log:function(a){console.log(a,{constructors:b,constructor:h,params:d})}}}});return c}},a2=ta.generate([{inputSelector:["selector","callback"]},{outputSelector:["selector","callback"]},{inputPredicate:["predicate","callback"]},{outputPredicate:["predicate","callback"]}]),ij=ua(a2,{cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}}),Zx=function(a){return function(b){b=E(b,function(a){return a.dom()});a(b)}},pT=function(a){return function(b){return a(b.dom())}},mb=function(){return"\ufeff"},
zs="\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF"+mb()+"\\u2018\\u2019",b2="[^"+zs+"]",c2="["+zs+"]",lk={chars:k(zs),wordbreak:k(b2),wordchar:k(c2)},jn={token:function(a){return zq(a,k(0),k(0),g.none())},word:function(a){a="((?:^'?)|(?:"+lk.wordbreak()+"+'?))"+a+"((?:'?$)|(?:'?"+lk.wordbreak()+"+))";return zq(a,function(a){return 1<a.length?a[1].length:0},function(a){return 2<a.length?a[2].length:0},g.none())}},As=function(a){return a.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},Bs={sanitise:As,word:function(a){a=
As(a);return jn.word(a)},token:function(a){a=As(a);return jn.token(a)}},Cb={safeword:function(a){return Bs.word(a)},safetoken:function(a){return Bs.token(a)},custom:function(a,b,c,d){return zq(a,b,c,d)},unsafeword:function(a){return jn.word(a)},unsafetoken:function(a){return jn.token(a)},sanitise:function(a){return Bs.sanitise(a)},chars:function(){return lk.chars()},wordbreak:function(){return lk.wordbreak()},wordchar:function(){return lk.wordchar()}},eh=function(a,b){return tC(a,b,{validate:vb,label:"function"})},
tC=function(a,b,c){if(0===b.length)throw Error("You must specify at least one required field.");ps("required",b);aC(b);return function(d){var e=cb(d);ob(b,function(a){return U(e,a)})||ZB(b,e);a(b,e);var f=ka(b,function(a){return!c.validate(d[a],a)});if(0<f.length)throw Error("All values need to be of type: "+c.label+". Keys ("+f.slice(0).sort().join(", ")+") were not.");return d}},d2=function(a,b){b=ka(b,function(b){return!U(a,b)});0<b.length&&$B(b)},fh=t,xd=function(a){return eh(d2,a)},kn=function(a,
b){return tC(fh,a,b)},e2=eh(fh,["elements","cursor","dictation","notify"]),f2=eh(fh,["elements","cursor","dictation","range","notify"]),Zd={species:e2,applicator:f2},qe={fromHtml:function(a,b){b=(b||Hb).createElement("div");b.innerHTML=a;return A.children(r.fromDom(b))},fromTags:function(a,b){return E(a,function(a){return r.fromTag(a,b)})},fromText:function(a,b){return E(a,function(a){return r.fromText(a,b)})},fromDom:function(a){return E(a,r.fromDom)}},cy={addSimpleMacro:function(a,b,c,d){Tb(arguments,
[ba.object("polish"),ba.string("startString"),ba.string("endString"),ba.func("callback")]);var e=$x(b,c,d);return a.macros().customMacros().add(e)},removeMacro:function(a,b){a.macros().customMacros().remove(b)}},uC=["error","info","warning"],tT={message:function(a,b,c,d){if(!U(uC,b))throw'Message level: "'+b+'" is not supported. Supported levels are: ['+uC.join(", ")+"].";Tb(arguments,[ba.object("polish"),ba.string("level"),ba.number("timeout"),ba.string("msg")]);var e=a.ui().showMessage(b,c,d);return{hide:function(){e()}}}},
g2=k("pencil"),h2=k("code"),i2=k("spin"),j2=k("none"),hc={pencil:g2,code:h2,wait:i2,none:j2},by={get:function(a){return a.getMode()===hc.pencil()?"design":"code"},set:function(a,b){Tb(arguments,[ba.object("polish"),ba.string("mode")]);var c=b.toLowerCase();if("code"!==c&&"design"!==c)throw Error('Editor mode "'+b+'" not supported. Must be either design or code.');a.setMode("design"===c?hc.pencil():hc.code())}},rT="body p div article aside figcaption figure footer header nav section ol ul li table thead tbody tfoot caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),
Cs=function(a,b){var c=[];z(A.children(a),function(a){b(a)&&(c=c.concat([a]));c=c.concat(Cs(a,b))});return c},ed={all:function(a){return Cs(ja.body(),a)},ancestors:function(a,b,c){return ka(A.parents(a,c),b)},siblings:function(a,b){return ka(A.siblings(a),b)},children:function(a,b){return ka(A.children(a),b)},descendants:Cs},Y={all:function(a){return Fa.all(a)},ancestors:function(a,b,c){return ed.ancestors(a,function(a){return Fa.is(a,b)},c)},siblings:function(a,b){return ed.siblings(a,function(a){return Fa.is(a,
b)})},children:function(a,b){return ed.children(a,function(a){return Fa.is(a,b)})},descendants:function(a,b){return Fa.all(b,a)}},vC=function(a,b,c){return Ja.ancestor(a,function(a){return Fa.is(a,b)},c)},L={first:function(a){return Fa.one(a)},ancestor:vC,sibling:function(a,b){return Ja.sibling(a,function(a){return Fa.is(a,b)})},child:function(a,b){return Ja.child(a,function(a){return Fa.is(a,b)})},descendant:function(a,b){return Fa.one(b,a)},closest:function(a,b,c){return Xx(Fa.is,vC,a,b,c)}},Ds=
ay(D.isText,"text"),Ya={get:function(a){return Ds.get(a)},getOption:function(a){return Ds.getOption(a)},set:function(a,b){Ds.set(a,b)}},k2=O("element","offset"),l2=O("element","deltaOffset"),m2=O("element","start","finish"),n2=O("begin","end"),o2=O("element","text"),W={point:k2,delta:l2,range:m2,points:n2,text:o2},ln=k(!1),p2=k(!0),Es=function(a){return{isBoundary:function(){return a(p2,ln,ln)},fold:a,toText:function(){return a(g.none,g.none,function(a,c){return g.some(a)})},is:function(b){return a(ln,
ln,function(a,d){return d.eq(a,b)})},len:function(){return a(k(0),k(1),function(a,c){return c.property().getText(a).length})}}},mn={text:function(a,b){return Es(function(c,d,e){return e(a,b)})},boundary:function(a,b){return Es(function(c,d,e){return c(a,b)})},empty:function(a,b){return Es(function(c,d,e){return d(a,b)})},cata:function(a,b,c,d){return a.fold(b,c,d)}},q2={boundAt:function(a,b,c,d){b=Va(a,u(d,b)).getOr(0);c=Va(a,u(d,c)).map(function(a){return a+1}).getOr(a.length);return a.slice(b,c)}},
r2={sliceby:function(a,b){b=Va(a,b).getOr(-1);return a.slice(0,b)}},Fs=ta.generate([{include:["item"]},{excludeWith:["item"]},{excludeWithout:["item"]}]),$h={include:Fs.include,excludeWith:Fs.excludeWith,excludeWithout:Fs.excludeWithout,cata:function(a,b,c,d){return a.fold(b,c,d)}},wC=function(a,b){var c=[],d=[];z(a,function(a){var e=b(a);$h.cata(e,function(){d.push(a)},function(){0<d.length&&c.push(d);c.push([a]);d=[]},function(){0<d.length&&c.push(d);d=[]})});0<d.length&&c.push(d);return c},xC=
{splitby:function(a,b){return wC(a,function(a){return b(a)?$h.excludeWithout(a):$h.include(a)})},splitbyAdv:wC},yC={splitby:function(a,b){return xC.splitby(a,b)},splitbyAdv:function(a,b){return xC.splitbyAdv(a,b)},sliceby:function(a,b){return r2.sliceby(a,b)},boundAt:function(a,b,c,d){return q2.boundAt(a,b,c,d)}},nn={count:function(a){return Eb(a,function(a,c){return c.len()+a},0)},dropUntil:function(a,b){return yC.sliceby(a,function(a){return a.is(b)})},gen:function(a,b){return a.fold(g.none,function(a){return g.some(W.range(a,
b,b+1))},function(c){return g.some(W.range(c,b,b+a.len()))})},justText:function(a){return ia(a,function(a){return a.fold(k([]),k([]),function(a){return[a]})})}},on=function(a,b,c){if(a.property().isText(b))return[mn.text(b,a)];if(a.property().isEmptyTag(b))return[mn.empty(b,a)];if(a.property().isElement(b)){var d=a.property().children(b),e=a.property().isBoundary(b)?[mn.boundary(b,a)]:[];b=void 0!==c&&c(b)?[]:ia(d,function(b){return on(a,b,c)});return e.concat(b).concat(e)}return[]},zC=function(a,
b,c,d,e){a=on(a,d,e);b=nn.dropUntil(a,b);b=nn.count(b);return W.point(d,b+c)},ai={typed:on,items:function(a,b,c){a=on(a,b,c);var d=function(a,b){return a};return E(a,function(a){return a.fold(d,d,d)})},extractTo:function(a,b,c,d,e){return a.up().predicate(b,d).fold(function(){return W.point(b,c)},function(d){return zC(a,b,c,d,e)})},extract:function(a,b,c,d){return a.property().parent(b).fold(function(){return W.point(b,c)},function(e){return zC(a,b,c,e,d)})}},s2=function(a,b){return"img"===b.property().name(a)?
" ":"\n"},t2={from:function(a,b,c){b=ai.typed(a,b,c);return E(b,function(b){return b.fold(k("\n"),s2,a.property().getText)}).join("")}},u2={make:function(a,b,c){return hb(a,function(a,c){return b(c,a.len).fold(k(a),function(b){return{len:b.finish(),list:a.list.concat([b])}})},{len:void 0!==c?c:0,list:[]}).list}},AC=function(a,b){return b>=a.start()&&b<=a.finish()},BC=function(a,b){return Va(a,function(a){return a.start()===b})},v2=function(a,b){return a[a.length-1]&&a[a.length-1].finish()===b?a.length+
1:-1},pn={get:function(a,b){return qa(a,function(a){return AC(a,b)})},find:function(a,b){return qa(a,b)},inUnit:AC,sublist:function(a,b,c){b=BC(a,b);var d=BC(a,c);return b.bind(function(b){var e=d.getOr(v2(a,c));return-1<e?g.some(a.slice(b,e)):g.none()}).getOr([])}},CC={translate:function(a,b){return E(a,function(a){return ua(a,{start:k(a.start()+b),finish:k(a.finish()+b)})})}},w2=function(a,b,c){b=c(a,b);return CC.translate(b,a.start())},x2={splits:function(a,b,c){return 0===b.length?a:ia(a,function(a){var d=
ia(b,function(b){return pn.inUnit(a,b)?[b-a.start()]:[]});return 0<d.length?w2(a,d,c):[a]})}},Rd={generate:function(a,b,c){return u2.make(a,b,c)},get:function(a,b){return pn.get(a,b)},find:function(a,b){return pn.find(a,b)},splits:function(a,b,c){return x2.splits(a,b,c)},translate:function(a,b){return CC.translate(a,b)},sublist:function(a,b,c){return pn.sublist(a,b,c)}},y2={find:function(a,b,c,d){a=ai.typed(a,b,d);a=Rd.generate(a,nn.gen);return Rd.get(a,c).map(function(a){return W.point(a.element(),
c-a.start())})}},fg={extract:function(a,b,c,d){return ai.extract(a,b,c,d)},extractTo:function(a,b,c,d,e){return ai.extractTo(a,b,c,d,e)},all:function(a,b,c){return ai.items(a,b,c)},from:function(a,b,c){return ai.typed(a,b,c)},find:function(a,b,c,d){return y2.find(a,b,c,d)},toText:function(a,b,c){return t2.from(a,b,c)}},bi=nb(),Wh={extract:function(a,b,c){return fg.extract(bi,a,b,c)},extractTo:function(a,b,c,d){return fg.extractTo(bi,a,b,c,d)},all:function(a,b){return fg.all(bi,a,b)},from:function(a,
b){return fg.from(bi,a,b)},find:function(a,b,c){return fg.find(bi,a,b,c)},toText:function(a,b){return fg.toText(bi,a,b)}},DC=function(a){var b=Object.create(null);Ma(a,function(a,d){b[d]=a});return b},z2=DC({img:!0,br:!0,hr:!0,input:!0}),A2=DC({script:!0,style:!0,noscript:!0}),B2=/[<>&\u00A0]/g,C2={"<":"&lt;",">":"&gt;","&":"&amp;","\u00a0":"&nbsp;"},D2=/["<>&]/g,E2={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;"},EC=function(a,b,c){return a.replace(b,function(a){return c[a]||a})},FC=function(a){for(var b=
"",c=0;c<a.length;c++){var d=a[c];d.specified&&"_moz_dirty"!==d.name&&(b+=" "+d.name+'="'+EC(d.value,D2,E2)+'"')}return b},HC=function(a){var b="";z(a,function(a){b+=GC(a)});return b},F2=function(a){var b="";z(a,function(a){b+=a.textContent});return b},GC=function(a){var b=a.nodeType;if(b===gk){b=a.nodeName.toLowerCase();var c=a.childNodes;a=a.attributes;0===c.length&&z2[b]?b="<"+b+FC(a)+" />":(c=A2[b]?F2(c):HC(c),b="<"+b+FC(a)+">"+c+"</"+b+">");return b}if(b===LB)return EC(a.textContent,B2,C2);if(b==
KB)return"\x3c!--"+a.data+"--\x3e";throw"unsupported node type "+a.nodeType;},qn={writeNode:function(a){if(!ic(a))throw"sugarNode parameter must be an object";return GC(a.dom())},writeChildren:function(a){if(!ic(a))throw"sugarNode parameter must be an object";return HC(a.dom().childNodes)}},IC=function(a){var b=new RegExp(mb(),"g");return a.replace(b,"")},Xj={output:function(a,b){a.filterDom(a.output(),b);a=qn.writeChildren(b);return IC(a)},zeroWidth:IC},rn={toText:function(a){a=E(a,function(a){return Wh.toText(a,
k(!1))}).join("");return Xj.zeroWidth(a.trim())},toHtml:function(a){a=E(a,qn.writeNode).join("");return Xj.zeroWidth(a)}},JC=function(a){return a.dom().innerHTML},Ea={get:JC,set:function(a,b){var c=A.owner(a).dom(),d=r.fromDom(c.createDocumentFragment());b=qe.fromHtml(b,c);P.append(d,b);G.empty(a);y.append(a,d)},getOuter:function(a){var b=r.fromTag("div");a=r.fromDom(a.dom().cloneNode(!0));y.append(b,a);return JC(b)}},Vb={get:function(a){return a.dom().textContent},set:function(a,b){a.dom().textContent=
b}},KC=function(a,b){return Sl.makeReadOnly({getAttributes:function(){return Sl.makeReadOnly(a.getFilteredAttributes(b))},setAttributes:function(c){Tb(arguments,[ba.object("attributes")]);Ma(c,function(a,b){if(!xa(a))throw Error("attribute key "+b+" does not have a string value: "+a);});m.setAll(b,c);a.domChanged();a.undoChanged()},getText:function(){return rn.toText([b])},setText:function(a){Tb(arguments,[ba.string("text")]);Vb.set(b,a)},getHtml:function(){return a.getFilteredContents(b)},setHtml:function(a){Tb(arguments,
[ba.string("html")]);Ea.set(b,a)},replaceElement:function(c){Tb(arguments,[ba.string("html")]);var d=qe.fromHtml(c);if(1!==d.length)throw Error("replacement html must be a single node");d=d[0];a.replaceElement(b,d);return KC(a,d)}})},Aq={getText:function(a){return a.content().getSelectedText().getOr("")},getHtml:function(a){return a.content().getSelectedHtml().getOr("")},findTagAtCursor:function(a,b){var c=a.content();return c.findTagAtCursor(b).map(function(a){return KC(c,a)}).getOr(null)}},LC={},
MC=function(a){return g.from(LC[a])},Bq={get:MC,register:function(a,b){return LC[a]=b},hookup:function(a,b){MC(b).fold(function(){console&&console.error&&console.error('textbox.io Could not find plugin "'+b+'". Have you declared it?')},function(b){a.events.loaded.addListener(function(){b.initialize(a)})})}},NC={attached:function(a,b){b=b||r.fromDom(Hb.documentElement);return Ja.ancestor(a,u(N.eq,b)).isSome()},windowOf:function(a){var b=a.dom();return b===b.window&&a instanceof E1?a:D.isDocument(a)?
b.defaultView||b.parentWindow:null}},OC=function(a,b){return{left:k(a),top:k(b),translate:function(c,d){return OC(a+c,b+d)}}},Ra=OC,sn=function(a,b){return void 0!==a?a:void 0!==b?b:0},PC=function(a){var b=a.dom(),c=b.ownerDocument,d=c.body;c=r.fromDom(c.documentElement);if(d===b)return Ra(d.offsetLeft,d.offsetTop);if(!NC.attached(a,c))return Ra(0,0);a=b.getBoundingClientRect();return Ra(a.left,a.top)},bb={absolute:function(a){var b=a.dom().ownerDocument,c=b.body,d=NC.windowOf(r.fromDom(b)),e=b.documentElement;
b=sn(d.pageYOffset,e.scrollTop);d=sn(d.pageXOffset,e.scrollLeft);var f=sn(e.clientTop,c.clientTop);c=sn(e.clientLeft,c.clientLeft);return PC(a).translate(d-c,b-f)},relative:function(a){a=a.dom();return Ra(a.offsetLeft,a.offsetTop)},viewport:PC},G2=aa.detect().browser.isSafari(),tn=function(a){a=void 0!==a?a.dom():Hb;return Ra(a.body.scrollLeft||a.documentElement.scrollLeft,a.body.scrollTop||a.documentElement.scrollTop)},un=function(a,b,c){(void 0!==c?c.dom():Hb).defaultView.scrollTo(a,b)},Gs=function(a,
b){G2&&vb(a.dom().scrollIntoViewIfNeeded)?a.dom().scrollIntoViewIfNeeded(!1):a.dom().scrollIntoView(b)},Za={get:tn,to:un,by:function(a,b,c){(void 0!==c?c.dom():Hb).defaultView.scrollBy(a,b)},preserve:function(a,b){var c=tn(a);b();b=tn(a);c.top()===b.top()&&c.left()===b.left()||un(c.left(),c.top(),a)},capture:function(a){var b=g.none(),c=function(){b=g.some(tn(a))};c();return{save:c,restore:function(){b.each(function(b){un(b.left(),b.top(),a)})}}},intoView:Gs,intoViewIfNeeded:function(a,b){b=b.dom().getBoundingClientRect();
var c=a.dom().getBoundingClientRect();c.top<b.top?Gs(a,!0):c.bottom>b.bottom&&Gs(a,!1)},setToElement:function(a,b){b=bb.absolute(b);a=r.fromDom(a.document);un(b.left(),b.top(),a)},scrollBarWidth:function(){var a=r.fromHtml('<div style="width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;"></div>');y.after(ja.body(),a);var b=a.dom().offsetWidth-a.dom().clientWidth;G.remove(a);return b}},QC={withOptions:function(a,b){return m.has(a,"tabindex")?oa(b,{content:{tabindex:m.get(a,
"tabindex")}}):b}},RC=aa.detect(),H2=RC.browser.isIE()&&10===RC.browser.version.major,Hs=function(a,b){var c=v.getRaw(a,b).getOrThunk(function(){return v.get(a,b)});return H2&&"0px"===c?"auto":c},mk=function(a,b,c){a=Hs(a,b);return void 0===a?c:g.some(a)},I2=function(a){return{width:mk(a,"width",g.none()),"max-width":mk(a,"max-width",g.some("none")),"min-width":mk(a,"min-width",g.some("none")),"max-height":mk(a,"max-height",g.some("none")),"min-height":mk(a,"min-height",g.some("1em"))}},vn=function(a,
b,c){var d=v.getRaw(b,"display"),e=Hs(b,"height");v.set(b,"display","none");var f=Hs(b,"height"),h=I2(b);d.fold(function(){v.remove(b,"display")},function(a){v.set(b,"display",a)});Ma(h,function(a,b){a.each(function(a){v.set(c,b,a)})});d="auto"===f?e:f;void 0!==d&&(!0===a?(v.set(c,"min-height",d),v.remove(c,"height")):v.set(c,"height",d));v.set(c,"display","flex")},J2=u(vn,!1),K2=u(vn,!0),L2=function(a){vn(!1,a,a)},M2=function(a){vn(!0,a,a)},SC=function(a){return a.replace(/\./g,"-")},Lb={create:function(a){var b=
SC(a);return{resolve:function(a){a=a.split(" ");return E(a,function(a){return b+"-"+a}).join(" ")}}},cssNamespace:SC,cssClass:function(a,b){return a+"-"+b}},TC=Lb.create("ephox-elder"),wn={resolve:TC.resolve,scrollable:u(TC.resolve,"scrollable")},Is=function(a,b){a=m.get(a,b);return void 0===a||""===a?[]:a.split(" ")},ff={read:Is,add:function(a,b,c){c=Is(a,b).concat([c]);m.set(a,b,c.join(" "));return!0},remove:function(a,b,c){var d=ka(Is(a,b),function(a){return a!==c});0<d.length?m.set(a,b,d.join(" ")):
m.remove(a,b);return!1}},UC=function(a){return ff.read(a,"class")},VC=function(a,b){return ff.add(a,"class",b)},WC=function(a,b){return ff.remove(a,"class",b)},md={get:UC,add:VC,remove:WC,toggle:function(a,b){return U(UC(a),b)?WC(a,b):VC(a,b)},supports:function(a){return void 0!==a.dom().classList}},XC=function(a,b){return md.supports(a)&&a.dom().classList.contains(b)},n={add:function(a,b){md.supports(a)?a.dom().classList.add(b):md.add(a,b)},remove:function(a,b){md.supports(a)?a.dom().classList.remove(b):
md.remove(a,b);0===(md.supports(a)?a.dom().classList:md.get(a)).length&&m.remove(a,"class")},toggle:function(a,b){return md.supports(a)?a.dom().classList.toggle(b):md.toggle(a,b)},toggler:function(a,b){var c=md.supports(a),d=a.dom().classList;return Cq(function(){c?d.remove(b):md.remove(a,b)},function(){c?d.add(b):md.add(a,b)},XC(a,b))},has:XC},ma={add:function(a,b){z(b,function(b){n.add(a,b)})},remove:function(a,b){z(b,function(b){n.remove(a,b)})},toggle:function(a,b){z(b,function(b){n.toggle(a,
b)})},hasAll:function(a,b){return ob(b,function(b){return n.has(a,b)})},hasAny:function(a,b){return Xa(b,function(b){return n.has(a,b)})},get:function(a){if(md.supports(a)){a=a.dom().classList;for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a.item(c);a=b}else a=md.get(a);return a}},yf={addClass:function(a){return function(b){n.add(b,a)}},removeClass:function(a){return function(b){n.remove(b,a)}},removeClasses:function(a){return function(b){ma.remove(b,a)}},hasClass:function(a){return function(b){return n.has(b,
a)}}},xn=g.none(),YC=wn.resolve("modal-scroll-lock"),ZC=function(a,b){z(b,function(b){a(b)})},N2=u(ZC,yf.addClass(YC)),O2=u(ZC,yf.removeClass(YC)),jf=function(a,b){var c=null,d=null;return{cancel:function(){null!==c&&(clearTimeout(c),d=c=null)},throttle:function(){for(var e=[],f=0;f<arguments.length;f++)e[f]=arguments[f];d=e;null===c&&(c=setTimeout(function(){a.apply(null,d);d=c=null},b))}}},uj=function(a,b){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){for(var d=
[],e=0;e<arguments.length;e++)d[e]=arguments[e];null!==c&&clearTimeout(c);c=setTimeout(function(){a.apply(null,d);c=null},b)}}},H={create:function(a){var b=eb(a,function(a){return{bind:a.bind,unbind:a.unbind}});a=eb(a,function(a){return a.trigger});return{registry:b,trigger:a}}},Vc={register:function(a){n.add(a,wn.scrollable())},deregister:function(a){n.remove(a,wn.scrollable())},scrollable:wn.scrollable,preserve:Za.preserve,capture:Za.capture,block:function(){if(xn.isNone()){var a=Za.get(),b=K.bind(r.fromDom(window),
"scroll",function(b){b=Za.get();b.left()===a.left()&&b.top()===a.top()||window.scrollTo(a.left(),a.top())});xn=g.some(b)}},unblock:function(){xn.each(function(a){a.unbind();xn=g.none()})},lock:N2,unlock:O2,event:function(a){var b=!1,c=H.create({started:p([]),stopped:p([])}),d=uj(function(){!0===b&&(b=!1,c.trigger.stopped())},250),e=K.bind(a,"scroll",function(){!1===b&&c.trigger.started();b=!0;d.throttle()});return{events:c.registry,destroy:function(){e.unbind()},isScrolling:function(){return b}}}},
xf={isEmpty:function(a){return null===a||void 0===a||""===a||Mb(a)&&0===a.length}},yn=Yx(),Js={preload:function(){yn.preload()},addStylesheet:function(a,b){return yn.addStylesheet(a,b)},addScript:function(a,b){return yn.addScript(a,b)},waitForLoad:function(){return yn.waitForLoad()}},$C=function(){return{zh_hk:"zh_tw",iw:"he",no:"nb",nn:"nb",en:"en",ar:"ar",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",es:"es",fa:"fa",fi:"fi",fr:"fr",he:"he",hr:"hr",hu:"hu",it:"it",ja:"ja",kk:"kk",ko:"ko",nl:"nl",nb:"nb",
pl:"pl",pt:"pt",pt_pt:"pt_pt",ro:"ro",ru:"ru",sl:"sl",sk:"sk",sv:"sv",th:"th",tr:"tr",uk:"uk",zh:"zh",zh_tw:"zh_tw"}},aD=function(a){a=a.toLowerCase().replace("-","_");var b=a.indexOf(";");a=-1<b?a.substring(0,b):a;a=Zh(a);b=a.indexOf("_");b=-1<b?a.substring(0,b):a;return{full:a,languageCode:b}},bD=function(a,b){a=a.split(",");a=E(a,function(a){a=aD(a);return b[a.full]||b[a.languageCode]||""});return qa(a,function(a){return""!==a})},Ks={extract:aD,determine:function(a){var b=$C();return bD(a,b)},
determineFrom:bD,localeList:$C},ee=function(a){for(var b=[],c=function(a){b.push(a)},d=0;d<a.length;d++)a[d].each(c);return b},yc=function(a,b){for(var c=0;c<a.length;c++){var d=b(a[c],c);if(d.isSome())return d}return g.none()},cD=function(){var a=bh("navigator")||{};return a.userLanguage||a.language||"en"}(),dD=g.none(),qf={determine:function(a){var b=void 0!==a?[a,cD]:[cD];return yc(b,Ks.determine).fold(function(){console.warn("WARNING: locales not supported: "+b.join(", "));return"en"},ca)},get:function(){return dD.getOrDie("locale used before it has been set")},
set:function(a){dD=g.from(a)}},P2={font:{arial:"Arial",courier:"Courier New",comicsans:"Comic Sans MS",consolas:"Consolas",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesnr:"Times New Roman",trebuchet:"Trebuchet MS",verdana:"Verdana"},error:{duplicate:{code:"That snippet code is already taken.",uuid:"That snippet uuid is already taken."},unknown:{uuid:"The snippet uuid cannot be found"},code:{duplicate:"That snippet code is already taken."}},cog:{login:"Log in",logout:"Log out","not-logged-in":"Not logged in",
user:"User: {0}"},banner:{"logged-in":"Logged in as: {0}"}},eD={},fD="",Ls={},gD=function(a){return bh(a,Ls)||bh(a,eD)||bh(a,P2)},gh={loadEnglish:function(a){eD=a},load:function(a,b){fD=a;Ls=b;qf.set(a)},isLoaded:function(a){return fD===a&&0<cb(Ls).length},get:function(a){var b=gD(a);if(xa(b))return b;throw Error("key "+a+" does not exist");},has:function(a){if(!xa(a))throw a.fold?console.error("object details were",a.fold(ca,ca,ca)):console.error("object key was",a),"key was an object";return xa(gD(a))}},
Ms=g.none(),Ns={set:function(a){Ms.fold(function(){Ms=g.some(a)},function(b){b!==a&&console.error('Only one base URL supported per page. Requested value "'+a+'", already using "'+b+'"')})},get:function(){return Ms.getOrDie("Must begin loading with a base URL")}},Q2={execute:function(a){if("complete"===Hb.readyState||"interactive"===Hb.readyState)a();else var b=K.bind(r.fromDom(Hb),"DOMContentLoaded",function(){a();b.unbind()})}},zn=dy("width",function(a){return a.dom().offsetWidth}),Ia={set:function(a,
b){zn.set(a,b)},get:function(a){return zn.get(a)},getOuter:function(a){return zn.getOuter(a)},setMax:function(a,b){b=zn.max(a,b,"margin-left border-left-width padding-left padding-right border-right-width margin-right".split(" "));v.set(a,"max-width",b+"px")}},hD=function(){var a=r.fromTag("div");n.add(a,"ephox-textbox-font");var b=r.fromTag("span");n.add(b,"ephox-chameleon-icon");y.append(a,b);y.append(ja.body(),a);var c=Ia.get(b);b=v.get(b,"font-family");G.remove(a);return 0<c&&void 0!==b&&Bb(b,
"Textbox Icons")},R2=function(a){var b=0,c=setInterval(function(){b+=250;hD()?(clearInterval(c),a(!0)):2E3<b&&(clearInterval(c),a(!1))},250)},S2={wait:gc(function(){return lf.nu(function(a){Q2.execute(function(){hD()?a(!0):R2(a)})})})},T2=function(a){S2.wait().get(function(b){a(b?J.value(!0):J.error("Stylesheet loaded, but did not contain Textbox.io styles"))})},iD=function(a,b){a=a+"/i18n/tbio_"+b+".js?"+Wf.resourceParam();return Js.addScript(a,function(a){return a.bind(function(a){return Wf.strictMatch(a.version,
"Language strings").fold(function(){return J.value(a.strings())},J.error)})})},jD=function(a){var b="/textboxio.css?"+Wf.fullParam();Js.addStylesheet(a+b,T2)},ak={load:function(a){Ns.set(a);a=Ns.get();jD(a+"/css");iD(a,"en").get(function(a){a.each(gh.loadEnglish)});return a},devLoad:jD,setLanguage:function(a){var b=qf.determine(a);gh.isLoaded(b)||(a=Ns.get(),iD(a,b).get(function(a){a.each(function(a){gh.load(b,a)})}))},waitForLoad:function(){return Js.waitForLoad()},getFailures:function(a){return ia(a,
function(a){return a.fold(function(a){return[a]},k([]))})}},T={span:function(a){a=r.fromTag("span",a);m.set(a,"role","presentation");return a},div:function(a){a=r.fromTag("div",a);m.set(a,"role","presentation");return a},tag:function(a,b){a=r.fromTag(a,b);m.set(a,"role","presentation");return a}},B={resolve:Lb.create("ephox-polish").resolve},Db={any:function(a){return L.first(a).isSome()},ancestor:function(a,b,c){return L.ancestor(a,b,c).isSome()},sibling:function(a,b){return L.sibling(a,b).isSome()},
child:function(a,b){return L.child(a,b).isSome()},descendant:function(a,b){return L.descendant(a,b).isSome()},closest:function(a,b,c){return L.closest(a,b,c).isSome()}},Os=B.resolve("highcontrast-mode"),U2=function(a){var b=r.fromTag("div");n.add(b,B.resolve("highcontrast-detect"));y.append(a,b);v.reflow(b);(!0===("none"===v.get(b,"background-image")?!0:!1)?n.add:n.remove)(a,Os);G.remove(b)},V2=function(a){var b=r.fromDom(document.documentElement);(!0===(m.has(b,"hc")&&m.has(b,"hcx"))?n.add:n.remove)(a,
Os)},W2=t,lj={detect:function(a){var b=aa.detect();b.os.isWindows()&&(b.browser.isIE()||b.browser.isEdge()||b.browser.isFirefox()?U2:b.browser.isChrome()?V2:W2)(a)},isHighContrast:function(a){return Db.ancestor(a.uiContainer(),"."+Os)}},iy=Aa(["width","docWidth","height","docHeight"],[]),kD=ta.generate([{unchanged:["html"]},{changed:["html"]}]),Lf={unchanged:kD.unchanged,changed:kD.changed,cata:function(a,b,c){return a.fold(b,c)}},lD=function(){return{validate:function(a,b){return vb(a)||"events"===
b&&ic(a)},label:"Function (or events)"}}(),mD="activateInline communication connect content deactivateInline element events filter focus getContent getMode insertHtmlAtCursor isDirty isPrettyPrinting keyboard macros operations setContent setDirty smartview state ui undo".split(" "),X2=kn(mD.concat([]),lD),Y2=kn(mD.concat("blur destroy fromTransfer fullscreen uploader toTransfer viewport".split(" ")),lD),kj={external:X2,internal:Y2},Z2={create:function(){var a=!1;return{isBlocked:function(){return a},
block:function(){a=!0},unblock:function(){a=!1}}}},$2={create:function(a,b){return{control:a,instance:b}}},Hd={tap:function(a){var b=Z2.create();return $2.create(b,function(){b.isBlocked()||a.apply(null,arguments)})}},nD=0,Ha=function(a){var b=(new Date).getTime(),c=Math.floor(1E9*Math.random());nD++;return a+"_"+c+nD+String(b)},oD={isFunctionOrEvents:function(a){var b=function(b){return!0===ob(a,function(a){return void 0!==b[a]&&void 0!==b[a].bind&&vb(b[a].bind)})?!0:!1};return{validate:function(a,
d){return vb(a)||"events"===d&&ic(a)&&b(a)},label:"Function (or events)"}}},Eq=kn("events init ui check scanView situation hasDropdown hasAutocorrect handle assign lock destroy state lookup name".split(" "),oD.isFunctionOrEvents(["analytics"])),Jg={noSituation:function(){return{primary:k([]),secondary:k([]),submenus:k({})}},basic:function(){return{destroy:t,ui:g.none,state:k({}),events:Gd(["analytics"])}}},pD=function(a,b){var c={};Ma(a,function(a,b){var d=b.split(".");if(1>=d.length)c[b]={finalvalue:a};
else{var e=c;es(b,c);for(b=0;b<d.length-1;b++)e=e[d[b]];e[d[d.length-1]]={finalvalue:a}}});var d=function(a){var c={},e=cb(a);z(e,function(e){c[e]=void 0!==a[e].finalvalue?b(a[e].finalvalue):k(d(a[e]))});return c};return d(c)},wb={ui:function(a,b){a=pD(a,void 0!==b?b:k);return k(g.some(a))},actions:function(a){a=pD(a,ca);return k(a)}},Ta={basic:Jg.basic,draganddrop:function(){return{events:Gd(["insertAssets","insertHtml"]),destroy:t}},communication:function(){return{headers:k({}),destroy:t}},fullscreen:function(){return{ui:g.none,
actions:wb.actions({maximize:t,restore:t}),select:t,deselect:t,destroy:t,events:Gd(["analytics","maximize","restore"])}},dialog:function(){return{destroy:t,ui:g.none,events:Gd(["analytics"]),actions:wb.actions({show:t})}},spelling:function(){return yT()},editorcontext:function(){return{events:Gd(["blockChanged","enterDown","enterUp"]),destroy:t}},highlighter:function(){return{destroy:t,run:t}},linkvalidator:function(){return{destroy:t,refresh:t,ignore:t,state:k({ignore:[],cache:{}})}},macros:function(){return{events:Gd(["analytics"]),
state:k({}),customMacros:k(Dq({})),destroy:t}},table:function(){return{ui:g.none,state:k({}),events:Gd(["analytics"]),situation:Jg.noSituation,handle:t,assign:t,destroy:t,name:k("table-disabled")}},image:function(){return{events:Gd(["changed","contextmenu"]),situation:Jg.noSituation,handle:t,assign:t,destroy:t,name:k("image-disabled")}},imageEdit:function(){var a=function(a,b){return Ga.pure(E(b,Pb(J.value,a)))},b=u(a,ca);a=u(a,function(a){return a.asset()});return{situation:Jg.noSituation,handle:t,
assign:t,ui:g.none,destroy:t,insertResample:k({assets:b,correlated:a,destroy:t}),name:k("imageEdit-disabled")}},mobile:function(){return{ui:g.none,events:Gd(["fullscreen"]),destroy:t}},noAnalytics:function(){return{log:t,register:t}},state:function(a){var b=ey(a.laundry),c=fy(a.filters,t,t),d=Dq(a.macros.customs);return{filter:k({customFilters:k(c)}),macros:k({customMacros:k(d)}),laundry:b,getState:function(e){return ua(a,void 0===e?{}:e,{laundry:b.state(),filters:c.state(),macros:{customs:d.state()}})}}},
uploader:function(){var a=H.create({reconstitute:p([]),uploadAssets:p(["assets"])});return{destroy:t,events:a.registry,reconstitute:t,uploadAssets:t}},undo:function(){return{reset:t,disable:xb,save:t}}},Id={activateInline:t,deactivateInline:t,communication:Ta.communication,events:function(){return H.create({loaded:p([]),focus:p([]),dirty:p([]),change:p([]),internal:p(["command","data"]),paint:p([])}).registry},keyboard:yb("the keyboard feature is not implemented in this mode"),operations:yb("the operations feature is not implemented in this mode"),
smartview:yb("the smartview feature is not implemented in this mode"),ui:yb("the ui feature is not implemented in this mode")},An=dy("height",function(a){var b=a.dom();return ja.inBody(a)?b.getBoundingClientRect().height:b.offsetHeight}),sa={set:function(a,b){An.set(a,b)},get:function(a){return An.get(a)},getOuter:function(a){return An.getOuter(a)},setMax:function(a,b){b=An.max(a,b,"margin-top border-top-width padding-top padding-bottom border-bottom-width margin-bottom".split(" "));v.set(a,"max-height",
b+"px")}},a3="undo insert style emphasis align listindent format tools".split(" "),gg=O("x","y","width","height"),b3={intersect:function(a,b){var c=Math.max(a.x(),b.x()),d=Math.max(a.y(),b.y()),e=Math.min(a.x()+a.width(),b.x()+b.width());e=Math.max(0,e-c);a=Math.min(a.y()+a.height(),b.y()+b.height());return gg(c,d,e,Math.max(0,a-d))}},Ge=ta.generate([{unbundled:[]},{unsupported:["message"]},{item:["info","blueprint"]},{customMenu:["info","groups","blueprint"]},{textboxMenu:["info","blueprint"]},{palette:["info",
"children","blueprint"]}]),qD={create:function(a){var b=function(a,b){return a.feature.fold(function(){return void 0!==a.unsupported?[Ge.unsupported(a.unsupported)]:[Ge.unbundled()]},function(c){if(void 0===c[a.command])return console.warn("unknown command: "+a.command),[];c=c[a.command]();return[b(c)]})},c=function(a,c){return b(c,function(b){return U(["widget","inline-widget","split-widget"],c.type)?Ge.item({instance:b.widget},a[c.type]):Ge.item(b[c.type](),a[c.type])})},d={dropdown:c,general:c,
widget:c,"split-widget":c,"inline-widget":c,palette:function(a,c){return b(c,function(b){b=b.palette();var c=E(b.items,function(b){return U(["widget","inline-widget","split-widget"],b.type)?Ge.item({instance:b.build},a[b.type]):U(["dropdown"],b.type)?Ge.item(b.build(),a[b.type]):Ge.item(b.spec,a[b.type])});return Ge.palette(b,c,a.palette)})},submenu:function(b,c){var d=E(c.commands,a);return[Ge.customMenu(c,d,b.menu)]},menu:function(a,c){return b(c,function(b){return Ge.textboxMenu(b[c.type](),a[c.type])})}};
return{classify:function(a,b){var c=d[b.type];return void 0!==c?c(a,b):[]}}},cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)}},c3={fromConfig:function(a,b,c){var d=function(a,b){a=u(e.classify,a);a=ia(b.items,a);return{category:b.category,books:a}};a=u(d,a);b=u(d,b);var e=qD.create(b);return E(c,a)}},va={resolve:Lb.create("ephox-chameleon").resolve},mj={show:function(a){v.remove(a,"display")},hide:function(a){v.set(a,"display","none")},isShowing:function(a){return v.getRaw(a,"display").isNone()},
isHiding:function(a){return v.getRaw(a,"display").is("none")}},jy={group:eh(fh,["component","isVisible","refreshUi","destroy"])},Oq={menu:function(a,b){var c=H.create({done:p([]),abort:p(["item"])}),d=function(a){a.done.bind(function(){c.trigger.done()});a.abort.bind(function(a){c.trigger.abort(a.item())});return ua(a,{done:c.registry.done,abort:c.registry.abort})},e=Eb(b,function(a,b){var c=ua(b.structure(),a.structures),e=b.submenus().concat(a.submenus),f=ua(b.handlers(),a.actions),h=[b.refreshMenu].concat(a.refreshMenu);
a=[b.destroyer].concat(a.destroyers);b=d(b.events);return{structures:c,submenus:e,refreshMenu:h,actions:f,destroyers:a,events:b}},{structures:{},submenus:[],actions:{},refreshMenu:[],destroyers:[],events:{}});return{structure:k(e.structures),init:function(a){z(e.refreshMenu,xb)},name:k(a),handlers:k(e.actions),submenus:k(e.submenus),events:e.events,destroy:function(){z(e.destroyers,xb)}}},toolbar:function(a){a=AT(a);var b=H.create({escaped:p([]),executed:p([])});return jy.group({component:a.component,
isVisible:a.isVisible,refreshUi:a.refreshUi,destroy:a.destroy,events:b.registry})}},rD=function(a,b){n.add(a,va.resolve("user-icon"));v.setAll(a,{"background-image":"url("+b+")"})},Bn={setUrl:rD,findAndSetUrl:function(a,b){L.descendant(a,".ephox-pastry-icon-content").each(function(a){rD(a,b)})}},Cn=function(a,b){m.set(a,"aria-pressed",b?"true":"false")},ra={expanded:function(a){m.set(a,"aria-expanded","true")},collapsed:function(a){m.set(a,"aria-expanded","false")},checked:function(a,b){m.set(a,"aria-checked",
String(b))},setPressed:Cn,press:function(a){Cn(a,!0)},release:function(a){Cn(a,!1)},pressed:function(a){Cn(a.element(),a.selected())},enable:function(a){m.set(a,"aria-disabled","false")},disable:function(a){m.set(a,"aria-disabled","true")},tabSelected:function(a,b){m.setAll(a,{"aria-selected":"true","aria-pressed":"true"});z(b,function(a){m.setAll(a,{"aria-selected":"false","aria-pressed":"false"})})},showPanel:function(a){m.set(a,"aria-selected","true");m.set(a,"aria-hidden","false")},hidePanel:function(a){m.set(a,
"aria-selected","false");m.set(a,"aria-hidden","true")}},d3=function(a){a.enable();ra.enable(a.element())},e3=function(a){a.disable();ra.disable(a.element())},Lq={control:function(a){return{enable:u(d3,a),disable:u(e3,a)}},ariaPressed:function(a){return{press:u(ra.press,a.element()),release:u(ra.release,a.element())}}},Dn=function(a){var b=a.replace(/\./g,"-");return{resolve:function(a){return b+"-"+a}}},nk={resolve:Dn("ephox-echo").resolve},f3=nk.resolve("aria-help"),g3=nk.resolve("aria-help-visible"),
En=function(a){m.set(a,"role","presentation")},sD=function(a,b){m.setAll(a,{role:"application","aria-label":b})},tD=function(a){m.set(a,"role","button")},Ps=function(a,b){m.set(a,"aria-owns",b)},uD=function(a,b){m.set(a,"aria-controls",b)},vD=function(a,b){var c=Ha("ephox-aria");m.set(b,"id",c);uD(a,c)},wD=function(a,b){m.set(a,"aria-describedby",b)},xD=function(a,b){m.set(a,"aria-labelledby",b)},Fn=function(a,b){m.set(a,"aria-label",b)},S={document:function(a){m.set(a,"role","document")},presentation:En,
region:function(a){m.set(a,"role","region")},controls:uD,owns:Ps,disown:function(a){m.remove(a,"aria-owns")},editor:function(a,b,c,d,e){sD(a,c);d.each(function(c){var d=r.fromTag("span");En(d);y.append(d,r.fromText(c));c=Ha("ephox-aria");m.set(d,"id",c);wD(b,c);n.add(d,f3);!0===e&&n.add(d,g3);y.append(a,d)});return{destroy:function(){m.remove(b,"aria-describedby")}}},inline:function(a,b,c,d,e){sD(a,c);var f=[];m.has(b,"id")?Ps(a,m.get(b,"id")):(c=Ha("ephox-aria-content"),m.set(b,"id",c),Ps(a,c),f.push(function(){m.remove(b,
"id")}));d.each(function(a){if(m.has(b,"aria-label")){var c=m.get(b,"aria-label");Fn(b,a);f.push(function(){Fn(b,c)})}else Fn(b,a),f.push(function(){m.remove(b,"aria-label")})});return{destroy:function(){z(f,xb)}}},group:function(a){m.set(a,"role","group")},toolbar:function(a,b){m.setAll(a,{role:"group","aria-label":b})},toolbarGroup:function(a,b){m.set(a,"role","toolbar");null===b||void 0===b||""===b||Mb(b)&&0===b.length||m.set(a,"aria-label",b)},toolbarButton:function(a,b,c,d){m.setAll(a,{role:"button",
"aria-label":b,"aria-haspopup":""+c});d&&m.set(a,"aria-pressed","false");c&&m.set(a,"aria-expanded","false")},textButton:function(a,b){tD(a);En(b)},menu:function(a,b){m.setAll(a,{"aria-label":b,role:"menu"})},menuItem:function(a,b,c){b=b.map(function(a){return{"aria-label":a}}).getOr({});m.setAll(a,ua(b,{role:"menuitem","aria-haspopup":c.getOr(!1)}))},menuItemCheckbox:function(a){m.setAll(a,{role:"menuitemcheckbox","aria-checked":!1})},checkbox:function(a,b){m.setAll(a,{role:"checkbox","aria-label":b,
"aria-checked":!1})},dialog:function(a,b){m.setAll(a,{role:"dialog","aria-label":b})},buttonRole:tD,button:function(a,b){m.setAll(a,{"aria-label":b,role:"button"})},labelledField:function(a,b,c){var d=r.fromTag("div");En(d);b+=Ha("");var e=Ha("label");c=r.fromHtml("<label>"+c+"</label>");m.set(c,"for",b);m.set(c,"id",e);m.set(a,"id",b);xD(a,e);P.append(d,[c,a]);return{element:k(d),field:k(a)}},multiline:function(a){m.set(a,"aria-multiline","true")},textarea:function(a){m.setAll(a,{"aria-multiline":"true",
role:"textbox"})},label:Fn,widget:function(a){m.set(a,"role","widget")},option:function(a){m.set(a,"role","option")},listBox:function(a){m.set(a,"role","listbox")},live:function(a,b,c){m.setAll(a,{"aria-live":c?c:"polite",id:b})},tabList:function(a){m.set(a,"role","tablist")},tabButton:function(a,b){m.setAll(a,{"aria-label":b,role:"tab"})},tabPanel:function(a){m.setAll(a,{role:"tabpanel"})},linkElements:vD,linkTabToPanel:function(a,b){vD(a,b)},describedBy:wD,labelledBy:xD,required:function(a){m.set(a,
"aria-required","true")},hidden:function(a,b){b?m.set(a,"aria-hidden",b):m.remove(a,"aria-hidden")},invalid:function(a,b){!0===b?m.set(a,"aria-invalid","true"):m.remove(a,"aria-invalid")}},BT={disable:function(a){m.set(a,"unselectable","on");v.setAll(a,{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"});a.dom().style.setProperty("-moz-user-select","-moz-none");return K.bind(a,"onselectstart",function(){return!1})}},lb={resolve:Lb.create("ephox-pastry").resolve},yD=function(a,
b,c,d){S.toolbarButton(a.element(),b,c,d);b=Lq.control(a);c=Lq.ariaPressed(a);return{enable:b.enable,disable:b.disable,press:c.press,release:c.release,destroy:function(){a.destroy()}}},Qs=function(a,b,c,d,e,f,h,l){h=g.from(h).fold(function(){return l(e)},function(a){return a(e,b)});f=g.from(f).getOr(!1);a=a(b);c=bf([va.resolve("icon"),va.resolve(c)]);f=!0===f?[Rc(l(e)).element()]:[];P.append(c.element(),f);a.content(c);a.events.click.bind(function(){d()});m.set(a.element(),"title",h);a.initAria=yD;
return a},zD=function(a,b){L.descendant(a,b).each(function(a){S.hidden(a,"true")})},AD=function(a,b,c,d,e,f,h,l){a=Qs(a,b,c,d,e,f,h,l);n.add(a.element(),va.resolve("split-"+b));zD(a.element(),".ephox-pastry-dropbutton-arrow");zD(a.element(),".ephox-pastry-dropbutton-button");L.descendant(a.element(),".ephox-pastry-dropbutton-arrow .ephox-pastry-icon-content").each(function(a){n.add(a,va.resolve("icon"));n.add(a,va.resolve("arrow-"+b))});return a},Ng={aria:yD,typical:function(a,b,c,d,e,f,h){return Qs(Oc,
a,b,c,d,e,f,h)},toggle:function(a,b,c,d,e,f,h){return Qs($d,a,b,c,d,e,f,h)},splitToggle:function(a,b,c,d,e,f,h){return AD(DT,a,b,c,d,e,f,h)},split:function(a,b,c,d,e,f,h){return AD(CT,a,b,c,d,e,f,h)}},re={resolve:Lb.create("ephox-gopher").resolve},Rs=Ul("item"),Ss=re.resolve("disabled-item"),BD="data-"+re.resolve("item-value"),Ic={set:function(a,b){Rs.set(a);m.set(a,BD,b)},get:function(a){return m.get(a,BD)},up:Rs.up,all:Rs.all,disable:function(a){n.add(a,Ss)},enable:function(a){n.remove(a,Ss)},isEnabled:function(a){return!n.has(a,
Ss)}},ok=Ul("menu"),CD="data-"+re.resolve("menu-value"),Gn=re.resolve("active-menu"),Jd={set:function(a,b){ok.set(a);m.set(a,CD,b)},active:function(a){return L.descendant(a,"."+Gn)},inactive:function(a){a=ok.all(a);return ka(a,function(a){return!n.has(a,Gn)})},activate:function(a,b){a=ok.all(a);z(a,function(a){n.remove(a,Gn)});n.add(b,Gn)},up:ok.up,all:ok.all,submenu:function(a,b,c){c=Ic.get(c);return(b.hasOwnProperty(c)?g.from(b[c]):g.none()).bind(function(b){return L.descendant(a,"["+CD+'="'+b+
'"]')})}},h3=Ul("submenu"),i3=Ul("main-menu"),Mf={main:k(i3),submenu:k(h3)},DD=function(a,b,c){Ic.set(c,b);m.set(c,"tabindex",-1);return c},FD=function(a,b,c){return ED(a,b,c,!1)},ED=function(a,b,c,d){var e=r.fromTag("li",a.dom()),f=T.span();n.add(f,re.resolve("item-text"));!0===d&&n.add(f,re.resolve("item-ellipsis"));y.append(f,r.fromText(c));y.append(e,f);DD(a,b,e);return e},GD=function(a){a=r.fromTag("li",a.dom());n.add(a,re.resolve("separator"));return a},j3=function(a,b){return"-"!==b.value()?
FD(a,b.value(),b.text()):GD(a)},HD=function(a,b,c){var d=r.fromTag("ol",a.dom());Jd.set(d,b);a=E(c,u(j3,a));P.append(d,a);return d},ID=function(a,b){a=r.fromTag("div",a.dom());Jd.set(a,b);return a},zb={item:FD,ellipsisItem:function(a,b,c){return ED(a,b,c,!0)},mainmenu:function(a,b,c){a=HD(a,b,c);Mf.main().set(a);return a},submenu:function(a,b,c){a=HD(a,b,c);Mf.submenu().set(a);return a},widget:ID,widgetSubmenu:function(a,b){a=ID(a,b);Mf.submenu().set(a);return a},separator:GD,custom:DD,enableItem:Ic.enable,
disableItem:Ic.disable},JD=function(a,b){if(void 0===a)throw Error("Cannot intersperse undefined");if(1>=a.length)return a;var c=[];c.push(a[0]);for(var d=1;d<a.length;d++)c.push(b()),c.push(a[d]);return c},k3={css:function(a){var b=/^[a-zA-Z]/.test(a)?"":"e";a=a.replace(/[^\w]/gi,"-");return b+a}},l3={splits:function(a,b){if(0===b.length)return[a];var c=hb(b,function(b,c){if(0===c)return b;var d=a.substring(b.prev,c);return{prev:c,values:b.values.concat([d])}},{prev:0,values:[]});b=b[b.length-1];
return b<a.length?c.values.concat(a.substring(b)):c.values}},Hn={cssSanitise:function(a){return k3.css(a)},splits:function(a,b){return l3.splits(a,b)}},m3=function(a,b){b=Qb(b);return Oq.menu(a,b)},n3=function(a){return E(a,function(a){a=E(a,function(a){return a.items()});return Qb(a)})},KD={create:function(a,b,c){var d=a.name,e=a.textkey,f=a.menuTextkey,h=a.tooltip,l=a.label,q=g.from(a.icon),C=k(void 0!==a.contentFocus?a.contentFocus:!1),w=r.fromDom(document),m=xa(e)?Hn.cssSanitise(d):d,F=c(e);f=
c(f);var n=zb.mainmenu(w,m+"-menu",[]),p=Ng.toggle(d,m,ca,e,l,h,c);q.filter(xa).each(function(a){Bn.findAndSetUrl(p.element(),a)});var u=p.initAria(p,F,!0,a.toggle);a=n3(b);var v=m3(m,b);b=JD(a,function(){return[zb.separator(w)]});S.menu(n,f);P.append(n,Qb(b));return{button:k(p),contentFocus:C,destroy:function(){p.destroy();v.destroy();u.destroy()},element:k(n),events:v.events,handlers:v.handlers,icon:k(q),init:v.init,label:k(F),name:v.name,structure:v.structure,submenus:v.submenus,textkey:k(e),menuTextkey:k(f),
updateMenu:t,enable:u.enable,disable:u.disable}}},o3=function(a,b){return g.some(b(a))},p3=function(a,b){return g.some(b(a,[]))},LD=function(a,b){var c=u(LD,a);return qD.cata(b,g.none,g.none,o3,function(b,e,f){e=E(e,function(a){return ia(a.books,c)});b=KD.create(b,e,a);return g.some(f(b,[]))},p3,function(a,b,f){b=ia(b,c);return g.some(f(a,b))}).toArray()},q3={build:function(a,b){return{items:ia(a.books,function(a){return LD(b,a)}),category:a.category}}},r3={build:function(a,b,c){var d=c.translations();
a=c3.fromConfig(b.toolbar(),b.menu(),a);a=E(a,function(a){return q3.build(a,d)});return E(a,function(a){var b=Oq.toolbar(a.items);a=a.category;S.toolbarGroup(b.component(),d(a));return b})}},s3=O("toolbar","menu"),t3=O("smartview","translations"),MD=function(a){return function(){return a.apply(null,arguments)}},ND={blueprints:MD(s3),env:MD(t3)},OD=function(){return/(?:(?:[A-Za-z]{3,9}:(?:\/\/))(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*|(?:www\.|[-;:&=+$,.\w]+@)[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*)(?::[0-9]+)?(?:\/[-+~%.()\/\w]*)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g},
In={tokens:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d,e,f){d=parseInt(d,10);if(void 0===b[d])throw"No value for token: "+c+" in translation: "+a;return b[d]})},link:OD,autolink:function(){var a=OD().source;return new RegExp("("+a+")[-.~*+=!&;:'%@?#^${}(),]*","g")}},Ts=ta.generate([{raw:["text"]},{key:["key"]},{pkey:["key","params"]}]),Us=function(a){var b=gh.get(a);if(1<arguments.length||/\{(\d+)\}/.test(b)){for(var c=Array(arguments.length-1),d=1;d<arguments.length;d++)c[d-1]=arguments[d];
return In.tokens(b,c)}return b},x={get:function(a){if(xa(a))throw"string passed to I18n.get:"+a;return a.fold(ca,Us,Us)},has:gh.has,translate:Us,raw:Ts.raw,key:function(a){gh.get(a);return Ts.key(a)},pkey:function(a,b){gh.get(a);return Ts.pkey(a,b)},cata:function(a,b,c,d){return a.fold(b,c,d)}},He={dropdown:xd("enable disable select clear selectElement populate tick untick activate deactivate".split(" ")),menu:xd(["enable","disable"]),general:xd("enable disable select deselect selected element".split(" ")),
widget:xd("enable disable select deselect press release".split(" ")),palette:xd(["show","hide"])},Zl={generateItem:function(a,b,c,d){return c.fold(function(){return zb.item(a,b.value(),d(b.textkey()))},function(c){c=c(b);var d=r.fromTag("li",a.dom());y.append(d,c);return zb.custom(a,b.value(),d)})},generateSeparator:function(a,b,c){var d=zb.separator(a);y.append(d,r.fromText(c(b),a.dom()));return d}},u3=function(a,b){a=qa(a,function(a){return a.value()===b});return g.from(a)},PD=function(a){a=Y.children(a,
".ephox-pastry-toggle-list-item-selected");z(a,function(a){n.remove(a,"ephox-pastry-toggle-list-item-selected");ra.checked(a,!1)})},Gh={updateDropdown:function(a,b,c,d,e){b.fold(a.clear,t,function(b){e.fold(function(){(xa(b)?u3(d,b):g.some(b)).each(a.select)},function(c){c=c(b);var d=lb.resolve("arrow-righticon");n.add(c,d);a.selectElement(c)})});c.fold(a.disable,t,a.enable)},tick:function(a,b){PD(a);a=Y.descendants(a,".ephox-gopher-item");qa(a,function(a){return m.get(a,"data-ephox-gopher-item-value")===
b}).each(function(a){n.add(a,"ephox-pastry-toggle-list-item-selected");ra.checked(a,!0)})},untick:PD,activate:function(a){n.add(a,"ephox-pastry-statebutton-selected")},deactivate:function(a){n.remove(a,"ephox-pastry-statebutton-selected")}},Vs=lb.resolve("toggle-list-item-selected"),v3=function(a){zb.enableItem(a);ra.enable(a)},w3=function(a){zb.disableItem(a);ra.disable(a)},x3=function(a){n.remove(a,Vs);ra.checked(a,!1)},y3=function(a){n.add(a,Vs);ra.checked(a,!0)},Eh={control:function(a){return{enable:u(v3,
a),disable:u(w3,a)}},selected:function(a){return{deselect:u(x3,a),select:u(y3,a),selected:u(n.has,a,Vs)}}},QD=function(a){var b=T.span();S.hidden(b,!0);ma.add(b,["ephox-pastry-icon-content","ephox-chameleon-icon"].concat([a]));return[b]},z3=function(a){var b=T.span();S.hidden(b,!0);ma.add(b,["ephox-pastry-icon-content","ephox-chameleon-"+a.value]);Bn.setUrl(b,a.icon);return[b]},A3=function(a){return QD(!0===a.icon?"ephox-chameleon-"+a.value:a.icon)},oj={generate:QD,generateFrom:function(a){return void 0===
a.icon?[]:(xa(a.icon)?z3:A3)(a)}},B3=aa.detect().browser.isFirefox(),C3={position:"absolute",left:"-9999px"},RD=function(a,b){var c=r.fromTag("span",a.dom());S.presentation(c);a=r.fromText(b,a.dom());y.append(c,a);return c},SD=function(a,b){var c=Ha("ephox-echo-voice");m.set(b,"id",c);m.set(a,"aria-describedby",c)},TD=function(a,b,c){var d=A.owner(b),e=RD(d,c);B3&&SD(b,e);m.setAll(e,a(c));v.setAll(e,C3);y.append(b,e);setTimeout(function(){m.remove(e,"aria-live");G.remove(e)},1E3)},D3=u(TD,function(a){return{"aria-live":"polite",
"aria-atomic":"true","aria-label":a}}),E3=u(TD,k({"aria-live":"assertive","aria-atomic":"true",role:"alert"})),ib={describe:function(a,b){var c=A.owner(a);b=RD(c,b);v.set(b,"display","none");S.hidden(b,!0);SD(a,b);return b},speak:D3,shout:E3,tokenSelector:function(){return'span[id^="ephox-echo-voice"]'}},FT=r.fromDom(document),ly=va.resolve("label-default"),Ws=r.fromDom(document),F3="data-"+re.resolve("item-value"),G3=function(a){a=zb.submenu(Ws,a+"-menu",[]);n.remove(a,"ephox-gopher-main-menu");
n.add(a,"ephox-gopher-submenu");return a},H3=function(a,b){b=m.get(b,"data-ephox-gopher-menu-value");var c={};c[a.name+"-menu-trigger"]=b;return c},I3=function(a,b){var c=G3(b.name);S.menu(c,a(b.textkey,!1));var d=H3(b,c),e=ET(a,b),f=function(d){d=ia(d,function(c){var d=E(c.items(),function(c){c=Zl.generateItem(Ws,c,b.render,a);S.menuItemCheckbox(c);return c});return c.label().fold(k(d),function(b){return[Zl.generateSeparator(Ws,b,a)].concat(d)})});G.empty(c);P.append(c,d)},h=H.create({done:p([]),
abort:p(["item"])}),l={};z(b.values,function(a){l[a.value()]=function(a){a=m.get(a,F3);b.action(a);h.trigger.done()}});e.events.populate.bind(function(a){f(a.items())});return{items:k([e.element()]),structure:k(d),submenus:k([c]),refreshMenu:function(){b.updateDropdown(He.dropdown({enable:e.enable,disable:e.disable,select:e.select,clear:e.clear,selectElement:e.selectElement,populate:e.populate,tick:u(Gh.tick,c),untick:u(Gh.untick,c),activate:t,deactivate:t}))},destroyer:function(){e.destroy()},handlers:k(l),
events:h.registry}},J3=r.fromDom(document),K3=function(a,b){a=a(b.textkey);var c=(!0===b.hasDialog?zb.ellipsisItem:zb.item)(J3,b.value,a),d=Eh.control(c),e=!0===b.toggle?Eh.selected(c):{select:t,deselect:t,selected:k(!1)};!0===b.toggle?S.menuItemCheckbox(c):S.menuItem(c,g.some(a),g.some(!1));var f=function(){b.updateGeneral(He.general({disable:d.disable,enable:d.enable,select:e.select,deselect:e.deselect,selected:e.selected,element:k(c)}))},h=H.create({done:p([]),abort:p(["item"])});a={};a[b.value]=
function(){h.trigger.done();b.action();f()};var l=oj.generateFrom(b);P.prepend(c,l);return{items:k([c]),structure:k({}),submenus:k([]),refreshMenu:f,handlers:k(a),destroyer:ca,events:h.registry}},L3=r.fromDom(document),M3=function(a){return{submenu:function(b){var c=b.textkey();b=b.element();S.menu(b,a(c));n.remove(b,"ephox-gopher-main-menu");n.add(b,"ephox-gopher-submenu");return b},item:function(b){var c=b.textkey();c=a(c);b=zb.item(L3,b.name()+"-menu-trigger",c);n.add(b,va.resolve("menu-more"));
S.menuItem(b,g.some(c),g.some(!0));return b}}},N3=function(a,b,c){c=M3(a);a=c.submenu(b);var d=m.get(a,"data-ephox-gopher-menu-value");c=c.item(b);var e={};e[b.name()+"-menu-trigger"]=d;d=ua(e,b.structure());var f=oj.generate("ephox-chameleon-"+b.name());P.prepend(c,f);b.icon().each(function(a){0<f.length&&Bn.setUrl(f[0],a)});var h=Eh.control(c);e=void 0!==b.destroyer?b.destroyer:void 0!==b.destroy?b.destroy:t;return{items:k([c]),structure:k(d),submenus:k([a].concat(b.submenus())),refreshMenu:function(){b.updateMenu({enable:h.enable,
disable:h.disable})},destroyer:e,handlers:b.handlers,events:b.events}},Xs=r.fromDom(document),UD=va.resolve("menu-widget"),O3=function(a,b){b=zb.widgetSubmenu(Xs,b);y.append(b,a.element());ma.add(a.element(),[UD,"ephox-gopher-item"]);return b},P3=function(a,b,c){a=a(b.textkey());a=zb.item(Xs,c,a);n.add(a,va.resolve("menu-more"));c=oj.generate(va.resolve(c));P.prepend(a,c);return a},VD=function(a,b){var c=b.instance();b=c.name();var d=b+"-submenu",e=O3(c,d),f=P3(a,c,b);S.menu(e,a(c.menuTextkey()));
S.menuItem(f,g.some(a(c.textkey())),g.some(!0));var h=Eh.control(f);a={};a[b]=d;var l=H.create({done:Q([],c.events.done),abort:p(["item"])});c.events.abort.bind(function(){l.trigger.abort(f)});return{items:k([f]),structure:k(a),submenus:k([e]),refreshMenu:function(){c.updateWidget(He.widget({enable:h.enable,disable:h.disable,select:t,deselect:t,press:t,release:t}))},destroyer:c.destroy,handlers:k({}),events:l.registry}},Yl={widget:VD,inline:function(a,b){var c=b.instance();b=c.name();n.add(c.element(),
va.resolve("menu-inline-widget"));var d=r.fromTag("li");y.append(d,c.element());var e=zb.custom(Xs,b,d),f=Eh.control(e);S.menuItem(e,g.some(a(c.textkey())),g.some(!1));a={};a[b]=function(a){var b=Z.active().filter(function(b){return wd.ancestor(b,u(N.eq,a))});c.element().dom().click();b.each(Z.focus)};var h=H.create({done:Q([],c.events.done),abort:p(["item"])});c.events.abort.bind(function(){h.trigger.abort(e)});return{items:k([e]),structure:k({}),submenus:k([]),refreshMenu:function(){c.updateInlineWidget(He.widget({enable:f.enable,
disable:f.disable,select:t,deselect:t,press:t,release:t}))},destroyer:c.destroy,handlers:k(a),events:h.registry}},split:VD,styles:k(UD)},WD=va.resolve("keyfocus"),XD=function(a,b){var c=T.span();v.set(c,"display","none");n.add(c,WD);y.append(a,c);return K.bind(c,"click",function(a){b();a.kill()})},Of={onButton:function(a){return XD(a.element(),a.click)},custom:XD,trigger:function(a){var b="."+WD;a=Fa.is(a,b)?g.some(a):L.descendant(a,b);a.each(function(a){a.dom().click()});return a}},rj={menu:Aa(["focusActive"],
[])},ci=re.resolve("item-selected"),Ys=function(a,b){n.add(b,ci)},YD=function(a,b){n.remove(b,ci)},Kd={is:function(a){return n.has(a,ci)},none:function(a){var b=Ic.all(a);z(b,function(b){YD(a,b)})},selectAll:function(a,b){a=Ic.all(a);z(a,function(a){n.remove(a,ci)});z(b,function(a){n.add(a,ci)})},select:Ys,deselect:YD,selected:function(a){return L.descendant(a,"."+ci)},first:function(a){var b=Ic.all(a);return g.from(b[0]).map(function(b){Ys(a,b);return b})},last:function(a){var b=Ic.all(a);return g.from(b[b.length-
1]).map(function(b){Ys(a,b);return b})}},Q3=function(a,b){var c=Ic.all(a);return Va(c,function(a){return N.eq(b,a)}).map(function(a){return{index:k(a),all:k(c)}})},R3=function(a,b){return 0===b?a.length-1:b-1},S3=function(a,b){return b===a.length-1?0:b+1},ZD=function(a,b,c){return Q3(a,b).map(function(d){var e=c(d.all(),d.index());d=d.all()[e];Kd.deselect(a,b);Kd.select(a,d);return d})},Jq={first:function(a){var b=Ic.all(a);return g.from(b[0]).map(function(b){Kd.select(a,b);return b})},prev:function(a,
b){return ZD(a,b,R3)},next:function(a,b){return ZD(a,b,S3)}},ac=function(a){return function(){return a}},R={BACKSPACE:ac([8]),TAB:ac([9]),ENTER:ac([13]),SHIFT:ac([16]),CTRL:ac([17]),ALT:ac([18]),CAPSLOCK:ac([20]),ESCAPE:ac([27]),SPACE:ac([32]),PAGEUP:ac([33]),PAGEDOWN:ac([34]),END:ac([35]),HOME:ac([36]),LEFT:ac([37]),UP:ac([38]),RIGHT:ac([39]),DOWN:ac([40]),INSERT:ac([45]),DEL:ac([46]),META:ac([91,93,224]),F10:ac([121])},ny={isCommand:function(a,b){var c=[];z(b,function(a){a="string"===typeof a?[a.toUpperCase().charCodeAt(0)]:
a;c=c.concat(a)});b=function(a){return 0<ka(c,function(b){return U(R[a](),b)}).length};if(!!a.altKey!==b("ALT")||!!a.shiftKey!==b("SHIFT")||!!a.ctrlKey!==b("CTRL")||!!a.metaKey!==b("META"))return!1;b=null!==a.charCode&&void 0!==a.charCode&&0!==a.charCode?String.fromCharCode(a.charCode).toUpperCase().charCodeAt(0):a.which;var d=R.CTRL().concat(R.ALT()).concat(R.SHIFT()).concat(R.META()),e=ka(c,function(a){return!U(d,a)});return 1<e.length?!1:0===e.length&&void 0===a.which||e[0]===b}},my={stop:function(a){a.preventDefault();
a.stopPropagation&&a.stopPropagation()}},T3={BACKSPACE:R.BACKSPACE,TAB:R.TAB,ENTER:R.ENTER,CAPSLOCK:R.CAPSLOCK,ESCAPE:R.ESCAPE,SPACE:R.SPACE,PAGEUP:R.PAGEUP,PAGEDOWN:R.PAGEDOWN,END:R.END,HOME:R.HOME,LEFT:R.LEFT,UP:R.UP,DOWN:R.DOWN,RIGHT:R.RIGHT,INSERT:R.INSERT,DEL:R.DEL},Kg={getSpecial:function(a){var b=null;Ma(T3,function(c,d){U(c(),a)&&(b=d)});return b},noModifiers:function(a){return!(a.metaKey||a.altKey||a.ctrlKey)},isCharCode:function(a){return a.charCode===a.keyCode}},$D=function(a,b){return qa(b,
function(b){return ny.isCommand(a,b)})},aE=function(a){return Kg.isCharCode(a)?g.none():g.from(Kg.getSpecial(a.keyCode))},IT={identify:function(a,b){return{fold:function(c,d,e){$D(a,b).fold(function(){aE(a).fold(function(){e(a.which&&String.fromCharCode(a.which))},function(a){d(R[a]())})},c)}}},shortcut:$D,special:aE},bE=function(a){return"rtl"===v.get(a,"direction")?"rtl":"ltr"},ae={onDirection:function(a,b){return function(c){return"rtl"===bE(c)?b:a}},getDirection:bE},cE=function(a,b,c,d){var e=
v.get(a,b);void 0===e&&(e="");c=e===c?d:c;e=u(v.set,a,b,e);a=u(v.set,a,b,c);return Cq(e,a,!1)},sc={toggler:function(a){return cE(a,"visibility","hidden","visible")},displayToggler:function(a,b){return cE(a,"display","none",b)},isVisible:function(a){a=a.dom();return!(0>=a.offsetWidth&&0>=a.offsetHeight)}},Jn=ta.generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]}]),yd={southeast:Jn.southeast,southwest:Jn.southwest,northeast:Jn.northeast,northwest:Jn.northwest,cata:function(a,b,c,d,
e){return a.fold(b,c,d,e)}},dE=function(a,b){return a.view(b).fold(k([]),function(b){var c=a.owner(b);c=dE(a,c);return[b].concat(c)})},U3={pathTo:function(a,b){a=b.owner(a);b=dE(b,a);return g.some(b)}},V3={view:function(a){return(a.dom()===document?g.none():g.from(a.dom().defaultView.frameElement)).map(r.fromDom)},owner:function(a){return A.owner(a)}},pk={find:function(a){var b=r.fromDom(document),c=Za.get(b);return U3.pathTo(a,V3).fold(u(bb.absolute,a),function(b){var d=bb.viewport(a);b=Eb(b,function(a,
b){b=bb.viewport(b);return{left:a.left+b.left(),top:a.top+b.top()}},{left:0,top:0});return Ra(b.left+d.left()+c.left(),b.top+d.top()+c.top())})}},Bf={absolute:function(a){var b=pk.find(a),c=Ia.getOuter(a);a=sa.getOuter(a);return gg(b.left(),b.top(),c,a)},view:function(){return gg(0,0,window.innerWidth,window.innerHeight)}},eE=function(a,b,c){var d=Ra(b,c);b=function(){var a=Za.get();return d.translate(-a.left(),-a.top())};return a.fold(k(d),b,b)},Zs={toBox:function(a,b){var c=pk.find(b);a=eE(a,c.left(),
c.top());c=Ia.getOuter(b);b=sa.getOuter(b);return gg(a.left(),a.top(),c,b)},viewport:function(a,b){return b.fold(function(){return a.fold(Bf.view,Bf.view,gg)},function(b){return a.fold(b,b,gg)})},translate:eE},W3=Aa("x y width height maxHeight direction classes label candidateYforTest".split(" "),[]),X3=O("position","left","top","right","bottom"),hh={decision:W3,css:X3},$s=ta.generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),fE=function(a,b,c,d,e,f){c=
b.x()-c;d=b.y()-d;var h=b.width(),l=b.height();e-=c+h;f-=d+l;var k=g.some(c),C=g.some(d),w=g.some(e),m=g.some(f),F=g.none();return yd.cata(b.direction(),function(){return hh.css(a,k,C,F,F)},function(){return hh.css(a,F,C,w,F)},function(){return hh.css(a,k,F,F,m)},function(){return hh.css(a,F,F,w,m)})},Ie={none:$s.none,relative:$s.relative,fixed:$s.fixed,reposition:function(a,b){return a.fold(function(){return hh.css("absolute",g.some(b.x()),g.some(b.y()),g.none(),g.none())},function(a,d,e,f){return fE("absolute",
b,a,d,e,f)},function(a,d,e,f){return fE("fixed",b,a,d,e,f)})},viewport:function(a,b){return Zs.viewport(a,b)},toBox:function(a,b){return Zs.toBox(a,b)},translate:function(a,b,c){return Zs.translate(a,b,c)},cata:function(a,b,c,d){return a.fold(b,c,d)}},gE=O("anchorBox","origin"),Lh={box:function(a,b){return gE(a,b)},element:function(a,b){a=Ie.toBox(b,a);return gE(a,b)},relativeOrigin:function(a){a=a.dom().getBoundingClientRect();return Ie.relative(a.left,a.top,a.width,a.height)}},qk={resolve:Lb.create("ephox-repartee").resolve},
hE=qk.resolve("caret-top-align"),iE=qk.resolve("caret-bottom-align"),jE=qk.resolve("caret-right-align"),kE=qk.resolve("caret-left-align"),lE=qk.resolve("caret-middle-align"),bc={east:k(kE),south:k(hE),west:k(jE),north:k(iE),middle:k(lE),all:k([hE,iE,kE,jE,lE])},Je=O("x","y","bubble","direction","anchors","label"),mE=function(a,b){return a.x()+a.width()-b.width()/2},nE=function(a,b){return a.x()+a.width()-b.width()},at=function(a,b){return a.y()-b.height()},bt=function(a){return a.y()+a.height()},
ct=function(a,b,c){return Je(a.x(),bt(a),c.southeast(),yd.southeast(),[bc.south(),bc.east()],"layout-se")},dt=function(a,b,c){return Je(nE(a,b),bt(a),c.southwest(),yd.southwest(),[bc.south(),bc.west()],"layout-sw")},et=function(a,b,c){return Je(a.x(),at(a,b),c.northeast(),yd.northeast(),[bc.north(),bc.east()],"layout-ne")},ft=function(a,b,c){return Je(nE(a,b),at(a,b),c.northwest(),yd.northwest(),[bc.north(),bc.west()],"layout-nw")},gt=function(a,b,c){return Je(mE(a,b),at(a,b),c.northeast(),yd.northeast(),
[bc.north(),bc.middle()],"layout-nm")},ht=function(a,b,c){return Je(mE(a,b),bt(a),c.southeast(),yd.southeast(),[bc.south(),bc.middle()],"layout-sm")},Qh={southeast:ct,northeast:et,southwest:dt,northwest:ft,southmiddle:ht,northmiddle:gt,all:function(){return[ct,dt,et,ft,ht,gt]},allRtl:function(){return[dt,ct,ft,et,ht,gt]}},oE=function(a){return a.x()+a.width()},pE=function(a,b){return a.y()-b.height()+a.height()},it=function(a,b,c){return Je(oE(a),a.y(),c.southeast(),yd.southeast(),[bc.south(),bc.east()],
"link-layout-se")},jt=function(a,b,c){b=a.x()-b.width();return Je(b,a.y(),c.southwest(),yd.southwest(),[bc.south(),bc.west()],"link-layout-sw")},kt=function(a,b,c){return Je(oE(a),pE(a,b),c.northeast(),yd.northeast(),[bc.north(),bc.east()],"link-layout-ne")},lt=function(a,b,c){var d=a.x()-b.width();return Je(d,pE(a,b),c.northwest(),yd.northwest(),[bc.north(),bc.west()],"link-layout-nw")},Y3={southeast:it,northeast:kt,southwest:jt,northwest:lt,all:function(){return[it,jt,kt,lt]},allRtl:function(){return[jt,
it,lt,kt]}},cf={anchored:k(function(a,b){sa.setMax(a,Math.floor(b));v.setAll(a,{"overflow-x":"hidden","overflow-y":"auto"})}),expandable:k(function(a,b){sa.setMax(a,Math.floor(b))})},ih=ta.generate([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),Z3=function(a,b,c,d){var e=a.x(),f=a.y(),h=a.bubble().left(),l=a.bubble().top(),g=d.x(),C=d.y(),w=d.width(),m=d.height();h=e+h;e=f+l;var F=h>=g,n=e>=C;f=F&&n;l=h+b<=g+w&&e+c<=C+m;g=F?Math.min(b,g+w-h):Math.abs(g-(h+b));w=n?Math.min(c,C+m-
e):Math.abs(C-(e+c));b=d.width()-b;b=Math.min(Math.max(0,h),b);c=n?e:e+(c-w);d=k(c+w-C);C=k(C+m-c);C=yd.cata(a.direction(),C,C,d,d);a=hh.decision({x:b,y:c,width:g,height:w,maxHeight:C,direction:a.direction(),classes:a.anchors(),label:a.label(),candidateYforTest:e});return f&&l?ih.fit(a):ih.nofit(a,g,w)},$3={attempts:function(a,b,c,d,e){var f=c.width(),h=c.height(),l=function(a,l,g,k){a=a(b,c,d);return Z3(a,f,h,e).fold(ih.fit,function(a,b,c){return b>g||c>k?ih.nofit(a,b,c):ih.nofit(l,g,k)})};return hb(a,
function(a,b){b=u(l,b);return a.fold(ih.fit,b)},ih.nofit(hh.decision({x:b.x(),y:b.y(),width:c.width(),height:c.height(),maxHeight:c.height(),direction:yd.southeast(),classes:[],label:"none",candidateYforTest:b.y()}),-1,-1)).fold(ca,ca)}},a4={measure:function(a){var b=r.fromTag("div");v.setAll(b,{position:"fixed",opacity:"0",top:"0",left:"0",bottom:"0",right:"0"});y.prepend(a,b);a=bb.viewport(b);var c=Ia.get(b),d=sa.get(b);G.remove(b);return{top:a.top,left:a.left,width:k(c),height:k(d)}}},Kn={layout:function(a,
b,c,d){v.remove(b,"max-height");b={width:k(Ia.getOuter(b)),height:k(sa.getOuter(b))};return $3.attempts(d.preference(),a,b,c,d.bounds())},setClasses:function(a,b){ma.remove(a,bc.all());ma.add(a,b.classes())},setHeight:function(a,b,c){c.maxHeightFunction()(a,b.maxHeight())},position:function(a,b,c){var d=function(a){return a+"px"};c=c.origin();var e=k(c);c=c.fold(e,e,function(){var b=a4.measure(a);return Ie.fixed(b.left(),b.top(),b.width(),b.height())});b=Ie.reposition(c,b,a);v.setOptions(a,{position:g.some(b.position()),
left:b.left().map(d),top:b.top().map(d),right:b.right().map(d),bottom:b.bottom().map(d)})}},qE=Aa(["bounds","origin","preference","maxHeightFunction"],[]),rk=function(a,b,c){return void 0===a[b]?c:a[b]},rE=function(a,b,c,d){a=Kn.layout(a,b,c,d);Kn.position(b,a,d);Kn.setClasses(b,a);Kn.setHeight(b,a,d)},Mm={simple:function(a,b,c,d,e){var f=rk(e,"maxHeightFunction",cf.anchored());e=a.anchorBox();a=a.origin();d=qE({bounds:Ie.viewport(a,g.none()),origin:a,preference:d,maxHeightFunction:f});rE(e,b,c,d)},
detailed:function(a,b,c,d){d=void 0!==d?d:{};d=qE({bounds:rk(d,"bounds",Bf.view()),origin:rk(d,"origin",Ie.none()),preference:rk(d,"preference",Qh.all()),maxHeightFunction:rk(d,"maxHeightFunction",cf.anchored())});rE(a,b,c,d)}},b4=function(a,b,c,d,e,f,h){return function(a){var l=Ie.none();var k=Ie.viewport(l,g.some(b));var w=Ie.toBox(l,c());k={bounds:k,origin:l,preference:e.isRtl()?f.allRtl():f.all(),maxHeightFunction:h};a=a.panel();Mm.detailed(w,a,d,k)}},c4=function(a,b,c,d,e,f,h){return function(b){var l=
e.isRtl()?f.allRtl():f.all(),g={maxHeightFunction:h},k=Lh.element(c(),Lh.relativeOrigin(a()));b=b.panel();Mm.simple(k,b,d,l,g)}},sE=aa.detect().deviceType.isiOS()?b4:c4,Lg={main:function(a,b,c,d,e,f){a=sE(a,b,c,d,e,Qh,f);return{recalculate:a,isAnchored:Jb,place:a}},submenu:function(a,b,c,d,e){a=sE(a,b,c,Fh(3,-2),d,Y3,e);return{recalculate:a,isAnchored:Jb,place:a}}},tE=function(a){return function(b){return b.key()===a}},d4=O("key","value"),Wl={put:function(a,b,c,d,e){var f=void 0!==d?d:d4,h=void 0!==
e?e:tE(b);a=hb(a,function(a,d){var e=h(d)?f(b,c):d;return{updated:h(d)||a.updated,acc:a.acc.concat([e])}},{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([f(b,c)])},get:function(a,b,c){b=void 0!==c?c:tE(b);return qa(a,b)}},OT={triage:function(a){a=Eb(a,function(a,c){var b=ja.inBody(c.menu());return{keep:b?[c].concat(a.keep):a.keep,throwaway:!1===b?[c].concat(a.throwaway):a.throwaway}},{throwaway:[],keep:[]});z(a.throwaway,function(a){a.popup().destroy()});return a.keep}},uE=function(a,b){return wd.ancestor(a,
u(N.eq,b))},LT={ancestor:uE,anyAncestor:function(a,b){return Xa(b,function(b){return uE(a,b)})},sibling:function(a,b){return wd.sibling(a,u(N.eq,b))},child:function(a,b){return wd.child(a,u(N.eq,b))},descendant:function(a,b){return wd.descendant(a,u(N.eq,b))}},NT={create:function(a,b){var c=H.create({open:p([]),close:p([]),uistale:p([])});if(void 0===a)throw"uicontainer not specified";var d=MT({layerClass:va.resolve("layer-menus"),container:a()}),e=T.div();n.add(e,va.resolve("popup-container"));d.content(e);
var f=!1,h=function(){f&&(g.off(),d.hide(),f=!1,k.control.block(),c.trigger.close())},l=[e],g=oy(function(a){!1===!f&&(h(),L.ancestor(a,"."+b).fold(function(){Z.focus(a)},t))},function(){return l}),k=Hd.tap(function(){c.trigger.uistale()});k.control.block();return{element:function(){return e},panel:d.element,destroy:function(){d.hide();d.destroy();g.off()},open:function(){f||(k.control.unblock(),v.set(d.element(),"opacity","0"),d.show(),v.reflow(d.element()),g.on(),f=!0,c.trigger.open(),v.set(d.element(),
"opacity","1"))},close:h,closed:function(){return!f},mousedown:function(a){g.mousedown(a.original())},uiStale:function(){k.instance()},setContent:function(a){y.append(e,a)},setComponents:function(a){l=a.concat([e])},events:c.registry}}},py=O("menu","popup"),Xl=function(a){return function(b){return N.eq(b.menu(),a)}},RT=aa.detect().deviceType.isiOS,e4=function(a,b,c,d,e){var f=QT(a,b,e.name,e.textkey,e.menuTextkey,e.render,e.layout,c,e.toggle,d);a=function(){e.updateDropdown(He.dropdown({enable:f.enable,
disable:f.disable,select:f.select,clear:f.clear,selectElement:f.selectElement,populate:f.populate,tick:f.tick,untick:f.untick,activate:f.activate,deactivate:f.deactivate}))};var h=Of.onButton(f);f.events.select.bind(function(a){e.action(a.value());f.close()});var l=H.create({select:Q(["value","item"],f.events.select),itemHover:Q(["item"],f.events.itemHover),escaped:Q([],f.events.escaped),open:Q(["menu","popup","anchor"],f.events.open),close:Q([],f.events.close)});a();m.set(f.element(),"tabindex",
"-1");return{dropdown:function(){return{events:l.registry,close:f.close,uiStale:f.uiStale,enable:f.enable,disable:f.disable,list:f.list,menu:f.menu,recalculate:f.recalculate}},component:f.element,refreshUi:a,destroy:function(){h.unbind();f.destroy()}}},f4=function(a,b){b=Ng.typical(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(b,a);return b},g4=function(a,b){b=Ng.toggle(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(b,a);a.selected&&b.select();
return b},h4=function(a,b){var c=!0===b.hasPopup,d=(!0===b.toggle?g4:f4)(b,a);xa(b.icon)&&Bn.findAndSetUrl(d.element(),b.icon);var e=d.initAria(d,a(b.textkey),c,b.toggle);m.set(d.element(),"tabindex","-1");var f=function(){!0===b.toggle&&ra.pressed(d)},h=Of.onButton(d);d.events.click.bind(function(){f()});var l=!0===b.toggle?d.select:t,g=!0===b.toggle?d.deselect:t,C=!0===b.toggle?d.selected:k(!1);f();var w=H.create({click:Q([],d.events.click)});return{generals:function(){return{events:w.registry,
enableButton:d.enable,disableButton:d.disable}},component:d.element,refreshUi:function(){b.updateGeneral(He.general({disable:e.disable,enable:e.enable,select:l,deselect:g,selected:C,element:d.element}));f()},destroy:function(){h.unbind();d.destroy();e.destroy()}}},i4=aa.detect().deviceType.isiOS,j4=function(a,b,c,d,e,f){var h=e.button(),l=Of.onButton(h),g=Kq(a.uiContainer,e.name,rj.menu({focusActive:!0}));m.set(h.element(),"tabindex","-1");var k=T.div();n.add(k,va.resolve("menu-system-main"));var w=
qj(g.sandbox,a.bounds,b,[h.element()],d),I=w.initMenu(k);c=Vl();var F=Lg.main(a.uiContainer,a.bounds,h.element,c,b.uiDirection(),cf.anchored()),r=function(){F.recalculate(I)},t=function(){var a=A.children(g.sandbox());z(a,function(a){v.set(a,"display","none")})},u=function(a){g.update(a.structure());G.empty(k);y.append(k,a.element());a=w.registerMenus(a.submenus());a=E(a,function(a){return a.panel()});G.empty(g.sandbox());P.append(g.sandbox(),[I.panel()].concat(a));t()},x=function(a){e.init(a)},B=
H.create({open:p(["menu","popup","anchor"]),close:Q([],g.events.close),itemAction:Q(["value","item"],g.events.itemAction),itemHover:Q(["item"],g.events.itemHover),reveal:p(["menu","trigger","popup","anchor"]),collapse:Q(["menu","item"],g.events.collapse),escaped:Q([],g.events.escaped)});h.events.click.bind(function(){return(h.selected()?I.open:I.close)()});e.events.done.bind(function(){g.close()});e.events.abort.bind(function(a){g.select(a.item());Z.focus(a.item())});I.events.uistale.bind(function(){g.getActiveMenu().bind(function(a){x(a)})});
I.events.close.bind(function(){g.close();ra.collapsed(h.element())});I.events.open.bind(function(){var a=void 0!==f?f:[];a=[g.sandbox()].concat(a);u(e);x(e);v.set(I.panel(),"display","block");v.set(k,"display","block");g.open(a,k);ra.expanded(h.element())});g.events.open.bind(function(){B.trigger.open(e.element(),I,F);i4()||g.setActiveMenu(e.element())});g.events.close.bind(function(){w.hideAll();h.deselect()});g.events.itemAction.bind(function(a){var b=e.handlers();if(void 0!==b[a.value()])(0,b[a.value()])(a.item())});
g.events.reveal.bind(function(a){ra.expanded(a.trigger());var b=w.expandMenu(a.menu(),a.trigger(),I);B.trigger.reveal(a.menu(),a.trigger(),b.popup,b.anchorage)});g.events.collapse.bind(function(a){w.hideMenu(a.menu());a.item().each(ra.collapsed)});return{menus:function(){return{events:B.registry,enable:e.enable,disable:e.disable,close:I.close,uiStale:I.uiStale,mousedown:I.mousedown,contentFocus:e.contentFocus,menu:I.element,refreshMenus:x,recalculate:r}},component:h.element,refreshUi:function(){e.updateMenu({enable:e.enable,
disable:e.disable})},destroy:function(){l.unbind();g.destroy();e.destroy();I.destroy()}}},k4=function(a,b){var c=T.span();n.add(c,va.resolve("palette-group"));var d=u(ib.speak,ja.body()),e=function(a){var b=mj.isShowing(c);mj.hide(c);b&&a.each(d);return b},f=He.palette({show:function(a){var b=mj.isHiding(c);mj.show(c);b&&a.each(d);return b},hide:e});e(g.none());P.append(c,E(b,function(a){return a.component()}));return{component:k(c),destroy:function(){z(b,function(a){a.destroy()})},refreshUi:function(){z(b,
function(a){a.refreshUi()});a.updatePalette(f)}}},l4=function(a,b,c,d,e){var f=e.instance();e=r.fromDom(document);var h=(f.toggle?Ng.splitToggle:Ng.split)(f.name(),f.name(),ca,f.textkey(),f.label(),f.tooltip,c),l=Of.custom(h.element(),function(){h.open();f.enter()});m.set(h.element(),"tabindex","-1");var g=h.initAria(h,c(f.textkey()),!0,f.toggle);d=qj(a.uiContainer,a.bounds,b,[h.element()],d);var k=Vl(),w=zb.widget(e,f.name());e=Ha("menu-control");m.set(w,"id",e);S.controls(h.element(),e);S.owns(h.element(),
e);S.menu(w,c(f.menuTextkey()));y.append(w,f.element());var I=d.initMenu(w),F=Lg.main(a.uiContainer,a.bounds,h.element,k,b.uiDirection(),cf.expandable()),n=function(){F.recalculate(I)};I.events.open.bind(function(){ra.expanded(h.element());f.open();t.trigger.open(w,I,F)});I.events.close.bind(function(){ra.collapsed(h.element());f.close();h.close()});f.events.done.bind(function(){I.close();h.close()});f.events.abort.bind(function(){I.close();h.close();t.trigger.abort()});h.events.open.bind(function(){I.open();
F.recalculate(I)});h.events.close.bind(function(){f.close();I.close()});h.events.click.bind(function(){f.action()});var t=H.create({abort:p([]),close:Q([],f.events.close),open:p(["menu","popup","anchor"])});return{widgets:function(){return{events:t.registry,open:h.open,isOpen:h.isOpen,close:h.close,recalculate:n}},component:h.element,refreshUi:function(){f.updateWidget(He.widget({select:h.select,deselect:h.deselect,enable:h.enable,disable:h.disable,press:g.press,release:g.release}))},destroy:function(){l.unbind();
g.destroy();I.destroy();f.destroy();h.destroy()}}},m4=function(a,b,c,d,e){var f=e.instance(),h=Ng.toggle(f.name(),f.name(),ca,f.textkey(),f.label(),f.tooltip,c),l=Of.onButton(h),g=h.initAria(h,c(f.textkey()),!0,!0);c=qj(a.uiContainer,a.bounds,b,[h.element()],d);d=Vl();var k=c.initMenu(f.element()),w=Lg.main(a.uiContainer,a.bounds,h.element,d,b.uiDirection(),cf.expandable());m.set(h.element(),"tabindex","-1");n.add(k.element(),va.resolve("toolbar-widget"));var I=function(){w.recalculate(k)};k.events.open.bind(function(){ra.expanded(h.element());
f.open();F.trigger.open(f.element(),k,w)});k.events.close.bind(function(){ra.collapsed(h.element());f.close()});f.events.done.bind(function(){k.close();h.deselect()});f.events.abort.bind(function(){k.close();h.deselect();F.trigger.abort()});h.events.click.bind(function(){h.selected()?(k.open(),w.recalculate(k)):k.close();ra.pressed(h)});var F=H.create({abort:p([]),open:p(["menu","popup","anchor"])}),r=function(){h.deselect();k.close()};return{widgets:function(){return{events:F.registry,close:r,recalculate:I}},
component:h.element,refreshUi:function(){f.updateWidget(He.widget({select:t,deselect:t,enable:g.enable,disable:g.disable,press:t,release:t}))},destroy:function(){l.unbind();g.destroy();k.destroy();f.destroy();h.destroy()}}},n4=function(a,b){var c=b.instance(),d=Of.custom(c.element(),function(){c.element().dom().click()});m.remove(c.element(),"tabindex");n.add(c.element(),va.resolve("toolbar-inline-widget"));S.toolbarButton(c.element(),a(c.textkey()),!1);var e=H.create({abort:p([]),open:p(["menu",
"popup","anchor"])});return{widgets:function(){return{events:e.registry,recalculate:t,close:t}},component:c.element,refreshUi:function(){c.updateInlineWidget(He.widget({select:t,deselect:t,enable:u(ra.enable,c.element()),disable:u(ra.disable,c.element()),press:t,release:t}))},destroy:function(){d.unbind();c.destroy()}}},sy={menu:function(a){return{general:u(K3,a),menu:u(N3,a),dropdown:u(I3,a),widget:u(Yl.widget,a),"split-widget":u(Yl.split,a),"inline-widget":u(Yl.inline,a),palette:yb("No palettes for menus yet")}},
toolbar:function(a,b,c,d){var e=function(e){return u(e,a,b,c,d)};return{menu:e(j4),dropdown:e(e4),widget:e(m4),"split-widget":e(l4),"inline-widget":u(n4,c),general:u(h4,c),palette:k4}}},vE=ta.generate([{toolbar:[]},{menu:[]}]),Mq={toolbar:vE.toolbar,menu:vE.menu,cata:function(a,b,c){return a.fold(b,c)}},o4=function(a,b,c,d){a.events.escaped.bind(function(a){c.focused()&&Z.focus(d.component())});a.events.close.bind(function(a){b.focus()})},p4=function(a,b,c,d){a.events.open.bind(function(a){Vc.register(a.popup().panel())})},
VT={init:function(a,b,c,d,e,f,h,l,g){var k=a.dropdown(g),q=k.dropdown();a=c.toolbar;(aa.detect().deviceType.isTouch()?p4:o4)(q,e,a,k);var m=!1;q.events.open.bind(function(a){e.toReading();h.show(a.popup(),a.anchor());m=!0});q.events.close.bind(function(){m=!1});q.events.escaped.bind(function(){Z.focus(k.component())});e.events.mousedown.bind(function(){m&&q.close()});e.events.uiStale.bind(q.uiStale);c.toolbar.events.transitionend.bind(function(a){U(["top","height"],a.property())&&q.recalculate()});
return{component:k.component,refreshUi:k.refreshUi,destroy:k.destroy}}},UT={init:function(a,b,c,d,e,f,h,l,g){a=a.general(g);b=a.generals();a.refreshUi();return{generals:b,component:a.component,refreshUi:a.refreshUi,destroy:a.destroy}}},wE=function(a){var b=g.none(),c=function(){b=g.none()};return{begin:function(){b=g.from(Za.capture(a))},end:function(){b.each(function(a){a.restore()});c()},destroy:c}},Qm={fromSafe:function(a){return wE(a.doc())},fromUnsafe:function(a){a=a.doc().getOrDie();return wE(a)}},
WT={init:function(a,b,c,d,e,f,h,l,k){var q=a.menu(k,[]),w=q.menus(),m=Qm.fromUnsafe(e);w.events.open.bind(function(a){e.toReading();w.refreshMenus(a.menu());h.show(a.popup(),a.anchor())});w.events.close.bind(function(){e.focus();m.end()});w.events.escaped.bind(function(){Z.focus(q.component())});w.events.reveal.bind(function(a){k.init(a.menu());h.show(a.popup(),a.anchor())});w.events.itemAction.bind(function(a){m.end()});w.events.itemHover.bind(function(a){m.begin();if(null!==document.activeElement&&
void 0!==document.activeElement){var b=r.fromDom(document.activeElement),c=A.owner(a.item());"input"!==D.name(b)&&Vc.preserve(c,u(Z.focusInside,a.item()))}else e.backupSelection(),Z.focus(a.item())});e.events.mousedown.bind(w.mousedown);e.events.uiStale.bind(w.uiStale);e.events.focus.bind(w.enable);var F=!e.isInline()&&k.contentFocus();F&&w.disable();return{component:q.component,refreshUi:function(){q.refreshUi();var a=F?g.none():g.some(!0);e.getSelection().or(a).fold(w.disable,w.enable)},destroy:function(){m.destroy();
e.events.mousedown.unbind(w.mousedown);e.events.uiStale.unbind(w.update);q.destroy()}}}},mt=function(a,b,c,d,e,f,h,l,g,k,w){var q=c[b]({instance:a(w.instance)});a=q.widgets();e=e.toolbar;a.events.open.bind(function(a){h.toReading();g.show(a.popup(),a.anchor())});a.events.abort.bind(function(){Z.focus(q.component())});h.events.mousedown.bind(a.close);return(aa.detect().deviceType.isTouch()&&"split-widget"===b?q4:r4)(a,h,e,q)},r4=function(a,b,c,d){return d},q4=function(a,b,c,d){var e=K.capture(d.component(),
"click",function(b){b.kill();n.add(d.component(),lb.resolve("statebutton-selected"));a.isOpen()?a.close():a.open()});a.events.close.bind(function(){n.remove(d.component(),lb.resolve("statebutton-selected"))});return{widgets:d.widgets,component:d.component,refreshUi:d.refreshUi,destroy:function(){e.unbind();d.destroy()}}},Nq={widget:u(mt,ca,"widget"),inlineWidget:u(mt,function(a){return function(){return a(Mq.toolbar())}},"inline-widget"),splitWidget:u(mt,ca,"split-widget")},s4=B.resolve("editor-container"),
Mg={editorContainer:k(s4)},Ln=O("key","link"),xE=O("url","text"),yE=function(a,b,c){return function(d){var e=xE(b,x.translate(c));return Ln(x.pkey(a,d),g.some(e))}},oc=function(a){return function(b){return Ln(x.pkey(a,b),g.none())}},nt=function(a){return function(b){var c=a(b);b=xE(b[0].websiteUrl,x.translate("cloud.dashboard"));return Ln(c.key(),g.some(b))}},t4={"no.api.key":nt(oc("cloud.error.apikey")),"domain.not.supported":nt(function(a){return Ln(x.pkey("cloud.error.domain",[a[0].details.domain]),
g.none())}),"plan.exceeded":nt(oc("cloud.error.plan")),"error.code.invalid.toolbar":oc("errors.toolbar.invalid"),"error.code.spelling.not.found":oc("errors.spelling.missing.service"),"error.code.images.not.found":oc("errors.images.missing.service"),"safari.imagepaste":yE("errors.safari.image","https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work","errors.safari.url"),"webview.imagepaste":oc("errors.webview.image"),"flash.clipboard.no.rtf":function(a){return(aa.detect().browser.isSafari()?
yE("errors.safari.browser-settings","https://support.ephox.com/entries/59328357-Safari-6-1-and-7-Flash-Sandboxing","errors.safari.rtf"):oc("errors.images.missing.flash"))(a)},"fileupload.invalidimages":oc("errors.images.upload.invalid"),"error.imageupload":oc("errors.images.upload.failed"),"error.imageupload.generic":oc("errors.images.upload.unknown"),"error.imageupload.cors":oc("errors.images.upload.cors"),"errors.paste.word.notready":oc("errors.paste.notready"),"errors.paste.process.failure":oc("errors.paste.generic"),
"flash.crashed":oc("errors.flash.crashed"),"errors.imageimport.failed":oc("errors.images.import.failed"),"errors.imageimport.unsupported":oc("errors.images.import.unsupported"),"errors.imageimport.invalid":oc("errors.images.import.invalid"),"imageedit.needsproxy":oc("errors.images.edit.needsproxy"),"imageedit.proxyerror":oc("errors.images.edit.proxyerror"),"imageedit.generic":oc("errors.images.edit.generic")},u4={"errors.local.images.disallowed":"Removing pasted images from content. Local image insert has been disabled.",
"errors.dragdrop.images.disallowed":"Blocking image drop operation. Local image insert has been disabled."},zE=function(a,b){a=(0,t4[a])(b);return{description:k(x.get(a.key())),link:k(a.link().getOr(null))}},mf={get:zE,getOrLog:function(a,b){return g.from(u4[a]).fold(function(){var c=zE(a,b);return g.some(c)},function(a){console.warn(a);return g.none()})}},v4=function(a,b){var c=function(b){var c=mf.get("error.code.invalid.toolbar",[b.small()]);c=nj(c);a.displayBanner(c);z(b.big(),function(a){console.error(a)})};
return b.fold(function(a){c(a);return[]},ca)},AE={setup:function(a,b,c,d,e,f){f=v4(a,f);var h=function(a){a=xa(a)?x.has(a)?x.key(a):x.raw(a):a;return x.get(a)};n.add(a.toolbar.element(),B.resolve("layer-above-editor"));b=ND.blueprints(TT(e.uiContainer,a,b,c,d,e,h),ST(h));e=ND.env(e.uiContainer,h);e=r3.build(f,b,e);z(e,a.toolbar.add);a.position();z(e,function(a){c.events.uiStale.bind(function(){a.refreshUi()})})}},Hh={preserve:function(a,b){var c=A.owner(b),d=Z.active(c).bind(function(a){var c=function(b){return N.eq(a,
b)};return c(b)?g.some(b):Ja.descendant(b,c)});a=a(b);d.each(function(a){Z.active(c).filter(function(b){return N.eq(b,a)}).isNone()&&Z.focus(a)});return a}},uy=O("component","index"),bU={item:k('.ephox-chameleon-toolbar-group [tabindex="-1"]'),group:k(".ephox-chameleon-toolbar-group"),sector:k(".ephox-chameleon-toolstrip > *")},BE=va.resolve("toolbar-more-closed"),CE=va.resolve("toolbar-more-open"),yy=va.resolve("toolbar-more-hide"),xy=va.resolve("toolbar-more-show"),Qq=function(a,b){v.set(a,"height",
b+"px");v.reflow(a)},Pq=function(a){n.remove(a,CE);n.add(a,BE);Qq(a,0)},zy=function(a){n.remove(a,BE);n.add(a,CE);v.remove(a,"height")},ot=O("within","extra","withinWidth"),DE=function(a,b,c){var d=Rd.generate(a,function(a,b){var d=c(a);return g.some({element:k(a),start:k(b),finish:k(b+d),width:k(d)})});a=ka(d,function(a){return a.finish()<b});var e=Eb(a,function(a,b){return a+b.width()},0);d=d.slice(a.length);return{within:k(a),extra:k(d),withinWidth:k(e)}},Mn=function(a){return E(a,function(a){return a.element()})},
w4=function(a,b,c){a=Mn(a.concat(b));return ot(a,[],c)},x4=function(a,b,c,d){a=Mn(a).concat([c]);return ot(a,Mn(b),d)},y4=function(a,b,c){return ot(Mn(a),[],c)},z4=function(a,b,c){a=DE(b,a,c);return 0===a.extra().length?g.some(a):g.none()},$T={partition:function(a,b,c,d){var e=z4(a,b,c).getOrThunk(function(){return DE(b,a-c(d),c)}),f=e.within(),h=e.extra();e=e.withinWidth();return 1===h.length&&h[0].width()<=c(d)?w4(f,h,e):1<=h.length?x4(f,h,d,e):y4(f,h,e)}},Ba={grid:Aa(["trigger"],["isValid","first"]),
flow:Aa(["trigger"],["first","executeOnArrow"]),sectors:Aa(["trigger","first"],[]),radio:Aa(["one"],[]),input:Aa([],["execute"]),button:Aa(["execute"],["process"]),dialog:Aa(["execute","ok","cancel"],["index"]),inlineDialog:Aa(["ok","cancel"],["index"]),page:Aa(["trigger"],["first"]),tabular:Aa(["trigger"],["first","isValid"]),dynamic:Aa([],["execute"])},gd=eh(fh,["enter","exit","destroy"]),EE=function(a){return function(b){return b.raw().which===a}},ea={inSet:function(a){return function(b){return U(a,
b.raw().which)}},and:function(a){return function(b){return ob(a,function(a){return a(b)})}},is:EE,isShift:function(a){return!0===a.raw().shiftKey},basic:function(a,b){return{matches:EE(a),run:b}},rule:function(a,b){return{matches:a,run:b}}},pt=function(a){m.has(a,"tabIndex")||m.set(a,"tabIndex","-1")},fb={set:function(a){pt(a);Z.focus(a)},find:function(a){return Z.search(a)},isFocused:Z.hasFocus,mark:pt,markSelectors:function(a,b){z(b,function(b){b=Y.descendants(a,b);z(b,pt)})}},Ke={adjust:function(a,
b,c,d){a+=b;return a>d?c:a<c?d:a},findPrev:function(a,b,c){var d=kd(a.slice(0,b));a=kd(a.slice(b+1));return qa(d.concat(a),c)},findNext:function(a,b,c){var d=a.slice(0,b);a=a.slice(b+1);return qa(a.concat(d),c)}},FE=function(a){return qa(a,Nn)},Nn=function(a){return sc.isVisible(a.element())&&a.isEnabled()&&"hidden"!==v.get(a.element(),"visibility")},ya={exit:function(a){z(a,function(a){a.clear();a.exit()})},clear:function(a){z(a,function(a){a.clear()})},refresh:function(a){z(a,function(a){a.refresh()})},
first:FE,enterFirst:function(a,b){b.index().bind(function(b){return g.from(a[b]).filter(Nn)}).orThunk(function(){return FE(a)}).each(function(a){a.enter()})},isEnabled:function(a){return Xa(a,function(a){return a.isEnabled()})},locate:function(a,b){return qa(a,function(a){var c=b.target();a=a.element();return wd.closest(c,u(N.eq,a))}).getOr(void 0)},next:function(a,b){var c=Gc(a,b).getOr(-1);return Ke.findNext(a,c,Nn).getOr(b)},prev:function(a,b){var c=Gc(a,b).getOr(-1);return Ke.findPrev(a,c,Nn).getOr(b)},
prevNoCycle:function(a,b){b=Gc(a,b).getOr(-1);return 0<b?g.some(a[b-1]):g.none()},nextNoCycle:function(a,b){b=Gc(a,b).getOr(-1);return b+1<a.length?g.some(a[b+1]):g.none()},progress:function(a,b){a.exit();b.enter()},destroy:function(a){z(a,function(a){a.destroy()})}},A4=Aa(["index","focused","group","items"],[]),B4=Aa(["index","sectors","sector"],[]),C4=Aa(["index","candidates"],[]),jh={ofFocus:function(a,b,c){return fb.find(a).bind(function(a){return L.closest(a,b).bind(function(b){var d=Y.descendants(b,
c),e=ka(d,sc.isVisible);return Va(e,u(N.eq,a)).map(function(c){return A4({index:c,focused:a,group:b,items:e})})})})},ofSector:function(a,b,c){var d=Y.descendants(a,b);return L.closest(c,b).bind(function(a){return Va(d,u(N.eq,a)).map(function(b){return B4({index:b,sectors:d,sector:a})})})},within:function(a,b,c){var d=Y.descendants(a,c);return Va(d,u(N.eq,b)).map(function(a){return C4({index:a,candidates:d})})}},GE={horizontal:function(a,b,c,d){return jh.within(a,c,b).bind(function(a){var b=a.index();
a=a.candidates();b=Ke.adjust(b,d,0,a.length-1);return g.from(a[b])})}},On={delegate:function(a,b,c){return Pf(a,[ea.basic(R.LEFT()[0],b.west),ea.basic(R.RIGHT()[0],b.east),ea.basic(R.UP()[0],b.north),ea.basic(R.DOWN()[0],b.south),ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),function(){return fb.find(a).bind(c.trigger()).map(Jb)})],g.none())},findRecent:function(a,b,c,d){return d.isValid().fold(k(c),function(a){return c.filter(a)}).orThunk(function(){return d.first().bind(function(a){return a()}).orThunk(function(){return L.descendant(a,
b)})})}},D4=O("row","column"),fa={set:function(a,b){if(void 0===b)throw Error("Value.set was undefined");a.dom().value=b},get:function(a){return a.dom().value}},E4={move:function(a,b,c){var d=O("row","col"),e=a.length-1,f=a[b.row()]-1;e=Ke.adjust(b.row(),c.dr(),0,e);a=a[e]-1;f=Math.max(f,a);b=Math.min(a,Ke.adjust(b.col(),c.dc(),0,f));return d(e,b)}},HE={single:Pf,multiple:function(a,b){var c=K.bind(a,"keydown",function(a){var c=ya.locate(b,a);if(ea.is(R.ESCAPE()[0])(a))d(),a.kill();else if(void 0!==
c&&null!==c&&ea.is(R.TAB()[0])(a)){var e=(ea.isShift(a)?ya.prev:ya.next)(b,c);ya.progress(c,e);a.kill()}}),d=function(){ya.exit(b);e.trigger.exit()},e=H.create({enter:p([]),exit:p([])});return gd({enter:function(){ya.first(b).each(function(a){a.enter()})},exit:d,clear:u(ya.clear,b),refresh:u(ya.refresh,b),isEnabled:u(ya.isEnabled,b),isFocused:u(fb.isFocused,a),destroy:function(){ya.destroy(b);c.unbind()},events:e.registry})},multipleAll:function(a,b){var c=K.bind(a,"keydown",function(a){var c=ya.locate(b,
a);if(ea.is(R.ESCAPE()[0])(a))d(),a.kill();else if(void 0!==c&&null!==c)if(ea.is(R.UP()[0])(a))ya.progress(c,ya.prev(b,c)),a.kill();else if(ea.is(R.DOWN()[0])(a))ya.progress(c,ya.next(b,c)),a.kill();else if(ea.is(R.TAB()[0])(a)){var e=(ea.isShift(a)?ya.prev:ya.next)(b,c);ya.progress(c,e);a.kill()}}),d=function(){ya.exit(b);e.trigger.exit()},e=H.create({enter:p([]),exit:p([])});return gd({enter:function(){ya.first(b).each(function(a){a.enter()})},exit:d,clear:u(ya.clear,b),refresh:u(ya.refresh,b),
isEnabled:u(ya.isEnabled,b),isFocused:u(fb.isFocused,a),events:e.registry,destroy:function(){ya.destroy(b);c.unbind()}})},flow:function(a,b,c){var d=g.none();fb.markSelectors(a,[b.item()]);var e=function(c){return fb.find(a).bind(function(d){return GE.horizontal(a,b.item(),d,c)})},f=sj(a,function(a){return e(a).bind(function(a){q(a);return c.executeOnArrow().fold(function(){return g.some(!0)},h)})}),h=function(){return fb.find(a).bind(c.trigger()).map(Jb)},l=Pf(a,[ea.rule(ea.inSet(R.LEFT().concat(R.UP())),
f.west),ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())),f.east),ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),h)],g.none()),q=function(a){d=g.some(a);fb.set(a)};return gd({element:l.element,destroy:l.destroy,clickFocus:function(a){Fa.is(a,b.item())&&q(a)},clear:function(){d=g.none()},isFocused:l.isFocused,isEnabled:k(!0),refresh:t,enter:function(){l.enter();d.orThunk(function(){return c.first().fold(function(){return L.descendant(a,b.item())},xb)}).each(q)},exit:l.exit})},grid:function(a,b,c,d,e){var f=
c,h=d;fb.markSelectors(a,[b.cell()]);var l=na(g.none()),k=function(a){return A.findIndex(a).map(function(a){return D4(Math.floor(a/h),a%h)})},C=function(c,d){return fb.find(a).bind(function(e){return k(e).bind(function(e){var l=Ke.adjust(e.row(),d,0,f-1),k=Ke.adjust(e.column(),c,0,h-1);e=Y.descendants(a,b.cell());var q=e.length-1;l*=h;l=l+k>q?0<c?l:q:l+k;return 0<=l&&l<e.length?g.some(e[l]):g.none()})})};c=sj(a,function(a,b){return C(a,b).bind(function(a){fb.set(a);l.set(g.some(a));return g.some(!0)})});
var w=On.delegate(a,c,e);return gd({element:w.element,destroy:w.destroy,clear:function(){l.set(g.none())},isFocused:w.isFocused,isEnabled:Jb,refresh:t,enter:function(){w.enter();l.set(On.findRecent(a,b.cell(),l.get(),e));l.get().each(Z.focus)},exit:w.exit,resize:function(a,b){f=a;h=b}})},sectors:function(a,b,c){fb.markSelectors(a,[b.sector(),b.group(),b.item()]);var d=function(a){return Ja.descendant(a,function(a){return Fa.is(a,b.item())&&k(a)})},e=function(a){return Ja.child(a,m)},f=function(a){a=
ed.children(a,m);return 0<a.length?g.some(a[a.length-1]):g.none()},h=sj(a,function(c){return jh.ofFocus(a,b.group(),b.item()).bind(function(a){var b=a.items();a=Ke.adjust(a.index(),c,0,b.length-1);return g.from(b[a])})}),l=function(c){return jh.ofFocus(a,b.group(),b.item()).bind(function(a){return c(a.group()).bind(d)})},k=function(a){return 0<sa.get(a)},C=function(c){return jh.ofSector(a,b.sector(),c).map(function(a){return Ke.findPrev(a.sectors(),a.index(),k).getOr(a.sector())})},w=function(c){return jh.ofSector(a,
b.sector(),c).map(function(a){return Ke.findNext(a.sectors(),a.index(),k).getOr(a.sector())})},m=function(a){var c;if(c=Fa.is(a,b.group()))a=Y.descendants(a,b.item()),c=Xa(a,sc.isVisible);return c},F=function(a){return function(){return a().map(function(a){fb.set(a);n.trigger.active(a);return a})}},n=H.create({enter:p([]),exit:p([]),active:p(["element"])}),r=Pf(a,[ea.rule(ea.inSet(R.ESCAPE()),function(){r.exit();n.trigger.exit();return g.some(!0)}),ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())),F(h.east)),
ea.rule(ea.inSet(R.LEFT().concat(R.UP())),F(h.west)),ea.rule(ea.and([ea.isShift,ea.inSet(R.TAB())]),F(u(l,function(a){return A.prevSibling(a).filter(m).orThunk(function(){return C(a).bind(f)})}))),ea.rule(ea.inSet(R.TAB()),F(u(l,function(a){return A.nextSibling(a).filter(m).orThunk(function(){return w(a).bind(e)})}))),ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),function(){return fb.find(a).bind(c.trigger()).map(Jb)})],g.none());return gd({element:r.element,clear:t,isFocused:r.isFocused,enter:function(){r.enter();
n.trigger.enter();c.first()().orThunk(function(){return d(a)}).each(function(a){fb.set(a);n.trigger.active(a)})},refresh:t,isEnabled:Jb,exit:r.exit,destroy:r.destroy,events:n.registry})},radio:function(a,b,c){var d=function(c){return fb.find(a).bind(function(d){return GE.horizontal(a,b.item(),d,c)})},e=sj(a,function(b){return d(b).bind(function(b){fb.set(b);c.one()(a,b);return g.some(!0)})}),f=Pf(a,[ea.rule(ea.inSet(R.LEFT().concat(R.UP())),e.west),ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())),e.east),
ea.rule(ea.inSet(R.SPACE()),u(g.some,!0))],g.none());return gd({element:f.element,destroy:f.destroy,clear:t,refresh:function(){f.isFocused()&&L.descendant(a,b.selected()).each(fb.set)},isFocused:f.isFocused,isEnabled:Jb,enter:function(){f.enter();L.descendant(a,b.selected()).orThunk(function(){return L.descendant(a,b.item())}).each(function(d){Fa.is(d,b.selected())||c.one()(a,d);fb.set(d)})},exit:f.exit})},input:function(a,b){var c=Pf(a,[ea.basic(R.ENTER()[0],function(c){return b.execute().map(function(b){var d=
{isShift:k(ea.isShift(c))},e=fa.get(a);b(e,d);return!0})})],g.none());return gd({element:c.element,destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:function(){return!m.has(a,"disabled")},refresh:t,enter:function(){c.enter();a.dom().setSelectionRange(0,fa.get(a).length)},exit:c.exit})},dialog:function(a,b,c){var d=c.execute(),e=Ba.button({execute:d}),f=b.slice(0).concat([Rq(c.cancel(),e),Rq(c.ok(),e)]),h=K.bind(a,"keydown",function(a){var b=ya.locate(f,a);if(void 0!==b&&null!==b){var e=
ea.isShift(a);ea.is(R.TAB()[0])(a)?(e=(e?ya.prev:ya.next)(f,b),ya.progress(b,e),a.kill()):ea.is(R.ESCAPE()[0])(a)?(l(),a.kill(),d(c.cancel())):"button"===D.name(b.element())||e||!ea.is(R.ENTER()[0])(a)?(b=[R.UP()[0],R.DOWN()[0]],e=["textarea","select","input"],ea.inSet(b)(a)&&!1===U(e,D.name(a.target()))&&a.kill()):(d(c.ok()),a.kill())}}),l=function(){ya.exit(f);g.trigger.exit()},g=H.create({enter:p([]),exit:p([])});return gd({enter:function(){ya.enterFirst(f,c)},exit:l,clear:u(ya.clear,f),refresh:u(ya.refresh,
f),isEnabled:u(ya.isEnabled,f),isFocused:u(fb.isFocused,a),events:g.registry,destroy:function(){ya.destroy(f);h.unbind()}})},button:Rq,inlineDialog:function(a,b,c){var d=c.ok(),e=c.cancel(),f=K.bind(a,"keydown",function(a){var c=ya.locate(b,a);if(void 0!==c&&null!==c){var f=ea.isShift(a);ea.is(R.TAB()[0])(a)?(f=(f?ya.prev:ya.next)(b,c),ya.progress(c,f),a.kill()):ea.is(R.ESCAPE()[0])(a)?(h(),a.kill(),e(a.target())):!f&&ea.is(R.ENTER()[0])(a)?(d(a.target()),a.kill()):(c=[R.UP()[0],R.DOWN()[0]],f=["textarea",
"select","input"],ea.inSet(c)(a)&&!1===U(f,D.name(a.target()))&&a.kill())}}),h=function(){ya.exit(b);l.trigger.exit()},l=H.create({enter:p([]),exit:p([])});return gd({enter:function(){ya.enterFirst(b,c)},exit:h,clear:u(ya.clear,b),refresh:u(ya.refresh,b),isEnabled:u(ya.isEnabled,b),isFocused:u(fb.isFocused,a),events:l.registry,destroy:function(){ya.destroy(b);f.unbind()}})},tabular:function(a,b,c){var d=b.row(),e=b.cell();fb.markSelectors(a,[d,e]);var f=na(g.none()),h=sj(a,function(a,b){return F(a,
b).bind(function(a){fb.set(a);f.set(g.some(a));return g.some(!0)})}),l=O("row","col"),k=O("dc","dr"),C=function(a){a=Y.descendants(a,d);return E(a,function(a){return Y.descendants(a,e).length})},w=function(b){return L.closest(b,d).bind(function(c){return jh.within(a,c,d).bind(function(a){return jh.within(c,b,e).map(function(b){return l(a.index(),b.index())})})})},m=function(b){var c=Y.descendants(a,d);return g.from(c[b.row()]).bind(function(a){a=Y.descendants(a,e);return g.from(a[b.col()])})},F=function(b,
c){return fb.find(a).bind(function(d){return w(d).bind(function(d){var e=C(a);d=E4.move(e,d,k(b,c));return m(d)})})},n=On.delegate(a,h,c);return gd({element:n.element,destroy:n.destroy,clear:function(){f.set(g.none())},isFocused:n.isFocused,isEnabled:Jb,refresh:t,enter:function(){n.enter();f.set(On.findRecent(a,b.cell(),f.get(),c));f.get().each(fb.set)},exit:n.exit})},page:function(a,b,c){var d=b.stops().join(","),e=function(){return c.first().bind(function(b){return L.descendant(a,b)}).getOr(a)},
f=function(a){var b=e();return(Z.hasFocus(b)?g.some:fb.find)(b).bind(function(b){var c=e();if(N.eq(c,b)&&0>a)c=g.none();else{var f=Y.descendants(c,d);b=Va(f,u(N.eq,b)).getOr(-1)+a;c=b>=f.length?g.none():0>b?g.some(c):0<=b&&b<f.length?g.some(f[b]):g.none()}return c})};b=function(a){return f(a).bind(function(a){fb.set(a);return g.some(!0)})};var h=Pf(a,[ea.rule(ea.and([ea.isShift,ea.inSet(R.TAB())]),u(b,-1)),ea.rule(ea.inSet(R.TAB()),u(b,1)),ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),function(){return fb.find(a).bind(c.trigger()).map(Jb)})],
g.none());return gd({element:h.element,destroy:h.destroy,clear:t,isFocused:h.isFocused,isEnabled:Jb,refresh:t,enter:function(){h.enter();fb.set(e())},exit:h.exit})},dynamic:function(a){var b=na([]),c=function(a,c){ea.is(R.TAB()[0])(c)&&(ea.isShift(c)?ya.prevNoCycle:ya.nextNoCycle)(b.get(),a).each(function(b){ya.progress(a,b);c.kill()})},d=K.bind(a,"keydown",function(a){var d=ya.locate(b.get(),a);void 0!==d&&null!==d&&c(d,a)}),e=H.create({enter:p([]),exit:p([])}),f=function(a){return function(){return a(b.get())}};
return gd({element:k(a),enter:function(){ya.first(b.get()).each(function(a){a.enter()})},exit:function(){ya.exit(b.get());e.trigger.exit()},set:function(a){ya.destroy(b.get());b.set(a)},clear:f(ya.clear),refresh:f(ya.refresh),isEnabled:f(ya.isEnabled),isFocused:u(fb.isFocused,a),destroy:function(){ya.destroy(b.get());d.unbind()},events:e.registry})}},F4={grid:function(a,b,c,d,e){fb.markSelectors(a,[b.cell()])}},G4=function(a,b){var c=g.from(F4[b]).getOr(t);return function(){c.apply(null,arguments);
return{element:t,clear:t,isFocused:t,isEnabled:t,refresh:t,enter:t,exit:t,events:H.create({enter:p([]),exit:p([]),active:p([])}).registry,destroy:t,set:t,clickFocus:t,resize:t}}},ha=aa.detect().deviceType.isTouch()?eb(HE,G4):HE,df={toolbar:function(a,b){return aU(a,b)},menu:function(a,b,c){return KD.create(a,b,c)},popup:function(a,b,c,d,e){return qj(a,b,c,d,e)},menuSystem:function(a,b,c){return Kq(a,b,c)}},be={styleSpan:k("ephox-hare-style-span"),base:k("ephox-candy-mountain"),active:k("ephox-candy-mountain-active"),
autoresize:k("ephox-candy-mountain-autoresize")},IE=aa.detect(),Pn=IE.deviceType.isTouch,H4=IE.deviceType.isAndroid,Qn=function(a,b){return Zg.screen.width>=a&&Zg.screen.height>=b},JE=function(){return!Qn(620,700)&&Pn()},xc={isTouch:Pn,choice:function(a,b){return hb(a,function(a,b){return a.orThunk(function(){return b.predicate()?g.some(b.value()):g.none()})},g.none()).getOr(b)},isLarge:function(){return Qn(620,700)},isLargeTouch:function(){return Qn(620,700)&&Pn()},isSmallTouch:JE,isLargeDesktop:function(){return Qn(620,
700)&&!Pn()},isSmallAndroid:function(){return JE()&&H4()}},kh=aa.detect(),I4={"ephox-platform-desktop":!kh.deviceType.isTouch(),"ephox-platform-touch":kh.deviceType.isTouch(),"ephox-platform-small-touch":xc.isSmallTouch(),"ephox-platform-android":kh.deviceType.isAndroid(),"ephox-platform-ios":kh.deviceType.isiOS(),"ephox-platform-ie":kh.browser.isIE()||kh.browser.isEdge(),"ephox-platform-firefox":kh.browser.isFirefox()},KE=[];Ma(I4,function(a,b){!0===a&&KE.push(b)});var Zr={addClasses:function(a){ma.add(a,
KE)}},LE=function(a,b){var c=r.fromTag("div");n.add(c,B.resolve(b));y.append(c,a);return c},Ky={build:function(a,b,c){g.from(b).filter(ck.isPrototypeOf).map(r.fromDom).each(function(b){var c=r.fromTag("div");n.add(c,B.resolve("flex-row"));var d=r.fromTag("div");n.add(d,B.resolve("flex-column"));P.append(d,A.children(a));y.append(a,c);y.append(c,d);y.append(c,LE(b,"side-bar"))});g.from(c).filter(ck.isPrototypeOf).map(r.fromDom).each(function(b){y.append(a,LE(b,"bottom-bar"))})}},J4=xd(["compare","extract",
"mutate","sink"]),K4=xd(["element","start","stop","destroy"]),L4=xd(["forceDrop","drop","move","delayDrop"]),sm={mode:J4,sink:K4,api:L4},Cy={resolve:Dn("ephox-dragster").resolve},M4=sm.mode({compare:function(a,b){return Ra(b.left()-a.left(),b.top()-a.top())},extract:function(a){return g.some(Ra(a.x(),a.y()))},sink:function(a,b){var c=dU(b),d=K.bind(c.element(),"mousedown",a.forceDrop),e=K.bind(c.element(),"mouseup",a.drop),f=K.bind(c.element(),"mousemove",a.move),h=K.bind(c.element(),"mouseout",a.delayDrop);
return sm.sink({element:c.element,start:function(a){y.append(a,c.element())},stop:function(){G.remove(c.element())},destroy:function(){c.destroy();e.unbind();f.unbind();h.unbind();d.unbind()}})},mutate:function(a,b){a.mutate(b.left(),b.top())}}),N4={setup:function(a,b,c){var d=!1,e=H.create({start:p([]),stop:p([])}),f=gU(),h=function(){k.stop();f.isOn()&&(f.off(),e.trigger.stop())},l=uj(h,200);f.events.move.bind(function(c){b.mutate(a,c.info())});var g=function(a){return function(){var b=Array.prototype.slice.call(arguments,
0);if(d)return a.apply(null,b)}},k=b.sink(sm.api({forceDrop:h,drop:g(h),move:g(function(a,c){l.cancel();f.onEvent(a,b)}),delayDrop:g(l.throttle)}),c);return{element:k.element,go:function(a){k.start(a);f.on();e.trigger.start()},on:function(){d=!0},off:function(){d=!1},destroy:function(){k.destroy()},events:e.registry}}},tj={transform:function(a,b){var c=void 0!==b?b:{};return N4.setup(a,void 0!==c.mode?c.mode:M4,b)}},iU={both:function(a){var b=H.create({relocate:p(["x","y","deltaX","deltaY"])});return{mutate:function(c,
d){var e=bb.absolute(a),f=e.left()+c;e=e.top()+d;b.trigger.relocate(f,e,c,d)},events:b.registry}}},ME=O("hx","hy","position","x","y"),O4=function(a,b,c,d,e,f){f=b.x();b=b.y()-c;return(b>=a.y()&&b<=a.y()+a.h()?[ME(f,b,"absolute",f,b)]:[]).concat([ME(e,a.y(),"fixed",e-d.left(),a.fy())])},P4={detect:function(a,b,c,d,e,f){a=O4(a,b,e,f,c,d);return qa(a,function(a){return 10>Math.abs(d-a.hy())&&38>Math.abs(c-a.hx())})}},NE={box:function(a){var b=bb.absolute(a),c=Ia.getOuter(a);a=sa.getOuter(a);var d=b.left();
b=b.top();return{x:k(d),y:k(b),width:k(c),height:k(a),right:k(d+c),bottom:k(b+a)}}},qt={resolve:Lb.create("ephox-ego").resolve},Rn=function(a){var b="data-"+qt.resolve(a+"-left"),c="data-"+qt.resolve(a+"-top"),d="data-"+qt.resolve(a+"-position");return{get:function(a){var e=parseInt(m.get(a,b),10),h=parseInt(m.get(a,c),10);a=m.get(a,d);return isNaN(e)||isNaN(h)?g.none():g.some({left:k(e),top:k(h),position:k(a)})},set:function(a,f,h,l){m.set(a,d,f);m.set(a,b,h+"px");m.set(a,c,l+"px")},clear:function(a){m.remove(a,
d);m.remove(a,b);m.remove(a,c)}}}("pre-snap"),Q4=function(a,b,c,d,e,f){return Rn.get(b).fold(function(){return a.fromLocation(b,c,d)},function(c){return a.fromFixed(b,c.left()+e,c.top()+f)})},R4=function(a,b,c,d){var e=A.owner(b);e=Za.get(e);b=NE.box(b);c=c.loc();return P4.detect(a,b,c.left(),c.top(),d,e)},rt=function(a,b,c,d){return{attrs:{"data-ephox-snap":"absolute"===b?"true":"false"},styles:{position:b,left:a.left+c+"px",top:a.top+d+"px"}}},sk={move:function(a,b,c,d,e,f){var h=a.graph(),l=a.lazyTheatre(),
g=a.lazyHeight();c=Q4(h,b,c,d,e,f);var k=c.loc(),w=c.fixed(),m={top:0,left:0};return R4(l,a.container(),c,g).fold(function(){var a=h.boundToFixed(l,b,k.left(),k.top(),w.left(),w.top(),g);Rn.set(b,"fixed",a.left(),a.top());return rt(m,"fixed",a.left(),a.top())},function(c){var d=h.boundToFixed(l,b,k.left(),k.top(),w.left(),w.top(),g);Rn.set(b,"fixed",d.left(),d.top());d="absolute"===c.position()?h.locationToAbsolute(b,c.x(),c.y()):Ra(c.x(),c.y());a.resetOffset();return rt(m,c.position(),d.left(),d.top())})},
getSnapAttrs:rt,forget:function(a){Rn.clear(a)}},Hy={none:function(a,b){var c=H.create({dragend:p([]),moved:p([])});return{blocker:yb("no blocker"),setState:t,getState:k({}),init:function(d,e){d=sk.getSnapAttrs(a.getOffset(),"absolute",d,e);v.setAll(b,d.styles);m.setAll(b,d.attrs);c.trigger.moved()},update:t,destroy:t,events:c.registry}},except:function(a){return function(b,c){var d=hU(c,a.join(",")),e=H.create({dragend:Q([],d.events.dragend),moved:p([])});d.events.relocate.bind(function(a){var d=
a.x(),e=a.y(),f=a.deltaX();a=a.deltaY();d=sk.move(b,c,d,e,f,a);v.setAll(c,d.styles);m.setAll(c,d.attrs)});d.events.dragend.bind(function(){e.trigger.moved()});return{blocker:d.blocker,setState:function(a){v.setAll(c,a.styles);m.setAll(c,a.attrs)},getState:function(){var a=bb.viewport(c);return sk.getSnapAttrs(b.getOffset(),"absolute",a.left(),a.top())},init:function(a,d){a=sk.getSnapAttrs(b.getOffset(),"absolute",a,d);v.setAll(c,a.styles);m.setAll(c,a.attrs);e.trigger.moved()},update:function(){sk.forget(c)},
destroy:function(){d.destroy()},events:e.registry}}}},Dy={isInside:function(a,b,c,d){return!(b>a.y()+a.h()||c-d<a.y())},isAllInside:function(a,b,c){return b>a.y()&&b<a.y()+a.h()&&c>a.y()&&c<a.y()+a.h()}},Iy={register:function(a,b,c,d){var e=a.container(),f=c(a,b),h=d(a,b),l=jU();c=H.create({dragend:Q([],f.events.dragend),appear:Q(["element"],h.events.appear),disappear:Q(["element"],h.events.disappear),dock:Q([],l.events.dock),undock:Q([],l.events.undock)});f.events.moved.bind(function(){C();k=!0});
h.events.scrolled.bind(function(){C()});h.events.appear.bind(function(){var c=a.lazyTheatre(),d=a.graph();l.update(d,c,b,a.lazyHeight,e,a.getOffset())});var k=!1,C=function(){if(sc.isVisible(b)){f.update();h.update();var c=a.lazyTheatre(),d=bb.absolute(b);c=Math.max(0,c.x()+c.w()-d.left());v.set(b,"max-width",c+"px")}};return{blocker:f.blocker,setState:function(a){f.setState(a);C();k=!0},state:function(){return k?g.some(f.getState()):g.none()},init:function(b,c,d){a.setOffset(d);f.init(b,c);C()},
update:C,destroy:function(){h.destroy();f.destroy()},events:c.registry}}},Gy={transitions:function(a,b){var c=a.container(),d=A.defaultView(b),e=H.create({appear:p(["element"]),disappear:p(["element"]),scrolled:p([])}),f=K.bind(d,"scroll",function(){e.trigger.scrolled()});return{update:function(){var d=a.lazyTheatre(),f=a.lazyHeight(),g=NE.box(c);Dy.isInside(d,g.y(),g.bottom(),f)?e.trigger.appear(b):e.trigger.disappear(b)},destroy:function(){f.unbind()},events:e.registry}}},Ey=O("fixed","loc"),lU=
function(a,b,c,d){b=kU(b);var e={top:0,left:0},f=function(a){e.top=a.top;e.left=a.left};return{lazyTheatre:a,graph:k(b),lazyHeight:c,container:k(d),setOffset:f,resetOffset:function(){f({top:-1*c(),left:0})},getOffset:function(){return e}}},st=B.resolve("drag-show"),OE=B.resolve("fade-container"),qd={width:function(a,b){return v.getRaw(a,"max-width").fold(function(){return A.owner(b).dom().defaultView.innerWidth-bb.absolute(b).left()},function(a){return parseInt(a,10)})},updateWidth:function(a,b,c){b=
0===c.extra().length?c.withinWidth():c.withinWidth()+Ia.getOuter(b.group());0<b&&v.set(a,"width",b+"px")},clearWidth:function(a){v.remove(a,"width")},offsetFrom:function(a,b,c,d){b=void 0!==d.toolbar.offset?d.toolbar.offset:d.toolbar.sticky?{left:0,top:0}:{left:0,top:-1*c};c=bb.absolute(a.element());a=a.isInline()?{left:c.left(),top:c.top()}:{left:0,top:0};return{left:a.left+b.left,top:a.top+b.top}},initFade:function(a){n.add(a,st)},fadeIn:function(a,b){z(a,function(a){n.remove(a,OE)});n.add(b,st)},
fadeOut:function(a,b){z(a,function(a){n.add(a,OE)});n.remove(b,st)}},pU={setup:function(a,b,c,d){return(!0===c.toolbar.draggable?mU:!0===c.toolbar.sticky||void 0!==c.toolbar.offset||a.isInline()?nU:By)(a,b,c)}};aa.detect();var Jy=function(a,b){a.updateUi(b);a=[Mg.editorContainer(),"ephox-textbox-font",B.resolve("layer-editor")];ma.add(b,a);m.set(b,"lang",qf.get());Zr.addClasses(b)},S4=function(a){a=Bf.absolute(a);var b=Bf.view();a=b3.intersect(a,b);return gg(a.x(),a.y(),a.width(),a.height())},$r=
{build:function(a,b,c,d,e,f,h,l){var g=oU(a,b,c,f,h,l),k=d.tabbed(g);k.init();return{element:g.element,socket:g.socket,viewport:g.viewport,uiContainerParent:g.uiContainerParent,init:function(b,d,h){d=k.config(a.isInline(),d,e,h);AE.setup(g,f,a,b,c,d);k.loaded()},connect:g.connect,destroy:function(){g.destroy();k.destroy()},displayBanner:g.displayBanner,hideBanner:g.hideBanner,position:g.position,refresh:g.refresh,tabstrip:g.toolbar,state:g.state,dialogContainer:g.dialogContainer}},bounds:function(){var a=
function(a){var b=function(){return g.from(a.bounds()).filter(ck.isPrototypeOf).map(r.fromDom).map(S4).getOrThunk(Bf.view)};return vb(a.bounds)?b:Bf.view};return aa.detect().deviceType.isTouch()?k(Bf.view):a}()},CB={settings:function(a){return{onprem:!0,blocktag:{styles:[{rule:"p"},{rule:"h1"},{rule:"h2"},{rule:"h3"},{rule:"h4"},{rule:"div"},{rule:"pre"}],showDocumentStyles:!1,bundled:!0},image:{bundled:!0},imageEdit:{bundled:!0},imageupload:{immediate:!1,bundled:!1},content:{imageExcludes:[],css:a+
"/css",tabindex:null,stylesheets:[],documentStyles:"",prettyprint:!0,showDocumentStyles:!1,autoresize:!1},ui:{layout:$r,isFullScreen:!1,toolbar:{draggable:!1,sticky:!1},locale:{},editorName:J.value("debug"),bounds:null,showHelpHint:!1,autoresize:!1},shortcuts:{features:!0},spelling:{bundled:!0,autocorrect:!0,scanView:!0,multilingual:!0,menu:!0},specialchar:{bundled:!0},fileupload:{bundled:!0,allowLocalImages:!0},horizontalrule:{bundled:!0},media:{bundled:!0},mentions:{bundled:!1},registration:{bundled:!1},
help:{baseUrl:a+"/html",integration:{},bundled:!0},draganddrop:{bundled:!0},wordcount:{bundled:!0},formatting:{bundled:!0},alignindent:{bundled:!0},directionality:{bundled:!0},parlance:{bundled:!0,languages:"en_us en_gb es fr de pt zh".split(" ")},font:{faces:[],colors:{custom:!0,buttons:[]},bundled:!0},lists:{bundled:!0},link:{bundled:!0},linkvalidator:{bundled:!1},bookmark:{bundled:!0},removeformat:{bundled:!0},fullscreen:{bundled:!0},editorcontext:{bundled:!0},macros:{allowed:g.none(),bundled:!0},
highlighter:{external:[],bundled:!0},table:{colors:{custom:!0,buttons:[]},bundled:!0},contextmenu:{bundled:!0},project:{apiKey:null},smartclipboard:{bundled:!0,copy:{},paste:{forceText:!1,baseUrl:a+"/js",swf:a+"/flash/textboxpaste.swf",officeStyles:"prompt",htmlStyles:"merge",allowLocalImages:!0,enableFlashImport:!0}},resize:{bundled:!0},platform:{toolbar:{items:a3,contextual:["table-tools","image-tools"]},allowLocalImages:!0,fillscreen:!1},codeview:{bundled:!0,showButton:!0,mode:"pencil",css:a+"/css",
js:a+"/js"},findreplace:{bundled:!0},accessibility:{bundled:!0},plaincodeview:{bundled:!0},embed:{inlineStyles:!0,bundled:!1}}},state:function(){return{spelling:{words:{},language:g.none()},undo:{initial:{raw:"",marked:""},undo:[],redo:[]},profile:{spelling:!1,nativeSpelling:!0,autocorrect:!0,capitalisation:!1,linkpreviews:!1},content:{raw:"",marked:""},ui:{toolbar:{drag:g.none()}},macros:{customs:{}},filters:{customs:[]},laundry:{dirty:!1},linkvalidator:{ignore:[],cache:{}},embed:{cache:{}}}}},tt=
O("item","mode"),ut=function(a,b,c,d){var e=void 0!==d?d:tk;return a.property().parent(b).map(function(a){return tt(a,e)})},tk=function(a,b,c,d){var e=void 0!==d?d:di;return c.sibling(a,b).map(function(a){return tt(a,e)})},di=function(a,b,c,d){var e=void 0!==d?d:di;a=a.property().children(b);return c.first(a).map(function(a){return tt(a,e)})},T4=[{current:ut,next:tk,fallback:g.none()},{current:tk,next:di,fallback:g.some(ut)},{current:di,next:di,fallback:g.some(tk)}],PE=function(a,b,c,d,e){e=void 0!==
e?e:T4;return qa(e,function(a){return a.current===c}).bind(function(c){return c.current(a,b,d,c.next).orThunk(function(){return c.fallback.bind(function(c){return PE(a,b,c,d)})})})},lh={backtrack:ut,sidestep:tk,advance:di,go:PE},Sn={left:function(){return{sibling:function(a,b){return a.query().prevSibling(b)},first:function(a){return 0<a.length?g.some(a[a.length-1]):g.none()}}},right:function(){return{sibling:function(a,b){return a.query().nextSibling(b)},first:function(a){return 0<a.length?g.some(a[0]):
g.none()}}}},vt=function(a,b,c,d,e,f){return lh.go(a,b,d,e).bind(function(b){return f(b.item())?g.none():c(b.item())?g.some(b.item()):vt(a,b.item(),c,b.mode(),e,f)})},Tn={left:function(a,b,c,d){return vt(a,b,c,lh.sidestep,Sn.left(),d)},right:function(a,b,c,d){return vt(a,b,c,lh.sidestep,Sn.right(),d)}},QE=function(a,b){return 0===a.property().children(b).length},RE=function(a,b,c,d){return Tn.left(a,b,c,d)},SE=function(a,b,c,d){return Tn.right(a,b,c,d)},Ca={before:function(a,b,c){return RE(a,b,u(QE,
a),c)},after:function(a,b,c){return SE(a,b,u(QE,a),c)},seekLeft:RE,seekRight:SE,walkers:function(){return{left:Sn.left,right:Sn.right}},walk:function(a,b,c,d,e){return lh.go(a,b,c,d,e)},backtrack:lh.backtrack,sidestep:lh.sidestep,advance:lh.advance},ei=nb(),wc={gather:function(a,b,c){return Ca.gather(ei,a,b,c)},before:function(a,b){return Ca.before(ei,a,b)},after:function(a,b){return Ca.after(ei,a,b)},seekLeft:function(a,b,c){return Ca.seekLeft(ei,a,b,c)},seekRight:function(a,b,c){return Ca.seekRight(ei,
a,b,c)},walkers:function(){return Ca.walkers()},walk:function(a,b,c,d){return Ca.walk(ei,a,b,c,d)}},TE=function(a){return r.fromDom(a.dom().cloneNode(!0))},wt=function(a,b){b=r.fromTag(b);a=m.clone(a);m.setAll(b,a);return b},Pc={shallow:function(a){return r.fromDom(a.dom().cloneNode(!1))},shallowAs:wt,deep:TE,copy:function(a,b){b=wt(a,b);a=A.children(TE(a));P.append(b,a);return b},mutate:function(a,b){b=wt(a,b);y.before(a,b);var c=A.children(a);P.append(b,c);G.remove(a);return b}},Ny={convertToHeading:function(a,
b){var c=A.owner(a);b=r.fromTag(b,c.dom());c=A.children(a);c=E(c,Pc.deep);P.append(b,c);c=Y.descendants(b,"b,strong");z(c,G.unwrap);y.before(a,b);G.remove(a);return J.value(b)},joinLinks:function(a,b){return wc.seekLeft(b,function(a){return"a"===D.name(a)},a).fold(function(){return J.value(b)},function(a){var c=A.children(b);P.append(a,c);G.remove(b);return J.value(a)})}},UE=O("row","y"),VE=O("col","x"),WE=function(a){return bb.absolute(a).left()+Ia.getOuter(a)},XE=function(a){return bb.absolute(a).left()},
YE=function(a,b){return VE(a,XE(b))},ZE=function(a,b){return VE(a,WE(b))},xt=function(a){return bb.absolute(a).top()},yt=function(a,b,c){if(0===c.length)return[];var d=E(c.slice(1),function(b,c){return b.map(function(b){return a(c,b)})}),e=c[c.length-1].map(function(a){return b(c.length-1,a)});return d.concat([e])},U4={delta:ca,positions:u(yt,function(a,b){return UE(a,xt(b))},function(a,b){return UE(a,xt(b)+sa.getOuter(b))}),edge:xt},V4={delta:ca,edge:XE,positions:u(yt,YE,ZE)},W4={delta:function(a,
b){return-a},edge:WE,positions:u(yt,ZE,YE)},Wj={height:U4,rtl:W4,ltr:V4},$l={ltr:Wj.ltr,rtl:Wj.rtl},$E=function(a){return"img"===D.name(a)?1:Ya.getOption(a).fold(function(){return A.children(a).length},function(a){return a.length})},X4=function(a){return Ya.getOption(a).filter(function(a){return 0!==a.trim().length||-1<a.indexOf("\u00a0")}).isSome()},Y4=["img","br"],wa={getEnd:$E,isEnd:function(a,b){return $E(a)===b},isStart:function(a,b){return 0===b},isCursorPosition:function(a){return X4(a)||U(Y4,
D.name(a))}},Z4=function(a,b){var c=function(a){a=A.children(a);for(var d=a.length-1;0<=d;d--){var f=a[d];if(b(f))return g.some(f);f=c(f);if(f.isSome())return f}return g.none()};return c(a)},kc={first:function(a){return Ja.descendant(a,wa.isCursorPosition)},last:function(a){return Z4(a,wa.isCursorPosition)}},zt=function(){var a=r.fromTag("td");y.append(a,r.fromTag("br"));return a},$4=function(a,b,c){var d=Pc.copy(a,b);Ma(c,function(a,b){null===a?m.remove(d,b):m.set(d,b,a)});return d},a5=function(a){return a},
aF=function(a){return function(){return r.fromTag("tr",a.dom())}},b5=function(a,b,c){return kc.first(a).map(function(d){var e=c.join(",");d=Y.ancestors(d,e,function(b){return N.eq(b,a)});return Eb(d,function(a,b){b=Pc.shallow(b);m.remove(b,"contenteditable");y.append(a,b);return b},b)}).getOr(b)},bF={cellOperations:function(a,b,c){return{row:aF(b),cell:function(b){var d=A.owner(b.element());d=r.fromTag(D.name(b.element()),d.dom());var f=c.getOr("strong em b i span font h1 h2 h3 h4 h5 h6 p div".split(" "));
f=0<f.length?b5(b.element(),d,f):d;y.append(f,r.fromTag("br"));v.copy(b.element(),d);v.remove(d,"height");1!==b.colspan()&&v.remove(b.element(),"width");a(b.element(),d);return d},replace:$4,gap:zt}},paste:function(a){return{row:aF(a),cell:zt,replace:a5,gap:zt}}},Ac={erase:function(a,b,c,d){a=r.fromText("");y.after(b,a);G.remove(b);return g.some(Sc(a,0,a,0))},execute:function(a,b,c,d){return function(e,f,h){var l=d(),k=e.doc().getOrDie();e=My(a.directionAt);var C=g.some([]);k=bF.cellOperations(c,
k,C);return b(l,f,h,k,e,t,t).bind(function(a){return a.cursor().map(function(a){return Sc(a,0,a,0)})})}}},Xr={only:function(a){var b=g.from(a.dom().documentElement).map(r.fromDom).getOr(a);return{parent:k(b),view:k(a),origin:k(Ra(0,0))}},detached:function(a,b){var c=u(bb.absolute,b);return{parent:k(b),view:k(a),origin:c}},body:function(a,b){return{parent:k(b),view:k(a),origin:k(Ra(0,0))}}},cF=function(a,b,c){return a.isInline()?Xr.detached(a.element(),b.uiContainer()):Xr.only(c)},Rr={get:cF,fromEngine:function(a){var b=
a.content(),c=a.smartview();return b.doc().map(function(a){return cF(b,c,a)})}},c5=O("width","height"),d5=O("rows","columns"),e5=O("row","column"),f5=O("x","y"),g5=O("element","rowspan","colspan"),h5=O("element","rowspan","colspan","isNew"),i5=O("element","rowspan","colspan","row","column"),j5=O("element","cells","section"),k5=O("element","isNew"),l5=O("element","cells","section","isNew"),m5=O("cells","section"),n5=O("details","section"),o5=O("startRow","startCol","finishRow","finishCol"),Oa={dimensions:c5,
grid:d5,address:e5,coords:f5,extended:i5,detail:g5,detailnew:h5,rowdata:j5,elementnew:k5,rowdatanew:l5,rowcells:m5,rowdetails:n5,bounds:o5},At=function(a,b,c){return ia(A.children(a),function(a){return Fa.is(a,b)?c(a)?[a]:[]:At(a,b,c)})},uk={firstLayer:function(a,b){return At(a,b,k(!0))},filterFirstLayer:At},Bt=function(a,b,c){var d=void 0!==c?c:k(!1);return d(b)?g.none():U(a,D.name(b))?g.some(b):L.ancestor(b,a.join(","),function(a){return Fa.is(a,"table")||d(a)})},dF=function(a,b){return A.parent(b).map(function(b){return Y.children(b,
a)})},p5=u(dF,"th,td"),q5=u(dF,"tr"),Ct=function(a,b){return parseInt(m.get(a,b),10)},sb={cell:function(a,b){return Bt(["td","th"],a,b)},firstCell:function(a){return L.descendant(a,"th,td")},cells:function(a){return uk.firstLayer(a,"th,td")},neighbourCells:p5,table:function(a,b){return L.closest(a,"table",b)},row:function(a,b){return Bt(["tr"],a,b)},rows:function(a){return uk.firstLayer(a,"tr")},notCell:function(a,b){return Bt(["caption","tr","tbody","tfoot","thead"],a,b)},neighbourRows:q5,attr:Ct,
grid:function(a,b,c){b=Ct(a,b);a=Ct(a,c);return Oa.grid(b,a)}},hg={fromTable:function(a){a=sb.rows(a);return E(a,function(a){var b=A.parent(a).map(function(a){a=D.name(a);return"tfoot"===a||"thead"===a||"tbody"===a?a:"tbody"}).getOr("tbody"),d=E(sb.cells(a),function(a){var b=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return Oa.detail(a,b,c)});return Oa.rowdata(a,d,b)})},fromPastedRows:function(a,b){return E(a,function(a){var c=E(sb.cells(a),
function(a){var b=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return Oa.detail(a,b,c)});return Oa.rowdata(a,c,b.section())})}},eF=function(a,b){a=ia(a.all(),function(a){return a.cells()});return ka(a,b)},Ib={generate:function(a){var b={},c=[],d=a.length,e=0;z(a,function(a,d){var f=[];z(a.cells(),function(a,c){for(c=0;void 0!==b[d+","+c];)c++;for(var h=Oa.extended(a.element(),a.rowspan(),a.colspan(),d,c),l=0;l<a.colspan();l++)for(var g=
0;g<a.rowspan();g++){var k=c+l;b[d+g+","+k]=h;e=Math.max(e,k+1)}f.push(h)});c.push(Oa.rowdata(a.element(),f,a.section()))});a=Oa.grid(d,e);return{grid:k(a),access:k(b),all:k(c)}},getAt:function(a,b,c){a=a.access()[b+","+c];return void 0!==a?g.some(a):g.none()},findItem:function(a,b,c){a=eF(a,function(a){return c(b,a.element())});return 0<a.length?g.some(a[0]):g.none()},filterItems:eF,justCells:function(a){a=E(a.all(),function(a){return a.cells()});return Qb(a)}},ke={repeat:function(a,b){for(var c=
[],d=0;d<a;d++)c.push(b(d));return c},range:function(a,b){for(var c=[];a<b;a++)c.push(a);return c},unique:function(a,b){var c=[];z(a,function(d,e){e<a.length-1&&!b(d,a[e+1])?c.push(d):e===a.length-1&&c.push(d)});return c},deduce:function(a,b){if(0>b||b>=a.length-1)return g.none();var c=a[b].fold(function(){var c=kd(a.slice(0,b));return yc(c,function(a,b){return a.map(function(a){return{value:a,delta:b+1}})})},function(a){return g.some({value:a,delta:0})}),d=a[b+1].fold(function(){var c=a.slice(b+
1);return yc(c,function(a,b){return a.map(function(a){return{value:a,delta:b+1}})})},function(a){return g.some({value:a,delta:1})});return c.bind(function(a){return d.map(function(b){return Math.abs(b.value-a.value)/(b.delta+a.delta)})})}},fF=function(a,b,c){var d=a();return qa(d,b).orThunk(function(){return g.from(d[0]).orThunk(c)}).map(function(a){return a.element()})},Un={columns:function(a){var b=a.grid(),c=ke.range(0,b.columns()),d=ke.range(0,b.rows());return E(c,function(b){return fF(function(){return ia(d,
function(c){return Ib.getAt(a,c,b).filter(function(a){return a.column()===b}).fold(k([]),function(a){return[a]})})},function(a){return 1===a.colspan()},function(){return Ib.getAt(a,0,b)})})},rows:function(a){var b=a.grid(),c=ke.range(0,b.rows()),d=ke.range(0,b.columns());return E(c,function(b){return fF(function(){return ia(d,function(c){return Ib.getAt(a,b,c).filter(function(a){return a.row()===b}).fold(k([]),function(a){return[a]})})},function(a){return 1===a.rowspan()},function(){return Ib.getAt(a,
b,0)})})}},gF=aa.detect(),fi=function(a,b,c){a=v.get(a,b);a=parseFloat(a);return isNaN(a)?c:a},r5={getWidth:function(a){return fi(a,"width",Ia.get(a))},getHeight:function(a){if(gF.browser.isIE()||gF.browser.isEdge()){var b=fi(a,"padding-top",0),c=fi(a,"padding-bottom",0),d=fi(a,"border-top-width",0),e=fi(a,"border-bottom-width",0),f=a.dom().getBoundingClientRect().height;a="border-box"===v.get(a,"box-sizing")?f:f-b-c-(d+e)}else a=fi(a,"height",sa.get(a));return a}},hF=/(\d+(\.\d+)?)(\w|%)*/,vk=/(\d+(\.\d+)?)%/,
Dt=/(\d+(\.\d+)?)px|em/,iF=function(a,b){v.set(a,"height",b+"px")},s5=function(a){return v.getRaw(a,"height").getOrThunk(function(){return r5.getHeight(a)+"px"})},t5=function(a,b,c,d){var e=sb.table(a).map(function(a){a=c(a);return Math.floor(b/100*a)}).getOr(b);d(a,e);return e},Vn=function(a){return v.getRaw(a,"width").fold(function(){return g.from(m.get(a,"width"))},function(a){return g.some(a)})},pc={percentageBasedSizeRegex:k(vk),pixelBasedSizeRegex:k(Dt),setPixelWidth:function(a,b){v.set(a,"width",
b+"px")},setPercentageWidth:function(a,b){v.set(a,"width",b+"%")},setHeight:iF,getPixelWidth:function(a,b){return Vn(a).fold(function(){return Ia.get(a)},function(c){Dt.test(c)?(c=Dt.exec(c),c=parseInt(c[1],10)):vk.test(c)?(c=vk.exec(c),c=parseFloat(c[1])/100*b.pixelWidth()):c=Ia.get(a);return c})},getPercentageWidth:function(a,b){return Vn(a).fold(function(){return Ia.get(a)/b.pixelWidth()*100},function(c){vk.test(c)?(c=vk.exec(c),c=parseFloat(c[1])):c=Ia.get(a)/b.pixelWidth()*100;return c})},getGenericWidth:function(a){return Vn(a).bind(function(a){return hF.test(a)?
(a=hF.exec(a),g.some({width:k(a[1]),unit:k(a[3])})):g.none()})},setGenericWidth:function(a,b,c){v.set(a,"width",b+c)},getHeight:function(a){var b;if(b=s5(a)){var c=sa.get,d=parseInt(b,10);b=je(b,"%")&&"table"!==D.name(a)?t5(a,d,c,iF):d}else b=sa.get(a);a=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return b/a},getRawWidth:Vn},jF=function(a,b){return m.has(a,b)&&1<parseInt(m.get(a,b),10)},Qd={hasColspan:function(a){return jF(a,"colspan")},hasRowspan:function(a){return jF(a,"rowspan")},minWidth:k(10),
minHeight:k(10),getInt:function(a,b){return parseInt(v.get(a,b),10)}},kF=function(a,b,c){return v.getRaw(a,b).fold(function(){return c(a)+"px"},function(a){return a})},u5=function(a){return kF(a,"width",pc.getPixelWidth)},v5=function(a){return kF(a,"height",pc.getHeight)},Et=function(a,b,c,d,e){a=Un.columns(a);var f=E(a,function(a){return a.map(b.edge)});return E(a,function(a,b){return a.filter(zf(Qd.hasColspan)).fold(function(){var a=ke.deduce(f,b);return d(a)},function(a){return c(a,e)})})},lF=
function(a){return a.map(function(a){return a+"px"}).getOr("")},mF=function(a,b,c,d){a=Un.rows(a);var e=E(a,function(a){return a.map(b.edge)});return E(a,function(a,b){return a.filter(zf(Qd.hasRowspan)).fold(function(){var a=ke.deduce(e,b);return d(a)},function(a){return c(a)})})},wk={getRawWidths:function(a,b){return Et(a,b,u5,lF)},getPixelWidths:function(a,b,c){return Et(a,b,pc.getPixelWidth,function(a){return a.getOrThunk(c.minCellWidth)},c)},getPercentageWidths:function(a,b,c){return Et(a,b,pc.getPercentageWidth,
function(a){return a.fold(function(){return c.minCellWidth()},function(a){return a/c.pixelWidth()*100})},c)},getPixelHeights:function(a,b){return mF(a,b,pc.getHeight,function(a){return a.getOrThunk(Qd.minHeight)})},getRawHeights:function(a,b){return mF(a,b,v5,lF)}},Wn=ta.generate([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),nF=function(a,b,c){a=c.substring(0,c.length-a.length);var d=parseFloat(a);return a===d.toString()?b(d):Wn.invalid(c)},mh=function(a){return je(a,"%")?nF("%",Wn.percent,
a):je(a,"px")?nF("px",Wn.pixels,a):Wn.invalid(a)},w5=function(a,b){return E(a,function(a){return mh(a).fold(function(){return a},function(a){return a/b*100+"%"},function(a){return a+"%"})})},x5=function(a,b,c){var d=c/b;return E(a,function(a){return mh(a).fold(function(){return a},function(a){return a*d+"px"},function(a){return a/100*c+"px"})})},y5=function(a,b){a=a.fold(function(){return k("")},function(a){return k(a/b+"px")},function(a){return k(a/b+"px")});return ke.repeat(b,a)},z5=function(a,
b,c){return a.fold(function(){return b},function(a){return x5(b,c,a)},function(a){return w5(b,c)})},oF=function(a,b){var c=Math.floor(a);return{value:c+b,remainder:a-c}},A5=function(a,b){return mh(a).fold(k(a),function(a){return a+b+"px"},function(a){return a+b+"%"})},pF=function(a){if(0===a.length)return a;a=Eb(a,function(a,b){var c=mh(b).fold(function(){return{value:b,remainder:0}},function(a){return oF(a,"px")},function(a){return oF(a,"%")});return{output:[c.value].concat(a.output),remainder:a.remainder+
c.remainder}},{output:[],remainder:0});var b=a.output;return b.slice(0,b.length-1).concat([A5(b[b.length-1],Math.round(a.remainder))])},xk={validate:mh,redistribute:function(a,b,c){c=mh(c);a=ob(a,function(a){return"0px"===a})?y5(c,a.length):z5(c,a,b);return pF(a)},sum:function(a,b){return 0===a.length?b:Eb(a,function(a,b){return mh(b).fold(k(0),ca,ca)+a},0)},toIntegers:pF},B5=function(a,b,c){z(b,function(b){var d=a.slice(b.column(),b.colspan()+b.column());d=xk.sum(d,Qd.minWidth());v.set(b.element(),
"width",d+c)})},C5=function(a,b,c,d){z(c,function(b){var c=a.slice(b.row(),b.rowspan()+b.row());c=xk.sum(c,Qd.minHeight());v.set(b.element(),"height",c+d)});z(b,function(b,c){v.set(b.element(),"height",a[c])})},qF=function(a){return xk.validate(a).fold(k("px"),k("px"),k("%"))},D5={redistribute:function(a,b,c,d){var e=hg.fromTable(a),f=Ib.generate(e),h=f.all(),l=Ib.justCells(f);b.each(function(b){var c=qF(b),e=Ia.get(a),h=wk.getRawWidths(f,d);e=xk.redistribute(h,e,b);B5(e,l,c);v.set(a,"width",b)});
c.each(function(b){var c=qF(b),d=sa.get(a),e=wk.getRawHeights(f,Wj.height);d=xk.redistribute(e,d,b);C5(d,h,l,c);v.set(a,"height",b)})}},E5=function(a){var b=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1,c=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return{element:k(a),colspan:k(b),rowspan:k(c)}},Ft=xd(["cell","row","replace","gap"]),cc={modification:function(a,b){Ft(a);var c=na(g.none()),d=void 0!==b?b:E5,e=function(b){var e=d(b);e=a.cell(e);c.get().isNone()&&c.set(g.some(e));f=g.some({item:b,
replacement:e});return e},f=g.none();return{getOrInit:function(a,b){return f.fold(function(){return e(a)},function(c){return b(a,c.item)?c.replacement:e(a)})},cursor:c.get}},transform:function(a,b){return function(c){var d=na(g.none());Ft(c);var e=[],f=function(a,b){return qa(e,function(c){return b(c.item,a)})},h=function(f){var h=c.replace(f,b,{scope:a});e.push({item:f,sub:h});d.get().isNone()&&d.set(g.some(h));return h};return{replaceOrInit:function(a,b){return f(a,b).fold(function(){return h(a)},
function(c){return b(a,c.item)?c.sub:h(a)})},cursor:d.get}}},merging:function(a){Ft(a);var b=na(g.none());return{combine:function(c){b.get().isNone()&&b.set(g.some(c));return function(){var b=a.cell({element:k(c),colspan:k(1),rowspan:k(1)});v.remove(b,"width");v.remove(c,"width");return b}},cursor:b.get}}},F5="body p div article aside figcaption figure footer header nav section ol ul table thead tfoot tbody caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),rF=function(a,b){a=a.property().name(b);
return U(F5,a)},sF=function(a,b){return U(["br","img","hr","input"],a.property().name(b))},Nc={isBlock:rF,isList:function(a,b){a=a.property().name(b);return U(["ol","ul"],a)},isFormatting:function(a,b){a=a.property().name(b);return U("address pre p h1 h2 h3 h4 h5 h6".split(" "),a)},isHeading:function(a,b){a=a.property().name(b);return U("h1 h2 h3 h4 h5 h6".split(" "),a)},isContainer:function(a,b){return U("div li td th blockquote body caption".split(" "),a.property().name(b))},isEmptyTag:sF,isFrame:function(a,
b){return"iframe"===a.property().name(b)},isInline:function(a,b){return!(rF(a,b)||sF(a,b))&&"li"!==a.property().name(b)}},ig=nb(),pa={isBlock:function(a){return Nc.isBlock(ig,a)},isList:function(a){return Nc.isList(ig,a)},isFormatting:function(a){return Nc.isFormatting(ig,a)},isHeading:function(a){return Nc.isHeading(ig,a)},isContainer:function(a){return Nc.isContainer(ig,a)},isEmptyTag:function(a){return Nc.isEmptyTag(ig,a)},isFrame:function(a){return Nc.isFrame(ig,a)},isInline:function(a){return Nc.isInline(ig,
a)}},G5={merge:function(a){var b=function(a){return ob(a,function(a){return"br"===D.name(a)||D.isText(a)&&0===Ya.get(a).trim().length})},c=function(a){return A.nextSibling(a).map(function(a){if(pa.isBlock(a))return!0;if(pa.isEmptyTag(a))return"img"===D.name(a)?!1:!0}).getOr(!1)},d=function(a){return kc.last(a).bind(function(b){var d=c(b);return A.parent(b).map(function(c){var e;(e=!0===d)||(e="li"===D.name(c)||Ja.ancestor(c,pa.isList).isSome());return e||"br"===D.name(b)||pa.isBlock(c)&&!N.eq(a,c)?
[]:[r.fromTag("br")]})}).getOr([])},e=function(){var c=ia(a,function(a){var c=A.children(a);return b(c)?[]:c.concat(d(a))});return 0===c.length?[r.fromTag("br")]:c}();G.empty(a[0]);P.append(a[0],e)}},tF=function(a,b){return Oa.rowcells(b,a.section())},uF=function(a,b){return a.cells()[b]},Ka={addCell:function(a,b,c){var d=a.cells(),e=d.slice(0,b);b=d.slice(b);c=e.concat([c]).concat(b);return tF(a,c)},setCells:tF,mutateCell:function(a,b,c){a.cells()[b]=c},getCell:uF,getCellElement:function(a,b){return uF(a,
b).element()},mapCells:function(a,b){var c=a.cells();b=E(c,b);return Oa.rowcells(b,a.section())},cellLength:function(a){return a.cells().length}},H5=function(a,b){return E(a,function(a){return Ka.getCell(a,b)})},vF=function(a,b){if(0===a.length)return 0;var c=a[0];return Va(a,function(a){return!b(c.element(),a.element())}).fold(function(){return a.length},function(a){return a})},I5={subgrid:function(a,b,c,d){var e=a[b].cells().slice(c);e=vF(e,d);a=H5(a,c).slice(b);d=vF(a,d);return{colspan:k(e),rowspan:k(d)}}},
Xn={toDetails:function(a,b){var c=E(a,function(a,b){return E(a.cells(),function(a,b){return!1})});return E(a,function(d,e){var f=ia(d.cells(),function(d,f){if(!1===c[e][f]){for(var h=I5.subgrid(a,e,f,b),l=h.rowspan(),g=h.colspan(),k=e;k<e+l;k++)for(var m=f;m<f+g;m++)c[k][m]=!0;return[Oa.detailnew(d.element(),h.rowspan(),h.colspan(),d.isNew())]}return[]});return Oa.rowdetails(f,d.section())})},toGrid:function(a,b,c){for(var d=[],e=0;e<a.grid().rows();e++){for(var f=[],h=0;h<a.grid().columns();h++){var l=
Ib.getAt(a,e,h).map(function(a){return Oa.elementnew(a.element(),c)}).getOrThunk(function(){return Oa.elementnew(b.gap(),!0)});f.push(l)}f=Oa.rowcells(f,a.all()[e].section());d.push(f)}return d}},Yn=function(a,b,c,d){c===d?m.remove(a,b):m.set(a,b,c)},J5={render:function(a,b){var c=[],d=[],e=function(b,e){var f=L.child(a,e).getOrThunk(function(){var b=r.fromTag(e,A.owner(a).dom());y.append(a,b);return b});G.empty(f);b=E(b,function(a){a.isNew()&&c.push(a.element());var b=a.element();G.empty(b);z(a.cells(),
function(a){a.isNew()&&d.push(a.element());Yn(a.element(),"colspan",a.colspan(),1);Yn(a.element(),"rowspan",a.rowspan(),1);y.append(b,a.element())});return b});P.append(f,b)},f=function(b,c){0<b.length?e(b,c):L.child(a,c).each(G.remove)},h=[],l=[],g=[];z(b,function(a){switch(a.section()){case "thead":h.push(a);break;case "tbody":l.push(a);break;case "tfoot":g.push(a)}});f(h,"thead");f(l,"tbody");f(g,"tfoot");return{newRows:k(c),newCells:k(d)}},copy:function(a){return E(a,function(a){var b=Pc.shallow(a.element());
z(a.cells(),function(a){var c=Pc.deep(a.element());Yn(c,"colspan",a.colspan(),1);Yn(c,"rowspan",a.rowspan(),1);y.append(b,c)});return b})}},wF={col:function(a,b,c,d,e){var f=r.fromTag("div");v.setAll(f,{position:"absolute",left:b-d/2+"px",top:c+"px",height:e+"px",width:d+"px"});m.setAll(f,{"data-column":a,role:"presentation"});return f},row:function(a,b,c,d,e){var f=r.fromTag("div");v.setAll(f,{position:"absolute",left:b+"px",top:c-e/2+"px",height:e+"px",width:d+"px"});m.setAll(f,{"data-row":a,role:"presentation"});
return f}},vd={resolve:Dn("ephox-snooker").resolve},Gt=vd.resolve("resizer-bar"),xF=vd.resolve("resizer-rows"),yF=vd.resolve("resizer-cols"),zF=function(a){a=Y.descendants(a.parent(),"."+Gt);z(a,G.remove)},AF=function(a,b,c){var d=a.origin();z(b,function(b,f){b.each(function(b){b=c(d,b);n.add(b,Gt);y.append(a.parent(),b)})})},K5=function(a,b,c,d){AF(a,b,function(a,b){a=wF.col(b.col(),b.x()-a.left(),c.top()-a.top(),7,d);n.add(a,yF);return a})},L5=function(a,b,c,d){AF(a,b,function(a,b){a=wF.row(b.row(),
c.left()-a.left(),b.y()-a.top(),d,7);n.add(a,xF);return a})},BF=function(a,b){a=Y.descendants(a.parent(),"."+Gt);z(a,b)},Fe={refresh:function(a,b,c,d){zF(a);var e=hg.fromTable(b);e=Ib.generate(e);var f=Un.rows(e),h=Un.columns(e);e=bb.absolute(b);c=0<f.length?c.positions(f,b):[];L5(a,c,e,Ia.getOuter(b));d=0<h.length?d.positions(h,b):[];K5(a,d,e,sa.getOuter(b))},hide:function(a){BF(a,function(a){v.set(a,"display","none")})},show:function(a){BF(a,function(a){v.set(a,"display","block")})},destroy:zF,
isRowBar:function(a){return n.has(a,xF)},isColBar:function(a){return n.has(a,yF)}},M5=function(a,b){var c=function(a){return yc(a,function(a){return A.parent(a.element()).map(function(a){var b=A.parent(a).isNone();return Oa.elementnew(a,b)})}).getOrThunk(function(){return Oa.elementnew(b.row(),!0)})};return E(a,function(a){var b=c(a.details());return Oa.rowdatanew(b.element(),a.details(),a.section(),b.isNew())})},CF=function(a,b){a=Xn.toDetails(a,N.eq);return M5(a,b)},Zn=function(a,b){a=Qb(E(a.all(),
function(a){return a.cells()}));return qa(a,function(a){return N.eq(b,a.element())})},Pa={run:function(a,b,c,d,e){return function(f,h,l,q,C){var w=hg.fromTable(h),m=Ib.generate(w);return b(m,l).map(function(b){var c=Xn.toGrid(m,q,!1);b=a(c,b,N.eq,e(q));c=CF(b.grid(),q);return{grid:k(c),cursor:b.cursor}}).fold(function(){return g.none()},function(a){var b=J5.render(h,a.grid());c(h,a.grid(),C);d(h);Fe.refresh(f,h,Wj.height,C);return g.some({cursor:a.cursor,newRows:b.newRows,newCells:b.newCells})})}},
toDetailList:CF,onCell:function(a,b){return sb.cell(b.element()).bind(function(b){return Zn(a,b)})},onCells:function(a,b){b=E(b.selection(),function(b){return sb.cell(b).bind(function(b){return Zn(a,b)})});b=ee(b);return 0<b.length?g.some(b):g.none()},onPaste:function(a,b){return sb.cell(b.element()).bind(function(c){return Zn(a,c).map(function(a){return ua(a,{generators:b.generators,clipboard:b.clipboard})})})},onPasteRows:function(a,b){var c=E(b.selection(),function(b){return sb.cell(b).bind(function(b){return Zn(a,
b)})});c=ee(c);return 0<c.length?g.some(ua({cells:c},{generators:b.generators,clipboard:b.clipboard})):g.none()},onMergable:function(a,b){return b.mergable()},onUnmergable:function(a,b){return b.unmergable()}},DF=function(a,b){return E(a,function(){return Oa.elementnew(b.cell(),!0)})},N5=function(a,b,c){return a.concat(ke.repeat(b,function(b){return Ka.setCells(a[a.length-1],DF(a[a.length-1].cells(),c))}))},O5=function(a,b,c){return E(a,function(a){return Ka.setCells(a,a.cells().concat(DF(ke.range(0,
b),c)))})},gi={measure:function(a,b,c){if(a.row()>=b.length||a.column()>Ka.cellLength(b[0]))return J.error("invalid start address out of table bounds, row: "+a.row()+", column: "+a.column());b=b.slice(a.row());a=b[0].cells().slice(a.column());var d=Ka.cellLength(c[0]);return J.value({rowDelta:k(b.length-c.length),colDelta:k(a.length-d)})},measureWidth:function(a,b){a=Ka.cellLength(a[0]);b=Ka.cellLength(b[0]);return{rowDelta:k(0),colDelta:k(a-b)}},tailor:function(a,b,c){var d=0>b.colDelta()?O5:ca,
e=0>b.rowDelta()?N5:ca;a=d(a,Math.abs(b.colDelta()),c);return e(a,Math.abs(b.rowDelta()),c)}},P5=function(a,b){return hb(a,function(a,d){return Xa(a,function(a){return b(a.element(),d.element())})?a:a.concat([d])},[])},$n={merge:function(a,b,c,d){if(0===a.length)return a;for(c=b.startRow();c<=b.finishRow();c++)for(var e=b.startCol();e<=b.finishCol();e++)Ka.mutateCell(a[c],e,Oa.elementnew(d(),!1));return a},unmerge:function(a,b,c,d){for(var e=!0,f=0;f<a.length;f++)for(var h=0;h<Ka.cellLength(a[0]);h++){var l=
Ka.getCellElement(a[f],h);l=c(l,b);!0===l&&!1===e?Ka.mutateCell(a[f],h,Oa.elementnew(d(),!0)):!0===l&&(e=!1)}return a},splitRows:function(a,b,c,d){if(0<b&&b<a.length){var e=a[b-1].cells();e=P5(e,c);z(e,function(e){for(var f=g.none(),l=b;l<a.length;l++)for(var k=0;k<Ka.cellLength(a[0]);k++){var C=a[l].cells()[k];c(C.element(),e.element())&&(f.isNone()&&(f=g.some(d())),f.each(function(b){Ka.mutateCell(a[l],k,Oa.elementnew(b,!0))}))}})}return a}},Ht={merge:function(a,b,c,d,e){return gi.measure(a,b,c).map(function(f){f=
gi.tailor(b,f,d);var h=a.row(),l=a.column(),g=c.length,k=Ka.cellLength(c[0]);g=h+g;k=l+k;for(var w=h;w<g;w++)for(var m=l;m<k;m++){var F=f,n=w,p=m,r=e,t=Ka.getCell(F[n],p);r=u(r,t.element());t=F[n];1<F.length&&1<Ka.cellLength(t)&&(0<p&&r(Ka.getCellElement(t,p-1))||p<t.length-1&&r(Ka.getCellElement(t,p+1))||0<n&&r(Ka.getCellElement(F[n-1],p))||n<F.length-1&&r(Ka.getCellElement(F[n+1],p)))&&$n.unmerge(f,Ka.getCellElement(f[w],m),e,d.cell);F=Ka.getCellElement(c[w-h],m-l);F=d.replace(F);Ka.mutateCell(f[w],
m,Oa.elementnew(F,!0))}return f})},insert:function(a,b,c,d,e){$n.splitRows(b,a,e,d.cell);e=gi.measureWidth(c,b);c=gi.tailor(c,e,d);e=gi.measureWidth(b,c);b=gi.tailor(b,e,d);return b.slice(0,a).concat(c).concat(b.slice(a,b.length))}},Sd={insertRowAt:function(a,b,c,d,e){var f=a.slice(0,b),h=a.slice(b);c=Ka.mapCells(a[c],function(c,f){return 0<b&&b<a.length&&d(Ka.getCellElement(a[b-1],f),Ka.getCellElement(a[b],f))?Ka.getCell(a[b],f):Oa.elementnew(e(c.element(),d),!0)});return f.concat([c]).concat(h)},
insertColumnAt:function(a,b,c,d,e){return E(a,function(a){var f=0<b&&b<Ka.cellLength(a)&&d(Ka.getCellElement(a,b-1),Ka.getCellElement(a,b))?Ka.getCell(a,b):Oa.elementnew(e(Ka.getCellElement(a,c),d),!0);return Ka.addCell(a,b,f)})},splitCellIntoColumns:function(a,b,c,d,e){var f=c+1;return E(a,function(a,l){l=l===b?Oa.elementnew(e(Ka.getCellElement(a,c),d),!0):Ka.getCell(a,c);return Ka.addCell(a,f,l)})},splitCellIntoRows:function(a,b,c,d,e){var f=b+1,h=a.slice(0,f);f=a.slice(f);a=Ka.mapCells(a[b],function(a,
b){return b===c?Oa.elementnew(e(a.element(),d),!0):a});return h.concat([a]).concat(f)},deleteRowsAt:function(a,b,c){return a.slice(0,b).concat(a.slice(c+1))},deleteColumnsAt:function(a,b,c){a=E(a,function(a){var d=a.cells().slice(0,b).concat(a.cells().slice(c+1));return Oa.rowcells(d,a.section())});return ka(a,function(a){return 0<a.cells().length})}},EF=function(a,b,c,d){var e=function(a){return Xa(b,function(b){return c(a.element(),b.element())})};return E(a,function(a){return Ka.mapCells(a,function(a){return e(a)?
Oa.elementnew(d(a.element(),c),!0):a})})},FF=function(a,b,c,d){return void 0!==Ka.getCellElement(a[b],c)&&0<b&&d(Ka.getCellElement(a[b-1],c),Ka.getCellElement(a[b],c))},GF=function(a,b,c){return 0<b&&c(Ka.getCellElement(a,b-1),Ka.getCellElement(a,b))},ao={replaceColumn:function(a,b,c,d){var e=ia(a,function(d,e){return FF(a,e,b,c)||GF(d,b,c)?[]:[Ka.getCell(d,b)]});return EF(a,e,c,d)},replaceRow:function(a,b,c,d){var e=a[b],f=ia(e.cells(),function(d,f){return FF(a,b,f,c)||GF(e,f,c)?[]:[d]});return EF(a,
f,c,d)}},hi={none:function(){return{fold:function(a,b,c,d,e){return a()}}},only:function(a){return{fold:function(b,c,d,e,f){return c(a)}}},left:function(a,b){return{fold:function(c,d,e,f,h){return e(a,b)}}},middle:function(a,b,c){return{fold:function(d,e,f,h,l){return h(a,b,c)}}},right:function(a,b){return{fold:function(c,d,e,f,h){return h(a,b)}}}},Q5=function(a,b){return 0===a.length?hi.none():1===a.length?hi.only(0):0===b?hi.left(0,1):b===a.length-1?hi.right(b-1,b):0<b&&b<a.length-1?hi.middle(b-
1,b,b+1):hi.none()},R5={determine:function(a,b,c,d){var e=a.slice(0);a=Q5(a,b);var f=function(a){return E(a,k(0))};b=k(f(e));var h=function(a,b){if(0<=c){var h=Math.max(d.minCellWidth(),e[b]-c);return f(e.slice(0,a)).concat([c,h-e[b]]).concat(f(e.slice(b+1)))}h=Math.max(d.minCellWidth(),e[a]+c);var l=e[a]-h;return f(e.slice(0,a)).concat([h-e[a],l]).concat(f(e.slice(b+1)))};return a.fold(b,function(a){return d.singleColumnWidth(e[a],c)},h,function(a,b,c){return h(b,c)},function(a,b){if(0<=c)return f(e.slice(0,
b)).concat([c]);a=Math.max(d.minCellWidth(),e[b]+c);return f(e.slice(0,b)).concat([a-e[b]])})}},HF=function(a,b,c){for(var d=0;a<b;a++)d+=void 0!==c[a]?c[a]:0;return d},bo={recalculateWidth:function(a,b){a=Ib.justCells(a);return E(a,function(a){var c=HF(a.column(),a.column()+a.colspan(),b);return{element:a.element,width:k(c),colspan:a.colspan}})},recalculateHeight:function(a,b){a=Ib.justCells(a);return E(a,function(a){var c=HF(a.row(),a.row()+a.rowspan(),b);return{element:a.element,height:k(c),rowspan:a.rowspan}})},
matchRowHeight:function(a,b){return E(a.all(),function(a,d){return{element:a.element,height:k(b[d])}})}},S5=function(a,b){var c=parseFloat(a),d=Ia.get(b);return{width:k(c),pixelWidth:k(d),getWidths:wk.getPercentageWidths,getCellDelta:function(a){return a/d*100},singleColumnWidth:function(a,b){return[100-a]},minCellWidth:function(){return Qd.minWidth()/d*100},setElementWidth:pc.setPercentageWidth,setTableWidth:function(a,b,d){pc.setPercentageWidth(a,c+d)}}},It=function(a){a=parseInt(a,10);var b=ca;
return{width:k(a),pixelWidth:k(a),getWidths:wk.getPixelWidths,getCellDelta:b,singleColumnWidth:function(a,b){return[Math.max(Qd.minWidth(),a+b)-a]},minCellWidth:Qd.minWidth,setElementWidth:pc.setPixelWidth,setTableWidth:function(a,b,e){b=Eb(b,function(a,b){return a+b},0);pc.setPixelWidth(a,b)}}},IF={getTableSize:function(a){return pc.getRawWidth(a).fold(function(){var b=Ia.get(a);return It(b)},function(b){pc.percentageBasedSizeRegex().test(b)?(b=pc.percentageBasedSizeRegex().exec(b),b=S5(b[1],a)):
pc.pixelBasedSizeRegex().test(b)?(b=pc.pixelBasedSizeRegex().exec(b),b=It(b[1])):(b=Ia.get(a),b=It(b));return b})}},T5=function(a){return Eb(a,function(a,c){return a+c},0)},JF=function(a){a=hg.fromTable(a);return Ib.generate(a)},Wr={adjustWidth:function(a,b,c,d){var e=IF.getTableSize(a);b=e.getCellDelta(b);var f=JF(a),h=e.getWidths(f,d,e);d=R5.determine(h,c,b,e);d=E(d,function(a,b){return a+h[b]});var l=bo.recalculateWidth(f,d);z(l,function(a){e.setElementWidth(a.element(),a.width())});c===f.grid().columns()-
1&&e.setTableWidth(a,d,b)},adjustHeight:function(a,b,c,d){var e=JF(a);d=wk.getPixelHeights(e,d);d=E(d,function(a,d){return c===d?Math.max(b+a,Qd.minHeight()):a});var f=bo.recalculateHeight(e,d);e=bo.matchRowHeight(e,d);z(e,function(a){pc.setHeight(a.element(),a.height())});z(f,function(a){pc.setHeight(a.element(),a.height())});e=T5(d);pc.setHeight(a,e)},adjustWidthTo:function(a,b,c){var d=IF.getTableSize(a);b=Ib.generate(b);c=d.getWidths(b,c,d);b=bo.recalculateWidth(b,c);z(b,function(a){d.setElementWidth(a.element(),
a.width())});c=Eb(c,function(a,b){return b+a},0);0<b.length&&d.setElementWidth(a,c)}},KF=function(a){0===sb.cells(a).length&&G.remove(a)},Cf=O("grid","cursor"),yk=function(a,b,c){return Jt(a,b,c).orThunk(function(){return Jt(a,0,0)})},Jt=function(a,b,c){return g.from(a[b]).bind(function(a){return g.from(a.cells()[c]).bind(function(a){return g.from(a.element())})})},nd=function(a,b,c){return Cf(a,Jt(a,b,c))},Kt=function(a){return hb(a,function(a,c){return Xa(a,function(a){return a.row()===c.row()})?
a:a.concat([c])},[]).sort(function(a,c){return a.row()-c.row()})},Lt=function(a){return hb(a,function(a,c){return Xa(a,function(a){return a.column()===c.column()})?a:a.concat([c])},[]).sort(function(a,c){return a.column()-c.column()})},LF=function(a,b,c){a=hg.fromPastedRows(a,c);a=Ib.generate(a);return Xn.toGrid(a,b,!0)},jg=Wr.adjustWidthTo,nc={insertRowBefore:Pa.run(function(a,b,c,d){var e=b.row(),f=b.row();a=Sd.insertRowAt(a,f,e,c,d.getOrInit);return nd(a,f,b.column())},Pa.onCell,t,t,cc.modification),
insertRowsBefore:Pa.run(function(a,b,c,d){var e=b[0].row(),f=b[0].row(),h=Kt(b);a=hb(h,function(a,b){return Sd.insertRowAt(a,f,e,c,d.getOrInit)},a);return nd(a,f,b[0].column())},Pa.onCells,t,t,cc.modification),insertRowAfter:Pa.run(function(a,b,c,d){var e=b.row(),f=b.row()+b.rowspan();a=Sd.insertRowAt(a,f,e,c,d.getOrInit);return nd(a,f,b.column())},Pa.onCell,t,t,cc.modification),insertRowsAfter:Pa.run(function(a,b,c,d){var e=Kt(b),f=e[e.length-1].row(),h=e[e.length-1].row()+e[e.length-1].rowspan();
a=hb(e,function(a,b){return Sd.insertRowAt(a,h,f,c,d.getOrInit)},a);return nd(a,h,b[0].column())},Pa.onCells,t,t,cc.modification),insertColumnBefore:Pa.run(function(a,b,c,d){var e=b.column(),f=b.column();a=Sd.insertColumnAt(a,f,e,c,d.getOrInit);return nd(a,b.row(),f)},Pa.onCell,jg,t,cc.modification),insertColumnsBefore:Pa.run(function(a,b,c,d){var e=Lt(b),f=e[0].column(),h=e[0].column();a=hb(e,function(a,b){return Sd.insertColumnAt(a,h,f,c,d.getOrInit)},a);return nd(a,b[0].row(),h)},Pa.onCells,jg,
t,cc.modification),insertColumnAfter:Pa.run(function(a,b,c,d){var e=b.column(),f=b.column()+b.colspan();a=Sd.insertColumnAt(a,f,e,c,d.getOrInit);return nd(a,b.row(),f)},Pa.onCell,jg,t,cc.modification),insertColumnsAfter:Pa.run(function(a,b,c,d){var e=b[b.length-1].column(),f=b[b.length-1].column()+b[b.length-1].colspan(),h=Lt(b);a=hb(h,function(a,b){return Sd.insertColumnAt(a,f,e,c,d.getOrInit)},a);return nd(a,b[0].row(),f)},Pa.onCells,jg,t,cc.modification),splitCellIntoColumns:Pa.run(function(a,
b,c,d){a=Sd.splitCellIntoColumns(a,b.row(),b.column(),c,d.getOrInit);return nd(a,b.row(),b.column())},Pa.onCell,jg,t,cc.modification),splitCellIntoRows:Pa.run(function(a,b,c,d){a=Sd.splitCellIntoRows(a,b.row(),b.column(),c,d.getOrInit);return nd(a,b.row(),b.column())},Pa.onCell,t,t,cc.modification),eraseColumns:Pa.run(function(a,b,c,d){c=Lt(b);a=Sd.deleteColumnsAt(a,c[0].column(),c[c.length-1].column());b=yk(a,b[0].row(),b[0].column());return Cf(a,b)},Pa.onCells,jg,KF,cc.modification),eraseRows:Pa.run(function(a,
b,c,d){c=Kt(b);a=Sd.deleteRowsAt(a,c[0].row(),c[c.length-1].row());b=yk(a,b[0].row(),b[0].column());return Cf(a,b)},Pa.onCells,t,KF,cc.modification),makeColumnHeader:Pa.run(function(a,b,c,d){a=ao.replaceColumn(a,b.column(),c,d.replaceOrInit);return nd(a,b.row(),b.column())},Pa.onCell,t,t,cc.transform("row","th")),unmakeColumnHeader:Pa.run(function(a,b,c,d){a=ao.replaceColumn(a,b.column(),c,d.replaceOrInit);return nd(a,b.row(),b.column())},Pa.onCell,t,t,cc.transform(null,"td")),makeRowHeader:Pa.run(function(a,
b,c,d){a=ao.replaceRow(a,b.row(),c,d.replaceOrInit);return nd(a,b.row(),b.column())},Pa.onCell,t,t,cc.transform("col","th")),unmakeRowHeader:Pa.run(function(a,b,c,d){a=ao.replaceRow(a,b.row(),c,d.replaceOrInit);return nd(a,b.row(),b.column())},Pa.onCell,t,t,cc.transform(null,"td")),mergeCells:Pa.run(function(a,b,c,d){d=b.cells();G5.merge(d);a=$n.merge(a,b.bounds(),c,k(d[0]));return Cf(a,g.from(d[0]))},Pa.onMergable,t,t,cc.merging),unmergeCells:Pa.run(function(a,b,c,d){a=Eb(b,function(a,b){return $n.unmerge(a,
b,c,d.combine(b))},a);return Cf(a,g.from(b[0]))},Pa.onUnmergable,jg,t,cc.merging),pasteCells:Pa.run(function(a,b,c,d){d=function(a,b){a=hg.fromTable(a);a=Ib.generate(a);return Xn.toGrid(a,b,!0)}(b.clipboard(),b.generators());var e=Oa.address(b.row(),b.column());return Ht.merge(e,a,d,b.generators(),c).fold(function(){return Cf(a,g.some(b.element()))},function(a){var c=yk(a,b.row(),b.column());return Cf(a,c)})},Pa.onPaste,jg,t,cc.modification),pasteRowsBefore:Pa.run(function(a,b,c,d){var e=a[b.cells[0].row()];
d=b.cells[0].row();e=LF(b.clipboard(),b.generators(),e);a=Ht.insert(d,a,e,b.generators(),c);b=yk(a,b.cells[0].row(),b.cells[0].column());return Cf(a,b)},Pa.onPasteRows,t,t,cc.modification),pasteRowsAfter:Pa.run(function(a,b,c,d){var e=a[b.cells[0].row()];d=b.cells[b.cells.length-1].row()+b.cells[b.cells.length-1].rowspan();e=LF(b.clipboard(),b.generators(),e);a=Ht.insert(d,a,e,b.generators(),c);b=yk(a,b.cells[0].row(),b.cells[0].column());return Cf(a,b)},Pa.onPasteRows,t,t,cc.modification)},Mt=function(a){return function(b,
c){return hb(a,function(a,e){return a.bind(function(a){return U5(c,function(a){return V5(e,b,c,a)})})},J.value(c))}},W5=Mt([nc.makeRowHeader,nc.makeColumnHeader]),X5=Mt([nc.makeRowHeader]),Y5=Mt([nc.makeColumnHeader]),V5=function(a,b,c,d){return Rr.fromEngine(b).bind(function(e){e=k(e);var f=t;return Ac.execute(b.region(),a,f,e)(b.content(),c,{element:k(d)})})},U5=function(a,b){return L.descendant(a,"td,th").bind(function(a){return b(a)}).fold(function(){return J.error("Could not run the operation on table")},
function(b){return J.value(a)})},Qf={setCaption:function(a,b){var c=L.child(a,"caption").fold(function(){return r.fromTag("caption")},function(a){G.empty(a);return a});Ea.set(c,b);y.prepend(a,c)},setSummary:function(a,b){m.set(a,"summary",b)},setDimensions:function(a,b){D5.redistribute(a,b.width(),b.height(),"rtl"===m.get(a,"dir")?$l.rtl:$l.ltr)},addBothHeaders:W5,addRowHeader:X5,addColumnHeader:Y5},Nt=ta.generate([{field:["name","textkey","f"]},{select:["name","textkey","values"]},{toggles:["name",
"textkey","options"]}]),Z5=O("value","text"),$5=O("value","icon","textkey"),jc={field:Nt.field,select:Nt.select,toggles:Nt.toggles,pair:Z5,toggle:$5,cata:function(a,b,c,d){return a.fold(b,c,d)}},a6=function(a,b){z(a,function(a){b.get(a.severity()).fold(function(){console.warn("unknown severity for accessibility rule: ",a.id(),a.severity())},function(c){ma.add(a.element(),[b.violation(),c.style()]);ff.add(a.element(),c.attribute(),a.id())})});g.from(a[0]).each(function(a){var c=a.element(),e=b.currentAttr();
a=a.severity();m.set(c,e,a)})},b6=function(a,b,c,d){a=Y.descendants(a,"["+b+"]");z(a,function(a){m.remove(a,b)});m.set(c,b,d)},c6=function(a,b){a=Y.descendants(a,"."+b.violation());z(a,function(a){n.remove(a,b.violation());m.remove(a,b.currentAttr());z(b.all(),function(b){n.remove(a,b.style());m.remove(a,b.attribute())})})},MF=function(a,b,c){var d=function(b){return 0===ff.read(a,b.attribute()).length};b.get(c).each(function(b){d(b)&&n.remove(a,b.style())});ob(b.all(),d)&&n.remove(a,b.violation())},
d6=function(a,b,c,d){b.get(d).each(function(d){ff.remove(a,d.attribute(),c);ff.add(a,b.ignoreAttr(),c);d=b.currentAttr();m.remove(a,d)})},e6=function(a,b,c,d){b.get(d).each(function(d){ff.remove(a,d.attribute(),c);d=b.currentAttr();m.remove(a,d)})},f6={manager:function(a){var b=a.content();return{start:function(b){a6(b,a)},moveTo:function(c,d){b.body().each(function(b){b6(b,a.currentAttr(),c,d)})},stop:function(){b.body().each(function(b){c6(b,a)})},ignore:function(b,d,e){d6(b,a,d,e);MF(b,a,e)},solve:function(b,
d,e){e6(b,a,d,e);MF(b,a,e)}}}},ii=function(a){return function(b){z(b,a)}},g6=ii(G.remove),h6=ii(function(a){m.set(a,"class","")}),i6=ii(function(a){var b=A.children(a);P.before(a,b);G.remove(a)}),j6=mb(),k6=function(a){return D.isText(a)?(a=Vb.get(a),""===a||a===j6):!1},l6=ii(function(a){if(D.isElement(a)){var b=A.childNodesCount(a);b=0===b||1===b&&A.child(a,0).exists(k6)}else b=!1;b&&m.hasNone(a)&&G.remove(a)}),Na={remove:g6,clearClasses:h6,removeClass:function(a){return ii(function(b){n.remove(b,
a)})},removeAttr:function(a){return ii(function(b){m.remove(b,a)})},unwrap:i6,removeIfEmpty:l6},zk=function(a){return"data-"+B.resolve(a)},NF=zk("a11y-current-violation"),OF=B.resolve("a11y-violation"),PF=B.resolve("a11y-severity-info"),QF=B.resolve("a11y-severity-warn"),RF=B.resolve("a11y-severity-error"),co=zk("a11y-ignore"),SF=zk("a11y-error"),TF=zk("a11y-warning"),UF=zk("a11y-info"),Ot=Aa(["style","attribute"],[]),VF=Ot({style:RF,attribute:SF}),WF=Ot({style:QF,attribute:TF}),XF=Ot({style:PF,attribute:UF}),
m6=function(a){return"error"===a?g.some(VF):"warning"===a?g.some(WF):"info"===a?g.some(XF):g.none()},Sq={configure:function(a){a.addSelector(a.output(),"["+co+"]",Na.removeAttr(co));z([a.output(),a.input(),a.history(),a.internal()],function(b){z([OF,PF,QF,RF],function(c){a.add(b,c,Na.removeClass(c))});z([NF,SF,TF,UF],function(c){a.addSelector(b,"["+c+"]",Na.removeAttr(c))})})},ignoreAttr:k(co),manager:function(a){return f6.manager({content:k(a),violation:k(OF),currentAttr:k(NF),ignoreAttr:k(co),get:m6,
all:k([VF,WF,XF])})}},YF=B.resolve("highlight-common"),Pt=B.resolve("highlight-placeholder"),rf={configure:function(a){a.add(a.output(),YF,Na.unwrap);a.add(a.history(),Pt,Na.unwrap);a.add(a.output(),Pt,Na.unwrap);a.add(a.output(),"ephox-custom-highlight",Na.unwrap);a.add(a.history(),"ephox-custom-highlight",Na.unwrap)},highlightClass:k(YF),customHighlightClass:k("ephox-custom-highlight"),placeholderClass:k(Pt)},ZF=function(){return Qt(function(a,b,c){return a()},"off")},$F=function(){return Qt(function(a,
b,c){return b()},"unchanged")},aG=function(a){return Qt(function(b,c,d){return d(a)},"on")},Qt=function(a,b){return{fold:a,map:function(b){return a(ZF,$F,function(a){return aG(b(a))})},label:k(b)}},Da={off:ZF,unchanged:$F,on:aG},bG=O("content"),se={hasSelection:function(a){return a.getSelection().fold(function(){return bG(Da.off())},function(){return bG(Da.on(!0))})},isAnnotation:function(a){return n.has(a,"ephox-cram-annotation-wrap")||n.has(a,rf.customHighlightClass())},isEmptyText:function(a){return D.isText(a)&&
0===Ya.get(a).length},isTextArea:function(a){return"textarea"===D.name(a)}},OA={descend:function(a,b){var c=A.children(a);if(0===c.length||se.isTextArea(a))return W.point(a,b);if(b<c.length&&!se.isTextArea(c[b]))return W.point(c[b],0);c=c[c.length-1];if(se.isTextArea(c))return W.point(a,b);a=D.isText(c)?Ya.get(c).length:"img"===D.name(c)?1:A.children(c).length;return W.point(c,a)}},Rt=ta.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),la={before:Rt.before,on:Rt.on,after:Rt.after,
cata:function(a,b,c,d){return a.fold(b,c,d)},getStart:function(a){return a.fold(ca,ca,ca)}},eo=ta.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),n6=O("start","soffset","finish","foffset"),o6=function(a){return a.match({domRange:function(a){return r.fromDom(a.startContainer)},relative:function(a,c){return la.getStart(a)},exact:function(a,c,d,e){return a}})},Lc={domRange:eo.domRange,relative:eo.relative,exact:eo.exact,exactFromRange:function(a){return eo.exact(a.start(),
a.soffset(),a.finish(),a.foffset())},range:n6,getWin:function(a){a=o6(a);return A.defaultView(a)}},cG=function(a,b,c,d){var e=A.owner(a).dom().createRange();e.setStart(a.dom(),b);e.setEnd(c.dom(),d);return e},id={after:function(a,b,c,d){var e=cG(a,b,c,d);a=N.eq(a,c)&&b===d;return e.collapsed&&!a},commonAncestorContainer:function(a,b,c,d){a=cG(a,b,c,d);return r.fromDom(a.commonAncestorContainer)}},p6={fromElements:function(a,b){var c=(b||Hb).createDocumentFragment();z(a,function(a){c.appendChild(a.dom())});
return r.fromDom(c)}},dG=function(a,b){a.selectNodeContents(b.dom())},q6=function(a,b){b.fold(function(b){a.setStartBefore(b.dom())},function(b,d){a.setStart(b.dom(),d)},function(b){a.setStartAfter(b.dom())})},r6=function(a,b){b.fold(function(b){a.setEndBefore(b.dom())},function(b,d){a.setEnd(b.dom(),d)},function(b){a.setEndAfter(b.dom())})},eG=function(a){a.deleteContents()},fG=function(a){return{left:k(a.left),top:k(a.top),right:k(a.right),bottom:k(a.bottom),width:k(a.width),height:k(a.height)}},
tc={create:function(a){return a.document.createRange()},replaceWith:function(a,b){eG(a);a.insertNode(b.dom())},selectNodeContents:function(a,b){a=a.document.createRange();dG(a,b);return a},selectNodeContentsUsing:dG,relativeToNative:function(a,b,c){a=a.document.createRange();q6(a,b);r6(a,c);return a},exactToNative:function(a,b,c,d,e){a=a.document.createRange();a.setStart(b.dom(),c);a.setEnd(d.dom(),e);return a},deleteContents:eG,cloneFragment:function(a){a=a.cloneContents();return r.fromDom(a)},getFirstRect:function(a){var b=
a.getClientRects();a=0<b.length?b[0]:a.getBoundingClientRect();return 0<a.width||0<a.height?g.some(a).map(fG):g.none()},getBounds:function(a){a=a.getBoundingClientRect();return 0<a.width||0<a.height?g.some(a).map(fG):g.none()},isWithin:function(a,b){return 1>b.compareBoundaryPoints(a.END_TO_START,a)&&-1<b.compareBoundaryPoints(a.START_TO_END,a)},toString:function(a){return a.toString()}},Ak=ta.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),gG=
function(a,b,c){return b(r.fromDom(c.startContainer),c.startOffset,r.fromDom(c.endContainer),c.endOffset)},s6=function(a,b){return b.match({domRange:function(a){return{ltr:k(a),rtl:g.none}},relative:function(b,d){return{ltr:gc(function(){return tc.relativeToNative(a,b,d)}),rtl:gc(function(){return g.some(tc.relativeToNative(a,d,b))})}},exact:function(b,d,e,f){return{ltr:gc(function(){return tc.exactToNative(a,b,d,e,f)}),rtl:gc(function(){return g.some(tc.exactToNative(a,e,f,b,d))})}}})},t6=function(a,
b){var c=b.ltr();return c.collapsed?b.rtl().filter(function(a){return!1===a.collapsed}).map(function(a){return Ak.rtl(r.fromDom(a.endContainer),a.endOffset,r.fromDom(a.startContainer),a.startOffset)}).getOrThunk(function(){return gG(a,Ak.ltr,c)}):gG(a,Ak.ltr,c)},hG=function(a,b){b=s6(a,b);return t6(a,b)},Le={ltr:Ak.ltr,rtl:Ak.rtl,diagnose:hG,asLtrRange:function(a,b){return hG(a,b).match({ltr:function(b,d,e,f){var c=a.document.createRange();c.setStart(b.dom(),d);c.setEnd(e.dom(),f);return c},rtl:function(b,
d,e,f){var c=a.document.createRange();c.setStart(e.dom(),f);c.setEnd(b.dom(),d);return c}})}},St={inRect:function(a,b,c){return b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom},searchForPoint:function(a,b,c,d,e){if(0===e)return 0;if(b===d)return e-1;for(var f=1;f<e;f++){var h=a(f),l=Math.abs(b-h.left);if(c<=h.bottom){if(c<h.top||l>d)return f-1;d=l}}return 0}},u6=function(a,b,c,d,e){var f=function(c){var d=a.dom().createRange();d.setStart(b.dom(),c);d.collapse(!0);return d},h=Ya.get(b).length;c=St.searchForPoint(function(a){return f(a).getBoundingClientRect()},
c,d,e.right,h);return f(c)},iG=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getClientRects();return yc(e,function(a){return St.inRect(a,c,d)?g.some(a):g.none()}).map(function(e){return u6(a,b,c,d,e)})},jG=function(a,b,c,d){var e=a.dom().createRange();b=A.children(b);return yc(b,function(b){e.selectNode(b.dom());return St.inRect(e.getBoundingClientRect(),c,d)?(D.isText(b)?iG:jG)(a,b,c,d):g.none()})},v6={locate:function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());
e=e.getBoundingClientRect();c=Math.max(e.left,Math.min(e.right,c));d=Math.max(e.top,Math.min(e.bottom,d));return(D.isText(b)?iG:jG)(a,b,c,d)}},kG=function(a,b,c){a=a.dom().createRange();a.selectNode(b.dom());a.collapse(c);return a},w6=function(a,b,c){var d=a.dom().createRange();d.selectNode(b.dom());d=d.getBoundingClientRect();var e=c-d.left<d.right-c?!0:!1;return(!0===e?kc.first:kc.last)(b).map(function(b){return kG(a,b,e)})},x6=function(a,b,c){var d=b.dom().getBoundingClientRect();return g.some(kG(a,
b,c-d.left<d.right-c?!0:!1))},y6={search:function(a,b,c){return(0===A.children(b).length?x6:w6)(a,b,c)}},z6=function(a,b,c){return g.from(a.dom().caretPositionFromPoint(b,c)).bind(function(b){if(null===b.offsetNode)return g.none();var c=a.dom().createRange();c.setStart(b.offsetNode,b.offset);c.collapse();return g.some(c)})},A6=function(a,b,c){return g.from(a.dom().caretRangeFromPoint(b,c))},B6=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getBoundingClientRect();return v6.locate(a,
b,Math.max(e.left,Math.min(e.right,c)),Math.max(e.top,Math.min(e.bottom,d)))},C6=function(a,b,c){return r.fromPoint(a,b,c).bind(function(d){var e=function(){return y6.search(a,d,b)};return 0===A.children(d).length?e():B6(a,d,b,c).orThunk(e)})},D6=document.caretPositionFromPoint?z6:document.caretRangeFromPoint?A6:C6,E6={fromPoint:function(a,b,c){a=r.fromDom(a.document);return D6(a,b,c).map(function(a){return Lc.range(r.fromDom(a.startContainer),a.startOffset,r.fromDom(a.endContainer),a.endOffset)})}},
F6=function(a,b,c,d){var e=tc.create(a);a=(Fa.is(b,d)?[b]:[]).concat(Y.descendants(b,d));return ka(a,function(a){tc.selectNodeContentsUsing(e,a);return tc.isWithin(c,e)})},G6={find:function(a,b,c){b=Le.asLtrRange(a,b);var d=r.fromDom(b.commonAncestorContainer);return D.isElement(d)?F6(a,d,b,c):[]}},Bk=function(a,b){var c=D.name(a);return"input"===c?la.after(a):U(["br","img"],c)?0===b?la.before(a):la.after(a):la.on(a,b)},lG=function(a,b){a=a.fold(la.before,Bk,la.after);b=b.fold(la.before,Bk,la.after);
return Lc.relative(a,b)},Tt=function(a,b,c,d){a=Bk(a,b);c=Bk(c,d);return Lc.relative(a,c)},Ut={beforeSpecial:Bk,preprocess:function(a){return a.match({domRange:function(a){var b=r.fromDom(a.startContainer),d=r.fromDom(a.endContainer);return Tt(b,a.startOffset,d,a.endOffset)},relative:lG,exact:Tt})},preprocessRelative:lG,preprocessExact:Tt},fo=function(a,b){g.from(a.getSelection()).each(function(a){a.removeAllRanges();a.addRange(b)})},mG=function(a,b){return Le.diagnose(a,b).match({ltr:function(b,
d,e,f){b=tc.exactToNative(a,b,d,e,f);fo(a,b)},rtl:function(b,d,e,f){var c=a.getSelection();if(c.setBaseAndExtent)c.setBaseAndExtent(b.dom(),d,e.dom(),f);else if(c.extend)try{c.collapse(b.dom(),d),c.extend(e.dom(),f)}catch(l){b=tc.exactToNative(a,e,f,b,d),fo(a,b)}else b=tc.exactToNative(a,e,f,b,d),fo(a,b)}})},H6=function(a){var b=r.fromDom(a.anchorNode),c=r.fromDom(a.focusNode);id.after(b,a.anchorOffset,c,a.focusOffset)?a=g.some(Lc.range(r.fromDom(a.anchorNode),a.anchorOffset,r.fromDom(a.focusNode),
a.focusOffset)):0<a.rangeCount?(b=a.getRangeAt(0),a=a.getRangeAt(a.rangeCount-1),a=g.some(Lc.range(r.fromDom(b.startContainer),b.startOffset,r.fromDom(a.endContainer),a.endOffset))):a=g.none();return a},nG=function(a){return g.from(a.getSelection()).filter(function(a){return 0<a.rangeCount}).bind(H6)},Wa={setExact:function(a,b,c,d,e){b=Ut.preprocessExact(b,c,d,e);mG(a,b)},getExact:nG,get:function(a){return nG(a).map(function(a){return Lc.exact(a.start(),a.soffset(),a.finish(),a.foffset())})},setRelative:function(a,
b,c){b=Ut.preprocessRelative(b,c);mG(a,b)},toNative:function(a){var b=Lc.getWin(a).dom(),c=function(a,c,f,h){return tc.exactToNative(b,a,c,f,h)};a=Ut.preprocess(a);return Le.diagnose(b,a).match({ltr:c,rtl:c})},setToElement:function(a,b){b=tc.selectNodeContents(a,b);fo(a,b)},clear:function(a){a.getSelection().removeAllRanges()},clone:function(a,b){a=Le.asLtrRange(a,b);return tc.cloneFragment(a)},replace:function(a,b,c){b=Le.asLtrRange(a,b);a=p6.fromElements(c,a.document);tc.replaceWith(b,a)},deleteAt:function(a,
b){a=Le.asLtrRange(a,b);tc.deleteContents(a)},forElement:function(a,b){a=tc.selectNodeContents(a,b);return Lc.range(r.fromDom(a.startContainer),a.startOffset,r.fromDom(a.endContainer),a.endOffset)},getFirstRect:function(a,b){a=Le.asLtrRange(a,b);return tc.getFirstRect(a)},getBounds:function(a,b){a=Le.asLtrRange(a,b);return tc.getBounds(a)},getAtPoint:function(a,b,c){return E6.fromPoint(a,b,c)},findWithin:function(a,b,c){return G6.find(a,b,c)},getAsString:function(a,b){a=Le.asLtrRange(a,b);return tc.toString(a)},
isCollapsed:function(a,b,c,d){return N.eq(a,c)&&b===d}},oG=function(a,b){return ja.inBody(a)?g.some(Math.max(0,Math.min(b,wa.getEnd(a)))):g.none()},xj={findDescendants:function(a,b,c,d,e){var f=A.defaultView(a);return oG(a,b).bind(function(b){return oG(c,d).map(function(d){d=Lc.exact(a,b,c,d);return Wa.findWithin(f.dom(),d,e)})}).getOr([])},findAncestors:function(a,b,c){return L.ancestor(a,c).fold(function(){return L.ancestor(b,c).toArray()},function(a){return L.ancestor(b,c).fold(k([a]),function(b){return N.eq(a,
b)?[a]:[a,b]})})}},I6=aa.detect().browser.isFirefox(),go=function(a){return a.filter(function(a){return"img"===D.name(a)})},J6=function(a){var b=go(A.child(a.startContainer(),a.startOffset()));return go(A.nextSibling(a.startContainer())).orThunk(function(){return b}).bind(function(c){return go(A.prevSibling(a.endContainer())).bind(function(d){d=N.eq(c,d);var e=a.startContainer().dom().length===a.startOffset(),f=0===a.endOffset();return d&&(e||b.isSome())&&f?g.some(c):g.none()})})},K6=function(a){var b=
a.startContainer();if(!N.eq(b,a.endContainer()))return g.none();if("img"===D.name(b))return g.some(b);var c=Math.min(a.startOffset(),a.endOffset());a=Math.max(a.startOffset(),a.endOffset());b=go(A.child(b,c));return a===c||a===c+1?b:I6&&a===c+2?b.filter(function(a){return A.nextSibling(a).filter(se.isEmptyText).isSome()}):g.none()},pG=O("image"),qG=function(a){return a.filter(function(a){return!a.collapsed()}).bind(function(a){return K6(a).orThunk(function(){return J6(a)})})},rG=function(a,b){return!Xa(b,
function(b){return Fa.is(a,b)})},vc={allowedForEditing:rG,detect:function(a){return qG(a).map(pG)},detectForEditing:function(a,b){return qG(a).filter(function(a){return rG(a,b)}).map(pG)}},sG=aa.detect().browser.isFirefox(),L6=function(a,b){return vc.detect(g.some(a)).filter(function(a){return N.eq(a.image(),b)}).isSome()},tG=function(a,b){var c=function(){a.setRelativeSelection(la.before(b),la.after(b))},d=sG?function(){a.getSelection().fold(c,function(c){M6(a,c,b)})}:c;a.focus();d()},M6=function(a,
b,c){2===Math.abs(b.startOffset()-b.endOffset())&&L6(b,c)||(b=A.nextSibling(c).filter(se.isEmptyText).getOrThunk(function(){var a=r.fromText("");y.after(c,a);return a}),a.setRelativeSelection(la.before(c),la.after(b)))},ie={selectionContains:function(a){a=xj.findDescendants(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset(),"img");return 1===a.length?g.some(a[0]):g.none()},remove:function(a,b){a.setRelativeSelection(la.before(b),la.before(b));G.remove(b)},select:tG,reselect:sG?tG:t},
Vt=function(a,b){var c=bb.absolute(a),d=sa.get(a);return{element:k(a),bottom:k(c.top()+d),pos:k(c),cleanup:b}},N6=function(a,b){a=OA.descend(a,b);b=r.fromText(mb());var c=r.fromTag("span");y.append(c,b);y.before(a.element(),c);return Vt(c,function(){G.remove(c)})},vG=function(a,b){a.getSelection().each(function(c){uG(a,function(d,e){O6(a,b,c)},c)})},O6=function(a,b,c){a.body().each(function(d){a.doc().each(function(a){v.reflow(d);var e=Za.get(a).top(),h=N6(c.startContainer(),c.startOffset());b(a,
e,h);h.cleanup()})})},wG=function(a,b,c){a.doc().each(function(a){var d=Za.get(a).top();c(a,d,b)})},xG=function(a,b,c){var d=a.dom().defaultView.innerHeight,e=c.pos();c.bottom()>d+b?(b=e.top()-d+1.5*sa.get(c.element()),Za.to(e.left(),b,a)):e.top()<b&&Za.to(e.left(),e.top(),a)},yG=function(a,b,c,d){a.body().each(function(e){var f=sa.get(a.element()),h=e.dom();var l=Math.max(h.offsetHeight,h.scrollHeight);h=d.pos();d.bottom()>l?v.set(e,"min-height",d.bottom()+"px"):v.remove(e,"min-height");h.top()<
c?Za.to(h.left(),h.top(),b):h.top()>f+c&&(e=h.top()-f+(d.bottom()-h.top()),Za.to(h.left(),e,b));e=pk.find(d.element());f=Za.get().top();h=window.innerHeight+f;e.top()<f?Za.intoView(d.element(),!0):e.top()>h&&Za.intoView(d.element(),!1)})},P6=function(a){vG(a,xG)},Q6=function(a,b){wG(a,Vt(b,t),xG)},R6=function(a){vG(a,u(yG,a))},S6=function(a,b){wG(a,Vt(b,t),u(yG,a))},uG=function(a,b,c){var d=c.startContainer(),e=c.startOffset(),f=c.endContainer();c=c.endOffset();b(d,f);a.setSelection(d,e,f,c);vc.detect(a.getSelection()).each(function(b){ie.select(a,
b.image())})},Og={cursorIntoView:function(a){(a.isInline()?P6:R6)(a)},elementIntoView:function(a,b){(a.isInline()?Q6:S6)(a,b)},preserve:function(a,b){a.getSelection().each(function(c){uG(a,b,c)})}},T6=aa.detect(),Wt=function(a,b,c){a=r.fromTag(a);c=x.translate(c);return zG(a,b,c)},zG=function(a,b,c){c=S.labelledField(a,b,c);n.add(c.element(),B.resolve("form-group"));n.add(c.element(),B.resolve(b));"select"===D.name(a)&&(a=T.div(),n.add(a,B.resolve("select-wrap")),y.append(a,c.field()),y.append(c.element(),
a));return c},Wc={input:function(a,b){a=Wt("input",a,b);T6.browser.isSafari()&&m.setAll(a.field(),{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});m.setAll(a.field(),{type:"text"});return{element:a.element,input:a.field}},textarea:function(a,b){a=Wt("textarea",a,b);S.multiline(a.field());return{element:a.element,textarea:a.field}},common:Wt,commonWith:zG,comboBox:function(a,b,c){var d=r.fromTag("input"),e=x.translate(b);b=T.div();var f=a+Ha("");e=r.fromHtml("<label>"+
e+"</label>");m.set(e,"for",f);m.set(d,"id",f);n.add(b,B.resolve("form-group"));n.add(b,B.resolve(a));a=T.span();S.hidden(a,!0);f=T.span();S.hidden(f,!0);ma.add(f,["ephox-textbox-font",B.resolve("icon"),B.resolve("combo-drop-arrow-icon")]);n.add(a,B.resolve("combo-drop-arrow"));y.append(a,f);var h=T.div();n.add(h,B.resolve("label-wrap"));c.each(function(a){y.append(h,a)});y.append(h,e);c=T.div();n.add(c,B.resolve("combo-wrap"));P.append(c,[d,a]);m.set(d,"type","text");P.append(b,[h,c]);return{element:k(b),
input:k(d),dropArrow:k(a)}}},AG=function(a){n.add(a,B.resolve("dialog-button-default"))},BG=function(a){n.add(a,B.resolve("dialog-button"))},Xt=function(a,b,c){var d=Oc(a+b);n.add(d.element(),B.resolve("dialog-"+b));a=Rc(x.translate(c));d.content(a);m.set(d.element(),"tabindex","-1");S.textButton(d.element(),a.element());return{enable:function(){d.enable();ra.enable(d.element())},disable:function(){d.disable();ra.disable(d.element())},element:d.element,name:d.name,destroy:d.destroy,content:d.content,
disabled:d.disabled,click:d.click,events:d.events}},U6=function(a){a=Xt(a,"ok","button.ok");AG(a.element());return a},V6=function(a){a=Xt(a,"cancel","button.cancel");BG(a.element());return a},td={button:Xt,okCancel:function(a){var b=void 0!==a?a+"-":"";a=T.div();n.add(a,B.resolve(b+"dialog-controls"));var c=V6(b),d=U6(b);P.append(a,[c.element(),d.element()]);b=H.create({ok:Q([],d.events.click),cancel:Q([],c.events.click)});return{element:k(a),ok:k(d),cancel:k(c),destroy:function(){d.destroy();c.destroy()},
events:b.registry}},makeNormal:BG,makeDefault:AG},Yt=function(a,b){a=a();var c=a.element();S.button(c,b);m.set(c,"tabindex","-1");a.events.click.bind(function(){Z.focus(c)});return a},CG=function(a,b){var c=Yt(Oc,b);c.content(bf([a,B.resolve("icon")]));m.set(c.element(),"title",b);return c},FU={setDefaultAction:function(a){td.makeDefault(a)},setNormalButton:function(a){td.makeNormal(a)},makeTextButton:function(a,b,c){b=Yt(Oc,b);ma.add(b.element(),a);b.content(Rc(c));return b},makeIconToggle:function(a,
b,c){var d=Yt($d,c);d.content(bf([b,B.resolve("icon")]));n.add(d.element(),B.resolve("choice-button"));m.set(d.element(),"data-value",a);m.set(d.element(),"title",c);return d},makeField:function(a,b,c){return Wc.commonWith(a,b,c)},makeIconButton:CG,makeIconStepperButton:function(a,b){a=CG(a,b);n.add(a.element(),B.resolve("stepper-button"));return a}},Zt={"a11y.widget.ok.label":"button.ok","a11y.widget.ok.text":"button.ok","a11y.widget.ignore.label":"a11y.widget.ignore","a11y.widget.ignore.text":"a11y.widget.ignore",
"a11y.widget.repair.label":"a11y.widget.repair","a11y.widget.repair.text":"a11y.widget.repair","a11y.widget.repair.available":"a11y.widget.available","a11y.i1.description":"a11y.image.alttext.empty","a11y.i1.repair.info":"a11y.image.alttext.set","a11y.i1.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i1.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate","a11y.i2.description":"a11y.image.alttext.filenameduplicate","a11y.i2.repair.info":"a11y.image.alttext.set",
"a11y.i2.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i2.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate","a11y.t1.description":"a11y.table.caption.empty","a11y.t1.repair.info":"a11y.table.caption.set","a11y.t1.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t1.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t2.description":"a11y.table.summary.empty","a11y.t2.repair.info":"a11y.table.summary.set","a11y.t2.repair.errors.empty":"a11y.table.summary.validation.empty",
"a11y.t2.repair.errors.duplicate":"a11y.table.summary.validation.captionduplicate","a11y.t3.description":"a11y.table.caption.summaryduplicate","a11y.t3.repair.info":"a11y.table.caption.set","a11y.t3.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t3.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t4a.description":"a11y.table.rowscells.none","a11y.t4b.description":"a11y.table.headers.none","a11y.t4b.repair.info":"a11y.table.headers.set","a11y.t4b.repair.row":"table.row-header",
"a11y.t4b.repair.column":"table.column-header","a11y.t4b.repair.errors.none":"a11y.table.headers.validation.none","a11y.t4c.description":"a11y.table.headerscope.none","a11y.t4c.repair.info":"a11y.table.headerscope.set","a11y.t4c.repair.scope.row":"a11y.table.headerscope.scope.row","a11y.t4c.repair.scope.col":"a11y.table.headerscope.scope.col","a11y.t4c.repair.scope.rowgroup":"a11y.table.headerscope.scope.rowgroup","a11y.t4c.repair.scope.colgroup":"a11y.table.headerscope.scope.colgroup","a11y.d1.description":"a11y.heading.paragraphmisuse",
"a11y.d1.repair.info":"a11y.heading.set","a11y.d1.repair.block.h1":"block.h1","a11y.d1.repair.block.h2":"block.h2","a11y.d1.repair.block.h3":"block.h3","a11y.d1.repair.block.h4":"block.h4","a11y.d1.repair.block.h5":"block.h5","a11y.d1.repair.block.h6":"block.h6","a11y.d2.description":"a11y.heading.nonsequential","a11y.d3.description":"a11y.link.adjacent","a11y.d4.description":"a11y.list.paragraphmisuse","a11y.d5a.description":"a11y.contrast.largetext","a11y.d5b.description":"a11y.contrast.smalltext"},
Oy={get:function(a){return g.from(Zt[a])},translate:function(a){var b=Array.prototype.slice.call(arguments,1);return x.translate.apply(void 0,[void 0!==Zt[a]?Zt[a]:a].concat(b))}},HU=Aa(["rules"],[]),DG=Aa(["rule","element"],[]),W6=function(a,b){return ia(b,function(b){return b.check()(a)?[DG({rule:b,element:a})]:[]})},X6=function(a,b){return ia(b,function(b){return E(b.check()(a),function(a){return DG({rule:b,element:a})})})},vU={audit:function(a,b){var c=[],d=p1(b,function(a){return a.walkable()});
b=d.pass;d=d.fail;for(var e=document.createTreeWalker(a,Kc.getOrDie("NodeFilter").SHOW_ELEMENT,null,!1);e.nextNode();)c=c.concat(W6(e.currentNode,b));a=X6(a,d);c=c.concat(a);c.sort(function(a,b){a=a.element();b=b.element();return a===b?0:om.documentPositionPreceding(a,b)?1:-1});return c}},Zc=Aa("id wcag severity desckey url walkable check".split(" "),[]),$c={error:k("error"),warning:k("warning"),info:k("info")},nh={match:function(a,b){return a.matches?a.matches(b):a.webkitMatchesSelector?a.webkitMatchesSelector(b):
a.mozMatchesSelector?a.mozMatchesSelector(b):a.msMatchesSelector?a.msMatchesSelector(b):!1}},Y6=function(a){return ob(a.childNodes,function(a){return/^(b|strong)$/i.test(a.nodeName)})},Z6=Zc({id:"D1",wcag:"1.3.1",severity:$c.warning(),desckey:"a11y.d1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return nh.match(a,"p")?Y6(a):!1}}),$6=Zc({id:"D2",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.d2.description",
url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){a=a.querySelectorAll("h1, h2, h3, h4, h5, h6");var b,c=[];z(a,function(a){var d=parseInt(a.tagName.slice(1),10);b&&1<d-b&&c.push(a);b=d});return c}}),a7=Zc({id:"D3",wcag:"2.4.4",severity:$c.error(),desckey:"a11y.d3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/navigation-mechanisms-refs.html",walkable:!1,check:function(a){return ka(a.querySelectorAll("a + a"),
function(a){return a.href===a.previousSibling.href})}}),EG=function(a){var b=a.nodeName;for(a=a.nextSibling;null!==a&&("#text"===a.nodeName||"BR"===a.nodeName);)a=a.nextSibling;return null!==a&&a.nodeName===b?a:!1},FG={check:function(a,b){a=a.querySelectorAll("p,h1,h2,h3,h4,h5,h6");for(var c=[],d=0;d<a.length;){var e=a[d];var f=b;var h=EG(e);for(e=f(e)?[e]:[];!1!==h&&f(h);)e.push(h),h=EG(h);f=e;if(1<f.length){c.push(f[0]);f=f[f.length-1];h=-1;for(e=0;e<a.length;e++)if(a[e]===f){h=e;break}f=h;d=-1===
f?d+1:f}else d++}return c}},b7=function(a){return a.textContent.match(/^\s{0,}([a-z1-9]|i+)\s{0,}[.)-]/gmi)},c7=Zc({id:"D4o",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){return FG.check(a,b7)}}),d7=function(a){return a.textContent.match(/^\s{0,}(\*|-)\s{0,}/gmi)},e7=Zc({id:"D4u",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!1,check:function(a){return FG.check(a,d7)}}),GG=O("red","green","blue","alpha"),Ck={rgbaColour:GG,white:function(){return GG(255,255,255,1)}},ji={calculateContrastRatio:function(a,b){return(Math.max(a,b)+.05)/(Math.min(a,b)+.05)},calculateLuminance:function(a){var b=function(a){return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},c=a.red()/255,d=a.green()/255;a=a.blue()/255;c=b(c);d=b(d);b=b(a);return.2126*c+.7152*d+.0722*b},composeColour:function(a,b){var c=a.alpha()+b.alpha()*(1-a.alpha()),
d=(a.red()*a.alpha()+b.red()*b.alpha()*(1-a.alpha()))/c,e=(a.green()*a.alpha()+b.green()*b.alpha()*(1-a.alpha()))/c;a=(a.blue()*a.alpha()+b.blue()*b.alpha()*(1-a.alpha()))/c;return Ck.rgbaColour(Math.ceil(d),Math.ceil(e),Math.ceil(a),c)}},HG={parseColour:function(a){var b=function(a,b,c,h){a=parseInt(a,10);b=parseInt(b,10);c=parseInt(c,10);h=parseFloat(h);return g.some(Ck.rgbaColour(a,b,c,h))};if("transparent"===a)return b(0,0,0,0);var c=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(null!==c)return b(c[1],
c[2],c[3],1);a=a.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/);return null!==a?b(a[1],a[2],a[3],a[4]):g.none()}},IG=function(a,b){a=parseFloat(v.get(a,"opacity"));return 1>a?Ck.rgbaColour(b.red(),b.green(),b.blue(),b.alpha()*a):b},JG={getBackgroundColor:function(a){var b=A.owner(a),c=ja.getBody(b);a=[a].concat(A.parents(a,function(a){return N.eq(a,c)}));a=hb(a,function(a,b){if(1===a.alpha())return a;var c=v.get(b,"background-color");return HG.parseColour(c).bind(function(c){c=IG(b,
c);return 0<c.alpha()?g.some(ji.composeColour(a,c)):g.none()}).getOr(a)},Ck.rgbaColour(0,0,0,0));return 1>a.alpha()?ji.composeColour(a,Ck.white()):a},getForegroundColor:function(a,b){var c=v.get(a,"color");return HG.parseColour(c).bind(function(c){c=IG(a,c);c=1>c.alpha()?ji.composeColour(c,b):c;return g.some(c)})}},KG=function(a){var b=JG.getBackgroundColor(a);return JG.getForegroundColor(a,b).map(function(a){var c=ji.calculateLuminance(b);a=ji.calculateLuminance(a);return ji.calculateContrastRatio(a,
c)})},LG={check:function(a,b){return KG(a).filter(function(a){return a<b}).isSome()},getRatio:KG},f7=function(a){a=v.get(a,"font-weight");return"bold"===a||"bolder"===a?!0:/^[0-9]*$/.test(a)?700<=parseInt(a,10):!1},MG=function(a){var b=v.get(a,"font-size");a=/.*px/.test(b);b=b.match(/(\d*\.?\d*)(.*)/);return a&&null!==b?g.some(Number(b[1])):g.none()},NG={isLargeFont:function(a){var b=f7(a),c=A.owner(a);c=ja.getBody(c);var d=MG(c);return MG(a).fold(fd,function(a){return d.fold(function(){return 24<=
a||b&&19<=a},function(c){return a>=1.5*c||b&&a>=1.2*c})})}},OG={hasNonEmptyTextChild:function(a){a=A.children(a);return 0<ka(a,function(a){return D.isText(a)&&0<D.value(a).trim().length}).length}},g7=Zc({id:"D5a",wcag:"1.4.3",severity:$c.error(),desckey:"a11y.d5a.description",url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=r.fromDom(a);return OG.hasNonEmptyTextChild(a)&&NG.isLargeFont(a)&&LG.check(a,3)}}),h7=Zc({id:"D5b",wcag:"1.4.3",
severity:$c.error(),desckey:"a11y.d5b.description",url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=r.fromDom(a);return OG.hasNonEmptyTextChild(a)&&!NG.isLargeFont(a)&&LG.check(a,4.5)}}),i7=Zc({id:"I1",wcag:"1.1.1",severity:$c.error(),desckey:"a11y.i1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return nh.match(a,"img")&&(!1===a.hasAttribute("alt")||""===a.getAttribute("alt").trim())}}),
j7=Zc({id:"I2",wcag:"1.1.1",severity:$c.error(),desckey:"a11y.i2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return nh.match(a,"img[alt][src]")&&a.src.split("/").pop()===a.alt.split("/").pop()}}),k7=Zc({id:"T1",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.t1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return nh.match(a,"table")?(a=a.querySelector("caption"))?
nh.match(a,":empty"):!0:!1}}),l7=Zc({id:"T2",wcag:"1.3.1",severity:$c.warning(),desckey:"a11y.t2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return nh.match(a,"table")&&(a.querySelector("[rowspan]")||a.querySelector("[colspan]"))&&!a.hasAttribute("summary")}}),m7=Zc({id:"T3",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.t3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return nh.match(a,"table")&&a.hasAttribute("summary")&&0<a.querySelectorAll("caption").length&&a.getAttribute("summary")===a.querySelector("caption").innerHTML}}),n7=Zc({id:"T4b",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.t4b.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()&&0===a.querySelectorAll("th").length}}),o7=Zc({id:"T4c",wcag:"1.3.1",
severity:$c.error(),desckey:"a11y.t4c.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){if("th"===a.nodeName.toLowerCase()){var b=!1===a.hasAttribute("scope");a=!1===/row|col|rowgroup|colgroup/i.test(a.getAttribute("scope"));b=b||a}else b=!1;return b}}),p7=Zc({id:"T4a",wcag:"1.3.1",severity:$c.error(),desckey:"a11y.t4a.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()?0===a.querySelectorAll("tr").length||0===a.querySelectorAll("td").length:!1}}),PG=[Z6,$6,a7,c7,e7,g7,h7,i7,j7,k7,l7,m7,o7,p7,n7],QG={get:function(a){return qa(PG,function(b){return b.name()===a})},all:k(PG)},GU={get:function(a){return QG.get(a)},all:function(){return QG.all().slice()}},q7={resolve:Lb.create("ephox-wheel").resolve},$a={resolve:function(a,b){return q7.resolve(a.prefix()+"-"+b)},translate:function(a,b){var c=[(Gb(b,
a.tnames())?"":a.tnames()+".")+b].concat(Array.prototype.slice.call(arguments,2));return a.translate.apply(null,c)}},$t=function(a,b,c,d,e){c=$a.translate(e,c);d=$a.translate(e,d);return a.makeTextButton(b,c,d)},ef={defaultActionButton:function(a,b,c,d,e){b=$t(a,b,c,d,e);a.setDefaultAction(b.element());return b},normalButton:function(a,b,c,d,e){b=$t(a,b,c,d,e);a.setNormalButton(b.element());return b},button:$t,toggleButton:function(a,b,c,d,e){d=$a.translate(e,d);return a.makeIconToggle(b,c,d)},field:function(a,
b,c,d,e){d=$a.translate(e,d);return a.makeField(b,c,d)},icon:function(a,b,c,d){c=$a.translate(d,c);return a.makeIconStepperButton(b,c)}},r7=function(a,b,c,d,e,f){var h=r.fromTag("input");a=ef.field(a,h,c,d,f);n.add(h,$a.resolve(f,"input"));b=[ha.input(h,Ba.input({execute:b}))];return{element:a.element,get:function(){var a={};a[c]=fa.get(h);return a},update:function(a){a=e(a);fa.set(h,a)},keylayouts:k(b),destroy:t}},s7=function(a,b,c,d,e){var f=r.fromTag("select");a=ef.field(a,f,b,c,e);d=E(d,function(a){var b=
r.fromTag("option");fa.set(b,a.value());Ea.set(b,$a.translate(e,a.text()));return b});P.append(f,d);d=[ha.single(f,[],g.none())];return{element:a.element,get:function(){var a={};a[b]=fa.get(f);return a},update:t,keylayouts:k(d),destroy:t}},t7=function(a,b,c,d,e){var f=T.div();n.add(f,$a.resolve(e,"flow"));var h=E(d,function(b){return ef.toggleButton(a,b.value(),b.icon(),b.textkey(),e)});d=E(h,function(a){return a.element()});P.append(f,d);d=[ha.flow(f,{item:k(".ephox-pastry-statebutton")},Ba.flow({trigger:function(a){return L.descendant(a,
".ephox-pastry-button").map(function(a){a.dom().click();return a})}}))];return{element:ef.field(a,f,b,c,e).element,get:function(){return Eb(h,function(a,b){var c={};c[m.get(b.element(),"data-value")]=b.selected();return oa(a,c)},{})},update:t,keylayouts:k(d),destroy:function(){z(h,function(a){a.destroy()})}}},yU={generate:function(a,b,c,d){b=b.getOr([]);var e=ia(b,function(a){return a.fold(function(a,b,c){return[a]},function(a,b,c){return[a]},function(a,b,c){return E(c,function(a){return a.value()})})}),
f=0<e.length?Aa(e,[]):k({}),h=H.create({execute:p([])}),l=function(){h.trigger.execute()},g=E(b,function(b){return b.fold(function(b,c,e){return r7(a,l,b,c,e,d)},function(b,c,e){return s7(a,b,c,e,d)},function(b,c,e){return t7(a,b,c,e,d)})});z(g,function(a){a.update(c)});b=E(g,function(a){return a.element()});var C=ia(g,function(a){return a.keylayouts()});return{elements:k(b),get:function(){var a=Eb(g,function(a,b){return oa(a,b.get())},{});return f(a)},keylayouts:k(C),destroy:function(){z(g,function(a){a.destroy()});
z(C,function(a){a.destroy()})},events:h.registry}}},Tc={title:k("widget.title"),running:k("widget.running"),previous:k("widget.previous"),next:k("widget.next"),issueCounter:k("widget.issue.counter"),issueHelp:k("widget.issue.help"),noIssue:k("widget.issue.none"),severity:function(a){return"severity."+a},repairLabel:k("widget.repair.label"),repairText:k("widget.repair.text"),repairAvailable:k("widget.repair.available"),ignoreLabel:k("widget.ignore.label"),ignoreText:k("widget.ignore.text"),okLabel:k("widget.ok.label"),
okText:k("widget.ok.text")},am=function(a,b,c){var d=T.div();n.add(d,$a.resolve(c,a));b.each(function(a){y.append(d,r.fromText($a.translate(c,a)))});return d},RG=function(a){var b=na(g.none());return{clear:function(){b.get().each(a);b.set(g.none())},isSet:function(){return b.get().isSome()},set:function(c){b.get().each(a);b.set(g.some(c))}}},hd={destroyable:function(){return RG(function(a){a.destroy()})},unbindable:function(){return RG(function(a){a.unbind()})},api:function(){var a=na(g.none()),b=
function(){a.get().each(function(a){a.destroy()})};return{clear:function(){b();a.set(g.none())},isSet:function(){return a.get().isSome()},set:function(c){b();a.set(g.some(c))},run:function(b){a.get().each(b)}}},value:function(){var a=na(g.none());return{clear:function(){a.set(g.none())},set:function(b){a.set(g.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}}},SG=aa.detect(),ho=SG.os.isOSX(),ad=ho?"\u2318":"Ctrl",io=ho?"\u21e7":"Shift",TG={blockquote:[ad,io,"9"],
bold:[ad,"B"],italic:[ad,"I"],underline:[ad,"U"],link:[ad,"K"],help:[ad,"?"],fullscreen:[ad,io,"F"],indent:[ad,"]"],outdent:[ad,"["],undo:[ad,"Z"],redo:ho?[ad,io,"Z"]:[ad,"Y"],search:[ad,"F"]},u7="fr nl sv ru de es it".split(" "),v7=ua(TG,{indent:[ad,"M"],outdent:[ad,io,"M"]}),UG=function(a){var b=qf.get();return U(u7,b)?v7[a]:TG[a]},w7=function(a){a=UG(a);return void 0===a?"":" "+a.join("")},x7=function(a){a=UG(a);return void 0===a?"":" ("+a.join(" ")+")"},y7=ho?w7:x7,qb={get:function(a,b){return SG.os.isiOS()?
x.get(a):x.get(a)+y7(b)}},KU=B.resolve("inverted-dialog-widget"),VG=function(a,b,c){var d=v.get(b,a);c=parseInt(d,10)+40*c;(0<c?v.set:v.remove)(b,a,c+"px")},z7={change:u(VG,"margin-right")},Qy={ltr:{change:u(VG,"margin-left")},rtl:z7},Pd={runTransaction:function(a,b,c,d){d=void 0!==d?d:t;b.save();a.focus();c=c();setTimeout(function(){a.domChanged();a.uiChanged()},0);d();b.save();return c}},au=O("startContainer","startOffset","endContainer","endOffset"),bu=function(a,b){if(a.property().isText(b))return W.point(b,
a.property().getText(b).length);var c=a.property().children(b);return 0<c.length?bu(a,c[c.length-1]):W.point(b,c.length)},WG=function(a,b,c){var d=a.property().children(b);return 0<d.length&&c<d.length?WG(a,d[c],0):0<d.length&&a.property().isElement(b)&&d.length===c?bu(a,d[d.length-1]):W.point(b,c)},cu=function(a,b,c){return a.property().isText(b)&&0===a.property().getText(b).trim().length||a.property().isComment(b)?c(b).bind(function(b){return cu(a,b,c).orThunk(function(){return g.some(b)})}):g.none()},
XG=function(a,b){b=cu(a,b,a.query().nextSibling).getOr(b);if(a.property().isText(b))return W.point(b,0);var c=a.property().children(b);return 0<c.length?XG(a,c[0]):W.point(b,0)},YG=function(a,b){return a.property().isText(b)?a.property().getText(b).length:a.property().children(b).length},ZG=function(a,b){b=cu(a,b,a.query().prevSibling).getOr(b);if(a.property().isText(b))return W.point(b,YG(a,b));var c=a.property().children(b);return 0<c.length?ZG(a,c[c.length-1]):W.point(b,YG(a,b))},kg={toLast:bu,
toLeaf:WG,toLower:function(a,b){a=a.property().isText(b)?a.property().getText(b).length:a.property().children(b).length;return W.point(b,a)},freefallLtr:XG,freefallRtl:ZG},bd={toLeaf:function(a,b,c){return kg.toLeaf(a,b,c)},freefallLtr:function(a,b){return kg.freefallLtr(a,b)},freefallRtl:function(a,b){return kg.freefallRtl(a,b)}},du=nb(),kb={toLeaf:function(a,b){return bd.toLeaf(du,a,b)},freefallLtr:function(a){return bd.freefallLtr(du,a)},freefallRtl:function(a){return bd.freefallRtl(du,a)}},$G=
function(a,b){return ja.inBody(a)&&0<=b&&b<A.children(a).length},jo={multiple:function(a,b,c){return function(d,e){d=a.getSelection();var f=d.map(function(a){return{left:A.parent(a.startContainer()).getOrDie(),right:A.parent(a.endContainer()).getOrDie()}}),h=Pd.runTransaction(a,b,function(){return ia(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing);d=d.filter(function(a){return $G(a.startContainer(),
a.startOffset())&&$G(a.endContainer(),a.endOffset())}).getOrThunk(function(){var a=kb.freefallLtr(0<h.length?h[0]:f.getOrDie().left),b=kb.freefallRtl(0<h.length?h[h.length-1]:f.getOrDie().right);return au(a.element(),a.offset(),b.element(),b.offset())});a.setSelection(d.startContainer(),d.startOffset(),d.endContainer(),d.endOffset());return h}},single:function(a,b,c,d,e){return function(f,h){var g=d(a,f.startContainer(),f.startOffset()),k=d(a,f.endContainer(),f.endOffset());h=Pd.runTransaction(a,
b,function(){return c(g.element(),g.offset(),k.element(),k.offset())},a.toEditing);return e(a,h,g,k,f)}}},ko={multiple:function(a,b,c){return function(d,e){return Pd.runTransaction(a,b,function(){return ia(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing)}},single:function(a,b,c,d,e){return function(f,h){var g=d(a,f.startContainer(),f.startOffset()),k=d(a,f.endContainer(),
f.endOffset());h=Pd.runTransaction(a,b,function(){return c(g.element(),g.offset(),k.element(),k.offset())},a.toEditing);return e(a,h,g,k,f)}}},Dk=function(a,b,c,d,e){return b.map(function(b){a.setSelection(b.start(),b.soffset(),b.finish(),b.foffset());return b.all()}).getOr([])},Ek=function(a,b,c){return W.point(b,c)},eu=ta.generate([{none:[]},{multiple:["elements","environments"]},{single:["selection","environment"]}]),Zb={cata:function(a,b,c,d){return a.fold(b,c,d)},none:eu.none,multiple:eu.multiple,
single:eu.single,toSelection:function(a){return a.fold(g.none,function(a,c){return g.from(c[0]).bind(function(a){return a.getSelection()})},g.some)}},aH=O("left","right"),bH=function(a,b,c){var d=a.property().children(b);return Va(d,u(a.eq,c)).map(function(a){return{before:k(d.slice(0,a)),after:k(d.slice(a+1))}})},Fk={breakToLeft:function(a,b,c){return bH(a,b,c).map(function(d){var e=a.create().clone(b);a.insert().appendAll(e,d.before().concat([c]));a.insert().appendAll(b,d.after());a.insert().before(b,
e);return aH(e,b)})},breakToRight:function(a,b,c){return bH(a,b,c).map(function(c){var d=a.create().clone(b);a.insert().appendAll(d,c.after());a.insert().after(b,d);return aH(b,d)})},breakPath:function(a,b,c,d){var e=O("first","second","splits"),f=function(b,l,k){var h=e(b,g.none(),k);return c(b)?e(b,l,k):a.property().parent(b).bind(function(e){return d(a,e,b).map(function(a){var b=[{first:a.left,second:a.right}],d=c(e)?e:a.left();return f(d,g.some(a.right()),k.concat(b))}).getOr(h)})};return f(b,
g.none(),[])}},B7=function(a,b,c,d){c=b(a,c);return Eb(d,function(c,d){d=b(a,d);return A7(a,c,d)},c)},A7=function(a,b,c){return b.bind(function(b){return c.filter(u(a.eq,b))})},C7={oneAll:function(a,b,c){if(0<c.length){var d=c[0];c=c.slice(1);a=B7(a,b,d,c)}else a=g.none();return a}},D7=function(a,b,c,d){var e=a.property().children(b);if(a.eq(b,c[0]))return g.some([c[0]]);if(a.eq(b,d[0]))return g.some([d[0]]);var f=function(c){c=kd(c);var d=Va(c,u(a.eq,b)).getOr(-1);return Va(e,u(a.eq,d<c.length-1?
c[d+1]:c[d]))};c=f(c);var h=f(d);return c.bind(function(a){return h.map(function(b){return e.slice(Math.min(a,b),Math.max(a,b)+1)})})},cH=function(a,b,c,d){var e=void 0!==d?d:k(!1);b=[b].concat(a.up().all(b));c=[c].concat(a.up().all(c));d=function(a){return Va(a,e).fold(function(){return a},function(b){return a.slice(0,b+1)})};b=d(b);var f=d(c);c=qa(b,function(b){return Xa(f,u(a.eq,b))});return{firstpath:k(b),secondpath:k(f),shared:k(c)}},fu={subset:function(a,b,c){var d=cH(a,b,c);return d.shared().bind(function(b){return D7(a,
b,d.firstpath(),d.secondpath())})},ancestors:cH},zd={sharedOne:function(a,b,c){return C7.oneAll(a,b,c)},subset:function(a,b,c){return fu.subset(a,b,c)},ancestors:function(a,b,c,d){return fu.ancestors(a,b,c,d)},breakToLeft:function(a,b,c){return Fk.breakToLeft(a,b,c)},breakToRight:function(a,b,c){return Fk.breakToRight(a,b,c)},breakPath:function(a,b,c,d){return Fk.breakPath(a,b,c,d)}},ki=nb(),nf={sharedOne:function(a,b){return zd.sharedOne(ki,function(b,d){return a(d)},b)},subset:function(a,b){return zd.subset(ki,
a,b)},ancestors:function(a,b,c){return zd.ancestors(ki,a,b,c)},breakToLeft:function(a,b){return zd.breakToLeft(ki,a,b)},breakToRight:function(a,b){return zd.breakToRight(ki,a,b)},breakPath:function(a,b,c){return zd.breakPath(ki,a,b,function(a,b,f){return c(b,f)})}},lo=function(a,b,c,d,e){return d(a).fold(function(){return!0},function(a){return N.eq(b,a)&&e(b,c)})},Qg={isLeft:function(a,b){return lo(a,b.startContainer(),b.startOffset(),kc.first,wa.isStart)},isAtLeftEdge:function(a,b,c){return lo(a,
b,c,kc.first,wa.isStart)},isRight:function(a,b){return lo(a,b.startContainer(),b.startOffset(),kc.last,wa.isEnd)},isAtRightEdge:function(a,b,c){return lo(a,b,c,kc.last,wa.isEnd)}},E7=function(a){a=D.name(a);return"td"===a||"th"===a},gu=function(a){return"li"===D.name(a)||pa.isBlock(a)},dH=function(a){return"a"===D.name(a)},eH=function(a,b,c){return Ja.closest(a,b,c).filter(zf(c)).filter(zf(E7))},dc={stopAt:function(a){return u(N.eq,a)},isList:function(a){a=D.name(a);return"ol"===a||"ul"===a},isAnchor:dH,
isHeading:function(a,b){b=Mb(b)?b:[];b="h1 h2 h3 h4 h5 h6".split(" ").concat(b);a=D.name(a);return U(b,a)},isCollapsed:function(a){return N.eq(a.startContainer(),a.endContainer())&&a.startOffset()===a.endOffset()},isRightEdge:function(a,b,c){var d=O("startContainer","startOffset");return Qg.isRight(a,d(b,c))},isBlockOrList:gu,exitList:function(a){return 0===ed.descendants(a,function(a){return D.isText(a)&&0<Ya.get(a).length&&0<Zh(Ya.get(a)).length||D.isElement(a)&&U("hr img input video iframe picture audio embed map object".split(" "),
D.name(a))}).length},findBlock:function(a,b){return Ja.closest(a,gu,b)},findValidHardBreak:function(a,b){return eH(a,gu,b)},findAnchorBreak:function(a,b){return eH(a,dH,b)}},hu={forceAddBr:function(a,b){if("br"!==D.name(a)){var c=r.fromTag("br");D.isText(a)?(y.after(a,c),N.eq(b,a)||G.remove(a)):dc.isBlockOrList(a)?y.append(a,c):(b=r.fromText(mb()),y.prepend(a,b),y.after(a,c))}},rootBr:function(a,b){y.before(a,r.fromTag("br"))}},fH=function(a,b,c){var d=[];z(A.children(a),function(a){b(a)&&(d=d.concat([a]));
d=c(a)?d:d.concat(fH(a,b,c))});return d},gH=function(a,b){var c=A.children(a);return 0<c.length?(c=c[0],b(c)||"textarea"===D.name(c)?a:gH(c,b)):a},mo={descendants:fH,plunge:gH},no=function(a){if(!D.isText(a))return!1;a=Ya.get(a).trim();return 0===a.length||0===a.replace(mb(),"").length},oo=function(a){if(D.isText(a))return no(a);var b=Ea.get(a);a=A.children(a);return""===Zh(b)||ob(a,no)},li={vacant:function(a){a=Y.descendants(a,"span,a");return ka(a,function(a){if("span"===D.name(a)){var b=m.has(a,
"class")&&0<m.get(a,"class").length,d=m.has(a,"id");a=!b&&!d&&!m.has(a,"style")&&oo(a)}else a=oo(a);return a})},isEmpty:oo,hasCursor:function(a,b){b=void 0!==b?b:"hr br img input textarea iframe".split(" ");return D.isText(a)?!1===no(a):U(b,D.name(a))},isVacantText:no,hasNoContent:oo},hH=function(a){var b="li"===D.name(a)?dc.isList:k(!1);return 0<mo.descendants(a,li.hasCursor,b).length?g.none():g.some(mo.plunge(a,b))},iH=function(a){a=li.vacant(a);z(a,G.remove)},jH=function(a,b){a=Y.descendants(b,
a);a=ka(a,li.isEmpty);z(a,G.remove);li.isEmpty(b)&&G.remove(b)},Df={vacate:iH,emptyStyles:function(a){!0===m.has(a,"style")&&0===m.get(a,"style").length&&m.remove(a,"style")},needsCursor:hH,postprocess:function(a,b,c){iH(a);hH(a).each(function(a){hu.forceAddBr(a,b)})},lists:u(jH,"ul,ol"),blockquotes:u(jH,"blockquote")},F7=function(a,b){a=nf.breakToRight(a,b);a.each(function(a){a=a.right();z(["id"],u(m.remove,a));Df.emptyStyles(a)});return a},po={breakPath:function(a,b){return nf.breakPath(a,b,F7)}},
G7={breakQuote:function(a,b){var c=po.breakPath(b,dc.stopAt(a));return c.second().map(function(a){var d=c.first();y.before(a,b);z([d,a],Df.blockquotes);return{start:k(la.on(b,0)),finish:k(la.on(b,0))}})}},kH=function(a){return D.isElement(a)?a:A.parent(a).getOr(a)},lH={bothMatch:function(a,b,c){a=kH(a);b=kH(b);return c(a)&&c(b)}},qo={isRootOrCell:function(a){return function(b){return a(b)||Fa.is(b,"td,th")}},isRootOrContainer:function(a){return function(b){return a(b)||pa.isContainer(b)}}},mH=function(a,
b){return 0===a.length?!0:0===b.length?!1:a[0]<b[0]?!0:b[0]<a[0]?!1:mH(a.slice(1),b.slice(1))},lg={head:function(a){return 0<a.length?g.some(a[0]):g.none()},tail:function(a){return 0<a.length?g.some(a.slice(1)):g.none()},toLast:function(a){return 0<a.length?g.some(a[a.length-1]):g.none()},box:function(a){return[a]},isBefore:mH},ro=ta.generate([{quasi:["elements"]},{block:["element"]},{container:["element","children"]},{fixture:["element"]}]),nH=function(a){return a.fold(function(a){return"@q["+E(a,
function(a){return a.dom().outerHTML||'"'+a.dom().nodeValue+'"'}).join(",")+"]"},function(a){return"@"+a.dom().nodeName.toLowerCase()+"("+a.dom().innerHTML+")"},function(a,c){return"#"+a.dom().nodeName.toLowerCase()+"("+E(c,nH).join(",")+")"},function(a){return a.dom().nodeName.toLowerCase()})},oH=function(a){var b=function(a){return[a]};return a.fold(ca,b,b,b)},so=k(!0),mg=k(!1),Bc={cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},quasi:ro.quasi,block:ro.block,container:ro.container,fixture:ro.fixture,
isQuasi:function(a){return a.fold(so,mg,mg,mg)},isFixture:function(a){return a.fold(mg,mg,mg,so)},isQuasiOrFixture:function(a){return a.fold(so,mg,mg,so)},toTarget:oH,toString:nH,toLastTarget:function(a){return lg.toLast(oH(a))}},Gk=function(a,b){return{fold:a,label:k(b)}},ng={before:function(a){return Gk(function(b,c,d,e,f){return b(a)},"before")},after:function(a){return Gk(function(b,c,d,e,f){return c(a)},"after")},rest:function(a){return Gk(function(b,c,d,e,f){return d(a)},"rest")},last:function(a){return Gk(function(b,
c,d,e,f){return e(a)},"last")},invalid:function(a,b){return Gk(function(c,d,e,f,h){return h(a,b)},"invalid")}},pH={subdivide:function(a,b,c){var d=a.property().getText(b);c=ka(Hn.splits(d,c),function(a){return 0<a.length});if(1>=c.length)return[W.range(b,0,d.length)];a.property().setText(b,c[0]);d=Rd.generate(c.slice(1),function(b,c){var d=a.create().text(b);b=W.range(d,c,c+b.length);return g.some(b)},c[0].length);var e=E(d,function(a){return a.element()});a.insert().afterAll(b,e);return[W.range(b,
0,c[0].length)].concat(d)}},to=function(a,b){return{fold:a,label:k(b)}},uo={none:function(){return to(function(a,b,c,d){return a()},"none")},start:function(a){return to(function(b,c,d,e){return c(a)},"start")},middle:function(a,b){return to(function(c,d,e,f){return e(a,b)},"middle")},end:function(a){return to(function(b,c,d,e){return e(a)},"end")}},H7={determine:function(a){return a.before().fold(function(){return a.after().fold(function(){return uo.none()},function(a){return uo.start(a)})},function(b){return a.after().fold(function(){return uo.end(b)},
function(a){return uo.middle(b,a)})})}},I7={group:function(a,b,c){b=ia(b,function(b){return fg.from(a,b,c)});b=yC.splitbyAdv(b,function(a){return mn.cata(a,function(){return $h.excludeWithout(a)},function(){return $h.excludeWith(a)},function(){return $h.include(a)})});return ka(b,function(a){return 0<a.length})}},J7={common:function(a,b,c){b=[b].concat(a.up().all(b));var d=[c].concat(a.up().all(c));return qa(b,function(b){return Xa(d,function(c){return a.eq(c,b)})})}},MU="table tbody thead tfoot tr ul ol".split(" "),
K7={range:function(a,b,c,d,e){return a.eq(b,d)?[b]:J7.common(a,b,d).fold(function(){return[]},function(f){var h=[f].concat(fg.all(a,f,k(!1)));f=Va(h,u(a.eq,b));var g=Va(h,u(a.eq,d));f=f.bind(function(a){return g.map(function(b){return a<b?h.slice(a+c,b+e):h.slice(b+e,a+c)})}).getOr([]);var q=LU(a);return ka(f,q.validateText)})}},qH={range:function(a,b,c,d,e){return K7.range(a,b,c,d,e)},group:function(a,b,c){return I7.group(a,b,c)}},iu=O("before","after"),rH=function(a,b,c){a=a.property().getText(b);
return Hn.splits(a,c)},sH=function(a,b,c,d){if(!a.property().isText(b)||c===d)return b;if(c>d)return sH(a,b,d,c);var e=a.property().getText(b).length;if(0===c&&d===e)return b;d=rH(a,b,[c,d]);a.property().setText(b,d[0]);d=E(d.slice(1),function(b){return a.create().text(b)});e=d[0];a.insert().afterAll(b,d);return 0===c?b:e},Hk={split:function(a,b,c){if(!a.property().isText(b)||0>=c)return iu(g.none(),g.some(b));if(c>=a.property().getText(b).length)return iu(g.some(b),g.none());c=rH(a,b,[c]);a.property().setText(b,
c[0]);c=a.create().text(c[1]);a.insert().after(b,c);return iu(g.some(b),g.some(c))},splitByPair:sH},L7=function(a,b,c,d,e){c=Hk.split(a,b,c).after().fold(function(){return W.delta(b,1)},function(a){return W.delta(a,0)});e=Hk.split(a,d,e).before().fold(function(){return W.delta(d,0)},function(a){return W.delta(a,1)});return qH.range(a,c.element(),c.deltaOffset(),e.element(),e.deltaOffset())},M7=function(a,b,c,d,e){return[Hk.splitByPair(a,b,c,e)]},N7={nodes:function(a,b,c,d,e){return(a.eq(b,d)?M7:L7)(a,
b,c,d,e)}},Td={split:function(a,b,c){return Hk.split(a,b,c)},splitByPair:function(a,b,c,d){return Hk.splitByPair(a,b,c,d)},range:function(a,b,c,d,e){return N7.nodes(a,b,c,d,e)},subdivide:function(a,b,c){return pH.subdivide(a,b,c)},position:function(a,b){return H7.determine(b)}},O7=function(a,b,c){var d=Td.split(a,b,c);return Td.position(a,d).fold(function(){return ng.invalid(b,c)},ng.before,ng.after,ng.after)},P7=function(a,b,c){var d=a.property().children(b);return a.property().isEmptyTag(b)?ng.before(b):
c===d.length?ng.last(b):c<d.length?ng.rest(d[c]):ng.invalid(b,c)},Q7={atStartOf:function(a,b,c,d){var e=function(b){a.insert().before(b,d)};(a.property().isText(b)?O7:P7)(a,b,c).fold(e,function(b){a.insert().after(b,d)},e,function(b){a.insert().append(b,d)},t)}},ju={atStartOf:function(a,b,c,d){Q7.atStartOf(a,b,c,d)}},R7=ta.generate([{none:[]},{root:["target","block"]},{created:["target","block"]},{actual:["target","block"]}]),og=ua(R7,{toString:function(a){return a.fold(function(){return["block.none"]},
function(a,c){return["block.root",a,c]},function(a,c){return["block.created",a,c]},function(a,c){return["block.actual",a,c]})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},extract:function(a){var b=k([]),c=function(a,b){return[b]};return a.fold(b,b,c,c)},extractEvenRoot:function(a){var b=k([]),c=function(a,b){return[b]};return a.fold(b,c,c,c)}}),tH=function(a,b){return function(c){return a.eq(c,b)||a.property().parent(c).map(function(c){return a.eq(c,b)}).getOr(!1)}},S7=function(a,b,c){return a.eq(b,
c)?g.none():a.property().isBoundary(c)?a.query().nextSibling(c):a.property().isEmptyTag(c)?(b=tH(a,b),b(c)?a.query().nextSibling(c):zd.breakPath(a,c,b,zd.breakToRight).second()):g.none()},T7=function(a,b,c){if(a.eq(b,c))return g.none();if(a.property().isBoundary(c))return a.query().prevSibling(c);if(a.property().isEmptyTag(c)){var d=tH(a,b);return d(c)?a.query().prevSibling(c):a.query().prevSibling(c).map(function(b){return zd.breakPath(a,b,d,zd.breakToRight).first()})}return g.none()},uH=function(a,
b,c,d){return c(a,b,d).bind(function(c){var d=a.property().children(b);return Va(d,function(b){return a.eq(b,c)})})},ku=function(a,b){return a.property().isEmptyTag(b)||a.property().isBoundary(b)},lu={create:function(a,b,c){if(ku(a,c)||ku(a,bd.toLeaf(a,c,0).element()))return[c];var d=u(ku,a),e=u(a.eq,b),f=Ca.seekLeft(a,c,d,e).bind(function(c){return uH(a,b,S7,c)}).getOr(0),h=a.property().children(b);c=Ca.seekRight(a,c,d,e).bind(function(c){return uH(a,b,T7,c)}).getOr(h.length-1);return a.property().children(b).slice(f,
c+1)}},U7=function(a,b,c,d){return c(b)||d(b)?g.some(b):a.up().predicate(b,c,d)},vH=function(a,b,c){c=c();a.insert().wrap(b,c);return og.created(b,c)},V7=function(a,b,c,d){var e=d();a.insert().before(c[0],e);z(c,function(b){a.insert().append(e,b)});return og.created(b,e)},W7=function(a,b,c,d,e,f,h){if(f(c)){var g=a.property().children(b);if(d<g.length&&h(g[d]))return og.actual(c,g[d])}return e(b).fold(function(){return og.root(c,b)},function(e){if(f(c)){var h=e(),g=a.property().children(b),l=g[d];
void 0!==l&&(e=lu.create(a,b,l,e),a.insert().appendAll(h,0<e.length?e:[l]));ju.atStartOf(a,b,Math.min(g.count,d),h);return og.created(b,h)}a.property().isEmptyTag(c)?e=vH(a,c,e):(h=lu.create(a,b,c),e=0<h.length?V7(a,c,h,e):vH(a,c,e));return e})},X7={single:function(a,b,c,d,e,f){return U7(a,c,b,f).fold(og.none,function(h){return f(h)?W7(a,h,c,d,e,f,b):og.actual(c,h)})}},wH={resolve:Lb.create("ephox-soldier").resolve},mi=wH.resolve("quasi-block"),xH=function(a){a=A.children(a);return 1===a.length&&
"br"===D.name(a[0])},yH=function(a){return n.has(a,mi)&&!xH(a)},vo={condense:function(a){a=ka(a,function(a,c){if(!D.isElement(a))return!0;n.has(a,mi)&&xH(a)&&(A.prevSibling(a).exists(yH)||A.nextSibling(a).exists(yH))?(G.remove(a),a=!1):a=!0;return a});return E(a,function(a){var b=D.isElement(a)?[a].concat(Y.descendants(a,"."+mi)):[];z(b,function(a){n.remove(a,mi)});return a})},register:function(a){return function(b){return a(b).map(function(a){return function(){var b=a();n.add(b,mi);return b}})}},
style:k(mi)},Y7=nb(),Dj={single:function(a,b,c,d,e){return X7.single(Y7,a,b,c,vo.register(d),e)},isBlock:function(a){return U("ol p div ul table caption td th h1 h2 h3 h4 h5 h6 body blockquote pre".split(" "),D.name(a))}},Ik={tag:function(){return"p"},nu:function(a){return u(a.create().nu,"p")}},mu=function(a){return 0<a.length?g.some(a[0]):g.none()},Jk=ta.generate([{descend:["index"]},{leftOf:["rindex"]},{bounded:["lindex","rindex"]},{rightOf:["lindex"]},{all:[]}]),zH={derive:function(a,b){return a.bind(mu).fold(function(){return b.bind(mu).fold(function(){return Jk.all()},
function(a){return Jk.leftOf(a)})},function(a){return b.bind(mu).fold(function(){return Jk.rightOf(a)},function(b){return a===b?Jk.descend(a):Jk.bounded(a,b)})})},cata:function(a,b,c,d,e,f){return a.fold(b,c,d,e,f)}},AH=function(a,b,c){return g.from(a.property().children(b)[c])},Z7=function(a,b,c){var d=a.property().children(c),e=AH(a,c,0).bind(function(e){return AH(a,c,d.length-1).map(function(d){return nu(a,b,c,e,d)})}).getOr([]);return Bc.container(c,e)},nu=function(a,b,c,d,e){var f=BH(a,c,b,d);
return Bc.toLastTarget(f).filter(function(b){return!a.eq(e,b)}).bind(function(d){return Ca.walk(a,d,Ca.sidestep,Ca.walkers().right()).bind(function(d){if(a.eq(c,d.item()))return g.none();d=nu(a,b,c,d.item(),e);return g.some([f].concat(d))})}).getOrThunk(function(){return[f]})},BH=function(a,b,c,d){if(Nc.isFormatting(a,d))return Bc.block(d);if(Nc.isEmptyTag(a,d))return Bc.fixture(d);if(Nc.isBlock(a,d)||Nc.isContainer(a,d))return Z7(a,c,d);a=lu.create(a,b,d);return Bc.quasi(0<a.length?a:[d])},CH=function(a,
b,c){return BH(a,c,b,c)},ou=function(a,b,c,d,e,f,h,l){c=c.map(function(c){return Kk(a,b,c,h.bind(lg.tail),g.none())}).getOr([]);e=e.map(function(c){return Kk(a,b,c,g.none(),l.bind(lg.tail))}).getOr([]);d=0===d.length?[]:nu(a,b,f,d[0],d[d.length-1]);return[Bc.container(f,c.concat(d).concat(e))]},Kk=function(a,b,c,d,e){var f=a.property().children(c);d.bind(lg.head).getOr(0);e.bind(lg.head).getOr(f.length-1);var h=zH.derive(d,e);return zH.cata(h,function(c){return Kk(a,b,f[c],d.bind(lg.tail),e.bind(lg.tail))},
function(h){return ou(a,b,g.none(),f.slice(0,h),g.from(f[h]),c,d,e)},function(h,k){return ou(a,b,g.from(f[h]),f.slice(h+1,k),g.from(f[k]),c,d,e)},function(h){return ou(a,b,g.from(f[h]),f.slice(h+1),g.none(),c,d,e)},function(){return[CH(a,b,c)]})},DH={categorise:CH,within:function(a,b,c,d,e){return!0===lg.isBefore(d,e)?Kk(a,b,c,g.some(d),g.some(e)):Kk(a,b,c,g.some(e),g.some(d))}},pu=function(a,b){if("li"!==D.name(a))return!1;a=hb(b,function(a,b){return 1<a.quasi||0<a.nonlist?a:Bc.cata(b,function(){return{quasi:1+
a.quasi,nonlist:a.nonlist}},function(){return{quasi:a.quasi,nonlist:1+a.nonlist}},function(b){return{quasi:a.quasi,nonlist:(U(["ul","ol"],D.name(b))?0:1)+a.nonlist}},function(){return{quasi:1+a.quasi,nonlist:a.nonlist}})},{quasi:0,nonlist:0});return 1>=a.quasi&&0===a.nonlist},qu=function(a,b,c){return 0>=c.length?!0:U(a,D.name(b))?2<c.length?!1:1===c.length?Bc.isQuasiOrFixture(c[0]):Bc.isQuasiOrFixture(c[0])&&Bc.isQuasiOrFixture(c[1])&&!ob(c,Bc.isFixture):!1},Ud={wrap:function(a){if(0===a.length||
1===a.length&&D.isText(a[0])&&0===Ya.get(a[0]).trim().length)return[];var b=r.fromTag(Ik.tag());n.add(b,vo.style());y.before(a[0],b);P.append(b,a);return[b]},handleContainer:function(a,b,c,d){if(qu(a,b,c))return[b];var e=pu(b,c)?[b]:[];return e.concat(ia(c,function(a){return d(a,0<e.length)}))},hasSimpleContent:qu,isNestedList:pu,handleRoot:function(a,b){b=DH.categorise(nb(),u(N.eq,b),b,b,b);var c=function(){return g.some(Ik.nu(nb()))},d=g.none;return Bc.cata(b,c,d,function(b,f){return qu(a,b,f)||
pu(b,f)?d():c()},c)}},wo=["li","td","th","caption"],EH=function(a,b){return Bc.cata(a,function(a){return!0===b?[]:Ud.wrap(a)},function(a){return[a]},function(a,b){return Ud.handleContainer(wo,a,b,EH)},function(a){return!0===b?[]:Ud.wrap([a])})},$7={isRootContainer:qo.isRootOrContainer,extract:function(a){return EH(a,!1)},isCapable:function(a){return Dj.isBlock(a)||U(wo,D.name(a))},canUse:function(a){return pa.isFormatting(a)||U(wo,D.name(a))},quasi:u(Ud.handleRoot,wo),ascend:ca},FH=Aa(["start","soffset",
"finish","foffset","all"],[]),GH=Aa(["start","soffset","finish","foffset"],[]),ni={block:FH,inline:GH,blockFrom:function(a){return 0<a.length?g.some(FH({start:a[0],soffset:0,finish:a[a.length-1],foffset:wa.getEnd(a[a.length-1]),all:a})):g.none()},inlineFrom:function(a){return a.map(function(a){return GH({start:a.start(),soffset:a.soffset(),finish:a.finish(),foffset:a.foffset()})})}},xo=function(a){return Fa.is(a,"td,th")},HH=function(a){return N.eq(a.startContainer(),a.endContainer())&&a.startOffset()===
a.endOffset()},IH=function(a,b){return a(b.startContainer())?g.some(kb.freefallLtr(b.startContainer())):g.none()},JH=function(a,b){return(a(b.endContainer())?g.some(kb.freefallRtl(b.endContainer())):g.none()).map(function(a){return Fa.is(a.element(),"br")&&!1===HH(b)?W.point(a.element(),1):a})},Vd={is:xo,isCollapsed:HH,isWholeCell:function(a){return xo(a.startContainer())&&N.eq(a.startContainer(),a.endContainer())&&0===a.startOffset()&&a.endOffset()===wa.getEnd(a.endContainer())},left:u(IH,xo),leftWith:IH,
right:u(JH,xo),rightWith:JH},ru=O("startContainer","startOffset","endContainer","endOffset"),su=O("start","soffset","finish","foffset"),Ub={hare:ru,fussy:su,fromHare:function(a){return su(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())},fromFussy:function(a){return ru(a.start(),a.soffset(),a.finish(),a.foffset())},fussyFromElements:function(a){if(0===a.length)return g.none();var b=a[0];a=a[a.length-1];b=A.firstChild(b).getOr(b);a=A.lastChild(a).getOr(a);return g.some(su(b,0,a,wa.getEnd(a)))},
hareFromElement:function(a){return ru(a,0,a,wa.getEnd(a))}},KH=function(a,b){return b(a)?g.some([]):A.parent(a).bind(function(c){return A.findIndex(a).bind(function(a){return KH(c,b).map(function(b){return b.concat([a])})})})},LH=function(a,b){return 0===b.length?g.some(a):A.child(a,b[0]).bind(function(a){return LH(a,b.slice(1))})},oi={path:function(a,b){var c=u(N.eq,a);return N.eq(a,b)?g.some([]):KH(b,c)},follow:LH},MH=O("ancestor","startPath","finishPath"),a8=function(a,b,c){return nf.ancestors(b,
c,a).shared().bind(function(a){return oi.path(a,b).bind(function(b){return oi.path(a,c).map(function(c){return MH(a,b,c)})})})},NH=function(a,b,c,d){var e=b.isRootContainer(a);c=Dj.single(b.isCapable,c,d,b.quasi,e);c=og.extractEvenRoot(c);return 1===c.length?g.some(c[0]).map(function(c){return b.ascend(c,a)}):g.none()},OH=function(a,b,c,d){if(!1===b(c))return W.point(c,d);d<wa.getEnd(c)||a.isCapable(c)&&a.canUse(c)?c=kb.toLeaf(c,d):(a=r.fromTag("br"),y.append(c,a),c=W.point(a,0));return c},b8={branch:function(a,
b,c,d,e,f){var h=b.isRootContainer(a),l=Ub.hare(c,d,e,f),q=k(!0===Vd.isWholeCell(l)),C=Vd.left(l).filter(q).getOrThunk(function(){return OH(b,h,c,d)}),w=Vd.right(l).filter(q).getOrThunk(function(){return OH(b,h,e,f)});return NH(a,b,C.element(),C.offset()).bind(function(c){return(N.eq(C.element(),w.element())&&C.offset()===w.offset()?g.some(c):NH(a,b,w.element(),w.offset())).bind(function(b){return N.eq(c,b)?g.some(MH(c,[],[])):a8(a,c,b)})})}},PH=function(a,b,c,d,e,f,h){a=b.isRootContainer(a)(c);b=
!a&&ja.inBody(c)?W.point(c,d):a||!b.isCapable(c)||ja.inBody(c)?ja.inBody(e.element())&&U(["td","th"],D.name(c))?e:!ja.inBody(c)&&ja.inBody(f.element())&&"br"==D.name(f.element())?f:kb.toLeaf(h,0):W.point(h,d);wa.getEnd(b.element());return b.offset()<=wa.getEnd(b.element())?g.some(b):g.none()},pi={applyOn:function(a,b,c,d,e,f,h){var l=id.after(c,d,e,f),k=b.isRootContainer(a)(c)?kb.toLeaf(c,d):W.point(c,d),C=b.isRootContainer(a)(e)?kb.toLeaf(e,f):W.point(e,f),w=kb.toLeaf(c,d),m=kb.toLeaf(e,f),n=b8.branch(a,
b,c,d,e,f).map(function(b){return DH.within(nb(),a,b.ancestor(),b.startPath(),b.finishPath())}).getOr([]);n=ia(n,b.extract);z(n,function(a){0===A.children(a).length&&pa.isFormatting(a)&&y.append(a,r.fromTag("br"))});n=vo.condense(n);var p=h(n);return 0===p.length?g.none():PH(a,b,c,d,k,w,p[l?p.length-1:0]).bind(function(c){return PH(a,b,e,f,C,m,p[l?0:p.length-1]).map(function(a){return ni.block({start:c.element(),soffset:c.offset(),finish:a.element(),foffset:a.offset(),all:p})})})}},tu=function(a){return function(b){return a}},
QH={start:ae.onDirection("left","right"),end:ae.onDirection("right","left"),justify:tu("justify"),center:tu("center"),"match-parent":tu("match-parent")},c8={hasAlignment:function(a,b,c){D.isText(a)?a=!1:(b=v.get(a,b),a=(void 0!==QH[b]?QH[b](a):b)===c);return a}},d8=function(a,b,c){return c8.hasAlignment(c,a,b)},yo=function(a,b,c){var d=NU(b,c);return{run:function(a,b,c,g,k){return pi.applyOn(a,$7,b,c,g,k,function(a){var b=ob(a,d.is)?d.remove:d.set;z(a,b);return a})},query:function(a,d){var e=u(d8,
b,c);return lH.bothMatch(a,d,e)},name:k(a)}},e8=yo("JustifyLeft","text-align","left"),f8=yo("JustifyCenter","text-align","center"),g8=yo("JustifyRight","text-align","right"),h8=yo("JustifyFull","text-align","justify"),le={justifyleft:k(e8),justifycentre:k(f8),justifyright:k(g8),justifyfull:k(h8)},RH=function(a){a=a.dom();if(af.isSupported(a)){var b=a.style.marginLeft;return"auto"===a.style.marginRight&&"auto"===b}return!1},uu={isCentered:RH,divine:function(a){if(RH(a))return g.some("center");var b=
v.getRaw(a,"float").getOrThunk(function(){return v.get(a,"float")});return void 0!==b&&null!==b&&0<b.length?g.some(b):g.none()},getRaw:function(a){return v.getRaw(a,"float").getOr(null)},setCentered:function(a){v.setAll(a,{"margin-left":"auto","margin-right":"auto"})}},i8={left:{"float":"left",margin:""},right:{"float":"right",margin:""},none:{"float":"none",margin:""},center:{"float":"",margin:"0 auto"}},SH={none:{display:""},left:{display:""},right:{display:""},center:{display:"block"}},TH=function(a,
b){return uu.divine(a).is(b)},UH=function(a,b){var c="img"===D.name(a)&&void 0!==SH[b]?SH[b]:{};g.from(i8[b]).each(function(b){v.setAll(a,b);v.setAll(a,c)})},zo=function(a,b){return{run:function(a){UH(a,b);return g.none()},query:function(a){return TH(a,b)},name:k(a)}},j8=zo("JustifyLeft","left"),k8=zo("JustifyCenter","center"),l8=zo("JustifyRight","right"),m8=zo("FloatNone","none"),oh={floatnone:k(m8),floatleft:k(j8),floatcentre:k(k8),floatright:k(l8),queryIsFloat:TH,runFloat:UH},VH=function(a){return Bc.cata(a,
function(a){return Ud.wrap(a)},function(a){return[a]},function(a,c){return ia(c,VH)},function(a){return Ud.wrap([a])})},WH={isRootContainer:qo.isRootOrContainer,extract:VH,isCapable:function(a){return Dj.isBlock(a)||"li"===D.name(a)},canUse:function(a){return pa.isFormatting(a)},quasi:function(a){return g.some(Ik.nu(nb()))},ascend:ca},vu=O("level","content","cruft","list","item"),Ao={level:function(a,b){return vu(a.level()+b,a.content(),a.cruft(),a.list(),a.item())},list:function(a,b){return vu(a.level(),
a.content(),a.cruft(),b,a.item())}},XH=O("elements","elementsTransformed"),n8=O("original","replaced"),ph=O("result","items"),Bo={answer:XH,write:function(a,b){var c=[],d=function(b){var c=a.create().nu("p");a.insert().appendAll(c,b);return c},e=function(a){if(0===a.length)throw"Cannot get tail of an empty array";return a.slice(1)},f=function(b,c){for(var d=a.create().clone(c[0].list()),g=[],l=c[0];0<c.length&&c[0].level()>=b&&a.property().name(l.list())===a.property().name(c[0].list());){if(c[0].level()===
b){var k=b;var q=c[0];var m=q;var n=m.item(),p=n;p=a.property().children(p);z(p,a.remove().remove);a.insert().appendAll(n,m.content());m=n;q=q.cruft();for(c=e(c);0<c.length&&c[0].level()>k;)c=f(k+1,c),n=[c.result()].filter(u(h,["li"])),c=c.items(),a.insert().appendAll(m,n);a.insert().appendAll(m,q);k=ph(m,c);c=[k.result()].filter(u(h,["li"]));k=ph(c,k.items())}else k=f(b+1,c),c=[k.result()].filter(u(h,["ul","ol"])),q=a.create().nu("li"),a.styles().set(q,"list-style-type","none"),a.attrs().remove(d,
"id"),a.insert().appendAll(q,c),k=ph([q],k.items());c=k.items();g=g.concat(k.result())}a.insert().appendAll(d,g);return ph(d,c)},h=function(b,c){return!(U(b,a.property().name(c))&&0===a.property().children(c).length)};b=function(b){for(var g=[];0<b.length;){var l=b[0];if(0===l.level()){var k=b[0],m=k.content();m=1===m.length&&Nc.isBlock(a,m[0])?m[0]:d(m);c.push(n8(k.item(),m));b=ph(m,e(b));k=[b.result()].filter(u(h,["p"]));0===k.length&&c.pop();b=b.items();g=g.concat(k);m=b;for(b=[];0<m.length&&0<
m[0].level();)m=f(1,m),k=[m.result()].filter(u(h,["ul","ol"])),m=m.items(),b=b.concat(k);k=ph(b,m);b=k.items();g=g.concat(k.result());0<l.cruft().length&&(g=g.concat([d(l.cruft())]))}else b=f(1,b),l=[b.result()].filter(u(h,["ul","ol"])),b=b.items(),g=g.concat(l)}return ph(g,b)}(b);if(0!==b.items().length)throw"Error - there should not be any remaining items to parse";return XH(b.result(),c)}},YH=function(a){return hb(a,function(a,c){var b=a.elements().concat(c.elements());a=a.elementsTransformed().concat(c.elementsTransformed());
return Bo.answer(b,a)},Bo.answer([],[]))},o8={combine:YH,write:function(a,b){b=hm(b,function(b){return a.property().name(b.list())+"-"+a.styles().getRaw(b.list(),"list-style-type").getOr("default")});b=E(b,function(b){return Bo.write(a,b)});return YH(b)}},ZH=nb(),$H=function(a){return o8.write(ZH,a)},p8=function(a){return Bo.write(ZH,a)},aI=function(a,b,c){return L.closest(a,"li",c).bind(function(a){return b(a,c).map(function(b){return{item:k(a),outerlist:k(b)}})})},bI=function(a,b){return Va(a,function(a){return N.eq(a,
b)})},q8=function(a,b,c){return bI(a,b).bind(function(b){return bI(a,c).map(function(c){return a.slice(Math.min(b,c),Math.max(b,c)+1)})})},qi={context:function(a,b,c,d,e){return aI(a,c,e).bind(function(f){return aI(b,c,e).bind(function(c){if(N.eq(f.outerlist(),c.outerlist())){if(N.eq(a,b))var e=[f.item()];else{var h=f.outerlist();e=f.item();var C=c.item();h=Y.descendants(h,"li");e=q8(h,e,C).getOr([])}c=g.some({outerlist:f.outerlist,startItem:f.item,finishItem:c.item,writer:k(d),selected:k(e)})}else c=
g.none();return c})})},immediate:function(a,b){return L.closest(a,"ul,ol",b)},topmost:function(a,b){var c=ed.ancestors(a,function(a){return pa.isList(a)||pa.isContainer(a)},b);return Va(c,function(a){return!U(["li","ol","ul"],D.name(a))}).map(function(a){return 0<a&&a-1<c.length?g.some(c[a-1]):0<c.length?g.some(c[c.length-1]):g.none()}).getOrThunk(function(){return 0<c.length?g.some(c[c.length-1]):g.none()})}},wu={context:function(a,b,c){return qi.context(a,b,qi.topmost,p8,c)},indent:function(a){return Ao.level(a,
1)},outdent:function(a){return Ao.level(a,-1)}},r8=function(a,b){return Xa(a,function(a){return N.eq(b,a)})},s8={operate:function(a,b,c){return E(b,function(b){return r8(c,b.item())?a(b):b})}},cI=O("before","on","after"),t8=function(a,b){var c=g.from(E(b,function(b){return a[b]})),d=a.slice(0,b[0]);b=a.slice(b[b.length-1]+1);return cI(d,c,b)},u8={refine:function(a,b){var c=E(a,function(a,c){return b(a)?g.some(c):g.none()});c=ee(c);var d=cI(a,g.none(),[]);return 0===c.length?d:t8(a,c)}},xu=function(a,
b){var c=Y.children(a,"li,ol,ul");return ia(c,function(c){return"li"===D.name(c)?v8(a,c,b):xu(c,b+1)})},v8=function(a,b,c){var d=w8(b),e=[vu(c,d.before(),d.after(),a,b)];return d.on().fold(function(){return e},function(a){a=ia(a,function(a){return xu(a,c+1)});return e.concat(a)})},x8=function(a){return Fa.is(a,"ol,ul")},w8=function(a){a=A.children(a);return u8.refine(a,x8)},y8={read:function(a){return xu(a,1)}},z8=function(a){a=a.elementsTransformed();z(a,function(a){v.transfer(a.original(),a.replaced(),
["text-align"]);m.transfer(a.original(),a.replaced(),["dir"])})},dI=function(a,b){return qa(b,function(b){return N.eq(b.original(),a)}).map(function(a){return a.replaced()}).getOr(a)},eI=function(a,b,c,d,e,f){if(0===a.selected().length)return g.none();var h=a.writer(),l=a.outerlist();a=a.selected();var k=y8.read(l);f=f(a);f=s8.operate(f,k,a);h=h(f);z8(h);P.before(l,h.elements());G.remove(l);l=h.elementsTransformed();b=dI(b,l);d=dI(d,l);return g.some(ni.block({start:b,soffset:c,finish:d,foffset:e,
all:h.elements()}))},fI={execute:function(a,b,c,d,e,f){return eI(a,b,c,d,e,k(f))},executeUsing:eI},A8=function(a,b,c,d,e,f,h){return pi.applyOn(a,WH,b,c,d,e,function(a){z(a,function(a){h.change(a,f)});return a})},gI=function(a,b){return function(c,d,e,f,h,g){var l=qo.isRootOrCell(c);return wu.context(d,f,c).fold(function(){return A8(l,d,e,f,h,a,g)},function(a){return fI.execute(a,d,e,f,h,b)})}},Yq={indent:function(a,b,c,d,e,f){return gI(1,wu.indent)(a,b,c,d,e,f)},outdent:function(a,b,c,d,e,f){return gI(-1,
wu.outdent)(a,b,c,d,e,f)}},B8={isRootContainer:function(a){return function(b){return a(b)||U(["td","th","caption"],D.name(b))}},extract:function(a){return Bc.cata(a,function(a){return[a]},function(a){return[a]},function(a,c){return U(["ol","ul"],D.name(a))?[a]:ia(c,Bc.toTarget)},function(a){return[a]})},isCapable:function(a){return pa.isBlock(a)},canUse:k(!1),quasi:function(a){return g.some(Ik.nu(nb()))},ascend:ca},yu=function(a){return Vd.is(a)?L.descendant(a,"blockquote"):L.closest(a,"blockquote")},
hI=function(a){return nf.sharedOne(yu,a)},C8=function(a,b,c,d,e){return pi.applyOn(a,B8,b,c,d,e,function(a){var b=r.fromTag("blockquote");0<a.length&&(y.before(a[0],b),P.append(b,a),b=Y.descendants(b,"blockquote"),E(b,G.unwrap));return a})},zu={toggle:function(a,b,c,d,e){return(N.eq(b,d)?yu(b):hI([b,d])).fold(function(){return C8(a,b,c,d,e)},function(a){G.unwrap(a);return g.some(ni.block({start:b,soffset:c,finish:d,foffset:e,all:[]}))})},queryPoint:yu,queryAll:hI},iI=function(a,b,c,d){var e=a.content(),
f=a.undo();Zb.cata(a.selections().get(),t,jo.multiple(e,a.undo(),d),jo.single(e,f,d,b,c))},jI=function(a){return function(b){var c=0<a?Yq.indent:Yq.outdent,d=Tq(b.region()),e=b.content();iI(b,Ek,Dk,function(a,b,g,k){return c(e.isRoot,a,b,g,k,d)})}},Co=function(a){return function(b){var c=b.content(),d=function(b,d,h,g){return a.run(c.isRoot,b,d,h,g)};Zb.cata(b.selections().get(),t,ko.multiple(c,b.undo(),d),ko.single(c,b.undo(),d,Ek,Dk))}},Do=function(a){return function(b){vc.detect(b.content().getSelection()).each(function(c){Pd.runTransaction(b.content(),
b.undo(),function(){(a.query(c.image())?oh.floatnone():a).run(c.image())},b.content().toEditing)})}},ce={indent:jI(1),outdent:jI(-1),blockquote:function(a){var b=a.content();iI(a,Ek,Dk,function(a,d,e,f){return zu.toggle(b.isRoot,a,d,e,f)})},justifyLeft:Co(le.justifyleft()),justifyCentre:Co(le.justifycentre()),justifyRight:Co(le.justifyright()),justifyFull:Co(le.justifyfull()),imageNone:Do(oh.floatnone()),imageLeft:Do(oh.floatleft()),imageCentre:Do(oh.floatcentre()),imageRight:Do(oh.floatright()),
breakQuote:function(a,b,c){G7.breakQuote(b,c).each(function(b){a.content().setRelativeSelection(b.start(),b.finish());a.content().uiChanged()})}},D8=function(a,b){return qa(a,function(a){return a.value()===b})},cm={updateMenu:function(a,b,c,d,e){b.fold(a.clear,t,function(b){(xa(b)?D8(d,b):g.some(b)).each(a.select);e.each(function(c){c=c(b);a.selectElement(c)})});c.fold(a.disable,t,a.enable);b.fold(a.untick,t,function(b){b=xa(b)?b:b.value();a.tick(b)})}},Au=ta.generate([{table:["selection"]},{list:["selection"]}]),
E8=function(a,b){return a.isRoot(b)||U(["table","ul","ol"],D.name(b))},bm={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed())return L.closest(b.startContainer(),"td,th,li",u(E8,a)).map(function(a){return"li"===D.name(a)?Au.list(b):Au.table(b)});var c=id.commonAncestorContainer(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());return L.closest(c,"ol,ul",a.isRoot).map(function(a){return Au.list(b)})})},cata:function(a,b,c){return a.fold(b,c)}},ri={attr:function(a,
b,c){var d=u(m.set,a,b,c);a=u(m.remove,a,b);0<c.length?d():a()},css:function(a,b,c){var d=u(v.set,a,b,c);a=u(v.remove,a,b);0<c.length?d():a()}},Bu={resolve:Lb.create("ephox-salmon").resolve},F8=Bu.resolve("upload-image-in-progress"),G8="data-"+Bu.resolve("image-blob"),H8="data-"+Bu.resolve("image-upload"),uc={uploadInProgress:k(F8),blobId:k(G8),trackedImage:k(H8)},kI=Aa("url alt width height isLocal align".split(" "),["computedWidth","computedHeight"]),lI=function(a,b){a=m.get(a,b);return void 0!==
a?a:""},Hm={divine:function(a){var b=v.getRaw(a,"width").getOr(""),c=v.getRaw(a,"height").getOr(""),d=v.getRaw(a,"width").getOrThunk(function(){return Ia.get(a)+"px"}),e=v.getRaw(a,"height").getOrThunk(function(){return sa.get(a)+"px"}),f=uu.divine(a);return kI({url:lI(a,"src"),alt:lI(a,"alt"),width:b,height:c,computedWidth:d,computedHeight:e,isLocal:m.has(a,uc.blobId()),align:f})},properties:kI,apply:function(a,b){m.get(a,"src")===b.url()||b.isLocal()||m.set(a,"src",b.url());ri.attr(a,"alt",b.alt());
ri.css(a,"width",b.width());ri.css(a,"height",b.height());b.align().each(function(b){oh.runFloat(a,b)})}},I8={hasNoContent:function(a){var b=A.children(a);return D.isElement(a)&&(0===b.length||1===b.length&&"br"===D.name(b[0]))}},J8=O("alignment","quoted"),mI=function(a){return a.getSelection().fold(function(){return!1},function(a){var b=a.startContainer();a=a.endContainer();return N.eq(b,a)?zu.queryPoint(b).isSome():zu.queryAll([b,a]).isSome()})},K8=[le.justifyleft(),le.justifycentre(),le.justifyright(),
le.justifyfull()],nI=function(a){return vc.detect(a.getSelection()).fold(function(){return a.getSelection().bind(function(a){return qa(K8,function(b){return b.query(a.startContainer(),a.endContainer())}).map(function(a){return a.name()})}).fold(Da.off,Da.on)},function(a){return Hm.divine(a.image()).align().fold(Da.off,function(a){return"center"===a?Da.on(le.justifycentre().name()):"right"===a?Da.on(le.justifyright().name()):Da.on(le.justifyleft().name())})})},Uq={read:function(a){var b=nI(a);a=mI(a)?
Da.on({}):Da.off();return J8(b,a)},alignment:nI,inQuote:mI,atQuoteBreak:function(a){return a.getSelection().bind(function(a){var b=a.startContainer();return a.collapsed()?L.closest(b,"blockquote").bind(function(a){return I8.hasNoContent(b)?g.some({quote:k(a),element:k(b)}):g.none()}):g.none()})}},fm={multiple:function(a,b,c){return function(d,e){Pd.runTransaction(a,b,function(){z(e,c)},a.toEditing)}},single:function(a,b,c){return function(d,e){Pd.runTransaction(a,b,function(){c(e).each(function(b){a.setSelection(b.start(),
b.soffset(),b.finish(),b.foffset())});a.backupSelection()},a.toEditing)}}},L8=nb(),dm={atStartOf:function(a,b,c){ju.atStartOf(L8,a,b,c)}},M8=wH.resolve("style-marker"),Rb={styleSpan:k(M8),overrideSpan:k("data-ephox-override"),quasiBlock:vo.style},Lk=ta.generate([{none:[]},{tempIn:["selection"]},{tempOut:["selection"]},{rangedIn:["selection"]},{rangedOut:["selection"]}]),Wq={detect:function(a,b){return a.getSelection().fold(function(){return Lk.none()},function(a){var c=b(a);return Wa.isCollapsed(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())?c?Lk.tempIn(a):Lk.tempOut(a):c?Lk.rangedIn(a):Lk.rangedOut(a)})}},oI=function(a,b){return r.fromTag(a,b.dom())},pI=function(a,b,c){c=r.fromTag("span",c.dom());v.set(c,a,b);return c},Vq={nu:function(a,b,c,d){return"span"===c?pI(a,b,d):oI(c,d)},nuTag:oI,nuAttr:function(a,b,c){c=r.fromTag("span",c.dom());m.set(c,a,b);return c},nuStyle:pI},qI={"font-weight":{700:"bold",400:"normal"}},rI=function(a,b){if(a===b&&""!==b&&void 0!==b)return!0;a=a.toLowerCase();
b=b.toLowerCase().split(" ");return U(b,a)},sI=function(a,b){return void 0!==qI[a]?(a=qI[a][b],void 0!==a?a:b):b},tI=function(a,b){a=N8(a,b);return sI(b,a)},N8=function(a,b){return(D.isText(a)?A.parent(a):g.some(a)).map(function(a){return v.get(a,b)}).getOr(void 0)},vj={state:function(a,b,c){a=tI(a,b);return"text-decoration"===b?rI(c,a):c===a&&""!==a&&void 0!==a},rawState:function(a,b,c){a=sI(b,v.getRaw(a,b).getOr(void 0));return"text-decoration"===b?rI(c,a):c===a&&""!==a&&void 0!==a},value:tI},uI=
{"text-decoration":function(a,b,c,d){var e=function(d){return Ja.closest(d,function(d){return D.isElement(d)&&(U(c,D.name(d))||v.getRaw(d,a).exists(function(a){return-1!==a.indexOf(b)}))}).toArray()};d=e(d.startContainer()).concat(e(d.endContainer()));return Xa(d,function(d){return U(c,D.name(d))?!0:v.getRaw(d,a).exists(function(a){return b===a})})}},O8={handle:function(a,b,c){return void 0!==uI[a]?g.some(uI[a]):g.none()}},vI=function(a,b){return b.getSelection().map(function(b){return a(b)}).getOr(!1)},
Cu=function(a,b,c,d){var e=Vd.leftWith(pa.isBlock,d).getOrThunk(function(){return W.point(d.startContainer(),d.startOffset())}),f=Vd.rightWith(pa.isBlock,d).getOrThunk(function(){return W.point(d.endContainer(),d.endOffset())});return O8.handle(a,b).fold(function(){var c=vj.state(e.element(),a,b),d=vj.state(f.element(),a,b);return c||d},function(d){return d(a,b,c,Ub.hare(e.element(),e.offset(),f.element(),f.offset()))})},P8=function(a,b,c,d){return vI(u(Cu,a,b,c),d)},wI=function(a,b){return Q8(a,
b)},R8=function(a,b){return vI(u(wI,a),b)},Q8=function(a,b){var c=Vd.leftWith(pa.isBlock,b).fold(b.startContainer,function(a){return a.element()});b=Vd.rightWith(pa.isBlock,b).fold(b.endContainer,function(a){return a.element()});c=Db.closest(c,a);a=Db.closest(b,a);return c||a},xI=function(a,b){return U(a,D.name(b))},S8=function(a,b){var c="["+a+"]";return L.closest(b.startContainer(),c).bind(function(d){return L.closest(b.endContainer(),c).bind(function(b){var c=m.get(d,a);b=m.get(b,a);c=c.toLowerCase();
b=b.toLowerCase();return c===b?g.some(c):g.none()})})},Pg={queriesStyle:function(a,b,c){return{queryOn:u(Cu,a,b,c),query:u(P8,a,b,c)}},queryStyleOn:Cu,queriesTag:function(a){return{queryOn:u(wI,a),query:u(R8,a)}},relatedStyle:function(a,b,c,d){(c=xI(c,d))||(c="span"===D.name(d)&&vj.state(d,a,b));return c},relatedTags:xI,queryAttrSame:function(a,b){return b.getSelection().bind(function(b){return S8(a,b)})},queryAttrIs:function(a,b,c){var d=b.toLowerCase(),e=function(b){return m.get(b,a).toLowerCase()===
d};return L.closest(c.startContainer(),"["+a+"]").filter(e).orThunk(function(){return L.closest(c.endContainer(),"["+a+"]").filter(e)}).isSome()}},Eo=ta.generate([{none:["last","mode"]},{running:["next","mode"]},{split:["boundary","last","mode"]},{finished:["element","mode"]}]),Du=O("start","soffset","finish","foffset"),yI=function(a,b,c){c=bd.toLeaf(a,c,0);return Eu(a,c.element())?Fu(a,b,c.element()).map(function(a){return W.point(a,0)}).getOr(c):c},Mk=function(a,b){return Nc.isFrame(a,b)||Nc.isBlock(a,
b)||U(["li"],a.property().name(b))},Fu=function(a,b,c){return Ca.seekRight(a,c,function(b){return!Eu(a,b)&&!Mk(a,b)},b)},Eu=function(a,b){return a.property().isText(b)?a.property().parent(b).exists(function(b){return U("table tbody thead tfoot tr ul ol".split(" "),a.property().name(b))}):!1},T8=function(a,b,c,d,e){return Ca.walk(a,d,c,Ca.walkers().right()).fold(function(){return Eo.none(d,Ca.sidestep)},function(b){return a.eq(b.item(),e)?Eo.finished(e,b.mode()):Mk(a,b.item())?Eo.split(b.item(),d,
b.mode()):Eo.running(b.item(),b.mode())})},AI=function(a,b,c,d){return Fu(a,b,c).fold(function(){return g.none()},function(e){return a.eq(e,d)?g.some(d):zI(a,c,e)?AI(a,b,e,d):Mk(a,e)?(e=yI(a,b,e),g.some(e.element())):g.some(e)})},zI=function(a,b,c){return a.property().parent(b).exists(function(b){return a.eq(b,c)})},Gu=function(a,b,c,d,e,f){return T8(a,b,c,e,f).fold(function(a,b){return[{start:d,finish:a}]},function(c,e){return Gu(a,b,e,d,c,f)},function(c,l,k){var h={start:d,finish:l};return(zI(a,
e,c)?AI(a,b,c,f):function(){var d=yI(a,b,c);return a.eq(d.element(),c)?Ca.walk(a,c,Ca.advance,Ca.walkers().right()).map(function(a){return a.item()}):g.some(d.element())}()).fold(function(){return[h]},function(c){return a.eq(c,f)?[h].concat({start:f,finish:f}):[h].concat(Gu(a,b,Ca.advance,c,c,f))})},function(a,b){return[{start:d,finish:a}]})},Hu=function(a,b,c){if(Mk(a,b)){var d=a.property().children(b);return 0<=c&&c<d.length?Hu(a,d[c],0):c===d.length?Hu(a,d[d.length-1],0):b}return b},BI=function(a,
b,c,d){c=Hu(a,c,d);return Eu(a,c)?Fu(a,b,c).getOr(c):c},U8=function(a,b,c,d,e,f){var h=BI(a,b,c,d),g=BI(a,b,e,f);b=Gu(a,b,Ca.sidestep,h,h,g);return E(b,function(b,h){h=a.eq(b.start,c)?d:0;if(a.eq(b.finish,e))var g=f;else g=b.finish,g=a.property().isText(g)?a.property().getText(g).length:a.property().children(g).length;return Du(b.start,h,b.finish,g)})},CI=function(a,b,c,d,e,f){a.eq(c,e)?Mk(a,c)?(d=bd.toLeaf(a,c,d),f=bd.toLeaf(a,c,f),a=a.eq(d.element(),c)&&a.eq(f.element(),c)?[Du(d.element(),d.offset(),
f.element(),f.offset())]:CI(a,b,d.element(),d.offset(),f.element(),f.offset())):a=[Du(c,d,c,f)]:a=U8(a,b,c,d,e,f);return a},V8={collect:CI},Ef=ta.generate([{leftEdge:["element"]},{between:["before","after"]},{rightEdge:["element"]}]),W8=function(a,b,c){c=Td.split(a,b,c);var d=function(){return Ef.rightEdge(b)};return Td.position(a,c).fold(d,function(){return Ef.leftEdge(b)},Ef.between,d)},DI=function(a,b,c,d){if(a.property().isText(b))return W8(a,b,c);if(a.property().isEmptyTag(b))return d(b);a=a.property().children(b);
b=0===c?Ef.leftEdge(b):c===a.length?Ef.rightEdge(b):0<c&&c<a.length?Ef.between(a[c-1],a[c]):Ef.rightEdge(b);return b},EI={toLeft:function(a,b,c,d){return DI(a,c,d,Ef.leftEdge).fold(function(a){return a},function(a,b){return b},function(c){return Ca.after(a,c,b).getOr(c)})},toRight:function(a,b,c,d){return DI(a,c,d,Ef.rightEdge).fold(function(c){return Ca.before(a,c,b).getOr(c)},function(a,b){return a},function(a){return a})}},X8=function(a,b,c,d){var e=a.property().children(b);b=function(b){return Va(e,
u(a.eq,b))};c=c.bind(b).getOr(0);d=d.bind(b).getOr(e.length-1);return-1<c&&-1<d?g.some(e.slice(c,d+1)):g.none()},FI=function(a,b,c,d){return zd.breakPath(a,b,function(b){return a.property().parent(b).fold(k(!0),u(a.eq,c))},d)},GI=function(a,b,c,d){a.eq(b,d)?d=g.none():(d=FI(a,d,b,Fk.breakToRight),d=g.some(d.first()));if(a.eq(b,c))c=g.none();else{var e=FI(a,c,b,Fk.breakToLeft);0<e.splits().length&&a.insert().prepend(e.splits()[0].second(),c);c=g.some(e.second().getOr(c))}return X8(a,b,c,d)},Y8=function(a,
b,c,d,e){return fu.ancestors(a,c,d,b).shared().orThunk(function(){return zd.sharedOne(a,function(c,d){return b(d)?g.some(d):a.up().predicate(d,b)},[c,d])}).map(e)},Z8=function(a,b,c,d,e){return Y8(a,b,c,d,e).bind(function(b){return GI(a,b,c,d)})},HI={fracture:function(a,b,c,d,e){e=void 0!==e?e:ca;a.eq(c,d)?(b=e(c),a=a.eq(b,c)?g.some([c]):GI(a,b,c,c)):a=Z8(a,b,c,d,e);return a}},II=function(a,b,c,d,e,f,h){a.property().isText(c)&&a.eq(c,e)?(c=Td.splitByPair(a,c,d,f),a=HI.fracture(a,b,c,c,h)):(e=EI.toRight(a,
b,e,f),c=EI.toLeft(a,b,c,d),a=HI.fracture(a,b,c,e,h));return a},JI={fractures:function(a,b,c,d,e,f,h){c=V8.collect(a,b,c,d,e,f);return ia(c,function(c,d){return II(a,b,c.start(),c.soffset(),c.finish(),c.foffset(),h).toArray()})},fracture:II},KI=nb(),$8={fractures:function(a,b,c,d,e,f){return JI.fractures(KI,a,b,c,d,e,f)},fracture:function(a,b,c,d,e,f){return JI.fracture(KI,a,b,c,d,e,f)}},qh={makeTo:function(a,b,c){var d=A.owner(a).dom().createRange();d.setStart(a.dom(),b);d.setEndBefore(c.dom());
return d},makeFrom:function(a,b,c){var d=A.owner(b).dom().createRange();d.setStartAfter(a.dom());d.setEnd(b.dom(),c);return d},leftEdge:function(a,b,c,d){return id.after(a,b,c,d)?W.point(c,d):W.point(a,b)},rightEdge:function(a,b,c,d){return id.after(a,b,c,d)?W.point(a,b):W.point(c,d)}},a9=function(a,b){b=cb(b).join(",");return(Fa.is(a,b)?[a]:[]).concat(Y.descendants(a,b))},LI={cleanse:function(a,b){a=a9(a,b);z(a,function(a){var c=D.name(a);(void 0!==b[c]?b[c]:t)(a)})}},b9={onlyEphox:function(a){var b=
ma.get(a);b=ka(b,function(a,b,e){return!Gb(a,"ephox-")});z(b,function(b){n.remove(a,b)})}},Nk=function(a){G.unwrap(a)},MI=function(a,b){v.remove(a,b);m.hasNone(a)&&Nk(a)},NI=function(a){var b={};z(a,function(a){b[a]=rh(Nk)});return b},rh=function(a){return function(b){m.has(b,"data-ignore")||a.apply(null,arguments)}},Jc={cssAndTag:function(a,b,c){a=NI(a);c=function(a){MI(a,b)};return ua(a,{span:rh(c),font:rh(c)})},tagList:NI,removeStyle:rh(MI),removeAttribute:rh(function(a,b){m.remove(a,b);m.hasNone(a)&&
Nk(a)}),unwrap:rh(Nk),unstyle:rh(function(a){b9.onlyEphox(a);m.remove(a,"style");m.hasNone(a)&&Nk(a)}),normal:function(a){m.remove(a,"data-ignore")},ignore:function(a){m.set(a,"data-ignore","true")}},Fo=function(a,b){var c=A.children(a);z(c,function(a){Fo(a,b)});b(a)},OI=function(a){return D.isElement(a)&&!pa.isEmptyTag(a)&&!pa.isFrame(a)&&0===Ea.get(a).replace(mb(),"").length},si={wipeout:Fo,onEmpty:function(a){Fo(a,function(a){!D.isElement(a)||pa.isFrame(a)||pa.isEmptyTag(a)||0!==Ea.get(a).length?
OI(a)&&G.unwrap(a):G.remove(a)})},onQuasiEmpty:function(a){Fo(a,function(a){OI(a)&&G.remove(a)})}},PI=function(a){return A.parent(a).fold(k([]),function(a){return pa.isBlock(a)?[a]:[a].concat(PI(a))})},c9=function(a,b){var c=[b].concat(PI(b)),d=kd(c);return Va(d,a).map(function(a){return 0===a?d[0]:d[a-1]}).getOr(b)},d9=function(a,b){z(b,function(b){LI.cleanse(b,a);si.onQuasiEmpty(b)})},Xq={run:function(a,b,c,d){var e=Vd.left(c).getOrThunk(function(){return qh.leftEdge(c.startContainer(),c.startOffset(),
c.endContainer(),c.endOffset())}),f=Vd.right(c).getOrThunk(function(){return qh.rightEdge(c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset())}),h=u(c9,d.matches);b=$8.fractures(b,e.element(),e.offset(),f.element(),f.offset(),h);b=ia(b,function(b){if(0<b.length){var c=d.purifiers();var e=(0,d.nu)(a);Jc.ignore(e);g.from(b[0]).bind(A.prevSibling).each(si.onQuasiEmpty);g.from(b[b.length-1]).bind(A.nextSibling).each(si.onQuasiEmpty);z(b,si.onQuasiEmpty);b=ka(b,ja.inBody);0<b.length?(y.before(b[0],
e),P.append(e,b),d9(c,b),c=[e]):c=[]}else c=[];return c});z(b,Jc.normal);return Ub.fussyFromElements(b)}},Iu=function(a,b){return N.eq(a,b)?[]:A.parent(a).fold(function(){return[]},function(c){c=Iu(c,b);var d=A.findIndex(a).toArray();return c.concat(d)})},e9=function(a,b){return a.slice(b+1)},f9=function(a,b){return a.slice(0,b)},Ju=function(a,b,c,d){if(0===d.length)b(c);else{var e=d[0],f=d.slice(1);A.child(c,e).each(function(c){Ju(a,b,c,f)});c=A.children(c);e=a(c,e);z(e,b)}},QI={one:function(a,b){a(b)},
across:function(a,b,c,d){c=Iu(c,b);d=Iu(d,b);b=A.children(b);var e=b.slice(0<c.length?c[0]+1:0,0<d.length?d[0]:b.length-1);z(e,a);0<c.length&&Ju(e9,a,b[c[0]],c.slice(1));0<d.length&&Ju(f9,a,b[d[0]],d.slice(1))}},Ok=nb(),ti={split:function(a,b){return Td.split(Ok,a,b)},splitByPair:function(a,b,c){return Td.splitByPair(Ok,a,b,c)},range:function(a,b,c,d){return Td.range(Ok,a,b,c,d)},subdivide:function(a,b){return Td.subdivide(Ok,a,b)},position:function(a){return Td.position(Ok,a)}},RI=function(a,b,c){var d=
A.children(b),e=0===c,f=c===d.length,h=0<d.length;return void 0!==a.empty&&U(["br","hr","img"],D.name(b))?a.empty:void 0!==a.hasPrevious&&h&&0<c&&c<d.length?a.hasPrevious:void 0!==a.hasNext&&h&&c<d.length-1?a.hasNext:void 0!==a.rightEdge&&h&&f?a.rightEdge:void 0!==a.first&&e?a.first:a.otherwise},g9=function(a,b,c){return RI(a.before.element,b,c)(b,c)},h9=function(a,b,c){return RI(a.after.element,b,c)(b,c)},SI=function(a,b,c){c=ti.split(b,c);var d=function(a){return function(){var c=Array.prototype.slice.call(arguments,
0);c=[b].concat(c);return a.apply(null,c)}};return ti.position(c).fold(d(a.none),d(a.start),d(a.middle),d(a.end))},i9=function(a,b,c){return SI(a.before.text,b,c)},j9=function(a,b,c){return SI(a.after.text,b,c)},Go={prefix:function(a,b,c){return(D.isText(b)?i9:g9)(a,b,c)},postfix:function(a,b,c,d,e){b=qh.rightEdge(b,c,d,e);return(D.isText(b.element())?j9:h9)(a,b.element(),b.offset())}},Ku=function(a,b){return a.bind(function(a){return b.map(function(b){return{left:k(a),right:k(b)}})})},k9=function(a,
b,c,d){b=ti.splitByPair(b,c,d);return Ku(a.general.insertBefore(b),a.general.insertAfter(b))},l9=function(a,b,c,d){c=A.child(b,c);var e=d<A.children(b).length?A.child(b,d):A.lastChild(b);return c.bind(function(b){return e.bind(function(c){return Ku(a.general.insertBefore(b),a.general.insertAfter(c))})})},VA={both:function(a,b,c,d,e){if(N.eq(b,d)){var f=D.isText(b)?k9:l9;return c>e?f(a,b,e,c):f(a,b,c,e)}f=qh.leftEdge(b,c,d,e);b=Go.postfix(a,b,c,d,e);a=Go.prefix(a,f.element(),f.offset());return Ku(a,
b)}},Ho=O("inside","outside"),TI=function(a,b){return A.parent(b).fold(k(!0),function(b){return a(b)})},UI=function(a,b){var c=nb();a=[a].concat(c.up().all(a));var d=[b].concat(c.up().all(b));return qa(a,function(a){return Xa(d,u(N.eq,a))})},VI=function(a){return Ho(a.second(),g.some(a.first()))},WI=function(a){return Ho(g.some(a.first()),a.second())},XI=function(a){return Ho(g.some(a),g.none())},Lu=function(a,b,c){c=u(TI,c);c=c(a)?a:Ja.ancestor(a,c).getOr(a);return N.eq(a,c)?XI(a):YI(a,b,c)},YI=
function(a,b,c){a=po.breakPath(a,u(N.eq,c));return b(a)},m9={bridge:function(a,b,c){var d=Lu(a,VI,c),e=Lu(b,WI,c);return d.inside().bind(function(a){return e.inside().bind(function(b){return UI(a,b).map(function(c){return{common:k(c),left:k(a),right:k(b),wipeout:function(){d.outside().each(si.onEmpty);e.outside().each(si.onEmpty)}}})})})},edge:Ho,isSplit:TI,getCommon:UI,onLeft:VI,onRight:WI,onInside:XI,splitFrom:Lu,breaker:YI},n9=O("start","soffset","finish","foffset"),Io=k(!1),Mu=function(a,b){return pa.isBlock(b)||
pa.isContainer(b)||a(b)},ZI=function(a,b){return A.parents(b,u(Mu,a))},$I=function(a,b,c){return D.isElement(c)&&!b(c)?(a=ZI(a,c),!Xa(a,b)):!1},aJ=function(a,b){return function(c){return Mu(a,c)||$I(a,b,c)}},o9=function(a,b,c,d,e,f){var h=Wa.isCollapsed(b,c,d,e);b=kb.toLeaf(b,c);d=kb.toLeaf(d,e);var g=Wh.extractTo(b.element(),b.offset(),f,Io),k=Wh.extractTo(d.element(),d.offset(),f,Io),m=function(b){return h||b.offset()!==wa.getEnd(b.element())?b:wc.after(b.element(),a).map(function(a){return W.point(a,
0)}).getOr(b)},w=function(b){return h||0!==b.offset()?b:wc.before(b.element(),a).map(function(a){return W.point(a,wa.getEnd(a))}).getOr(b)};return function(){return Wh.find(g.element(),g.offset(),Io).map(m).bind(function(a){return Wh.find(k.element(),k.offset(),Io).map(w).map(function(b){return n9(a.element(),a.offset(),b.element(),b.offset())})})}},p9={applyTo:function(a,b,c,d,e,f,h){var g=aJ(a,h),k=o9(a,c,d,e,f,g);a=PU(mb(),mb());return VA.both(a,c,d,e,f).bind(function(a){return m9.bridge(a.left().element(),
a.right().element(),g).bind(function(c){b(c.common(),c.left(),c.right());a.left().cleanup();a.right().cleanup();c.wipeout();return k()})})},blockRoot:Mu,pathToTop:ZI,isEnclosingInline:$I,isStopper:aJ},bJ=function(a,b,c,d){var e=function(a){LI.cleanse(a,b)};return p9.applyTo(a,function(a,b,c,d){if(N.eq(b,c))QI.one(e,b);else QI.across(e,a,b,c)},c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d)},de={doRemoveAll:function(a,b,c){return bJ(a,b,c,Jb)},doRemoveUpto:bJ,allRules:{b:Jc.unwrap,
strong:Jc.unwrap,i:Jc.unwrap,em:Jc.unwrap,u:Jc.unwrap,strike:Jc.unwrap,del:Jc.unwrap,s:Jc.unwrap,sup:Jc.unwrap,sub:Jc.unwrap,small:t,span:Jc.unstyle,font:Jc.unstyle}},q9=function(a,b,c){return{groups:0<a.current.length?a.groups.concat({parent:a.parent,children:a.current}):a.groups,current:[c],parent:b}},r9=function(a,b,c){return{groups:a.groups,current:a.current.concat([c]),parent:b}},s9=function(a,b,c){return g.from(b.current[b.current.length-1]).bind(a.query().nextSibling).bind(function(b){return a.eq(b,
c)?g.some(r9):g.none()}).getOr(q9)},t9={textnodes:function(a,b){b=hb(b,function(b,d){return a.property().parent(d).fold(function(){return b},function(c){return s9(a,b,d)(b,c,d)})},{groups:[],current:[],parent:null});return 0<b.current.length?b.groups.concat({parent:b.parent,children:b.current}):b.groups}},dJ=function(a,b,c,d,e,f){b=Td.range(a,b,c,d,e);return cJ(a,b,f)},cJ=function(a,b,c){if(0===b.length)return b;b=ka(b,function(b){return a.property().isText(b)&&0<a.property().getText(b).length});
return E(b,function(b){var d=c();a.insert().before(b,d.element());d.wrap(b);return d.element()})},u9=function(a,b){return g.from(b[0]).map(function(c){var d=kg.toLower(a,b[b.length-1]);return W.points(W.point(c,0),W.point(d.element(),d.offset()))})},Pk={wrapWith:dJ,wrapper:cJ,leaves:function(a,b,c,d,e,f){b=kg.toLeaf(a,b,c);d=kg.toLeaf(a,d,e);f=dJ(a,b.element(),b.offset(),d.element(),d.offset(),f);return u9(a,f)},reuse:function(a,b,c,d,e,f,h){b=kg.toLeaf(a,b,c);d=kg.toLeaf(a,d,e);d=Td.range(a,b.element(),
b.offset(),d.element(),d.offset());d=t9.textnodes(a,d);var g=function(a){return a.parent},k=function(b){var c=h();a.insert().before(b.children[0],c.element());z(b.children,c.wrap);return c.element()};return E(d,function(b){return(a.property().children(b.parent).length===b.children.length&&f(b.parent)?g:k)(b)})}},w9=function(a,b,c,d,e,f){a=v9(a,b,c,d,e,f);b=a.cursor();b=W.points(W.point(b.element(),b.offset()),W.point(b.element(),b.offset()));return g.some({range:k(b),temporary:a.temporary,wrappers:a.wrappers})},
x9=function(a,b,c,d,e){d=b.dom().ownerDocument;var f=a.create().nu("span",d);d=a.create().text(mb(),d);a.insert().append(f,d);(a.property().isEmptyTag(b)?a.property().parent(b):g.some(b)).each(function(b){ju.atStartOf(a,b,c,f)});return{cursor:k(W.point(d,1)),wrappers:k([f]),temporary:k(!0)}},v9=function(a,b,c,d,e,f){return a.property().parent(b).bind(function(d){var e=W.point(b,c),h;if(h=eJ(a,f,d)&&1===a.property().children(d).length)h=a.property().isText(b)&&a.property().getText(b)===mb();return h?
g.some({cursor:k(e),temporary:k(!1),wrappers:k([d])}):g.none()}).getOrThunk(function(){return x9(a,b,c,d,e)})},eJ=function(a,b,c){return"span"===a.property().name(c)&&!1===b(c)},y9=function(a,b,c,d,e,f){var h=b.dom().ownerDocument,l=Pk.reuse(a,b,c,d,e,u(eJ,a,f),function(){return Sy(a,a.create().nu("span",h))});return g.from(l[l.length-1]).map(function(b){var c=a.property().children(b).length;b=W.points(W.point(l[0],0),W.point(b,c));return{wrappers:k(l),temporary:k(!1),range:k(b)}})},z9={spans:function(a,
b,c,d,e,f){f=void 0!==f?f:k(!1);return(a.eq(b,d)&&c===e?w9:y9)(a,b,c,d,e,f)}},ui={nu:function(a,b){return Sy(a,b)},wrapWith:function(a,b,c,d,e,f){return Pk.wrapWith(a,b,c,d,e,f)},wrapper:function(a,b,c){return Pk.wrapper(a,b,c)},leaves:function(a,b,c,d,e,f){return Pk.leaves(a,b,c,d,e,f)},reuse:function(a,b,c,d,e,f,h){return Pk.reuse(a,b,c,d,e,f,h)},spans:function(a,b,c,d,e,f){return z9.spans(a,b,c,d,e,f)}},vi=nb(),wi={nu:function(a){return ui.nu(vi,a)},wrapWith:function(a,b,c,d,e){return ui.wrapWith(vi,
a,b,c,d,e)},wrapper:function(a,b){return ui.wrapper(vi,a,b)},leaves:function(a,b,c,d,e){return ui.leaves(vi,a,b,c,d,e)},reuse:function(a,b,c,d,e,f){return ui.reuse(vi,a,b,c,d,e,f)},spans:function(a,b,c,d,e){return ui.spans(vi,a,b,c,d,e)}},A9=function(a,b,c){a.getSelection().each(function(d){var e=Vd.left(d).getOrThunk(function(){return W.point(d.startContainer(),d.startOffset())}),f=Vd.right(d).getOrThunk(function(){return W.point(d.endContainer(),d.endOffset())});wi.spans(e.element(),e.offset(),
f.element(),f.offset(),c).each(function(c){var d=c.temporary()?[Rb.styleSpan()]:[],e=c.range();z(c.wrappers(),function(a){ma.add(a,d);b(a)});c=e.begin();e=e.end();a.setSelection(c.element(),c.offset(),e.element(),e.offset())})})},fJ=function(a,b,c,d){b(a);A9(a,d,c)},gf={style:function(a,b,c,d){return fJ(a,c,d,function(a){v.setAll(a,b)})},generic:fJ},gJ=em("bold","strong",["strong","b"],"font-weight","bold","normal"),hJ=em("italic","em",["em","i"],"font-style","italic","normal"),iJ=em("underline",
"span",["u"],"text-decoration","underline","none"),jJ=em("strikethrough","span",["s","strike","del"],"text-decoration","line-through","none"),kJ=function(a,b){var c=function(a,c){return Vq.nuAttr(b,a,c)},d=function(a){return"span"===D.name(a)&&m.has(a,b)},e={span:function(a){Jc.removeAttribute(a,b)}},f=function(a,c){return Pg.queryAttrIs(b,a,c)},h=function(a,c){gf.generic(c,t,void 0,function(c){n.add(c,Rb.styleSpan());m.set(c,b,a)});return g.none()};return{run:function(a,q,m){return Wq.detect(q,u(f,
m)).fold(function(){return g.none()},function(a){var c=["[",b,'="',m,'"]'].join("");L.closest(a.startContainer(),c).each(G.unwrap);return g.none()},function(a){return h(m,q)},function(b){return de.doRemoveAll(a,e,b)},function(b){return Xq.run(q.doc(),a,b,{nu:u(c,m),matches:d,purifiers:k(e)})})},queryValue:function(a){return Pg.queryAttrSame(b,a)},name:k(a)}}("language","lang"),lJ=Ry("superscript","sup",["sup","sub"],{"font-size":"smaller","vertical-align":"super"}),mJ=Ry("subscript","sub",["sub",
"sup"],{"font-size":"smaller","vertical-align":"sub"}),nJ={bold:gJ,italic:hJ,underline:iJ,strikethrough:jJ,language:kJ,superscript:lJ,subscript:mJ},cd={bold:k(gJ),italic:k(hJ),underline:k(iJ),strikethrough:k(jJ),language:k(kJ),superscript:k(lJ),subscript:k(mJ),search:function(a){return void 0!==nJ[a]?g.some(nJ[a]):g.none()}},xi=function(a,b){return a.query(b)},Yg={bold:u(xi,cd.bold()),italic:u(xi,cd.italic()),underline:u(xi,cd.underline()),strikethrough:u(xi,cd.strikethrough()),superscript:u(xi,cd.superscript()),
subscript:u(xi,cd.subscript()),language:u(function(a,b){return a.queryValue(b)},cd.language())},B9=O("bold","italic","underline","strikethrough","superscript","subscript"),yi=function(a,b){return a.on(function(a){return b(a)?Da.on(!0):Da.off()}).getOrThunk(Da.off)},RU={read:function(a){return B9(yi(a,Yg.bold),yi(a,Yg.italic),yi(a,Yg.underline),yi(a,Yg.strikethrough),yi(a,Yg.superscript),yi(a,Yg.subscript))}},Jo=O("startContainer","startOffset","endContainer","endOffset"),Ko=O("item","start","finish",
"text"),Lo=O("items","abort"),oJ=function(a,b){a=a.property().getText(b);return Ko(b,0,a.length,a)},Nu=function(a,b,c){return Lo([],!0)},C9=function(a,b,c){return Lo([],!1)},D9=function(a,b,c){var d=a.property().getText(b);return c(d).fold(function(){return Lo([Ko(b,0,d.length,d)],!1)},function(a){a=a[0]===a[1]?[]:[Ko(b,a[0],a[1],d.substring(a[0],a[1]))];return Lo(a,!0)})},Ff={detail:oJ,fromItem:function(a,b){return a.property().isText(b)?oJ(a,b):Ko(b,0,0,"")},decide:function(a,b,c,d){return(a.property().isBoundary(b)?
Nu:a.property().isEmptyTag(b)?Nu:d(a,b)?Nu:a.property().isText(b)?D9:C9)(a,b,c)}},pJ={all:function(a,b){for(var c=b.term(),d=[],e=c.exec(a);e;){var f=e.index+b.prefix(e);e=e[0].length-b.prefix(e)-b.suffix(e);d.push({start:k(f),finish:k(f+e)});c.lastIndex=f+e;e=c.exec(a)}return d}},E9=function(a){a=Array.prototype.slice.call(a,0);a.sort(function(a,c){return a.start()<c.start()?-1:c.start()<a.start()?1:0});return a},F9={search:function(a,b){b=ia(b,function(b){var c=pJ.all(a,b.pattern());return E(c,
function(a){return ua(b,{start:a.start,finish:a.finish})})});return E9(b)}},Mo={findall:function(a,b){return pJ.all(a,b)},findmany:function(a,b){return F9.search(a,b)}},G9=new RegExp(Cb.wordbreak()+"+","g"),qJ=k(0),rJ=function(a){a=Mo.findall(a,Cb.custom(Cb.wordbreak(),qJ,qJ,g.none()));return g.from(a[a.length-1]).map(function(a){return a.start()})},Ou=function(a){a=a.search(G9);return-1<a?g.some(a):g.none()},Qk={firstWord:function(a){return Ou(a).map(function(b){return a.substring(0,b+1)})},lastWord:function(a){return rJ(a).map(function(b){return a.substring(b)})},
leftBreak:rJ,rightBreak:Ou,hasBreak:function(a){return Ou(a).isSome()}},sJ=Ca.walkers(),tJ=sJ.left(),uJ=sJ.right(),H9={sibling:tJ.sibling,first:tJ.first,slicer:function(a){return Qk.leftBreak(a).map(function(b){return[b+1,a.length]})}},I9={sibling:uJ.sibling,first:uJ.first,slicer:function(a){return Qk.rightBreak(a).map(function(a){return[0,a]})}},Pu=function(a,b,c,d,e){b=Ca.walk(a,b,c,d).map(function(b){var c=Ff.decide(a,b.item(),d.slicer,e);b=c.abort()?[]:Pu(a,b.item(),b.mode(),d,e);return c.items().concat(b)}).getOr([]);
return ka(b,function(a){return 0<a.text().trim().length})},Rk={creepLeft:function(a,b,c){return Pu(a,b,Ca.sidestep,H9,c)},creepRight:function(a,b,c){return Pu(a,b,Ca.sidestep,I9,c)},flatten:function(a,b){return a.property().isText(b)?[Ff.detail(a,b)]:E(a.down().predicate(b,a.property().isText),function(b){return Ff.detail(a,b)})},isEmpty:function(a,b){return a.property().isText(b)?!1:0===a.down().predicate(b,a.property().isText).length}},Qu=function(a,b){return a.up().closest(b,"[lang]",k(!1)).map(function(b){return a.attrs().get(b,
"lang")})},zi={nu:function(a){var b=[],c=[],d=[],e=a,f=function(a){a.each(function(a){b.push(a)})},h=function(a){a.each(function(a){b=b.slice(0,b.length-1)})},l=function(){0<d.length&&c.push({lang:k(e),details:k(d)})},q=function(a){l();d=[];e=a},m=function(c){return c.or(g.from(b[b.length-1])).getOr(a)};return{openInline:function(a,b){b=m(a);b!==e&&q(b);f(a)},closeInline:function(a,b){h(a)},addDetail:function(a){var b=m(g.none());b!==e&&q(b);d.push(a)},addEmpty:function(a){a=m(g.none());q(a)},openBoundary:function(a,
b){f(a);a=m(a);q(a)},closeBoundary:function(a,b){h(a);a=m(a);q(a)},done:function(){l();return c.slice(0)}}},calculate:Qu,softBounder:function(a){return function(b,c){b=Qu(b,c);return!a.equals(b)}},strictBounder:function(a,b){return function(c,d){c=Qu(c,d).getOr(a);return b!==c}}},vJ=function(a,b,c,d){var e=Rk.creepLeft(a,b,d);d=Rk.creepRight(a,c,d);b=0<e.length?e[e.length-1]:Ff.fromItem(a,b);a=0<d.length?d[d.length-1]:Ff.fromItem(a,c);e=0===e.length&&0===d.length;return{left:k(b),right:k(a),isEmpty:k(e)}},
Sk={byBoundary:function(a,b){var c=k(!1);c=vJ(a,b,b,c);a=c.isEmpty()&&Rk.isEmpty(a,b);return{left:c.left,right:c.right,isEmpty:k(a)}},getEdges:vJ,byLanguage:function(a,b){var c=zi.calculate(a,b),d=zi.softBounder(c),e=Rk.creepLeft(a,b,d);d=Rk.creepRight(a,b,d);a=a.property().isText(b)?[Ff.detail(a,b)]:[];b=kd(e).concat(a).concat(d);return{all:k(b),left:k(e),middle:k(a),right:k(d),lang:k(c)}}},Ru=function(a,b,c,d){d=a.property().getText(b);var e=ka(d.substring(0,c),function(a){return a!==mb()}).length,
f=ka(d.substring(c,d.length),function(a){return a===mb()}).length;a=Sk.byLanguage(a,b);b=0===e&&0===a.left().length;c=c+f===d.length&&0===a.right().length;return{all:a.all,leftEdge:k(b),rightEdge:k(c),text:k(d)}},No={before:function(a,b,c,d,e){a=Ru(a,b,c,e);a.rightEdge()?b=g.none():(a=a.all(),0===a.length?b=g.none():(a=a[a.length-1],b=g.some(Jo(b,d,a.item(),a.finish()))));return b},after:function(a,b,c,d,e){a=Ru(a,b,c,e);a.leftEdge()?b=g.none():(a=a.all(),0===a.length?b=g.none():(a=a[0],b=g.some(Jo(a.item(),
a.start(),b,d))));return b},both:function(a,b,c,d,e,f){return d===e?g.none():g.some(Jo(b,d,b,e))},neither:function(a,b,c,d){a=Ru(a,b,c,d);a.leftEdge()||a.rightEdge()?a=g.none():(b=a.all(),0===b.length?a=g.none():(a=b[0],b=b[b.length-1],a=g.some(Jo(a.item(),a.start(),b.item(),b.finish()))));return a}},wJ=O("before","after"),J9={around:function(a,b){var c=a.substring(0,b),d=Qk.leftBreak(c).map(function(a){return a+1});a=a.substring(b);a=Qk.rightBreak(a).map(function(a){return b+a});var e=wJ(d,a),f=
wJ(g.some(b),g.some(b));return a.bind(function(a){return b===a?g.some(f):g.none()}).getOrThunk(function(){return d.bind(function(a){return b===a?g.some(f):g.none()}).getOr(e)})}},K9={word:function(a,b,c,d){if(!a.property().isText(b))return g.none();var e=a.property().getText(b),f=J9.around(e,c);return f.before().fold(function(){return f.after().fold(function(){return No.neither(a,b,c,d)},function(e){return No.after(a,b,c,e,d)})},function(e){return f.after().fold(function(){return No.before(a,b,c,
e,d)},function(f){return No.both(a,b,c,e,f,d)})})}},L9={word:function(a,b,c,d){return K9.word(a,b,c,d)}},M9=nb(),N9={word:function(a,b,c){return L9.word(M9,a,b,c)}},xJ=function(a,b,c){N9.word(b,c,k(!1)).each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())})},Ad={expand:function(a){a.getSelection().each(function(b){Wa.isCollapsed(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())&&xJ(a,b.startContainer(),b.startOffset())})},expandWord:xJ},
zJ=function(a,b){var c=Ub.fussy(b,0,b,A.children(b).length-1);yJ(a,b,c)},Su=function(a){a=A.children(a);return 1===a.length&&D.isText(a[0])&&Ya.get(a[0])===mb()},AJ=function(a,b){return L.closest(a,"."+Rb.styleSpan()).bind(function(a){return L.closest(b,"."+Rb.styleSpan()).filter(function(b){return N.eq(a,b)})})},yJ=function(a,b,c){n.remove(b,Rb.styleSpan());return m.has(b,Rb.overrideSpan())?BJ(a,b,c):g.some(c)},BJ=function(a,b,c){return O9(b).bind(function(d){if(d.isStyled(b)){d=d.nu;var e=A.owner(b);
e=d(e);y.before(b,e);P.append(e,A.children(b));G.remove(b);d=N.eq(b,c.start())?e:c.start();e=N.eq(b,c.finish())?e:c.finish();d=g.some(Ub.fussy(d,c.soffset(),e,c.foffset()))}else d=P9(a,b,d.purifiers(),c,d.matches);return d})},O9=function(a){a=m.get(a,Rb.overrideSpan());return cd.search(a).map(function(a){return a.deferred()})},P9=function(a,b,c,d,e){b=A.owner(b);var f=Ub.fromFussy(d);de.doRemoveUpto(a,c,f,e);a="["+Rb.overrideSpan()+"]";return Fa.one(a,b).bind(function(a){G.unwrap(a);return ja.inBody(d.start())&&
ja.inBody(d.finish())?g.some(d):g.none()})},pg={clean:function(a,b){Su(b)?G.unwrap(b):zJ(a,b)},cleanNonEmpty:zJ,isTransient:Su,withinTransient:AJ,handleOverride:BJ,apply:function(a,b,c,d,e){var f=Ub.fussy(b,c,d,e);return AJ(b,d).bind(function(b){if(Su(b)){var c=A.children(b);c=N.eq(b,f.start())?Ub.fussy(c[0],0,c[0],wa.getEnd(c[0])):f;G.unwrap(b);b=g.some(c)}else b=yJ(a,b,f);return b})}},Oo=function(a,b){return a.action().run(a.isRoot(),a.environment())},qg=function(a,b){var c=a.temp();pg.handleOverride(a.isRoot(),
c,Ub.fussy(c,0,c,wa.getEnd(c)));return g.some(b)},Q9=function(a,b){y.after(a.temp(),a.cursor());return g.some(b)},CJ=function(a,b){y.before(a.temp(),a.cursor());return g.some(b)},Tu=function(a,b){var c=a.original();dm.atStartOf(c.startContainer(),c.startOffset(),a.cursor());return g.some(b)},DJ=function(a,b){var c=a.action().deferred().isStyled(a.temp()),d=a.cursor(),e=g.some(Ub.fussy(d,1,d,1));c?a=e:(a.environment().setSelection(d,0,d,0),a=Oo(a,b));return a},R9=function(a,b){b=a.cursor();var c=a.action().deferred();
de.doRemoveUpto(a.isRoot(),c.purifiers(),Ub.hare(b,0,b,1),c.matches);return g.some(Ub.fussy(b,1,b,1))},Uu=function(a,b){var c=a.cursor();a.environment().setSelection(c,0,c,1);Oo(a,b);return g.some(Ub.fussy(c,1,c,1))},EJ=function(a,b){b=a.environment();a=a.original();b.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());Ad.expand(b);return b.getSelection().map(Ub.fromHare)},S9=function(a,b){var c=a.action().deferred();return de.doRemoveUpto(a.isRoot(),c.purifiers(),Ub.fromFussy(b),
c.matches)},T9=function(a,b){a.action().deferred().isStyled(a.temp())?a=g.some(b):(a.environment().setSelection(b.start(),b.soffset(),b.finish(),b.foffset()),a=Oo(a,b));return a},U9=function(a,b){a=a.temp();b=A.children(a);G.unwrap(a);return 0===b.length?g.none():g.some(Ub.fussy(b[0],0,b[b.length-1],wa.getEnd(b[b.length-1])))},V9=O("environment","isRoot","cursor","temp","action","original"),W9=function(a,b){return kc.last(a).fold(k(!0),function(a){return N.eq(a,b.startContainer())&&wa.getEnd(a)===
b.startOffset()})},X9=function(a,b){return kc.first(a).fold(k(!0),function(a){return N.eq(a,b.startContainer())&&0===b.startOffset()})},Y9=function(a,b,c,d,e){var f=m.get(d,Rb.overrideSpan()),h=e.collapsed(),l=r.fromText(mb()),k=W9(d,e),C=X9(d,e);f=a.name()===f;var w=V9(c,b,l,d,a,e);a=f&&pg.isTransient(d)?[U9]:h&&f&&k?[Q9,qg,DJ]:h&&f&&C?[CJ,qg,DJ]:h&&f?[Tu,qg,R9]:h&&k?[Tu,qg,Uu]:h&&C?[CJ,qg,Uu]:h?[Tu,qg,Uu]:f?[qg,EJ,S9,T9]:[qg,EJ,Oo];return hb(a,function(a,b){return a.bind(function(a){return b(w,
a)})},g.some(Ub.fromHare(e)))},Ai=function(a,b,c){Ad.expand(c);var d=c.getSelection().bind(function(d){return pg.withinTransient(d.startContainer(),d.endContainer()).filter(function(a){return m.has(a,Rb.overrideSpan())}).fold(function(){return a.run(b,c)},function(e){return Y9(a,b,c,e,d)})});return ni.inlineFrom(d)},rd={bold:u(Ai,cd.bold()),italic:u(Ai,cd.italic()),underline:u(Ai,cd.underline()),strikethrough:u(Ai,cd.strikethrough()),superscript:u(Ai,cd.superscript()),subscript:u(Ai,cd.subscript()),
removeformat:function(a,b){Ad.expand(b);b=b.getSelection().bind(function(b){return de.doRemoveAll(a,de.allRules,b)});return ni.inlineFrom(b)},language:u(function(a,b,c,d){c.getSelection().each(function(a){pg.apply(b,a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).each(function(a){c.setSelection(a.start(),a.soffset(),a.finish(),a.foffset())})});Ad.expand(c);a=a.run(b,c,d);return ni.inlineFrom(a)},cd.language()),cleanup:pg.clean,cleanupNonEmpty:pg.cleanNonEmpty,isTransient:pg.isTransient,
withinTransient:pg.withinTransient},Po={multiple:function(a,b,c,d){return function(e,f){Pd.runTransaction(a,b,function(){z(f,c)},d)}},single:function(a,b,c,d){return function(e,f){Pd.runTransaction(a,b,function(){c(f)},d)}}},FJ=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.insert().append(b,c);a.insert().appendAll(c,d);return c},GJ=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.attrs().copyTo(b,c);a.insert().before(b,c);a.insert().appendAll(c,d);a.remove().remove(b);
return c},Wy={blockTransform:function(a,b,c){return(Nc.isFormatting(a,b)?GJ:FJ)(a,b,c)},nest:FJ,replace:GJ},SU={tags:k("address article aside audio blockquote canvas dd div dl fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li noscript ol output p pre section table tbody td tfoot th thead tr ul video".split(" "))},Z9=nb(),$9=Ty(Z9),a$={div:!0},HJ={query:function(a,b,c){return $9.query(a,b,c)},apply:function(a,b,c,d,e,f){return pi.applyOn(a,WH,b,c,d,e,function(b){return E(b,
function(b){if(!a$[f]){var c=Ub.hareFromElement(b);de.doRemoveAll(a,de.allRules,c)}return Wy.blockTransform(nb(),b,f)})})}},Bi={background:function(a,b,c){gf.style(a,{"background-color":b},Ad.expand,c)},addClass:function(a,b,c){gf.generic(a,Ad.expand,c,function(a){n.add(a,b)})},setClass:function(a,b,c){gf.generic(a,Ad.expand,c,function(a){m.set(a,"class",b)})},foreground:function(a,b,c){gf.style(a,{color:b},Ad.expand,c)},addAttribute:function(a){return function(b,c,d){gf.generic(b,Ad.expand,d,function(b){m.set(b,
a,c)})}},face:function(a,b,c){gf.style(a,{"font-family":b},Ad.expand,c)},size:function(a,b,c){gf.style(a,{"font-size":b},Ad.expand,c)}},IJ=function(a,b,c,d,e){b=function(b,d,e,f){return a(c.isRoot,b,d,e,f)};var f=jo.multiple(c,d,b),h=jo.single(c,d,b,Ek,Dk);return Zb.cata(e.get(),g.none,function(a,b){return g.some(f(a,b))},function(a,b){return g.some(h(a,b))})},Ih={transform:function(a,b,c,d,e){return IJ(function(a,b,c,d,g){return HJ.apply(a,b,c,d,g,e)},a,b,c,d)},setClass:function(a,b,c,d,e,f){var h=
function(a){L.closest(a,e).each(function(a){Pd.runTransaction(b,c,function(){m.set(a,"class",f)},b.toEditing)})};Zb.cata(d.get(),t,function(a,b){z(a,h)},function(a,b){h(a.startContainer())})},inline:function(a,b,c,d,e){a=function(a){Bi.setClass(a,e,se.isAnnotation)};Zb.cata(d.get(),t,Po.multiple(b,c,a,b.toEditing),Po.single(b,c,a,b.toEditing))},list:function(a,b,c,d,e){return IJ(a,b,c,d,e)}},JJ=O("label","items"),Ci=function(a,b){return 0<b.length?[JJ(g.some(x.key(a)),b)]:[]},Yy={groups:function(a,
b,c){var d=a.divisions(),e=E(d.blocks().concat(d.classblocks()),a.toCandidate),f=E(d.inlines(),a.toCandidate);a=E(d.objects(),a.toCandidate);a=Eb(a,function(a,d){if(Db.closest(b,d.base(),c)){var e=d.base();a=U(["a"],e)?ua(a,{link:a.link.concat([d])}):U(["embed","img","object"],e)?ua(a,{media:a.media.concat([d])}):U(["hr"],e)?ua(a,{line:a.line.concat([d])}):U(["li","ol","ul"],e)?ua(a,{list:a.list.concat([d])}):U(["table","tr","td","th"],e)?ua(a,{table:a.table.concat([d])}):a}return a},{link:[],media:[],
line:[],list:[],table:[]});return Qb([[JJ(g.none(),e)],Ci("block.label.inline",f),Ci("block.label.link",a.link),Ci("block.label.media",a.media),Ci("block.label.line",a.line),Ci("block.label.list",a.list),Ci("block.label.table",a.table)])}},Qo=function(a,b){return{fold:b}},Rf={inline:function(a,b,c){return Qo("inline",function(d,e,f,h){return d(a,b,c)})},object:function(a,b,c,d){return Qo("object",function(e,f,h,g){return f(a,b,c,d)})},block:function(a,b,c){return Qo("block",function(d,e,f,h){return f(a,
b,c)})},classblock:function(a,b,c,d){return Qo("classed block",function(e,f,h,g){return g(a,b,c,d)})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}},KJ="h1 h2 h3 h4 h5 h6 div p pre".split(" "),b$="a embed hr img li object ol table td tr ul th".split(" "),c$=function(a){var b=a.match(/[\[\]* !#%=+>:~,\^\$]/),c=a.indexOf(".");-1<c&&null===b?(b=a.substring(0,c),a=a.substring(c+1),a=-1===a.indexOf(".")?g.some({tag:k(b),clazz:k(a)}):g.none()):a=g.none();return a},e$=function(a,b){var c=a.tag(),d=a.clazz(),
e=U(KJ,c),f=U(b$,c);return(e?J.value(Rf.classblock):f?J.value(Rf.object):J.error("Rule must have object tag or block tag.")).map(function(e){var f=d$(b,a);return e(c,d,f,b.style)})},f$=function(a){return a.text.getOrThunk(function(){return x.key("block."+a.name)})},g$=function(a,b){return a.text.getOrThunk(function(){return x.pkey("tag.inline.class",[b])})},d$=function(a,b){return a.text.getOrThunk(function(){var a="block."+b.tag(),d="tag."+b.tag();a=(x.has(a)?x.translate(a):x.has(d)?x.translate(d):
b.tag())+" ("+b.clazz()+")";return x.raw(a)})},UU={decipher:function(a){return c$(a.name).fold(function(){return U(KJ,a.name)?J.value(Rf.block(a.name,f$(a),a.style)):J.error("Invalid style name: "+a.name)},function(b){return 0<b.tag().length?e$(b,a):J.value(Rf.inline(b.clazz(),g$(a,b.clazz()),a.style))})}},TU=function(a,b){return ia(b,function(b){if(Xa(ds(b.cssRules),function(a){return/ephox-candy-mountain/i.test(a.selectorText)}))return[];var c={};z(ds(b.cssRules),function(b){if(b.type===CSSRule.STYLE_RULE){var d=
b.selectorText,e=d.match(/(.*)\[ephox-data\](.*)/i);null===e?(c.hasOwnProperty(d)||(c[d]={}),c[d].rule=d,c[d].visibility=a):(d=e[1]+e[2],c.hasOwnProperty(d)||(c[d]={}),e=b.style.visibility,"hidden"===e?c[d].visibility=!1:"visible"===e&&(c[d].visibility=!0),b=b.style.content,xf.isEmpty(b)||(c[d].text=b.replace(/["']/g,"")))}});return ka(Ze(c),function(a){return a.hasOwnProperty("rule")&&!1!==a.visibility})})},h$={text:function(a){var b=x.get(a.textkey()),c=x.cata(a.textkey(),k(!0),k(!1),k(!1));a=c&&
void 0===b?a.value():b;return{text:k(a),unknown:k(c)}}},Xy={format:function(a){var b=r.fromText(x.get(a.textkey())),c=T.div();n.add(c,B.resolve("format-element-"+a.tag()));v.setAll(c,a.styles());a=T.div();n.add(a,B.resolve("format-element-container"));y.append(c,b);y.append(a,c);return a},face:function(a){var b=h$.text(a),c=b.text();c=Rc(c).element();v.setAll(c,{"font-family":a.value()});a=b.unknown()?[B.resolve("font-face-unknown")]:[];ma.add(c,a);return c}},XU=function(a,b){a=r.fromTag(a);S.hidden(a,
!0);v.set(a,"list-style-type",b);b=B.resolve("list-style-content");for(var c=0;3>c;c++){var d=r.fromTag("li"),e=T.span();n.add(e,b);y.append(d,e);y.append(a,d)}return a},WU=function(a,b){b=x.translate(b);var c=r.fromText(b),d=T.span();n.add(d,B.resolve("list-style-default"));m.set(a,"data-"+B.resolve("list-style"),"default");m.set(a,"title",b);y.append(d,c);return d},gm="data-"+B.resolve("list-style"),i$=ta.generate([{mine:["element"]},{other:["element"]},{paragraphs:["elements"]}]),wj=ua(i$,{cata:function(a,
b,c,d){return a.fold(b,c,d)}}),j$=function(a,b,c){var d=D.name(a);return v.getRaw(a,"list-style-type").fold(function(){return d===b&&c.isNone()},function(a){return c.exists(function(c){return d===b&&a===c})})},$U={categorise:function(a,b,c){a=hm(a,function(a){return pa.isList(a)?!0:A.parent(a).map(function(a){return a.dom()}).getOr(!1)});return ia(a,function(a){return ob(a,pa.isList)?E(a,function(a){return j$(a,b,c)?wj.mine(a):wj.other(a)}):[wj.paragraphs(a)]})}},LJ=function(a){return Bc.cata(a,function(a){return Ud.wrap(a)},
function(a){return[a]},function(a,c){return pa.isList(a)?[a]:ia(c,LJ)},function(a){return Ud.wrap([a])})},k$={isRootContainer:function(a){return function(b){return a(b)||pa.isContainer(b)&&"li"!==D.name(b)}},extract:LJ,isCapable:pa.isBlock,canUse:k(!1),quasi:function(){return g.some(Ik.nu(nb()))},ascend:function(a,b){return L.closest(a,"ol,ul",b).getOr(a)}},l$=function(a,b,c){var d=r.fromTag(b);c.each(function(a){v.set(d,"list-style-type",a)});return Ao.list(a,d)},sh={hasSameType:function(a,b){return D.name(a)===
b},hasSameStyle:function(a,b){var c=v.getRaw(a,"list-style-type");return b.fold(function(){return c.isNone()},function(a){return c.is(a)})},convertOr:function(a,b,c,d,e){return function(f){return d(f.list(),a)&&e(f.list(),b)?c(f):l$(f,a,b)}},topContext:function(a,b,c){return qi.context(a,b,qi.topmost,$H,c)},context:function(a,b,c){return qi.context(a,b,qi.immediate,$H,c)},unapply:function(a){return Ao.level(a,-1*a.level())}},Tk=nb(),m$=Ty(Tk),n$=function(a){a=E(a,function(a){return L.ancestor(a,"ul,ol")});
var b=E(a,function(a){return a.fold(function(){return"-"},function(a){return D.name(a)+"-"+v.get(a,"list-style-type")})}),c=b[0];return ob(b.slice(1),function(a){return a===c})?a[0]:g.none()},MJ=function(a,b,c){var d=ZU(Tk,a,c),e=function(a,b,c,e,f,g){return pi.applyOn(a,k$,b,c,e,f,function(b){return d.apply(a,g,b)})},f=function(b,d,e){b=b.selected();return 0<b.length&&n$(b).map(function(b){return d(b,a)&&e(b,c)}).getOr(!1)};return{query:function(c){return m$.queryAll(c.startContainer(),c.endContainer(),
["ul","ol"],b).exists(function(b){return b===a})},queryStyle:function(a){var d=c.fold(function(){return":not([style])"},function(a){return'[style*="list-style-type: '+a+';"]'});return Tk.up().closest(a.startContainer(),"ol, ul",b).exists(function(c){return Tk.up().closest(a.endContainer(),"ol, ul",b).exists(function(a){return c.dom()===a.dom()?Tk.is(c,d):!1})})},apply:function(b,d,g,m,w,n,p){var h=p?k(!0):sh.hasSameStyle,l=function(){return e(b,d,g,m,w,n)},q=function(b,e){return fI.executeUsing(b,
d,g,m,w,function(){return sh.convertOr(a,c,e,sh.hasSameType,h)})},C=function(){return sh.topContext(d,m,b).fold(l,function(a){return q(a,sh.unapply)})};return sh.context(d,m,b).fold(l,function(a){return f(a,sh.hasSameType,h)?C():q(a,ca)})}}},im={unordered:u(MJ,"ul"),ordered:u(MJ,"ol")},NJ=function(a,b,c,d){return function(c){var e=d(c.content().isRoot,g.none());return{toggle:!0,value:a,textkey:x.key(b),icon:!0,tooltip:qb.get,updateGeneral:function(a){c.content().getSelection().each(function(b){(e.query(b)?
Da.on(!0):Da.off()).fold(a.deselect,t,a.select)})},action:function(){Ih.list(function(a,b,d,f,g){return e.apply(a,b,d,f,g,Tq(c.region()))},c.region(),c.content(),c.undo(),c.selections());c.content().focus()}}}},o$=NJ("bullist","action.bullist","ul",im.unordered),Zy={ol:NJ("numlist","action.numlist","ol",im.ordered),ul:o$},p$=O("tag"),OJ=function(a,b){return U(["label","li","td","th","normal"],b)?Da.on(a.backup(b)):Da.off()},q$=function(a,b,c){return HJ.query(a,b.selectors(),c).fold(function(){return a.collapsed()?
OJ(b,"normal"):Da.off()},function(a){return b.candidateByName(a).map(Da.on).getOrThunk(function(){return OJ(b,a)})})},cV={read:function(a,b){var c=a.getSelection().fold(function(){return Da.off()},function(c){return q$(c,b,a.isRoot)});return p$(c)}},bV=aa.detect(),PJ={resolve:Lb.create("ephox-arcade").resolve},Vu="data-"+PJ.resolve("no-merge"),Wu="data-"+PJ.resolve("atomic"),rg={doNotMerge:function(a){D.isElement(a)&&m.set(a,Vu,"true")},shouldMerge:function(a){return D.isElement(a)&&!1===m.has(a,
Vu)},setAtomic:function(a){D.isElement(a)&&m.set(a,Wu,"true")},isAtomic:function(a){return D.isElement(a)&&"true"===m.get(a,Wu)},clear:function(a){D.isElement(a)&&z([Vu,Wu],function(b){m.remove(a,b)})}},r$=function(a){var b=A.owner(a);a=Y.descendants(a,"td,th");z(a,function(a){Df.needsCursor(a).each(function(c){y.append(a,r.fromTag("br",b.dom()))})})},s$=function(a){Df.vacate(a);Df.needsCursor(a).each(function(b){G.remove(a)})},t$=function(a){("table"===D.name(a)?r$:s$)(a)},QJ=function(a,b){a=u$(a);
b=ka(a,b);z(b,t$)},u$=function(a){var b=function(a){return[a]},c=A.prevSibling(a).map(b).getOr([]);b=A.nextSibling(a).map(b).getOr([]);return c.concat([a]).concat(b)},Di={purge:function(a){QJ(a,pa.isBlock)},purgeBy:QJ},RJ=function(a){Di.purgeBy(a,function(a){var b=pa.isBlock(a)||"li"===D.name(a)||"ol"===D.name(a)||"ul"===D.name(a);if("li"===D.name(a)){var d;if(!(d=0===Y.descendants(a,"ul,ol").length)){d=Y.descendants(a,"ul,ol,li");var e=Y.descendants(a,"*");a=ed.descendants(a,D.isText);d=d.length===
e.length&&0===a.length}a=d}else a=!0;return b&&a})},Xu=function(a){var b=Y.descendants(a,"ol,ul,li");z([a].concat(b),RJ)},SJ=function(a){a=("li"===D.name(a)?[a]:[]).concat(Y.descendants(a,"li"));z(a,function(a){var b=A.children(a);Xa(b,function(a){return D.isText(a)?0<Ya.get(a).length:!U(["ol","ul"],D.name(a))})||v.set(a,"list-style-type","none")})},Ro=function(a,b){var c=r.fromText(mb());a(b,c);return g.some({element:k(c),cleanup:function(){G.remove(c)},splits:k([])})},Ei=function(a,b){return a.map(function(a){return{element:k(a),
cleanup:t,splits:k(b)}})},TJ=function(a,b){return Ro(y.before,a)},UJ=function(a,b){return Ro(y.after,a)},Yu=function(a,b){return Ro(y.append,a)},Zu=function(a,b){return Ro(y.prepend,a)},VJ=function(a,b){return function(c,d){return a(c,d).fold(function(){return b(c,d)},g.some)}},$u=function(a,b,c){return Ei(g.some(b),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},WJ={before:{text:{none:g.none,start:VJ(function(a,b){return Ei(A.prevSibling(a),[])},TJ),middle:$u,end:$u},element:{hasPrevious:function(a,
b){return Ei(A.child(a,b-1),[])},rightEdge:Yu,first:Zu,empty:TJ,otherwise:Zu}},after:{text:{none:g.none,start:$u,middle:function(a,b,c){return Ei(g.some(c),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},end:VJ(function(a,b){return Ei(A.nextSibling(a),[])},UJ)},element:{hasNext:function(a,b){return Ei(A.child(a,b+1),[])},rightEdge:Yu,first:Zu,empty:UJ,otherwise:Yu}}},So={prefix:u(Go.prefix,WJ),postfix:u(Go.postfix,WJ)},v$=function(a){return!wd.descendant(a,function(a){return li.hasCursor(a,
["hr","img"])})},w$=function(a){var b=a.second();if(dc.isHeading(b)&&v$(b)){var c=Pc.shallowAs(b,"p");y.before(b,c);G.remove(b);b=g.some(c)}else b=g.none();b=b.getOr(a.second());return{first:a.first,second:k(b),mark:a.mark,splits:a.splits}},x$=function(a){return D.isElement(a)&&pa.isInline(a)&&0===A.children(a).length},y$=function(a){var b=r.fromText(mb());y.append(a,b);return b},XJ=function(a,b,c){return So.prefix(b,c).bind(function(b){var c=po.breakPath(b.element(),dc.stopAt(a));return c.second().map(function(d){return{first:k(a),
second:k(d),mark:k(b),splits:k(c.splits().concat(b.splits()))}})})},Me={soft:function(a,b,c){var d=function(c){if(D.isText(c)){var e=Ya.get(c);e=-1===e.indexOf("\u00a0")&&0===e.trim().length}else e=!1;return e?A.nextSibling(c).forall(d):!wa.isStart(a,b)&&pa.isBlock(c)},e=r.fromTag("br");dm.atStartOf(a,b,e);A.nextSibling(e).fold(function(){return wa.getEnd(a)===b&&dc.findBlock(a,c).bind(kc.last).fold(k(!1),function(b){var c="br"===D.name(b)?e:a;return N.eq(c,b)})},d)&&y.after(e,r.fromTag("br"));return g.some({start:k(la.after(e)),
finish:k(la.after(e))})},hard:function(a,b,c,d,e){return XJ(a,b,c).map(w$).map(function(a){z([d.getOr(a.first()),a.second()],function(b){Df.postprocess(b,a.mark().element(),e)});dc.findValidHardBreak(a.second(),e).isNone()&&hu.rootBr(a.second(),a.mark().element());var b=mo.plunge(a.second(),k(!1));b=x$(b)?y$(b):b;a.mark().cleanup();return{start:k(la.on(b,0)),finish:k(la.on(b,0))}})},rupture:XJ},YJ=function(a){return g.some({start:k(a),finish:k(a)})},z$={doubleBr:function(a){y.after(a,r.fromTag("br"));
var b=r.fromTag("br");y.after(a,b);return YJ(la.after(b))},emptyParagraph:function(a){var b=r.fromTag("p"),c=r.fromTag("br");y.append(b,c);y.after(a,b);return YJ(la.on(c,0))}},ZJ=function(a){return[a]},A$={processes:function(a){return{stopper:dc.stopAt(a),wrapper:ZJ,post:t}}},C$=function(a,b,c){g.from(c[c.length-1]).each(function(a){P.append(a,B$(A.children(b)));G.empty(b)})},B$=function(a){return ka(a,function(a){return!(D.isElement(a)&&dc.isList(a)&&0===A.children(a).length)})},D$={processes:function(a){return{stopper:dc.stopAt(a),
wrapper:ZJ,post:C$}}},E$=function(a,b){G.remove(a);return b},F$=function(a,b){var c=r.fromTag("p");P.append(c,b);y.before(a,c);G.remove(a);Df.needsCursor(c).each(function(a){hu.forceAddBr(a,r.fromTag("span"))});return[c]},G$=function(a){var b=A.children(a);b=(wd.descendant(a,pa.isFormatting)?E$:F$)(a,b);z(b,function(b){D.isElement(b)&&(m.transfer(a,b,["dir"]),v.transfer(a,b,["text-align"]))});return b},H$={processes:function(a){return{stopper:dc.stopAt(a),wrapper:G$,post:t}}},I$={exit:function(a,
b){return L.ancestor(a,"ol,ul",b).bind(function(c){var d=L.ancestor(c,"li,ol,ul",b).fold(function(){return H$.processes(c)},function(a){return"li"===D.name(a)?D$.processes(a):A$.processes(c)}),e=po.breakPath(a,d.stopper);return e.second().map(function(b){var c=e.first(),f=d.wrapper(a);P.before(b,f);d.post(c,b,f);z([c,b],Df.lists);b=mo.plunge(f[0],k(!1));b=k(la.on(b,0));return{start:b,finish:b}})})}},J$=function(a,b,c,d){return L.closest(b,"li",d).fold(function(){return Me.hard(a,b,c,g.none(),d)},
function(a){a=dc.exitList(a)?I$.exit(a,d):Me.hard(a,b,c,g.some(a),d);return a})},av={hard:function(a,b,c){return dc.findValidHardBreak(a,c).fold(function(){return dc.findAnchorBreak(a,c).fold(function(){return Me.soft(a,b,c)},function(d){return!0===dc.isRightEdge(d,a,b)?z$.doubleBr(d):Me.hard(d,a,b,g.none(),c)})},function(d){return J$(d,a,b,c)})},soft:Me.soft,rupture:Me.rupture},bv=O("cursor","blocks"),To=function(a,b,c,d){return So.postfix(a,b,c,d).map(function(e){var f=qh.leftEdge(a,b,c,d);qh.makeTo(f.element(),
f.offset(),e.element()).deleteContents();return{start:k(la.before(e.element())),finish:k(la.before(e.element())),mark:e.element}})},cv=function(a,b,c,d,e){return To(a,b,c,d).bind(function(a){return Me.soft(a.mark(),0,e)})},K$=function(a,b,c,d,e){return To(a,b,c,d).bind(function(a){return dc.findValidHardBreak(a.mark(),e).bind(function(b){return Me.hard(b,a.mark(),0,g.none(),e)})})},L$=function(a,b){z(a,function(a){Df.postprocess(a,b)})},dv={soft:cv,hard:function(a,b,c,d,e){var f=dc.findValidHardBreak(a,
e),h=dc.findValidHardBreak(c,e),g=f.fold(function(){var f=cv(a,b,c,d,e);return bv(f,[])},function(f){return h.fold(function(){var h=cv(a,b,c,d,e);return bv(h,[f])},function(h){var g=N.eq(f,h)?K$(a,b,c,d,e):To(a,b,c,d);return bv(g,[f,h])})});return g.cursor().map(function(a){L$(g.blocks(),a.start().fold(ca,ca,ca));return a})},rupture:function(a,b,c,d,e){return To(a,b,c,d).bind(function(a){return dc.findValidHardBreak(a.mark(),e).bind(function(b){return Me.rupture(b,a.mark(),0)})})}},ev={point:function(a,
b,c){return av.rupture(a,b,c)},range:function(a,b,c,d,e){return dv.rupture(a,b,c,d,e)},ruptureUntil:function(a,b,c,d,e,f){var h=So.postfix(a,b,c,d);return function(a,b){return dc.findValidHardBreak(a,e).map(f).bind(function(c){return Me.rupture(c,a,b)})}(a,b).bind(function(a){return h.map(function(b){var c=document.createRange();c.setStartAfter(a.first().dom());c.setEndBefore(b.element().dom());c.deleteContents();b.cleanup();a.mark().cleanup();return a.first()})})}},Uk=function(a,b,c){if(0<a.length){var d=
a[0],e=a.slice(1);dm.atStartOf(b,c,d);P.after(d,e);return g.some(a[a.length-1])}return g.none()},Bd={split:function(a,b,c){var d=void 0===c?Di.purge:c;return ev.point(a.block(),a.element(),a.offset()).bind(function(a){var c=b.all();P.before(a.second(),c);a.mark().cleanup();d(a.first());d(a.second());z([a.first(),a.second()],SJ);a=kd(c);return qa(a,function(a){return A.parent(a).isSome()})})},merge:function(a,b){b=A.children(b.single());return Uk(b,a.element(),a.offset())},nest:function(a,b){return Uk(b.all(),
a.element(),a.offset())},insertMany:Uk,insertChildren:function(a,b){a=A.children(a);return Uk(a,b.element(),b.offset())},fallback:function(a,b,c){return Uk(c,b.startContainer(),b.startOffset())}},$J={lists:function(a){return Eb(a,function(a,c){return a.bind(function(a){return L.closest(c,"ol,ul").map(function(b){return[b].concat(a)})})},g.some([])).map(function(a){return{all:k(a)}})},from:function(a){return{all:k(a)}}},aK=O("left","right"),M$=function(a){return pa.isFormatting(a)||pa.isContainer(a)},
bK=function(a,b,c,d){return Ja.closest(c,a,b)},cK=function(a){return function(b,c,d){return a(b,c.element(),c.offset()).bind(function(c){return a(b,d.element(),d.offset()).map(function(a){return aK(c,a)})})}},dK=function(a){var b=cK(a);return function(a,d,e){return b(a,d,e).filter(function(a){return N.eq(a.left(),a.right())})}},ab={inline:function(a,b,c){return Ja.closest(b,M$,a).fold(function(){return g.some(b)},function(c){return a(c)?g.some(b):g.none()})},formatter:u(bK,pa.isFormatting),container:function(a,
b,c){return Ja.closest(b,pa.isContainer,a).filter(zf(a))},inListItem:function(a,b,c){return L.closest(b,"li",a)},inList:function(a,b,c){return L.closest(b,"ol,ul",a)},inTableCell:function(a,b,c){return L.closest(b,"td,th",a)},setBlock:function(a,b){return oa(a,{block:k(b)})},both:cK,shared:dK,sharedPredicate:function(a){a=u(bK,a);return dK(a)},entireRoot:function(a,b,c){return Ja.closest(b.element(),a).filter(function(c){var d=function(a){return N.eq(a,b.element())};return a(b.element())&&0===b.offset()||
D.isText(b.element())&&0===b.offset()&&kc.first(c).map(d).getOr(!1)}).filter(function(b){var d=function(a){return N.eq(a,c.element())};return a(c.element())&&c.offset()>=A.children(b).length-1||D.isText(c.element())&&c.offset()>=Ya.get(c.element()).length&&kc.last(b).map(d).getOr(!1)}).map(function(a){return aK(a,a)})}},eK=function(a){return function(b){return(1===b.length?g.some(b[0]):g.none()).filter(a).map(function(a){return{single:k(a)}})}},fK=function(a){return function(b){return(Xa(b,a)?g.some(b):
g.none()).map(function(a){return{all:k(a)}})}},ec={oneOf:eK,anyOf:fK,noneOf:function(a){return function(b){return(Xa(b,a)?g.none():g.some(b)).map(function(a){return{all:k(a)}})}},allOf:function(a){return function(b){return ob(b,a)?g.some({all:k(b)}):g.none()}},any:g.some,oneOfTag:function(a){return eK(function(b){return D.name(b)===a})},anyOfTag:function(a){return fK(function(b){return D.name(b)===a})},single:function(a){return g.some({single:k(a)})},all:function(a){return g.some({all:k(a)})}},Uo=
function(a){return 1===a.length?L.closest(a[0],"ol,ul").map(function(a){return{single:k(a)}}):g.none()},gK=function(a){return Uo(a).bind(function(a){a=Y.descendants(a.single(),"li");return 1===a.length?g.some({single:k(a[0])}):g.none()})},hK=function(a){if(2!==a.length)return g.none();var b=a[0],c=a[1];return pa.isFormatting(b)||pa.isContainer(b)||U(["ol","ul","li"],D.name(b))||!U(["ol","ul"],D.name(c))?g.none():g.some({all:k(a),list:k(c),inline:k(b)})},Fi=ab.formatter,iK=ab.inline,N$=ab.container,
jK=function(a){return pa.isFormatting(a)&&!1===rg.shouldMerge(a)},O$=[jb(ab.inListItem,Uo,function(a,b){b=Y.children(b.single(),"li");return 1!==b.length||Db.descendant(b[0],"ol,ul")?Bd.split(a,$J.from(b),RJ):Bd.insertChildren(b[0],a)},"List"),jb(ab.inListItem,$J.lists,function(a,b){return L.ancestor(a.block(),"ol,ul",a.isRoot).bind(function(c){c=ab.setBlock(a,c);return Bd.split(c,b,Xu)})},"Many lists"),jb(iK,ec.anyOf(jK),Bd.nest,"Copying formatting (NO MERGE) into root"),jb(iK,ec.oneOf(pa.isFormatting),
Bd.merge,"Copying formatting into root"),jb(Fi,ec.anyOfTag("hr"),Bd.split,"insert hr into formatter"),jb(Fi,ec.anyOf(jK),Bd.split,"Copying one formatting block (NO MERGE) into formatting"),jb(Fi,ec.oneOf(pa.isFormatting),Bd.merge,"Copying one formatting block into formatting"),jb(Fi,ec.anyOf(pa.isFormatting),Bd.split,"Copying many formatting blocks into formatting"),jb(Fi,ec.anyOfTag("table"),function(a){return function(b,c){var d=c.all();b=a(b,c);g.from(d[d.length-1]).each(function(a){A.nextSibling(a).fold(function(){var b=
r.fromTag("p");y.append(b,r.fromTag("br"));y.after(a,b)},t)});return b}}(Bd.split),"Copying tables into formatting"),jb(Fi,ec.anyOf(pa.isContainer),Bd.split,"Copying container blocks into formatting"),jb(N$,ec.all,Bd.nest,"Fallback pasting into container.")],P$={context:function(a,b,c){return b.context(a.isRoot,c.startContainer(),c.startOffset()).map(function(b){return{block:k(b),element:c.startContainer,offset:c.startOffset,isRoot:a.isRoot}})},rules:k(O$),fallback:Bd.fallback},Q$={force:function(a){var b=
id.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()),c=b?W.point(a.endContainer(),a.endOffset()):W.point(a.startContainer(),a.startOffset());a=b?W.point(a.startContainer(),a.startOffset()):W.point(a.endContainer(),a.endOffset());return{left:k(c),right:k(a)}}},R$=function(a,b){var c=a.original(),d=So.postfix(c.left().element(),c.left().offset(),c.right().element(),c.right().offset()),e=b.all();return d.bind(function(b){qh.makeTo(c.left().element(),c.left().offset(),b.element()).deleteContents();
b.cleanup();P.append(a.left(),e);b=A.children(a.right());P.append(a.left(),b);G.remove(a.right());return g.from(e[e.length-1])})},kK=function(a,b){if(!N.eq(a.left(),a.right()))throw"replaceContents used in the wrong context";a=a.left();G.empty(a);b=b.all();P.append(a,b);return kc.last(a).or(g.from(b[b.length-1]))},Cd={replace:function(a,b){return N.eq(a.left(),a.right())?(b=b.all(),a.replaceSelection(b),g.from(b[b.length-1])):R$(a,b)},replaceContents:kK,replaceContentsWrapP:function(a,b){var c=r.fromTag("p");
P.append(c,b.all());return kK(a,{all:k([c])})},replaceWhole:function(a,b){b=b.all();P.after(a.left(),b);G.remove(a.left());return g.from(b[b.length-1])},merge:function(a,b){b=A.children(b.single());a.replaceSelection(b);return g.from(b[b.length-1])},split:function(a,b,c){var d=void 0===c?Di.purge:c;c=a.original().left();var e=a.original().right();return ev.range(c.element(),c.offset(),e.element(),e.offset(),a.isRoot).bind(function(a){var c=b.all();P.before(a.second(),c);a.mark().cleanup();z([a.first(),
a.second()],d);return g.from(c[c.length-1])})},fallback:function(a,b,c){a.replaceSelection(c);g.from(c[0]).each(Di.purge);g.from(c[c.length-1]).each(Di.purge);return g.from(c[c.length-1])}},lK=function(a,b,c,d){d=void 0!==d?d:ca;var e=b.original(),f=e.left();e=e.right();return ev.ruptureUntil(f.element(),f.offset(),e.element(),e.offset(),b.isRoot,d).bind(function(b){var d=a(b,c);S$(b);return d},void 0!==d?d:ca)},S$=function(a){var b=Y.ancestors(a,"ol,ul");0<b.length&&z([Xu,SJ],function(a){a(b[b.length-
1])})},Vo=function(a,b,c){return lK(a,b,c,ca)},Vk=ab.formatter,T$=u(Vo,function(a,b){y.after(a,b.single());return g.some(b.single())}),mK=u(function(a,b,c){return lK(a,b,c,function(a){return A.parent(a).getOr(a)})},function(a,b){b=b.all();P.after(a,b);return g.from(b[b.length-1])}),U$=u(Vo,function(a,b){b=A.children(b.single());P.after(a,b);return g.some(b[b.length-1])}),V$=u(Vo,function(a,b){var c=r.fromTag("li");P.append(c,[b.inline(),b.list()]);y.after(a,c);return g.some(b.list())}),W$=u(Vo,function(a,
b){var c=r.fromTag("li");P.append(c,[b.inline(),b.list()]);var d=L.ancestor(a,"ol,ul").fold(function(){var a=r.fromTag(D.name(b.list()));y.append(a,c);return a},function(){return c});y.after(a,d);return g.some(b.list())}),X$=[jb(ab.sharedPredicate(rg.isAtomic),ec.all,Cd.replaceWhole,"selection: inside something atomic, so just replace the whole thing"),jb(ab.shared(ab.inListItem),gK,function(a,b){return Cd.merge(a,b)},"selection: same item, paste: singleton"),jb(ab.shared(ab.inListItem),Uo,function(a,
b){return Cd.split(a,{all:k(A.children(b.single()))},Xu)},"selection: same item, paste: single list"),jb(ab.shared(ab.inListItem),hK,W$,"selection: same item, paste: partial"),jb(ab.shared(ab.inListItem),ec.noneOf(pa.isBlock),Cd.replace,"selection: same item, paste: no blocks"),jb(ab.shared(ab.inListItem),ec.anyOf(pa.isHeading),function(a,b){a=Cd.replace(a,b);z(b.all(),function(a){Di.purgeBy(a,li.isVacantText)});return a},"selection: same item, paste: heading"),jb(ab.shared(ab.inListItem),ec.all,
mK,"selection: same item, paste: any"),jb(ab.both(ab.inListItem),gK,T$,"selection: diff items, paste: singleton"),jb(ab.both(ab.inListItem),Uo,U$,"selection: diff items, paste: single list"),jb(ab.both(ab.inListItem),hK,V$,"selection: diff items, paste: partial"),jb(ab.both(ab.inListItem),ec.all,mK,"selection: diff items, paste: any"),jb(ab.both(Vk),ec.anyOfTag("hr"),Cd.split,"selection: inside formatter, paste: split"),jb(ab.both(Vk),ec.noneOf(pa.isBlock),Cd.replace,"range no blocks"),jb(ab.both(Vk),
ec.anyOf(function(a){return pa.isFormatting(a)&&!1===rg.shouldMerge(a)}),Cd.split,"range 1 formatting block"),jb(ab.both(Vk),ec.oneOf(pa.isFormatting),Cd.merge,"range 1 formatting block"),jb(ab.both(Vk),ec.all,Cd.split,"range anything > formatters"),jb(ab.entireRoot,ec.noneOf(pa.isBlock),Cd.replaceContentsWrapP,"complete body, not inserting a block: wrap in P and replace the contents"),jb(ab.entireRoot,ec.all,Cd.replaceContents,"complete body: replace the contents")],Y$={context:function(a,b,c){var d=
Q$.force(c);return b.context(a.isRoot,d.left(),d.right()).map(function(b){return{left:b.left,right:b.right,original:k(d),isRoot:a.isRoot,replaceSelection:a.replaceSelection}})},rules:k(X$),fallback:Cd.fallback},Z$=function(a,b,c,d,e){return hb(a,function(a,h){return a.orThunk(function(){return d(b,h,c).bind(function(a){return h.profile(e).map(function(b){return{action:h.action,target:k(b),ctx:k(a)}})})})},g.none())},nK=function(a,b,c,d,e,f){var h={getSelection:a,replaceSelection:b,isRoot:c},k=function(a,
b){return a.fold(function(){if(0===d.length){var a=b.startContainer(),c=b.startOffset();c=D.isText(a)?Math.min(c,a.dom().length):c;return g.some(W.point(a,c))}return g.none()},function(a){var b=wa.getEnd(a);return g.some(W.point(a,b))})};return h.getSelection().bind(function(a){var b=a.collapsed()?P$:Y$,c=a.collapsed()?e.concat(b.rules()):f.concat(b.rules());c=Z$(c,h,a,b.context,d).fold(function(){return b.fallback(h,a,d)},function(a){return a.action(a.ctx(),a.target())});return k(c,a)})},$$={insertAtCursor:function(a,
b,c,d){return nK(a,b,c,d,[],[])},insertAtCursorWith:nK},aaa=function(a){return D.isElement(a)&&"false"===m.get(a,"contenteditable")},baa=function(a){return a().map(function(a){a=E([a.startContainer(),a.endContainer()],function(a){return Ja.closest(a,aaa)});return ee(a)}).getOr([])},oK=function(a,b,c){z(a,b);b=c();z(a,rg.clear);return b},caa=function(a,b){return oK(a,rg.setAtomic,b)},pK=function(a,b,c,d,e,f){var h=baa(a);return caa(h,function(){return $$.insertAtCursorWith(a,b,c,d,e,f)})},qK=function(a,
b,c,d){b=pK(a.getSelection,a.replaceSelection,a.isRoot,b,c,d);a.domChanged();a.undoChanged();return b},rK=function(a,b){return qK(a,b,[],[])},sd={insertAtCursorWith:qK,insertAtCursor:rK,insertAtCursorWithInstructions:function(a,b,c){return oK(c,a,function(){return rK(b,c)})},insertAt:function(a,b,c){c=pK(function(){return g.some(b)},function(c){a.win().each(function(a){var d=Lc.relative(la.on(b.startContainer(),b.startOffset()),la.on(b.endContainer(),b.endOffset()));Wa.replace(a,d,c)})},a.isRoot,
c,[],[]);a.domChanged();a.undoChanged();return c}},jm={generate:function(a){return a+"-"+Math.floor(99999*Math.random()).toString()}},daa=O("ch","offset"),sK=function(a,b){return daa(a.charAt(b),b)},Wo={previous:function(a,b){for(b=b.getOr(a.length)-1;0<=b;b--)if(a.charAt(b)!==mb())return g.some(sK(a,b));return g.none()},next:function(a,b){for(b=b.getOr(0)+1;b<a.length;b++)if(a.charAt(b)!==mb())return g.some(sK(a,b));return g.none()},rfind:function(a,b){b.lastIndex=-1;a=kd(a).join("");b=a.match(b);
return void 0!==b&&null!==b&&0<=b.index?g.some(a.length-1-b.index):g.none()},lfind:function(a,b){b.lastIndex=-1;a=a.match(b);return void 0!==a&&null!==a&&0<=a.index?g.some(a.index):g.none()}},eaa=Ca.walkers().left(),faa=Ca.walkers().right(),gaa=ta.generate([{abort:[]},{kontinue:[]},{finish:["info"]}]),fv=ta.generate([{aborted:[]},{edge:["element"]},{success:["info"]}]),tK=function(a,b){return Nc.isEmptyTag(a,b)||a.property().isBoundary(b)},gv=function(a,b,c,d,e,f,h){var k=function(){return h.fold(fv.aborted,
fv.edge)},q=function(d){return Ca.walk(a,b,c,f).fold(k,function(b){return gv(a,b.item(),b.mode(),g.none(),e,f,d)})};if(tK(a,b))return k();if(a.property().isText(b)){var m=a.property().getText(b);return e(a,gaa,b,m,d).fold(k,function(){return q(g.some(b))},fv.success)}return q(h)},haa=function(a,b,c,d){c=bd.toLeaf(a,b,c);return a.property().isText(b)?g.none():Tn.left(a,c.element(),a.property().isText,d).map(function(b){return W.point(b,a.property().getText(b).length)})},iaa=function(a,b,c,d){c=bd.toLeaf(a,
b,c);return a.property().isText(b)?g.none():Tn.right(a,c.element(),a.property().isText,d).map(function(a){return W.point(a,0)})},uK=function(a,b,c){var d=u(tK,a);return haa(a,b,c,d).orThunk(function(){return iaa(a,b,c,d)}).getOr(W.point(b,c))},vK={repeatLeft:function(a,b,c,d){b=uK(a,b,c);return gv(a,b.element(),Ca.sidestep,g.some(b.offset()),d,eaa,g.none())},repeatRight:function(a,b,c,d){b=uK(a,b,c);return gv(a,b.element(),Ca.sidestep,g.some(b.offset()),d,faa,g.none())}},wK=xd(["regex","attempt"]),
xK=function(a,b,c,d){return vK.repeatLeft(a,b,c,d)},yK=function(a,b,c,d){return vK.repeatRight(a,b,c,d)},zK=function(a,b,c){var d=k(!1);if(!a.property().isText(b))return g.none();var e=a.property().getText(b);return c<=e.length?g.some(W.point(b,c)):Ca.seekRight(a,b,a.property().isText,d).bind(function(b){return zK(a,b,c-e.length)})},th={previousChar:function(a,b){return Wo.previous(a,b)},nextChar:function(a,b){return Wo.next(a,b)},repeatLeft:xK,repeatRight:yK,expandLeft:function(a,b,c,d){var e=wK(d);
return xK(a,b,c,function(a,b,c,d,g){a=g.getOr(d.length);return Wo.rfind(d.substring(0,a),e.regex()).fold(function(){return b.kontinue()},function(a){return e.attempt(b,c,d,a)})})},expandRight:function(a,b,c,d){var e=wK(d);return yK(a,b,c,function(a,b,c,d,g){var f=g.getOr(0);return Wo.lfind(d.substring(f),e.regex()).fold(function(){return b.kontinue()},function(a){return e.attempt(b,c,d,f+a)})})},scanRight:zK},Wk=nb(),uh={previousChar:function(a,b){return th.previousChar(a,b)},nextChar:function(a,
b){return th.nextChar(a,b)},repeatLeft:function(a,b,c){return th.repeatLeft(Wk,a,b,c)},repeatRight:function(a,b,c){return th.repeatRight(Wk,a,b,c)},expandLeft:function(a,b,c){return th.expandLeft(Wk,a,b,c)},expandRight:function(a,b,c){return th.expandRight(Wk,a,b,c)},scanRight:function(a,b){return th.scanRight(Wk,a,b)}},Gi=O("before","after"),jv=function(a,b,c,d,e){return Xo(c).fold(function(){var c=AK(a,b,d);return Gi(c,e)},function(f){var h=Hi(c,f);return h.length>a?Gi(d,e):hv(b).fold(function(){var b=
iv(a-h.length,f,e+h);return Gi(d,b)},function(c){var g=Hi(c,b);return g.length>a-h.length?Gi(d,e+h):jv(a-h.length-g.length,c,f,g+d,e+h)})})},BK=function(a,b,c,d){return a.finish(W.point(b,d))},CK={regex:function(){return new RegExp(Cb.wordchar(),"i")},attempt:BK},DK={regex:function(){return new RegExp(Cb.wordbreak(),"i")},attempt:BK},EK=function(a,b){return a.offset()===b.offset()&&N.eq(a.element(),b.element())},FK=function(a){return W.point(a,D.value(a).length)},GK=function(a){return W.point(a,0)},
kv=function(a,b,c){var d=function(b){b=c(b);return EK(a,b)?g.none():g.some(b)};return b(a.element(),a.offset(),CK).fold(g.none,d,function(a){return b(a.element(),a.offset(),DK).fold(g.none,d,function(a){return g.some(a)})})},Xo=function(a){return kv(a,uh.expandRight,FK)},hv=function(a){return kv(a,uh.expandLeft,GK)},Yo=function(a,b,c,d,e,f){return a(c).fold(k(d),function(h){var g=e(c,h);return g.length+d.length>b||0===g.length?d:Yo(a,b,h,f(d,g),e,f)})},iv=function(a,b,c){return Yo(Xo,a,b,c,Hi,function(a,
b){return a+b})},AK=function(a,b,c){return Yo(hv,a,b,c,function(a,b){return Hi(b,a)},function(a,b){return b+a})},Hi=function(a,b){var c=A.defaultView(a.element()).dom();a=Lc.exact(a.element(),a.offset(),b.element(),b.offset());return Wa.getAsString(c,a)},HK={beforeAfter:Gi,anchorText:function(a,b){var c=kb.freefallLtr(b);return Xo(c).map(function(b){var d=Hi(c,b);return d+iv(a-d.length,b,"")}).getOr("")},flankingText:function(a,b){if(0===a)return Gi("","");var c=kb.freefallLtr(b);b=kb.freefallRtl(b);
return jv(a,c,b,"","")},extendRightAndLeft:jv,extendWordsSearch:Yo,extendWordsRight:iv,extendWordsLeft:AK,wordSearch:kv,wordLeft:hv,wordRight:Xo,pointEq:EK,boundaryPointRight:FK,boundaryPointLeft:GK,textBetweenPoints:Hi,wordSeeker:CK,wordBreakSeeker:DK},IK=function(a,b){try{return a()}catch(c){if(12===c.code)return b();throw c;}},lv=function(a){return L.closest(a,"a[href]")},mv=function(a,b){return lv(a).bind(function(a){return lv(b).filter(function(b){return N.eq(a,b)})})},jaa=O("element","innerText",
"before","after"),nv=function(a,b,c,d){b=xf.isEmpty(b)&&xf.isEmpty(c)&&xf.isEmpty(d)?"#"+m.get(a,"id"):b;return jaa(a,b,c,d)},ov=function(a){return Fa.is(a,"a[href]")?[a]:Fa.all("a[href]",a)},Ld={contentLink:function(a){var b=a.getSelection();return vc.detect(b).fold(function(){return b.bind(function(a){return mv(a.startContainer(),a.endContainer())})},function(a){return g.some(a.image()).bind(lv)})},sharedLink:mv,sharedLinkOrClosest:function(a,b){var c=kb.toLeaf(a.startContainer(),a.startOffset());
a=kb.toLeaf(a.endContainer(),a.endOffset());return mv(c.element(),a.element()).orThunk(function(){return L.closest(c.element(),"a[href]",b)})},findLinkTargets:function(a){return Fa.all("h1,h2,h3,h4,h5,h6,div[id],p[id],span[id],a[id],a[name]",a)},linkTargetText:function(a,b){var c=Vb.get(b).length,d=Pc.deep(b);c=HK.anchorText(c,d);if(pa.isBlock(b))return nv(b,c,"","");a=HK.flankingText(Math.max(0,a-c.length),b);return nv(b,c,a.before(),a.after())},linkTargetFastText:function(a,b){var c=Vb.get(b);a=
c.length>a?c.substr(0,a):c;return nv(b,a,"","")},all:ov,many:function(a){return ia(a,ov)},hrefUrl:function(a,b){return IK(function(){return Fa.all('a[href="'+b+'"]',a)},function(){var c=ov(a);return ka(c,function(a){return m.get(a,"href")===b})})},anchorTarget:function(a,b){return IK(function(){return Fa.one("#"+b+',a[name="'+b+'"]',a)},function(){var c=A.owner(a).dom();return g.from(c.getElementById(b)).map(r.fromDom).orThunk(function(){var c=Fa.all("[name]",a);return qa(c,function(a){return m.get(a,
"id")===b||m.get(a,"name")===b})})})},getAnchorValue:function(a,b){a=a.replace(/[^0-9a-zA-Z$_.+*(),-]/g,"");return 0<a.length?a:b}},Zo=["li"],JK=function(a,b){return Bc.cata(a,function(a){return!0===b?[]:Ud.wrap(a)},function(a){return[a]},function(a,b){return"table"===D.name(a)?[a]:Ud.handleContainer(Zo,a,b,JK)},function(a){return!0===b?[]:Ud.wrap([a])})},kaa={isRootContainer:qo.isRootOrContainer,extract:function(a){return JK(a,!1)},isCapable:function(a){return Dj.isBlock(a)||U(Zo,D.name(a))},canUse:function(a){return pa.isFormatting(a)||
U(Zo,D.name(a))},quasi:u(Ud.handleRoot,Zo),ascend:ca},laa=function(a,b){return L.closest(b,'[dir="rtl"],[dir="ltr"]').filter(a).isSome()},KK=function(a,b,c){var d=eV(b,c),e=function(a){d.set(a);v.reflow(a)},f=function(a){return ae.getDirection(a)===c};return{run:function(a,b,c,d,f){return pi.applyOn(a,kaa,b,c,d,f,function(a){z(a,e);return a})},query:function(a,b){return lH.bothMatch(a,b,u(laa,f))},name:k(a)}},maa=KK("DirRtl","dir","rtl"),naa=KK("DirLtr","dir","ltr"),$o={dirLtr:k(naa),dirRtl:k(maa)},
LK=function(a){return function(b){var c=function(c,e,f,h){return a.run(b.content().isRoot,c,e,f,h)};Zb.cata(b.selections().get(),t,ko.multiple(b.content(),b.undo(),c),ko.single(b.content(),b.undo(),c,Ek,Dk));setTimeout(function(){b.content().uiChanged()},0)}},az={dirRtl:LK($o.dirRtl()),dirLtr:LK($o.dirLtr())},oaa=O("ltrdir","rtldir"),MK=function(a,b){return b.query(a.startContainer(),a.endContainer())?Da.on(!0):Da.off()},paa=function(a){return L.closest(a.startContainer(),"[dir]").isSome()||L.closest(a.endContainer(),
"[dir]").isSome()},$y={readDir:function(a){return a.getSelection().filter(paa).map(function(a){return oaa(MK(a,$o.dirLtr()),MK(a,$o.dirRtl()))})}},qaa=ta.generate([{blob:["id","imageresult","objurl"]},{url:["id","url","raw"]}]),Qc=ua(qaa,{cata:function(a,b,c){return a.fold(b,c)}}),Uc={create:bz,clone:function(a){var b=bz(a.width,a.height);dz(b).drawImage(a,0,0);return b},resize:cz,get2dContext:dz,get3dContext:function(a){var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){}b||
(b=null);return b}},Nh={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},raa=function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(a){var b=this;null===this._state?this._deferreds.push(a):k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)(b._state?a.resolve:a.reject)(b._value);else{try{var d=c(b._value)}catch(X){a.reject(X);return}a.resolve(d)}})}function c(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");
if(b&&("object"===typeof b||"function"===typeof b)){var f=b.then;if("function"===typeof f){h(a(f,b),a(c,this),a(d,this));return}}this._state=!0;this._value=b;e.call(this)}catch(F){d.call(this,F)}}function d(a){this._state=!1;this._value=a;e.call(this)}function e(){for(var a=0,c=this._deferreds.length;a<c;a++)b.call(this,this._deferreds[a]);this._deferreds=null}function f(a,b,c,d){this.onFulfilled="function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=c;this.reject=
d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(X){d||(d=!0,c(X))}}var g=function(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];h(b,a(c,this),a(d,this))},k=g.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===
Object.prototype.toString.call(a)};g.prototype["catch"]=function(a){return this.then(null,a)};g.prototype.then=function(a,c){var d=this;return new g(function(e,h){b.call(d,new f(a,c,e,h))})};g.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new g(function(b,c){function d(f,h){try{if(h&&("object"===typeof h||"function"===typeof h)){var g=h.then;if("function"===typeof g){g.call(h,function(a){d(f,a)},c);return}}a[f]=h;0===--e&&b(a)}catch(zT){c(zT)}}
if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})};g.resolve=function(a){return a&&"object"===typeof a&&a.constructor===g?a:new g(function(b){b(a)})};g.reject=function(a){return new g(function(b,c){c(a)})};g.race=function(a){return new g(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})};return g},Md=window.Promise?window.Promise:raa(),km={atob:function(a){return Kc.getOrDie("atob")(a)},requestAnimationFrame:function(a){Kc.getOrDie("requestAnimationFrame")(a)}},
jd={blobToImage:gz,imageToBlob:function(a){a=a.src;return 0===a.indexOf("data:")?$q(a):hz(a)},blobToArrayBuffer:function(a){return new Md(function(b){var c=new Zq;c.onloadend=function(){b(c.result)};c.readAsArrayBuffer(a)})},blobToDataUri:jz,blobToBase64:function(a){return jz(a).then(function(a){return a.split(",")[1]})},dataUriToBlobSync:iz,canvasToBlob:function(a,b,c){b=b||"image/png";return HTMLCanvasElement.prototype.toBlob?new Md(function(d){a.toBlob(function(a){d(a)},b,c)}):$q(a.toDataURL(b,
c))},canvasToDataURL:function(a,b,c){b=b||"image/png";return a.then(function(a){return a.toDataURL(b,c)})},blobToCanvas:function(a){return gz(a).then(function(a){URL.revokeObjectURL(a.src);var b=Uc.create(Nh.getWidth(a),Nh.getHeight(a));Uc.get2dContext(b).drawImage(a,0,0);return b})},uriToBlob:function(a){return 0===a.indexOf("blob:")?hz(a):0===a.indexOf("data:")?$q(a):null}},Nj={blobToImage:function(a){return jd.blobToImage(a)},imageToBlob:function(a){return jd.imageToBlob(a)},blobToDataUri:function(a){return jd.blobToDataUri(a)},
blobToBase64:function(a){return jd.blobToBase64(a)},dataUriToBlobSync:function(a){return jd.dataUriToBlobSync(a)},uriToBlob:function(a){return g.from(jd.uriToBlob(a))}},xe={fromBlob:kz,fromCanvas:function(a,b){return jd.canvasToBlob(a,b).then(function(b){return ar(Md.resolve(a),b,a.toDataURL())})},fromImage:function(a){return jd.imageToBlob(a).then(function(a){return kz(a)})},fromBlobAndUrlSync:function(a,b){return ar(jd.blobToCanvas(a),a,b)}},NK=function(a){return a.toBlob()},Yc={blobToImageResult:function(a){return xe.fromBlob(a)},
fromBlobAndUrlSync:function(a,b){return xe.fromBlobAndUrlSync(a,b)},imageToImageResult:function(a){return xe.fromImage(a)},imageResultToBlob:function(a,b,c){return void 0===b&&void 0===c?NK(a):a.toAdjustedBlob(b,c)},imageResultToOriginalBlob:NK,imageResultToDataURL:function(a){return a.toDataURL()}},dg={createObjectURL:function(a){return Kc.getOrDie("URL").createObjectURL(a)},revokeObjectURL:function(a){Kc.getOrDie("URL").revokeObjectURL(a)}},Xk=aa.detect(),PK=function(a){var b=dg.createObjectURL(a);
return OK(a,b)},OK=function(a,b){return Ga.nu(function(c){Nj.blobToDataUri(a).then(function(d){d=Yc.fromBlobAndUrlSync(a,d);var e=Ha("image");d=Qc.blob(e,d,b);c(d)})})},saa=function(a){return 1===a.length&&U(a,"Files")},taa=function(a){return!U(a,"text/_moz_htmlcontext")},uaa=function(a){return U(a,"Files")},vaa=function(a){return!0},ve={multiple:function(a){return 0===a.length?Ga.pure([]):Ce(a,PK)},toFiles:function(a){return a.raw().target.files||a.raw().dataTransfer.files},isFiles:Xk.browser.isChrome()||
Xk.browser.isSafari()||Xk.browser.isOpera()?uaa:Xk.browser.isFirefox()?taa:Xk.browser.isIE()?saa:vaa,fromImages:function(a){a=E(a,function(a){var b=Ha("image");return Qc.url(b,m.get(a,"src"),a)});return Ga.pure(a)},single:PK,singleWithUrl:OK},Ii=na(!1),gA={register:function(a,b,c){var d=H.create({dragstart:p(["original"]),dragend:p(["original"]),dragover:p(["original"]),dragleave:p(["original"]),drop:p(["original"]),dragndropimages:p(["original","files"]),dragndrophtml:p(["original"]),dragndropinternal:p([])});
b.each(function(b){var c=function(c){return function(){c(a,b)}};d.registry.dragover.bind(c(n.add));d.registry.dragleave.bind(c(n.remove));d.registry.drop.bind(c(n.remove))});var e=K.bind(a,"dragstart",function(a){Ii.set(!0);d.trigger.dragstart(a)}),f=K.bind(a,"dragend",function(a){Ii.set(!1);d.trigger.dragend(a)}),h=K.bind(a,"dragover",function(a){Ii.get()||(!0===c?(a.prevent(),d.trigger.dragover(a)):a.kill())}),g=K.bind(a,"dragleave",function(a){Ii.get()||d.trigger.dragleave(a)}),k=K.bind(a,"drop",
function(a){if(Ii.get())Ii.set(!1),setTimeout(function(){return d.trigger.dragndropinternal()},100);else if(d.trigger.drop(a),a.kill(),ve.isFiles(a.raw().dataTransfer.types)){var b=ve.toFiles(a);d.trigger.dragndropimages(a,b)}else U(a.raw().dataTransfer.types,"text/html")&&d.trigger.dragndrophtml(a)});return{destroy:function(){e.unbind();f.unbind();h.unbind();g.unbind();k.unbind()},events:d.registry}}},hV={forImages:function(a,b,c){a=gA.register(a,b,c);var d=H.create({dragstart:p(["original"]),dragend:p(["original"]),
dragover:p(["original"]),dragleave:p(["original"]),drop:p(["original"]),dragndropimages:p(["assets","x","y"]),dragndrophtml:p(["html","x","y"]),dragndropinternal:p([])});b=function(a,b){a.bind(function(a){b(a.original())})};a.events.dragndropimages.bind(function(a){var b=a.original();ve.multiple(a.files()).get(function(a){d.trigger.dragndropimages(a,b.x(),b.y())})});a.events.dragndrophtml.bind(function(a){a=a.original();var b=a.raw().dataTransfer.getData("text/html");d.trigger.dragndrophtml(b,a.x(),
a.y())});a.events.dragndropinternal.bind(function(){d.trigger.dragndropinternal()});b(a.events.dragstart,d.trigger.dragstart);b(a.events.dragend,d.trigger.dragend);b(a.events.dragover,d.trigger.dragover);b(a.events.dragleave,d.trigger.dragleave);b(a.events.drop,d.trigger.drop);return{destroy:a.destroy,events:d.registry}}},waa={recompose:function(a){var b="";""!==a.protocol&&(b+=a.protocol,b+=":");""!==a.authority&&(b=b+"//"+a.authority);b+=a.path;""!==a.query&&(b=b+"?"+a.query);""!==a.anchor&&(b=
b+"#"+a.anchor);return b}},xaa={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},
yaa=function(a,b){a=b.parser[b.strictMode?"strict":"loose"].exec(a);for(var c={},d=14;d--;)c[b.key[d]]=a[d]||"";c[b.q.name]={};c[b.key[12]].replace(b.q.parser,function(a,d,h){d&&(c[b.q.name][d]=h)});return c},Sh={parse:function(a,b){b=ua(xaa,b);return yaa(a,b)}},ap={remove:function(a){for(var b="";""!==a;)if(Gb(a,"../"))a=hk(a,"../");else if(Gb(a,"./"))a=hk(a,"./");else if(Gb(a,"/./"))a="/"+hk(a,"/./");else if("/."===a)a="/";else if(Gb(a,"/../"))a="/"+hk(a,"/../"),b=ik(b,b.substring(b.lastIndexOf("/")));
else if("/.."===a)a="/",b=ik(b,b.substring(b.lastIndexOf("/")));else if("."===a||".."===a)a="";else{var c=a.match(/(^\/?.*?)(\/|$)/)[1];a=hk(a,c);b+=c}return b}},zaa={merge:function(a,b,c){if(""!==c&&""===a)return"/"+b;c=a.substring(a.lastIndexOf("/")+1);return ik(a,c)+b}},Aaa={transform:function(a,b){var c={strictMode:!0},d=Sh.parse(a,c);b=Sh.parse(b,c);c={};""!==b.protocol?(c.protocol=b.protocol,c.authority=b.authority,c.path=ap.remove(b.path),c.query=b.query):(""!==b.authority?(c.authority=b.authority,
c.path=ap.remove(b.path),c.query=b.query):(""===b.path?(c.path=d.path,c.query=""!==b.query?b.query:d.query):(Gb(b.path,"/")?c.path=ap.remove(b.path):(c.path=zaa.merge(d.path,b.path,a.authority),c.path=ap.remove(c.path)),c.query=b.query),c.authority=d.authority),c.protocol=d.protocol);c.anchor=b.anchor;return c}},Cr={resolve:function(a,b){a=Aaa.transform(a,b);return waa.recompose(a)}},QK=aa.detect(),RK=QK.browser,Baa=!(RK.isEdge()&&16>RK.version.major||QK.deviceType.isiOS()),SK=function(a,b){var c=
function(b,c,f){var d=m.get(b,c);Bb(d,"://")||(m.set(b,f,d),m.set(b,c,Cr.resolve(a.baseURI(),d)))};z(b,function(a){"a"===D.name(a)&&m.has(a,"href")?c(a,"href","data-ephox-href"):"img"===D.name(a)&&m.has(a,"src")&&c(a,"src","data-ephox-src")})},TK=function(a,b,c){v.setAll(b,{position:"absolute",top:"-1000px"});y.append(a.body(),b);var d=a.getSelection();Wa.setToElement(a.win(),b);setTimeout(function(){G.remove(b);d.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),
b.endOffset())});setTimeout(c,0)},0)},Caa=function(a,b){return function(b,d,e,f){var c=b.raw();if(!xa(c.type)||"copy"!==c.type.toLowerCase()&&"cut"!==c.type.toLowerCase())throw"Can only set the clipboard with a cut or copy event";c=c.clipboardData;var g=r.fromTag("div",a.doc().dom());Ea.set(g,e());var k=Fa.all("a,img",g);SK(a,k);g=Ea.get(g);if(Baa&&void 0!==c&&vb(c.setData))try{c.setData("text/plain",d());c.setData("text/html",g);var m=!0}catch(w){m=!1}else m=!1;m?(b.kill(),setTimeout(f,0)):TK(a,
e,f)}},Daa=xd("doc win body baseURI getSelection setSelection".split(" ")),lz={register:function(a){Daa(a);return{setClipboard:Caa(a,TK)}},textMime:k("text/plain"),htmlMime:k("text/html"),processLinksAndImages:SK},Eaa=Pb(Ga.pure,J.value),Faa=Pb(Ga.pure,J.error),hf={pure:Eaa,failed:Faa,foldSync:function(a,b,c){return a.map(function(a){return a.fold(b,c)})},bindSync:function(a,b){return a.map(function(a){return a.bind(b)})},bindAsync:function(a,b){return a.bind(function(a){return a.bind(b)})},mapSync:function(a,
b){return a.map(function(a){return a.map(b)})},handle:function(a,b,c){return a.get(function(a){return a.fold(b,c)})}},yj={now:function(){return(new Date).getTime()}},Ne=ta.generate([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),sg=Ne.strict,Yk=Ne.asOption,Gaa=Ne.defaultedThunk,Haa=Ne.mergeWithThunk;ta.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},
{bothValues:["value1","value2"]}]);var UK=function(a){var b=[],c=[];z(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,values:c}},VK=function(a){return Pb(J.error,Qb)(a)},pv={consolidateObj:function(a,b){a=UK(a);return 0<a.errors.length?VK(a.errors):J.value(oa.apply(void 0,[b].concat(a.values)))},consolidateArr:function(a){a=UK(a);return 0<a.errors.length?VK(a.errors):J.value(a.values)}},SY=function(a,b){var c={};z(a,function(a){c[a[b]]=a});return c},Iaa=function(a,
b){var c={};Ma(a,function(a,e){U(b,e)||(c[e]=a)});return c},Kj=function(a){return function(b){return b.hasOwnProperty(a)?g.from(b[a]):g.none()}},WK=function(a,b){return function(c){return Kj(a)(c).getOr(b)}},zc=function(a,b){return Kj(b)(a)},ye=function(a,b){return a.hasOwnProperty(b)&&void 0!==a[b]&&null!==a[b]},fc=function(a,b){var c={};c[a]=b;return c},pb=function(a){var b={};z(a,function(a){b[a.key]=a.value});return b},XK=function(a,b){return zc(a,b)},qv=function(a,b){return fc(a,b)},rv=function(a,
b){return pv.consolidateObj(a,b)},Zk=ta.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),YK=ta.generate([{field:["name","presence","type"]},{state:["name"]}]),Nb={parse:function(a){return Kc.getOrDie("JSON").parse(a)},stringify:function(a,b,c){return Kc.getOrDie("JSON").stringify(a,b,c)}},sv=function(a){return ic(a)&&100<cb(a).length?" removed due to size":
Nb.stringify(a,null,2)},Jaa=function(a){a=10<a.length?a.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):a;return E(a,function(a){return"Failed path: ("+a.path.join(" > ")+")\n"+a.getErrorInfo()})},$k=function(a,b){return J.error([{path:a,getErrorInfo:b}])},Kaa=function(a,b,c){return $k(a,function(){return'Could not find valid *strict* value for "'+b+'" in '+sv(c)})},Laa=function(a,b){return $k(a,function(){return'Choice schema did not contain choice key: "'+
b+'"'})},Maa=function(a,b,c){return $k(a,function(){return'The chosen schema: "'+c+'" did not exist in branches: '+sv(b)})},Naa=function(a,b){return $k(a,function(){return"There are unsupported fields: ["+b.join(", ")+"] specified"})},Oaa=function(a,b){return $k(a,function(){return b})},tv=ta.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Paa=function(a,b,c){return zc(b,c).fold(function(){return Kaa(a,c,b)},J.value)},ZK=function(a,b,c){b=zc(a,b).fold(function(){return c(a)},
ca);return J.value(b)},Qaa=function(a,b,c){b=zc(a,b).map(function(b){return!0===b?c(a):b});return J.value(b)},Raa=function(a,b,c,d){return c.fold(function(c,f,h,l){var e=function(b){return l.extract(a.concat([c]),d,b).map(function(a){return fc(f,d(a))})},m=function(b){return b.fold(function(){var a=fc(f,d(g.none()));return J.value(a)},function(b){return l.extract(a.concat([c]),d,b).map(function(a){return fc(f,d(g.some(a)))})})};return function(){return h.fold(function(){return Paa(a,b,c).bind(e)},
function(a){return ZK(b,c,a).bind(e)},function(){return J.value(zc(b,c)).bind(m)},function(a){return Qaa(b,c,a).bind(m)},function(a){var d=a(b);return ZK(b,c,k({})).map(function(a){return oa(d,a)}).bind(e)})}()},function(a,c){c=c(b);return J.value(fc(a,d(c)))})},Saa=function(a,b,c,d){c=E(c,function(c){return Raa(a,b,c,d)});return pv.consolidateObj(c,{})},Ji=function(a){return{extract:function(b,c,d){return a(d,c).fold(function(a){return Oaa(b,a)},J.value)},toString:function(){return"val"},toDsl:function(){return Zk.itemOf(a)}}},
Taa=function(a){var b=cb(a);return ka(b,function(b){return ye(a,b)})},od=function(a){var b=Cc(a),c=Eb(a,function(a,b){return b.fold(function(b){return oa(a,fc(b,!0))},k(a))},{});return{extract:function(a,e,f){var d=$m(f)?[]:Taa(f);d=ka(d,function(a){return!ye(c,a)});return 0===d.length?b.extract(a,e,f):Naa(a,d)},toString:b.toString,toDsl:b.toDsl}},Cc=function(a){return{extract:function(b,c,d){return Saa(b,d,a,c)},toString:function(){return"obj{\n"+E(a,function(a){return a.fold(function(a,b,e,f){return a+
" -> "+f.toString()},function(a,b){return"state("+a+")"})}).join("\n")+"}"},toDsl:function(){return Zk.objOf(E(a,function(a){return a.fold(function(a,b,e,f){return YK.field(a,e,f)},function(a,b){return YK.state(a)})}))}}},$K=function(a){return{extract:function(b,c,d){d=E(d,function(d,f){return a.extract(b.concat(["["+f+"]"]),c,d)});return pv.consolidateArr(d)},toString:function(){return"array("+a.toString()+")"},toDsl:function(){return Zk.arrOf(a)}}},uv=k(Ji(J.value)),Uaa=Pb($K,Cc),al=tv.state,Dc=
tv.field,Vaa=function(a,b,c,d,e){return zc(d,e).fold(function(){return Maa(a,d,e)},function(d){return Cc(d).extract(a.concat(["branch: "+e]),b,c)})},aL=function(a,b){return{extract:function(c,d,e){return zc(e,a).fold(function(){return Laa(c,a)},function(a){return Vaa(c,d,e,b,a)})},toString:function(){return"chooseOn("+a+"). Possible values: "+cb(b)},toDsl:function(){return Zk.choiceOf(a,b)}}},Waa=Ji(J.value),bL=function(a){return Ji(function(b){return a(b)})},cL=function(a,b,c,d){return b.extract([a],
c,d).fold(function(a){return J.error({input:d,errors:a})},J.value)},tg=function(a,b,c){return cL(a,b,k,c)},Ki=function(a){return a.fold(function(a){throw Error(bp(a));},ca)},Oe=function(a,b,c){return Ki(cL(a,b,ca,c))},bp=function(a){return"Errors: \n"+Jaa(a.errors)+"\n\nInput object: "+sv(a.input)},dL=function(a,b){return aL(a,b)},cp=k(Waa),eL=function(a,b){return Ji(function(c){var d=typeof c;return a(c)?J.value(c):J.error("Expected type: "+b+" but got: "+d)})},Xaa=eL(xa,"string"),fL=eL(vb,"function"),
dp=ta.generate([{get:[]},{post:[]},{put:[]},{del:[]}]),ep={get:dp.get,post:dp.post,put:dp.put,del:dp.del},Yaa={generate:function(a,b,c,d){a=a.bind(function(a){return a.match({file:function(){return g.none()},form:function(){return g.some("application/x-www-form-urlencoded; charset=UTF-8")},json:function(){return g.some("application/json")},plain:function(){return g.some("text/plain")},html:function(){return g.some("text/html")}})});c=c.match({none:g.none,xhr:k(g.some(!0))});var e=b.match({json:g.none,
blob:k(g.some("blob")),xml:k(g.some("document")),html:k(g.some("document")),text:k(g.some("text"))});b=b.match({json:k("application/json, text/javascript"),blob:k("application/octet-stream"),text:k("text/plain"),html:k("text/html"),xml:k("application/xml, text/xml")})+", */*; q=0.01";return{contentType:k(a),credentials:k(c),responseType:k(e),accept:k(b),headers:k(d)}}},Zaa={mutate:function(a,b){b.contentType().each(function(b){a.setRequestHeader("Content-Type",b)});var c=b.accept();a.setRequestHeader("Accept",
c);b.credentials().each(function(b){a.withCredentials=b});b.responseType().each(function(b){a.responseType=b});b=b.headers();Ma(b,function(b,c){xa(c)||xa(b)?a.setRequestHeader(c,b):console.error("Request header data was not a string: ",c," -> ",b)})}},gL={parse:function(a){try{var b=Nb.parse(a);return J.value(b)}catch(c){return J.error("Response was not JSON")}}},hL=Aa(["message","status","responseText"],[]),iL={handle:function(a,b,c){var d=function(){return Ga.pure(c.response)};return b.match({json:function(){return gL.parse(c.response).fold(d,
Ga.pure)},blob:function(){return g.from(c.response).map(iV).getOr(Ga.pure("no response content"))},text:d,html:d,xml:d}).map(function(b){return hL({message:0===c.status?"Unknown HTTP error (possible cross-domain request)":'Could not load url "'+a+'": '+c.statusText,status:c.status,responseText:b})})},nu:hL},$aa=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},Pe=function(a){return $aa({},
a,{bindFuture:function(b){return Pe(a.bind(function(c){return c.fold(function(){return a},function(a){return b(a)})}))},bindResult:function(b){return Pe(a.map(function(a){return a.bind(b)}))},mapResult:function(b){return Pe(a.map(function(a){return a.map(b)}))},foldResult:function(b,c){return a.map(function(a){return a.fold(b,c)})},withTimeout:function(b,c){return Pe(Ga.nu(function(d){var e=!1,f=window.setTimeout(function(){e=!0;d(J.error(c()))},b);a.get(function(a){e||(window.clearTimeout(f),d(a))})}))}})},
jL=function(a){return Pe(Ga.nu(a))},kL=function(a){return Pe(Ga.pure(J.value(a)))},bl={nu:jL,wrap:Pe,pure:kL,value:kL,error:function(a){return Pe(Ga.pure(J.error(a)))},fromResult:function(a){return Pe(Ga.pure(a))},fromFuture:function(a){return Pe(a.map(J.value))},fromPromise:function(a){return jL(function(b){a.then(function(a){b(J.value(a))},function(a){b(J.error(a))})})}},aba={validate:function(a,b){var c=function(){return bl.pure(b.response)};return a.match({json:function(){return gL.parse(b.response).fold(function(a){return bl.error(iL.nu({message:a,
status:b.status,responseText:b.responseText}))},bl.pure)},blob:c,text:c,html:c,xml:function(a,b){return function(){return b().bindResult(function(b){return null===b?J.error(a):J.value(b)})}}("Invalid XML document",c)})}},fp=function(a,b,c,d,e,f){var h=void 0!==f?f:{};return bl.nu(function(f){var g=b.match({get:k("get"),put:k("put"),post:k("post"),del:k("delete")}),l=new (Kc.getOrDie("XMLHttpRequest"));l.open(g,a,!0);g=Yaa.generate(c,d,e,h);Zaa.mutate(l,g);var m=function(){iL.handle(a,d,l).get(function(a){f(J.error(a))})};
l.onload=function(){0!==l.status||Gb(a,"file:")?100>l.status||400<=l.status?m():aba.validate(d,l).get(f):m()};l.onerror=m;c.fold(function(){l.send()},function(a){a=a.match({file:ca,form:ca,json:Nb.stringify,plain:ca,html:ca});l.send(a)})}).toLazy()},Ae={get:function(a,b,c,d){var e=ep.get();return fp(a,e,g.none(),b,c,d)},post:function(a,b,c,d,e){var f=ep.post();return fp(a,f,g.some(b),c,d,e)},put:function(a,b,c,d,e){var f=ep.put();return fp(a,f,g.some(b),c,d,e)},del:function(a,b,c,d){var e=ep.del();
return fp(a,e,g.none(),b,c,d)}},cl=ta.generate([{file:["data"]},{form:["data"]},{json:["data"]},{plain:["data"]},{html:["data"]}]),zB={file:cl.file,form:cl.form,json:cl.json,plain:cl.plain,html:cl.html},lL=ta.generate([{none:[]},{xhr:[]}]),he={none:lL.none,xhr:lL.xhr},dl=ta.generate([{json:[]},{blob:[]},{text:[]},{html:[]},{xml:[]}]),Be={json:dl.json,blob:dl.blob,text:dl.text,html:dl.html,xml:dl.xml,cata:function(a,b,c,d,e,f){return a.match({json:b,blob:c,text:d,html:e,xml:f})}},mL=function(a,b){var c=
-1===a.indexOf("?")?"?":"&";return b?a+c+"apiKey="+encodeURIComponent(b):a},nL=function(a){return a.hasOwnProperty("tiny-api-key")?a["tiny-api-key"]:a.hasOwnProperty("tinymce-api-key")?a["tinymce-api-key"]:a["textbox-api-key"]},oL=function(a){return a.fold(function(a){var b=a.responseText();a=ic(b)?b:a.message();return J.error(a)},J.value)},mm={get:function(a,b,c,d){var e=nL(d);return{execute:function(f){f=Oe(a+".ajax.service.get",b,f);f=eb(f,function(a){return $m(a)?String(a):a});f=mL(xB(c,f),e);
return Ae.get(f,Be.json(),he.xhr(),d).map(oL)}}},post:function(a,b,c,d){var e=nL(d);return{execute:function(f){f=Oe(a+".ajax.service.post",b,f);return Ae.post(mL(c,e),zB.json(f),Be.json(),he.xhr(),d).map(oL)}}}},bba={partition:function(a,b,c,d,e){return!0===e?{known:{},unknown:c}:hb(c,function(c,e){var f=d(e);return a(b,f).fold(function(){return{known:c.known,unknown:c.unknown.concat([e])}},function(a){a=fc(f,a);return{known:ua(c.known,a),unknown:c.unknown}})},{known:{},unknown:[]})}},cba=function(a,
b,c,d,e,f,h){a=a(d,h);return hf.mapSync(a,function(a){a=e(a);Ma(a,function(a,c){b.set(c,a,f)});return oa(c,a)})},nm={single:function(a,b,c,d,e){return(!0===e?g.none():b.get(d,c)).fold(function(){return a(c,e).map(function(a){return a.map(function(a){b.set(c,a,d);return a})})},function(a){return hf.pure(a)})},multiple:function(a,b,c,d,e,f,h){c=bba.partition(b.get,f,c,e,h);return 0===c.unknown.length?hf.pure(c.known):cba(a,b,c.known,c.unknown,d,f,h)}},za=function(a){return Dc(a,a,sg(),uv())},gp=function(a,
b){return Dc(a,a,sg(),b)},dba=function(a,b){return Dc(a,a,Yk(),Ji(function(c){return J.error("The field: "+a+" is forbidden. "+b)}))},el=function(a,b){return Dc(a,a,sg(),Cc(b))},Dd=function(a){return Dc(a,a,Yk(),uv())},pL=function(a,b){return Dc(a,a,Yk(),b)},fl=function(a,b){return Dc(a,a,Yk(),Cc(b))},da=function(a,b){return Dc(a,a,Ne.defaultedThunk(k(b)),uv())},eba=function(a,b,c){return Dc(a,a,Ne.defaultedThunk(k(b)),Cc(c))},ug=function(a,b){return al(a,b)},hp=function(a){return"["+a.join(", ")+
"]"},qL=["iframely","oembed","fallback"],ip=function(a,b,c){return Xa(b,function(b){return U(a,b)})?J.error("Embed response source: "+hp(a)+" contains more than one of "+hp(qL)):J.value(c)},fba={iframely:k("iframely"),oembed:k("oembed"),fallback:k("fallback"),identify:function(a){return U(a,"iframely")?ip(a,["oembed","fallback","wikipedia"],"iframely"):U(a,"oembed")?ip(a,["iframely","fallback","wikipedia"],"oembed"):U(a,"fallback")?ip(a,["iframely","oembed","wikipedia"],"fallback"):U(a,"wikipedia")?
ip(a,["iframely","oembed","fallback"],"wikipedia"):J.error("Embed response source: "+hp(a)+" did not contain any of: "+hp(qL))}},gba=Cc([za("url"),za("maxWidth"),da("fresh",!1)]),hba=Cc([za("status_code"),za("sub_code"),za("msg")]),iba=Cc([za("html"),el("rels",[Dc("source","source",sg(),bL(function(a){return Mb(a)?fba.identify(a):J.error("Sources was not an array: "+a)}))])]),br={requestOne:k(gba),responseFailed:k(hba),responseSucceeded:k(iba)},mz={failed:function(a){return tg("EmbedResponse.failure",
br.responseFailed(),a).fold(function(a){return J.error({code:k(600),subcode:k(0),msg:k(bp(a))})},function(a){return J.error({code:a.status_code,subcode:a.sub_code,msg:a.msg})})},success:function(a){return tg("EmbedResponse.success",br.responseSucceeded(),a).fold(function(a){return J.error({code:k(601),subcode:k(0),msg:k(bp(a))})},function(a){return J.value({recommended:k({html:a.html,source:a.rels().source})})})}},Gf=B.resolve("embed-checking"),cr={configure:function(a){a.add(a.input(),Gf,Na.removeClass(Gf));
a.add(a.output(),Gf,Na.removeClass(Gf));a.add(a.history(),Gf,Na.removeClass(Gf));a.add(a.internal(),Gf,Na.removeClass(Gf))},embedChecking:k(Gf)},vv=function(){return x.translate("link.anchor.top")},wv=function(){return x.translate("link.anchor.bottom")},rL=function(){var a={};a[vv().toLowerCase()]="top";a[wv().toLowerCase()]="bottom";return a},rb={bookmarkDataAttr:k("data-textbox-bookmark"),bookmarkAnchorDataAttr:k("data-textbox-bookmark-anchor"),bookmarkBookmarkDataAttr:k("data-textbox-user-bookmark"),
topAnchorUrl:vv,bottomAnchorUrl:wv,top:k("top"),bottom:k("bottom"),reservedUrls:rL,isReservedUrl:function(a){return rL().hasOwnProperty(a.toLowerCase())},getReservedUrl:function(a){var b={};b.top=vv();b.bottom=wv();return b[a.toLowerCase()]}},jba={setCss:function(a,b,c){a.dom().styleSheet?a.dom().styleSheet.cssText=b:y.append(a,c)}},kba={escape:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},sL=function(a,b,c){b=new RegExp("url\\(\\s*['\"]?"+kba.escape(b)+"(.*?)['\"]?\\s*\\)","g");
return a.replace(b,'url("'+c+'$1")')},lba={replace:sL,replaceMany:function(a,b){var c=a;Ma(b,function(a,b){console.log("rm css",c);c=sL(c,b,a)});return c}},tL={stylesheets:function(a){a=a.dom().styleSheets;return Array.prototype.slice.call(a)},inject:function(a,b,c){var d=r.fromTag("style",c.dom());m.set(d,"type","text/css");a=void 0===b?a:lba.replaceMany(a,b);jba.setCss(d,a,r.fromText(a,c.dom()));c=L.descendant(c,"head").getOrDie();y.append(c,d)}},mba=O("selector","style","raw"),xv=function(a){return ia(a.cssRules,
function(a){if(a.type===CSSRule.IMPORT_RULE)return xv(a.styleSheet);if(a.type===CSSRule.STYLE_RULE){var b=a.selectorText,d=a.style.cssText;if(void 0===d)throw"WARNING: Browser does not support cssText property";return[mba(b,d,a.style)]}return[]})},uL={extract:xv,extractAll:function(a){return ia(a,xv)}},vL={},wL={exports:vL};(function(a,b,c,d){(function(d){"object"===typeof b&&"undefined"!==typeof c?c.exports=d():"function"===typeof a&&a.amd?a([],d):("undefined"!==typeof window?window:"undefined"!==
typeof global?global:"undefined"!==typeof self?self:this).EphoxContactWrapper=d()})(function(){return function(){function a(b,c,e){function f(g,k){if(!c[g]){if(!b[g]){var l="function"==typeof d&&d;if(!k&&l)return l(g,!0);if(h)return h(g,!0);k=Error("Cannot find module '"+g+"'");throw k.code="MODULE_NOT_FOUND",k;}k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return f(b[g][1][a]||a)},k,k.exports,a,b,c,e)}return c[g].exports}for(var h="function"==typeof d&&d,g=0;g<e.length;g++)f(e[g]);return f}
return a}()({1:[function(a,b,c){a=function(){var a=function(a){var b=a,c={a:0,b:0,c:0},d=[];var e=function(e,f){var h;if(e.test(b)){e=b.match(e);var g=0;for(h=e.length;g<h;g+=1){c[f]+=1;var k=e[g];var l=b.indexOf(k);var q=k.length;d.push({selector:a.substr(l,q),type:f,index:l,length:q});b=b.replace(k,Array(q+1).join(" "))}}};(function(){var a=function(a){var c;if(a.test(b)){a=b.match(a);var d=0;for(c=a.length;d<c;d+=1){var e=a[d];b=b.replace(e,Array(e.length+1).join("A"))}}};a(/\\[0-9A-Fa-f]{6}\s?/g);
a(/\\[0-9A-Fa-f]{1,5}\s/g);a(/\\./g)})();(function(){var a=/:not\(([^\)]*)\)/g;a.test(b)&&(b=b.replace(a,"     $1 "))})();(function(){var a=/{[^]*/gm,c;if(a.test(b)){a=b.match(a);var d=0;for(c=a.length;d<c;d+=1){var e=a[d];b=b.replace(e,Array(e.length+1).join(" "))}}})();e(/(\[[^\]]+\])/g,"b");e(/(#[^#\s\+>~\.\[:]+)/g,"a");e(/(\.[^\s\+>~\.\[:]+)/g,"b");e(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c");e(/(:[\w-]+\([^\)]*\))/gi,"b");e(/(:[^\s\+>~\.\[:]+)/g,"b");b=b.replace(/[\*\s\+>~]/g,
" ");b=b.replace(/[#\.]/g," ");e(/([^\s\+>~\.\[:]+)/g,"c");d.sort(function(a,b){return a.index-b.index});return{selector:a,specificity:"0,"+c.a.toString()+","+c.b.toString()+","+c.c.toString(),specificityArray:[0,c.a,c.b,c.c],parts:d}};return{calculate:function(b){var c,d=[];b=b.split(",");var e=0;for(c=b.length;e<c;e+=1){var f=b[e];0<f.length&&d.push(a(f))}return d},compare:function(b,c){var d;if("string"===typeof b){if(-1!==b.indexOf(","))throw"Invalid CSS selector";b=a(b).specificityArray}else if(Array.isArray(b)){if(4!==
b.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";}else throw"Invalid CSS selector or specificity array";if("string"===typeof c){if(-1!==c.indexOf(","))throw"Invalid CSS selector";c=a(c).specificityArray}else if(Array.isArray(c)){if(4!==c.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";}else throw"Invalid CSS selector or specificity array";for(d=0;4>d;d+=1){if(b[d]<c[d])return-1;if(b[d]>c[d])return 1}return 0}}}();"undefined"!==
typeof c&&(c.calculate=a.calculate,c.compare=a.compare)},{}],2:[function(a,b,c){a=a("specificity");b.exports={boltExport:a}},{specificity:1}]},{},[2])(2)})})(void 0,vL,wL,void 0);var nba=wL.exports.boltExport,xL=O("selector","raw"),oba=function(a,b){var c={};z(a,function(d){if(void 0!==a[d]){var e=b.dom().style;U(e,d)||(c[d]=a[d])}});return c},pba=function(a,b){b=ia(b,function(b){var c=Y.descendants(a,b.selector());z(c,function(a){var c=oba(b.raw(),a);v.setAll(a,c)});return c});z(b,function(a){m.remove(a,
"class")})},yL=function(a,b){var c=function(a){return-1!==a.selector().indexOf(",")},d=ia(ka(a,c),function(a){var b=a.selector().split(",");return E(b,function(b){b=b.trim();return xL(b,a.raw())})});a=ka(a,function(a){return!c(a)}).concat(d);a.sort(function(a,b){return nba.compare(a.selector(),b.selector())}).reverse();pba(b,a)},zL={inlineStyles:function(a,b,c){a=tL.stylesheets(a);a=uL.extractAll(a).map(function(a){var b=a.selector();b=c.hasOwnProperty(b)?c[b]:b;return xL(b,a.raw())});yL(a,b)},inlinePrefixedStyles:function(a,
b,c){a=tL.stylesheets(a);a=uL.extractAll(a);a=ka(a,function(a){return Gb(a.selector(),c)});yL(a,b)}},nz={inlineStyles:function(a,b,c){zL.inlineStyles(a,b,c)},inlinePrefixedStyles:function(a,b,c){zL.inlinePrefixedStyles(a,b,c)}},lV=function(a){a=qe.fromHtml(a);if(1===a.length)return a[0];var b=r.fromTag("div");P.append(b,a);return b},tm={handle:function(a,b){return K.bind(a,"click",b)}},qba={editor:function(a,b){b=u(x.translate,b?"aria.label.fullscreen":"aria.label.editor");return a.fold(ca,b)}},rba=
function(a,b){var c=Or(b,500);return function(){Vh(c)}},sba=function(a,b){var c=new window.MutationObserver(b);c.observe(A.owner(a).dom(),{attributes:!0,subtree:!0,childList:!0,attributeFilter:["style","class"]});return function(){c.disconnect()}},tba=void 0!==window.MutationObserver&&null!==window.MutationObserver?sba:rba,zz={onShow:function(a,b){if(sc.isVisible(a))return km.requestAnimationFrame(b),t;var c=jf(function(){sc.isVisible(a)&&(d(),km.requestAnimationFrame(b))},100),d=tba(a,c.throttle);
return d}},gl=[],yv=function(a){return Va(gl,function(b){return N.eq(b.element,a)}).getOr(-1)},zv={begin:function(a,b){-1===yv(a)&&(b=b(),gl.push({element:a,unbind:b}))},query:function(a){a=yv(a);return-1===a?g.none():g.some(gl[a])},end:function(a){a=yv(a);if(-1!==a){var b=gl[a];gl.splice(a,1);b.unbind()}}},uba=function(a){return{element:a,handlers:[],lastWidth:Ia.get(a),lastHeight:sa.get(a)}},Hf=[],AL=function(a){return Va(Hf,function(b){return N.eq(b.element,a)}).getOr(-1)},BL=function(a){var b=
Ia.get(a.element),c=sa.get(a.element);if(b!==a.lastWidth||c!==a.lastHeight)a.lastWidth=b,a.lastHeight=c,z(a.handlers,xb)},CL=function(a){var b=a.element;sc.isVisible(b)?BL(a):zv.begin(b,function(){return zz.onShow(b,function(){zv.end(b);BL(a)})})},Av=!1,vba=function(){Av=!1;z(Hf,CL)},wba=function(){Av||(Av=!0,km.requestAnimationFrame(vba))},jp=g.none(),xba=function(){jp.each(function(a){a.unbind();jp=g.none()})},pz={bind:function(a,b){var c=qa(Hf,function(b){return N.eq(b.element,a)}).getOr(void 0);
void 0===c&&(c=uba(a),Hf.push(c));c.handlers.push(b);jp.isNone()&&(jp=g.some(K.bind(r.fromDom(Zg),"resize",wba)));Kf(function(){-1!==AL(c.element)&&CL(c)},100)},unbind:function(a,b){zv.end(a);a=AL(a);-1!==a&&(b=Gc(Hf[a].handlers,b),b.isNone()||(Hf[a].handlers.splice(b.getOr(0),1),0===Hf[a].handlers.length&&Hf.splice(a,1),0===Hf.length&&xba()))}},qz=aa.detect(),yba=k(!1),pm=aa.detect(),DL=pm.browser.isIE()||pm.browser.isEdge()?2:5,sz=ta.generate([{above:["element"]},{below:["element"]}]),EL=function(a,
b,c){return function(b){b=Wa.forElement(a,b);b=Lc.exactFromRange(b);return Wa.getBounds(a,b).fold(yba,c)}},nV=function(a,b){return EL(a,b,function(a){return b>a.top()+a.height()-DL})},oV=function(a,b){return EL(a,b,function(a){return b<a.top()+DL})},$b={clearAll:function(a){Wa.clear(a)},get:function(a){return Wa.getExact(a).map(function(a){return Sc(a.start(),a.soffset(),a.finish(),a.foffset())})},set:function(a,b){Wa.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())},
setExact:function(a,b,c,d,e){Wa.setExact(a,b,c,d,e)},setRelative:function(a,b,c){Wa.setRelative(a,b,c)},replace:function(a,b){Wa.get(a).each(function(c){Wa.replace(a,c,b)})}},pV=function(a,b){var c=u(N.eq,ja.body()),d=b.join(", ");return yc(a,function(a){return Ja.ancestor(a,function(a){return Fa.is(a,d)},c)}).isSome()},zba=function(a,b){return{toEditor:a,toOld:u(Z.focus,b),isSet:function(){return Z.active().exists(function(a){return N.eq(a,b)})}}},FL=function(a,b,c,d){d=d.dom().activeElement;return a()?
{toEditor:b,toOld:t,isSet:k(!0)}:void 0===d||null===d?{toEditor:c,toOld:t,isSet:k(!1)}:zba(c,r.fromDom(d))},dr={build:FL,toEditor:function(a,b,c,d){FL(a,b,c,d).toEditor()}},Aba=function(a){return Db.closest(a.startContainer(),'[contenteditable="false"]')&&Db.closest(a.endContainer(),'[contenteditable="false"]')},vz={focus:function(a,b,c){b=b().filter(Aba);b.each(function(b){L.closest(b.endContainer(),'[contenteditable="false"]').each(function(b){$b.setRelative(a.win(),la.after(b),la.after(b))})});
a.focus();b.each(function(a){c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})}},sV=aa.detect(),Bba=O("doc","href"),uV=function(){var a=[],b=function(a,b){return function(c){return N.eq(a,c.doc())&&b===c.href()}};return{addLinkIfMissing:function(c,d){Xa(a,b(c,d))||(a.push(Bba(c,d)),oC.addStylesheet(d,c))}}}(),wz=function(){console.log("The previous selection could not be restored. Defaulting to the current selection.")},Bv=aa.detect(),Cba=Bv.deviceType.isiOS()?BV:Bv.deviceType.isAndroid()?
zV:AV,EV={get:function(a){return Cba(a,Bv)}},Dba=function(a){a=a.dom();try{var b=a.contentWindow?a.contentWindow.document:a.contentDocument;return void 0!==b&&null!==b?g.some(r.fromDom(b)):g.none()}catch(c){return console.log("Error reading iframe: ",a),console.log("Error was: "+c),g.none()}},xz={doc:function(a){return Dba(a).fold(function(){return a},function(a){return a})}},DV=aa.detect(),GV={resolve:Lb.create("ephox-hare").resolve},yz={write:function(a,b){if(!ja.inBody(a))throw"Internal error: attempted to write to an iframe that is not in the DOM";
a=xz.doc(a).dom();a.open("text/html","replace");a.writeln(b);a.close()}},HV=function(a){var b=a.base.fold(k(""),function(a){return'<base href="'+a+'" />'}),c=a.editorStyles.concat(a.stylesheets),d=E(c,function(a){return'<link rel="stylesheet" type="text/css" href="'+a+'" onload="styleLoaded()" onerror="styleLoaded()" />'});a=0===a.documentStyles.length?"":'<style type="text/css">'+a.documentStyles+"</style>";return"<!doctype html>\n<html>\n  <head>\n    "+b+'\n    <script type="text/javascript">\n      var stillToLoad = '+
c.length+";\n      function styleLoaded() {\n        stillToLoad--;\n      }\n    \x3c/script>\n    "+d.join("")+"\n    "+a+'\n  </head>\n  <body contenteditable="true" spellcheck="false"></body>\n</html>'},GL=function(a){var b=g.none(),c=Hd.tap(function(a,b,c){n.trigger.nodeChanged(a,b,c)});a.loaded(function(a){var d=function(){try{return null!==a.win().window&&void 0!==a.win().window}catch(X){return!1}};if(d()){b=g.some(a);if(aa.detect().browser.isFirefox()){try{a.execCommand("enableObjectResizing",
!1,!1)}catch(X){}try{a.execCommand("enableInlineTableEditing",!1,!1)}catch(X){}}a.events.nodeChanged.bind(function(a){c.instance(a.node(),a.offset(),a.prev())});a.events.loiter.bind(function(a){n.trigger.loiter(a.node(),a.offset())});a.events.uiStale.bind(function(){n.trigger.uiStale()});a.events.domChanged.bind(function(){n.trigger.domChanged()});a.events.interaction.bind(function(){n.trigger.interaction()});a.events.keyup.bind(function(a){n.trigger.keyup(a.original())});a.events.keydown.bind(function(a){n.trigger.keydown(a.original())});
a.events.keypress.bind(function(a){n.trigger.keypress(a.original())});a.events.mousedown.bind(function(a){n.trigger.mousedown(a.original())});a.events.mouseup.bind(function(a){n.trigger.mouseup(a.original())});a.events.contextmenu.bind(function(a){n.trigger.contextmenu(a.original())});a.events.cut.bind(function(a){n.trigger.cut(a.original())});a.events.copy.bind(function(a){n.trigger.copy(a.original())});a.events.paste.bind(function(a){n.trigger.paste(a.original())});a.events.focus.bind(function(a){n.trigger.focus(a.original())});
a.events.focusOut.bind(function(a){n.trigger.focusOut(a.original())});a.events.dblclick.bind(function(a){n.trigger.dblclick(a.original())});a.events.selectionchange.bind(function(a){n.trigger.selectionchange(a.original())});a.futures.stylesheetLoad.get(function(a){a.each(function(a){n.trigger.stylesheetLoad(a)})});a.events.paint.bind(function(){n.trigger.paint()});a.resetContent(f);d()&&(n.trigger.ready(a),n.trigger.loaded(),a.uiChanged())}else a.destroy()});var d=function(){return b.map(function(a){return a.win()})},
e=function(){return b.map(function(a){return a.doc()})},f=a.initial(),h=function(){b.each(function(a){a.focus()})},l=function(){return b.bind(function(a){return a.getSelection()})},q=function(a,c,d,e){b.each(function(b){b.setSelection(a,c,d,e)})},m=function(a,c){b.each(function(b){b.setRelativeSelection(a,c)})},w=function(){var a=arguments;b.each(function(b){b.execCommand.apply(null,a)})},n=H.create({nodeChanged:p(["node","offset","prev"]),loiter:p(["node","offset"]),uiStale:p([]),domChanged:p([]),
interaction:p([]),keydown:p(["original"]),keyup:p(["original"]),keypress:p(["original"]),mousedown:p(["original"]),mouseup:p(["original"]),contextmenu:p(["original"]),cut:p(["original"]),copy:p(["original"]),paste:p(["original"]),focus:p(["original"]),focusOut:p(["original"]),dblclick:p(["original"]),selectionchange:p(["original"]),paint:p([]),ready:p(["api"]),loaded:p([]),stylesheetLoad:p(["sheets"])});return{element:a.element,tabindex:a.tabindex,onCanvas:a.onCanvas,win:d,doc:e,body:function(){return b.map(function(a){return a.body()})},
getContent:function(){return b.fold(function(){return f},function(a){return a.getContent()})},setContent:function(a){b.fold(function(){f=a},function(b){b.setContent(a)})},resetContent:function(a){b.fold(function(){f=a},function(b){b.resetContent(a)})},blur:function(){b.each(function(a){a.blur()})},focus:h,uiChanged:function(){b.each(function(a){a.uiChanged()})},domChanged:function(){b.each(function(a){a.domChanged()})},clearSelection:function(){b.each(function(a){a.clearSelection()})},getSelection:l,
setSelection:q,setRelativeSelection:m,backupSelection:function(){b.each(function(a){a.backupSelection()})},replaceSelection:function(a){b.each(function(b){b.replaceSelection(a)})},execCommand:w,lockdown:function(a){var b=c.control.isBlocked();c.control.block();a();b||c.control.unblock()},destroy:function(){a.destroy();b=g.none()},events:n.registry,background:function(){b.each(function(a){a.background()})},foreground:function(){b.each(function(a){a.foreground()})},on:function(a){return d().bind(function(b){return e().map(function(c){return a({win:k(b),
doc:k(c),execCommand:w,getSelection:l,setSelection:q,setRelativeSelection:m,focus:h})})})},translateScreen:function(a,c){return b.fold(function(){return Ra(a,c)},function(b){return b.translateScreen(a,c)})},translateLocation:function(a,c){return b.fold(function(){return Ra(a,c)},function(b){return b.translateLocation(a,c)})},placeholder:a.placeholder,isInline:a.isInline}},HL={frame:function(a,b){a=IV(a,b);return GL(a)},detached:function(a,b,c){a=tV(a,b,c);return GL(a)}},Cv=ay(D.isComment,"comment"),
Dv={get:function(a){return Cv.get(a)},getOption:function(a){return Cv.getOption(a)},set:function(a,b){Cv.set(a,b)}},Uj={intraFlag:k({findClipboardTags:function(a){a=ee(E(a,function(a){if(D.isComment(a)){var b=Dv.get(a);if(Bb(b,"x-textbox/html"))return g.some(a)}return g.none()}));return 0===a.length?g.none():g.some(a)}}),injectEphemera:function(a){return gc(function(){return"\x3c!-- x-textbox/html --\x3e"+a()})},ignoreSelectors:k([".ephox-sloth-bin"])},IL=function(a,b){return{editable:k(a),connect:b}},
Eba=function(a,b){var c=HL.frame(b,Uj.ignoreSelectors());c.events.ready.bind(function(b){b=b.api().body();a.updateUi(b)});return IL(c,function(a){y.append(a,c.element())})},Fba=function(a,b){0!==b.stylesheets.length&&console.log("You have attempted to declare the following stylesheets for use in textbox.io: ["+b.stylesheets.join(", ")+"]. User stylesheets are not used in inline editing mode and have been ignored.");0!==b.documentStyles.length&&console.log('You have attempted to declare the following document styles for use in textbox.io: "'+
b.documentStyles+'". Document styles are not used in inline editing mode and have been ignored.');b.base.fold(t,function(a){console.log('You have attempted to declare the following content base URL for use in textbox.io: "'+a+'". Content base URL is not used in inline editing mode and has been ignored.')});var c=HL.detached(b.inline,b.editorStyles,Uj.ignoreSelectors());return IL(c,function(a){y.append(a,c.placeholder());a=L.ancestor(a,".ephox-polish-editor-container").getOr(a);v.set(c.placeholder(),
"display","none");ma.add(a,[B.resolve("inline-editor-container"),B.resolve("layer-editor")])})},Gba={build:function(a,b){return(void 0!==b.inline?Fba:Eba)(a,b)}},Hba=aa.detect().browser.isFirefox(),Iba=function(a){z(a,function(a){A.nextSibling(a).isNone()&&y.after(a,r.fromText(mb()))})},Jba={configure:function(a){Hba&&a.addSelector(a.input(),"a",Iba)}},kp=B.resolve("content-eph-wrapper"),lp=B.resolve("content-eph-extra"),mp=B.resolve("content-eph-general"),Kba=function(a){z(a,function(a){n.remove(a,
Rb.styleSpan());m.remove(a,Rb.overrideSpan());m.hasNone(a)?G.unwrap(a):rd.isTransient(a)&&G.remove(a)})},JL=function(a){z(a,function(a){n.remove(a,Rb.quasiBlock())})},KL=function(a){z(a,function(a){var b=m.get(a,"style");m.set(a,"style",b.replace(/"/g,"'"))})},Lba=function(a){return wa.isCursorPosition(a)||pa.isBlock(a)||wa.isCursorPosition(kb.freefallLtr(a).element())},LL=function(a){z(a,function(a){if(0===ka(A.children(a),Lba).length){var b=r.fromTag("br");y.append(a,b)}})},np={configure:function(a){a.add(a.internal(),
kp,Na.unwrap);a.add(a.internal(),lp,Na.remove);a.add(a.internal(),mp,Na.remove);a.add(a.internal(),Rb.quasiBlock(),JL);a.add(a.output(),kp,Na.unwrap);a.add(a.output(),lp,Na.remove);a.add(a.output(),mp,Na.remove);a.add(a.output(),Rb.styleSpan(),Kba);a.add(a.output(),Rb.quasiBlock(),JL);a.addExcludedContext(["."+kp,"."+lp,"."+mp,"."+Rb.styleSpan()]);a.addSelector(a.input(),"[style]",KL);a.addSelector(a.input(),"td,th,p",LL);a.addSelector(a.paste(),"[style]",KL);a.addSelector(a.paste(),"td,th,p",LL);
a.addSelector(a.output(),"strong,b,em,i,u,s,strike,del,sup,sub",Na.removeIfEmpty);Jba.configure(a)},markerWrapper:k(kp),markerExtra:k(lp),markerGeneral:k(mp)},vg={resolve:Lb.create("ephox-cereal").resolve},Ev=vg.resolve("start-cursor"),Fv=vg.resolve("finish-cursor"),Gv="data-"+vg.resolve("start-offset"),Hv="data-"+vg.resolve("finish-offset"),ML=function(a){m.remove(a,Gv);m.remove(a,Hv);ma.remove(a,[Ev,Fv]);""===m.get(a,"class")&&m.remove(a,"class")},NL=function(a,b){a=m.get(a,b);return parseInt(a,
10)},Li={setInfo:function(a,b,c,d){z([a,b],ML);n.add(a,Ev);n.add(b,Fv);m.set(a,Gv,c);m.set(b,Hv,d)},clearInfo:ML,findStart:function(a){return L.descendant(a,"."+Ev).map(function(a){return{token:k(a),offset:k(NL(a,Gv))}})},findFinish:function(a){return L.descendant(a,"."+Fv).map(function(a){return{token:k(a),offset:k(NL(a,Hv))}})}},OL=O("token","remove","extra"),PL={use:function(a,b){return OL(b,t,[])},extract:function(a){return{remove:u(Li.clearInfo,a),element:k(a)}}},QL=vg.resolve("pre-cursor-token"),
RL=vg.resolve("post-cursor-token"),SL=vg.resolve("first-cursor-token"),Iv=function(){var a=r.fromTag("span");v.set(a,"display","none");return a},Jv=function(a){var b=u(G.remove,a);return OL(a,b,[a])},Mba=function(a){return n.has(a,QL)?A.nextSibling(a):n.has(a,RL)?A.prevSibling(a):n.has(a,SL)?A.parent(a):g.none()},vh={pre:function(a,b){a=Iv();y.before(b,a);n.add(a,QL);return Jv(a)},post:function(a,b){a=Iv();y.after(b,a);n.add(a,RL);return Jv(a)},first:function(a,b){b=Iv();y.prepend(a,b);n.add(b,SL);
return Jv(b)},extract:function(a){return Mba(a).map(function(b){return{remove:u(G.remove,a),element:k(b)}})}},Nba=O("element","offset"),Oba=O("startContainer","startOffset","endContainer","endOffset"),Pba={point:Nba,range:Oba},Kv=vg.resolve("text-node-wrapper"),TL=function(a){return n.has(a,Kv)},wg={create:function(){var a=r.fromTag("span");n.add(a,Kv);return a},findIn:function(a){return Y.children(a,"."+Kv)},isWrap:TL,inWrap:function(a){return A.parent(a).fold(k(!1),function(a){return TL(a)})},child:function(a){return A.child(a,
0).fold(function(){var b=r.fromText("");y.append(a,b);return b},ca)}},Qba=function(a){a=wg.findIn(a);z(a,function(a){0===A.children(a).length&&y.before(a,r.fromText(""));G.unwrap(a)})},Rba=function(a){A.parent(a).each(G.unwrap)},UL=function(a){(wg.inWrap(a)?Rba:Qba)(a)},Lv=function(a,b,c,d){return N.eq(a,b)?vh.first(a,b):D.isElement(b)&&!d(b)?PL.use(a,b):c(a,b)},Mv={extractFrom:function(a,b){a.remove();b.remove();var c=function(a){var b=wg.isWrap(a)?G.unwrap:UL,c=wg.isWrap(a)?wg.child(a):a;return{target:k(c),
unwrap:u(b,a)}},d=c(a.element()),e=c(b.element()),f=Pba.range(d.target(),a.offset(),e.target(),b.offset());return{remove:function(){d.unwrap();e.unwrap()},getSelection:function(){return f}}},same:function(a,b,c,d,e){a=Lv(a,b,vh.pre,e);Li.setInfo(a.token(),a.token(),c,d);return[a]},diff:function(a,b,c,d,e,f){var h=id.after(b,c,d,e),g=h?vh.pre:vh.post;b=Lv(a,b,h?vh.post:vh.pre,f);a=Lv(a,d,g,f);Li.setInfo(b.token(),a.token(),c,e);return[b,a]}},Sba=function(a){return A.parent(a).fold(k(!1),function(a){return wg.isWrap(a)})},
Tba=function(a){return Eb(a,function(a,c){if(D.isText(c)&&!Sba(c)){var b=wg.create();y.wrap(c,b);return[b].concat(a)}return a},[])},Uba=function(a){var b=A.children(a);b=0<b.length?b:[a];return wg.isWrap(a)?[]:Tba(b)},Vba=function(a){a.remove()},VL={combine:function(a,b){var c=ia(a,Uba),d=ia(b,function(a){return a.extra()});return{extra:k(d),wrappers:k(c),remove:function(){z(b,function(a){Li.clearInfo(a.token())});z(a,UL);z(b,Vba)}}}},Wba=function(a,b,c,d,e,f){var h=[b,d];a=Mv.diff(a,b,c,d,e,f);return VL.combine(h,
a)},Xba=function(a,b,c,d,e,f){d=[b];a=Mv.same(a,b,c,e,f);return VL.combine(d,a)},WL=function(a,b){return b(a).map(function(a){var b=vh.extract(a.token()).getOrThunk(function(){return PL.extract(a.token())});return{remove:b.remove,offset:a.offset,element:b.element}})},Yba=function(a){return WL(a,Li.findStart).bind(function(b){return WL(a,Li.findFinish).map(function(a){return{startMarker:k(b),finishMarker:k(a)}})})},XL={insertAt:function(a,b,c,d,e,f){return(N.eq(b,d)?Xba:Wba)(a,b,c,d,e,f)},extract:function(a){return Yba(a).map(function(a){return Mv.extractFrom(a.startMarker(),
a.finishMarker())})}},YL={insert:function(a,b,c){a=XL.insertAt(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c);return{extra:a.extra,wrappers:a.wrappers,remove:a.remove}},extract:function(a){return XL.extract(a).map(function(a){return{remove:a.remove,getSelection:a.getSelection}})}},ZL=function(a,b){z(a,function(a){n.add(a,b)})},Zba=function(a){var b=function(){return A.parent(a).map(function(a){return"false"===m.get(a,"contenteditable")}).getOr(!1)};return"false"===m.get(a,
"contenteditable")||b()},op={extract:function(a){return YL.extract(a)},getSelection:function(a){var b=a.getSelection();a=b.startContainer();var c=b.startOffset(),d=b.endContainer();b=b.endOffset();var e=wa.getEnd(a),f=wa.getEnd(d);return 0<=c&&c<=e&&0<=b&&b<=f?{start:k(la.on(a,c)),finish:k(la.on(d,b))}:{start:k(la.before(a)),finish:k(la.before(a))}},remove:function(a){a.remove()},serialise:function(a,b){return oi.path(a,b.startContainer()).bind(function(c){return oi.path(a,b.endContainer()).bind(function(d){var e=
Pc.deep(a);return oi.follow(e,c).bind(function(a){return oi.follow(e,d).map(function(c){c={startContainer:k(a),startOffset:k(b.startOffset()),endContainer:k(c),endOffset:k(b.endOffset())};c=YL.insert(e,c,Zba);ZL(c.wrappers(),np.markerWrapper());ZL(c.extra(),np.markerExtra());return qn.writeChildren(e)})})})})}},pp=O("word","left","right"),$L=["'","\u2018","\u2019"],$ba=ia($L,function(a){return E(["twas"],function(b){return a+b})}),aca=function(a){var b=a.word();return pp(b.substring(1),g.some(b.charAt(0)),
a.right())},qp=function(a){return U($L,a)},bca=function(a){var b=a.word(),c=Xa($ba,function(a){return-1<b.indexOf(a)})?2:1,d=b.substring(0,c);return ob(d,qp)&&!qp(b.charAt(c))?aca(a):a},aM=function(a){var b=a.word();2<=b.length&&qp(b.charAt(b.length-1))&&!qp(b.charAt(b.length-2))&&(b=a.word(),a=pp(b.substring(0,b.length-1),a.left(),g.some(b.charAt(b.length-1))));return bca(a)},cca={scope:aM,text:function(a){a=pp(a,g.none(),g.none());return aM(a).word()}},bM={words:function(a){var b=Cb.unsafetoken(Cb.wordchar()+
"+");b=Mo.findall(a,b);var c=a.length;return E(b,function(b){var d=b.start(),f=b.finish();b=a.substring(d,f);d=0<d?g.some(a.charAt(d-1)):g.none();f=f<c?g.some(a.charAt(f)):g.none();b=pp(b,d,f);return cca.scope(b)})}},cM={identify:function(a){return bM.words(a)},isWord:function(a,b){return!Qk.hasBreak(b)}},dca=nb(),eca={identify:function(a){return cM.identify(a)},isWord:function(a){return cM.isWord(dca,a)}},fca=aa.detect(),dM=function(a,b){return D.isText(a)?g.some(W.point(a,b)):0===A.children(a).length?
g.none():A.child(a,b).bind(function(a){return dM(a,0)})},gca=function(a,b,c){a.on(function(a){Ad.expandWord(a,b,c)})},hca=function(a,b){a=a.dom().createRange();a.setStart(b.startContainer().dom(),b.startOffset());a.setEnd(b.endContainer().dom(),b.endOffset());return eca.isWord(a.cloneContents().textContent)},eM={correct:function(a){a.getSelection().each(function(b){a.doc().each(function(c){hca(c,b)&&dM(b.startContainer(),b.startOffset()).each(function(c){(!b.collapsed()||a.isInline()&&fca.browser.isIE())&&
gca(a,c.element(),c.offset())})})})},expand:function(a){a.on(Ad.expand);a.backupSelection()}},fM=function(a,b){return a.bind(function(a){return a.fold(function(){return Ga.pure(a)},function(a){return b(a)})})},gM=function(a){return Ga.pure(J.value(a))},hM=function(a){return Ga.nu(function(b){a.then(function(a){b(J.value(a))},function(a){b(J.error(a))})})},iM=function(a){return a.map(J.value)},Ua={fromPromise:hM,error:function(a){return Ga.pure(J.error(a))},map:function(a,b){return a.map(function(a){return a.map(b)})},
bind:fM,pure:gM,fromChain:function(a){return function(b){return hb(a,function(a,b){return fM(a,function(a){return b(a)})},gM(b))}},fromFuture:iM,pToFR:function(a){return Pb(hM,a)},fToFR:function(a){return Pb(iM,a)},effect:function(a){return function(b){b.each(function(){a()});return b}}},ica=function(a){return Ga.nu(function(b){if(!0===a.dom().complete)b(J.value(a));else{var c=fr();jM(c,b);c.monitor(a)}})},jM=function(a,b){a.events.success.bind(function(a){b(J.value(a.image()))});a.events.fail.bind(function(a){b(J.error("Unable to download image "+
a.url()))})},rp={load:function(a){return Ga.nu(function(b){var c=fr();jM(c,b);c.go(a)})},loadIfNeeded:function(a){return!0===a.dom().complete||void 0===m.get(a,"src")?Ua.pure(a):ica(a)}},Mi={text:function(a){a=A.children(a);return rn.toText(a)},html:function(a,b){var c=r.fromTag("div");y.append(c,a);return Xj.output(b,c)},fragment:function(a,b){if(b.collapsed())return g.none();b=Lc.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());a=Wa.clone(a,b);return g.some(a)}},kM=aa.detect(),
jca=function(a,b,c,d,e){np.configure(a);var f=g.none(),h={inline:c.inline,base:g.from(c.base),editorStyles:[c.css+"/content.css"],stylesheets:c.stylesheets,documentStyles:c.documentStyles,needStyles:c.showDocumentStyles,autoresize:c.autoresize};d=Gba.build(d,h);var l=d.editable();null!==c.tabindex&&l.tabindex(c.tabindex);void 0!==e.raw&&l.setContent(e.raw);l.events.ready.bind(function(){if(void 0!==e.raw){var a=l.getContent();e.raw===a&&e.marked!==e.raw&&C(e.marked,!1)}a=l.body().getOrDie();f=g.some(K.bind(a,
"dblclick",function(a){eM.correct(l)}))});l.events.ready.bind(function(a){Zr.addClasses(a.api().body())});var q=function(){return l.getSelection().bind(function(a){var b=l.body().getOrDie("content should not return a selection if body is not yet available");return op.serialise(b,a)}).getOr(l.getContent())},C=function(a,b){l.body().each(function(c){l.setContent(a);op.extract(c).fold(function(){var a=kb.freefallLtr(c);l.setSelection(a.element(),a.offset(),a.element(),a.offset())},function(a){var b=
op.getSelection(a);op.remove(a);l.setRelativeSelection(b.start(),b.finish())});if(!kM.deviceType.isiOS()){var d=Y.descendants(c,"img");b?Ce(d,rp.loadIfNeeded).get(function(){x()}):x()}})},w=H.create({nodeChanged:p(["node","offset","prev"]),undoChanged:p([]),loiter:Q(["node","offset"],l.events.loiter),uiStale:Q([],l.events.uiStale),domChanged:Q([],l.events.domChanged),interaction:Q([],l.events.interaction),keydown:Q(["original"],l.events.keydown),keyup:Q(["original"],l.events.keyup),keypress:Q(["original"],
l.events.keypress),mousedown:Q(["original"],l.events.mousedown),mouseup:Q(["original"],l.events.mouseup),contextmenu:Q(["original"],l.events.contextmenu),copy:Q(["original"],l.events.copy),paste:Q(["original"],l.events.paste),focus:Q(["original"],l.events.focus),focusOut:Q(["original"],l.events.focusOut),dblclick:Q(["original"],l.events.dblclick),selectionchange:Q(["original"],l.events.selectionchange),paint:Q([],l.events.paint),ready:Q(["api"],l.events.ready),loaded:Q([],l.events.loaded),stylesheetLoad:Q(["sheets"],
l.events.stylesheetLoad),background:p([]),foreground:p([]),scrollToCursor:p([]),scrollToElement:p(["element"]),toEditing:p([]),toReading:p([])});l.events.nodeChanged.bind(function(a){w.trigger.nodeChanged(a.node(),a.offset(),a.prev());a.prev().fold(v,function(b){Ja.ancestor(b,pa.isBlock).each(function(b){Ja.ancestor(a.node(),pa.isBlock).each(function(a){N.eq(a,b)||v()})})})});var t=Hd.tap(function(){w.trigger.undoChanged()}),v=function(){t.instance()},z=function(a){t.instance();var b=t.control.isBlocked();
t.control.block();a=a();b||t.control.unblock();t.instance();return a},x=function(){w.trigger.scrollToCursor()},B=Hd.tap(function(){l.focus()});h=function(a){return function(){var b=arguments;A.parent(l.element()).fold(function(){a.apply(null,b)},function(c){var d=c.dom().scrollTop;a.apply(null,b);c.dom().scrollTop=d})}}(l.execCommand);var E=function(a){return D.isText(a)&&(kM.browser.isSafari()||0===Ya.get(a).length)||D.isElement(a)&&!pa.isEmptyTag(a)&&!pa.isBlock(a)},J=function(a){var b=r.fromText(mb());
y.after(a,b);return b},L=function(a,b){var c=A.children(a);if(b>=c.length)return W.point(a,b);var d=c[b];return D.isElement(d)&&!pa.isEmptyTag(d)?L(c[b],0):W.point(a,b)},M=function(a){a=E(a)?J(a):a;l.setRelativeSelection(la.after(a),la.after(a));l.getSelection().each(function(a){a=L(a.startContainer(),a.startOffset());l.setSelection(a.element(),a.offset(),a.element(),a.offset())})},O=function(){return P.getSelection().bind(function(a){return P.win().bind(function(b){return Mi.fragment(b,a)})})},P=
{onCanvas:l.onCanvas,element:l.element,isInline:l.isInline,win:l.win,doc:l.doc,body:l.body,getContent:l.getContent,setContent:l.setContent,resetContent:l.resetContent,focus:function(){B.instance()},blur:l.blur,uiChanged:l.uiChanged,domChanged:l.domChanged,undoChanged:v,clearSelection:l.clearSelection,getSelection:l.getSelection,getSelectionStart:function(){return l.getSelection().map(function(a){return a.startContainer()})},setSelection:l.setSelection,setRelativeSelection:l.setRelativeSelection,backupSelection:l.backupSelection,
replaceSelection:l.replaceSelection,replaceElement:function(a,b){var c=P.getSelection().filter(function(b){var c=u(N.eq,a);return Ja.closest(b.startContainer(),c)||Ja.closest(b.endContainer(),c)}).isSome();y.before(a,b);G.remove(a);c&&M(b);P.domChanged();v()},findTagAtCursor:function(b){var c=function(b,c,d){b=A.child(b,c).getOr(b);return Ja.closest(b,function(b){return Fa.is(b,d)&&a.includeContext(b)})};return P.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),b).orThunk(function(){return c(a.endContainer(),
a.endOffset(),b)})})},getFilteredAttributes:function(b){b=Pc.shallow(b);var c=r.fromTag("div");y.append(c,b);a.filterDom(a.output(),c);return m.clone(b)},execCommand:h,insertHtmlAtCursor:function(a){var c=qe.fromHtml(a);z(function(){sd.insertAtCursorWithInstructions(rg.doNotMerge,P,c).each(function(a){if(0===c.length)l.setSelection(a.element(),a.offset(),a.element(),a.offset());else{var d=a.element();A.parent(d).each(function(a){M(d);b.input(c)})}})})},on:l.on,destroy:function(){f.each(function(a){a.unbind()});
l.destroy()},events:w.registry,state:function(){return{raw:l.getContent(),marked:q()}},serialize:q,deserialize:function(a){C(a,!0)},background:function(){l.background();w.trigger.background()},foreground:function(){l.foreground();w.trigger.foreground()},isRoot:function(a){return l.body().fold(k(!1),function(b){return N.eq(b,a)})},selectWord:function(){eM.expand(l)},cursor:function(){return JV(l)},activate:function(){B.control.unblock()},deactivate:function(){B.control.block()},cursorIntoView:x,elementIntoView:function(a){w.trigger.scrollToElement(a)},
placeholder:l.placeholder,connect:d.connect,translateScreen:l.translateScreen,translateLocation:l.translateLocation,runOrOnLoaded:function(a){l.body().fold(function(){l.events.ready.bind(function(b){a(b.api().body())})},function(b){a(b)})},getSelectedText:function(){return O().map(Mi.text)},getSelectedHtml:function(){return O().map(function(b){return Mi.html(b,a)})},getFilteredContents:function(b){return Xj.output(a,b)},toEditing:function(){w.trigger.toEditing()},toReading:function(){w.trigger.toReading()},
undoOperation:z,markAsEphemeral:function(a){n.add(a,np.markerGeneral())},hideInlineSelection:function(){l.isInline()&&(l.backupSelection(),l.clearSelection())},imageExcludes:c.imageExcludes};return P},kca={get:k({onShortcut:function(a,b){a.bind(b)}})},lM="data-"+B.resolve("context-type"),gr={nu:function(a,b,c){a=zb.item(a,c.value(),c.text());m.set(a,lM,b);m.setAll(a,c.attrs());return a},type:function(a){return m.get(a,lM)}},LV={derive:function(a,b,c){b=E(b,function(b){var d=c[b],f=d.primary(),h=d.submenus();
return E(f,function(c){var d=gr.nu(a,b,c),e=h.hasOwnProperty(c.value())&&void 0!==h[c.value()]?[va.resolve("menu-more")]:[],f=void 0!==h[c.value()];S.menuItem(d,g.some(c.text()),g.some(f));ma.add(d,e);return d})});b=ka(b,function(a){return 0<a.length});return Qb(JD(b,function(){return[zb.separator(a)]}))}},MV={derive:function(a,b,c){return ia(b,function(b){var d=c[b].secondary();return E(d,function(c){var d=zb.submenu(a,c.value(),[]);S.menu(d,x.get(c.textkey()));c=E(c.items(),function(c){var d=gr.nu(a,
b,c);S.menuItem(d,g.some(c.text()),g.none());return d});P.append(d,c);return d})})}},mM={mainmenu:function(a,b,c,d,e,f){return Lg.main(a,b,c,d,e,f)},submenu:function(a,b,c,d,e){return Lg.submenu(a,b,c,d,e)}},Pm={makeshift:function(a,b,c,d,e,f,h,g,q){return{recalculate:t,isAnchored:k(!1),place:function(k){var l=b.uiOrigin(),m=a.isInline()?Ra(c,d):Ie.translate(l,c,d),C=gg(m.left(),m.top(),e,f);m=h.isRtl()?Qh.allRtl():Qh.all();l=Lh.box(C,l);k=k.panel();Mm.simple(l,k,g,m,void 0===q?{}:q)}}},mainmenu:function(a,
b,c,d){return mM.mainmenu(a.uiContainer,a.bounds,b,c,d)},submenu:function(a,b,c){return mM.submenu(a.uiContainer,a.bounds,b,c)}},nM=O("target","x","y"),oM=aa.detect().browser,OV=function(a,b,c,d,e,f){c=b.doc().getOrDie();var h=KV(c),l=Ra(0,0);c=kca.get();var q=Qm.fromUnsafe(b),m=df.menuSystem(e.uiContainer,k("context"),rj.menu({focusActive:!0})),w=df.popup(m.sandbox,e.bounds,a,[],Mg.editorContainer());f=T.div();var n=w.initMenu(f),p=function(a){h.update(a.target());var b=y(),c=[m.sandbox()];if(0<
b.all.length){var d=a.x(),e=a.y();l=Ra(d,e);n.setContent(b.main);u(n);n.open();m.open(c,b.main);return g.some(a)}return g.none()},r=function(a){return b.getSelection().bind(function(a){return function(){return ie.selectionContains(a).fold(function(){return D.isText(a.startContainer())?A.parent(a.startContainer()):g.some(a.startContainer())},function(a){return g.some(a)})}().map(function(a){var c=bb.viewport(a);c=b.translateScreen(c.left(),c.top());return nM(a,c.left(),c.top())})})},t=function(a){var c=
a.original();c=oM.isIE()&&10>=oM.version.major?Ra(c.raw().clientX,c.raw().clientY):Ra(c.x(),c.y());c=b.translateScreen(c.left(),c.top());return nM(a.original().target(),c.left(),c.top())},u=function(c){var d=Fh(14,10);d=Pm.makeshift(b,e,l.left(),l.top(),0,0,a.uiDirection(),d);e.show(c,d)},x=function(){n.close();var a=y();z(a.all,function(a){v.set(a,"display","none")});q.end()};n.events.close.bind(function(){m.close()});var y=function(){var a=h.all();return{all:a,main:a[0],submenus:a.slice(1)}};b.events.contextmenu.bind(function(a){var b=
t(a);p(b).orThunk(function(){return r().bind(p)}).each(function(b){a.original().raw().preventDefault()})});c.onShortcut(d.events.context,function(){r().each(p)});m.events.open.bind(function(){var a=h.structure(),b=y();m.update(a);w.registerMenus(b.submenus);u(n);m.setActiveMenu(b.main)});m.events.itemAction.bind(function(a){h.handle(a.item())});m.events.itemHover.bind(function(a){q.begin()});m.events.reveal.bind(function(a){ra.expanded(a.trigger());w.expandMenu(a.menu(),a.trigger(),n);u(n)});m.events.collapse.bind(function(a){w.hideMenu(a.menu());
a.item().each(ra.collapsed)});m.events.itemAction.bind(x);m.events.escaped.bind(function(){x();b.focus()});b.events.mousedown.bind(x);return{register:h.register,destroy:function(){n.destroy();m.destroy()}}},Nv={resolve:Dn("ephox-darwin").resolve},pM=Nv.resolve("selected"),lca="."+pM,qM=Nv.resolve("first-selected"),mca="."+qM,rM=Nv.resolve("last-selected"),nca="."+rM,te={selected:k(pM),selectedSelector:k(lca),firstSelected:k(qM),firstSelectedSelector:k(mca),lastSelected:k(rM),lastSelectedSelector:k(nca)},
QV=function(a){G.empty(a);y.append(a,r.fromTag("br"))},oca=aa.detect().browser,sp=function(a){var b=r.fromHtml("<p><br></p>");y.append(a,b);return g.some(b)},pca=function(a){var b=A.children(a);return 0===b.length?sp(a):1===b.length&&"br"===D.name(b[0])||1===b.length&&D.isText(b[0])&&""===D.value(b[0])?(G.empty(a),sp(a)):g.none()},qca=function(a){return 1===a.dom().childNodes.length?A.firstChild(a).fold(k(!1),function(a){return"br"===D.name(a)&&m.has(a,"_moz_editor_bogus_node")}):!1},rca=function(a){return pca(a).orThunk(function(){if(oca.isFirefox()&&
qca(a)){G.empty(a);var b=sp(a)}else b=g.none();return b})},TV={listen:function(a){a.events.nodeChanged.bind(function(b){var c=b.node();a.body().each(function(b){var d=A.children(b);(a.isRoot(c)||1===d.length)&&rca(b).each(function(b){a.setSelection(b,0,b,0)})})})}},Az={onNodeChange:function(a,b){a.events.nodeChanged.bind(function(c){c.prev().each(function(c){rd.withinTransient(c,c).each(function(c){b.atomic(function(){rd.cleanup(a.isRoot,c)})})})});return{destroy:t}},preLinebreak:function(a){a.getSelection().each(function(b){A.parent(b.startContainer()).each(function(b){rd.withinTransient(b,
b).each(function(b){rd.cleanupNonEmpty(a.isRoot,b)})})})}},xg=function(a,b){b=b.original();b=b.raw().which||b.raw().keycode;return U(a,b)},sca=u(xg,R.ENTER()),tca=u(xg,R.SPACE()),uca=u(xg,R.BACKSPACE()),vca=u(xg,R.DEL()),wca=u(xg,R.LEFT().concat(R.UP())),xca=u(xg,R.RIGHT().concat(R.DOWN())),yca=u(xg,R.TAB()),zca=u(xg,R.ESCAPE()),fe={isEnter:sca,isSpace:tca,isBackspace:uca,isDel:vca,isTab:yca,isLeftOrUp:wca,isRightOrDown:xca,isEscape:zca},sM=function(a,b,c,d){return dc.isCollapsed(a)?b(a.startContainer(),
a.startOffset(),d):c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset(),d)},Bz={soft:function(a,b){return sM(a,av.soft,dv.soft,b)},hard:function(a,b){return sM(a,av.hard,dv.hard,b)}},tM=function(a,b){z(b,function(b){var c=b.find(a);b.cleaner(c,a)})},qm={filterHtml:function(a,b){var c=r.fromTag("div");c.dom().innerHTML=a;tM(c,b);return qn.writeChildren(c)},filterDom:tM},uM=function(a,b){var c=W.point(a,b);return D.isText(a)?uh.scanRight(a,b).getOr(c):c},Ez={handle:function(a){var b=
uM(a.startContainer(),a.startOffset());a=uM(a.endContainer(),a.endOffset());return Sc(b.element(),b.offset(),a.element(),a.offset())}},wh=ta.generate([{onText:["element","offset"]},{firstText:["parent","child","offset"]},{beforeText:["parent","child","offset"]},{afterText:["parent","child"," offset"]},{lastText:["parent","child","offset"]},{onElement:["element","offset"]}]),vM={detect:function(a,b){if(D.isText(a))return wh.onText(a,b);var c=A.children(a);return 0===c.length?wh.onElement(a,b):0===
b&&D.isText(c[0])?(0,wh.firstText)(a,c[0],0):b===c.length&&D.isText(c[c.length-1])?(b=c[b-1],(0,wh.lastText)(a,b,wa.getEnd(b))):b<c.length&&D.isText(c[b])?(0,wh.beforeText)(a,c[b],0):0<b&&D.isText(c[b-1])?(b=c[b],(0,wh.afterText)(a,b,wa.getEnd(b))):wh.onElement(a,b)},cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)}},xh=O("startContainer","startOffset","endContainer","endOffset"),wM={resolve:Lb.create("ephox-newt").resolve}.resolve("cursor-marker"),hl={generator:function(a){var b=null;return{getOrInit:function(){if(null===
b){var c=r.fromTag("span",a.dom());n.add(c,wM);v.set(c,"display","none")}else c=b;return b=c}}},isCursor:function(a){return n.has(a,wM)}},xM=function(a,b){return{element:k(b),backup:ca,restore:function(){var b=xh(a,0,a,0);return g.some(b)}}},yM=function(a){a=A.children(a);return ka(a,zf(hl.isCursor))},Aca=function(a,b){return{element:k(b),backup:ca,restore:function(){var b=yM(a).length;b=xh(a,b,a,b);return g.some(b)}}},Bca=function(a){return A.parent(a).bind(function(b){var c=yM(b);return Va(c,function(b){return N.eq(a,
b)}).map(function(a){return xh(b,a,b,a)})})},Cca=function(a,b){return{backup:function(){y.before(a,b)},restore:function(){var a=A.nextSibling(b);G.remove(b);return a.map(function(a){return Bca(a).getOrThunk(function(){return xh(a,0,a,0)})})},element:k(b)}},Dca={place:function(a,b,c){var d=A.children(a);return 0===d.length?xM(a,c):d.length===b?Aca(a,c):0===b?xM(a,c):b>d.length?Cz(c):Cca(d[b],c)}},zM=function(a,b){return b().fold(function(){return hl.generator(a).getOrInit()},function(a){return a.element()})},
tp=function(a){a=a();a.backup();return g.some(a)},AM=function(a,b){var c=a.or(b),d=b.or(a);return c.bind(function(a){return d.map(function(b){return xh(a.startContainer(),a.startOffset(),b.startContainer(),b.startOffset())})})},Eca=function(a,b,c){var d=g.none(),e=g.none();return{backup:function(){e=tp(b);d=tp(c)},restore:function(){return d.bind(function(a){return e.bind(function(b){var c=a.restore();b=b.restore();return AM(c,b)})})},element:u(zM,a,function(){return e})}},Fca=function(a,b,c){var d=
g.none(),e=g.none();return{backup:function(){d=tp(c);e=tp(b)},restore:function(){return e.bind(function(a){return d.bind(function(b){var c=a.restore();b=b.restore();return AM(b,c)})})},element:u(zM,a,function(){return d})}},Gca=function(a,b,c){return{backup:function(){y.before(b,c)},restore:function(){var b=wc.after(c,a).map(function(a){return xh(a,0,a,0)});G.remove(c);return b},element:k(c)}},BM=function(a,b,c){return{backup:function(){y.after(b,c)},restore:function(){var b=wc.before(c,a).map(function(a){var b=
wa.getEnd(a);return xh(a,b,a,b)});G.remove(c);return b},element:k(c)}},CM={place:function(a,b,c,d){b=ti.split(b,c);return ti.position(b).fold(function(){return Cz(d)},function(b){return Gca(a,b,d)},function(b,c){return BM(a,b,d)},function(b){return BM(a,b,d)})}},Ov=O("result","cursor"),Hca=function(a,b,c){var d=function(b,d,h){return CM.place(a,d,h,c)};return vM.cata(b,function(b,d){return CM.place(a,b,d,c)},d,d,d,d,function(a,b){return Dca.place(a,b,c)})},Pv=function(a,b,c,d){d=d.getOrInit();b=vM.detect(b,
c);return Hca(a,b,d)},DM=function(a,b){a.backup();b=b(a.element());return Ov(b,a.restore())},up={inspect:Pv,runOnRange:function(a,b,c,d,e,f){var h=A.owner(b),g=(id.after(b,c,d,e)?Fca:Eca)(h,function(){return Pv(a,d,e,hl.generator(h))},function(){return Pv(a,b,c,hl.generator(h))});return DM(g,f)},runOnCursor:DM},Ica=function(a,b,c,d,e,f){return up.runOnRange(a,b,e>c?c:e,b,e>c?e:c,f)},Jca=up.runOnRange,EM={point:function(a,b,c,d){var e=A.owner(b);e=hl.generator(e);a=up.inspect(a,b,c,e);return up.runOnCursor(a,
d)},range:function(a,b,c){return(N.eq(b.startContainer(),b.endContainer())?Ica:Jca)(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c)}},Kca=function(a,b){return function(a,d){a=d(b);return Ov(a,g.none())}},Lca=function(a,b){return function(c,d){return EM.point(a,b.startContainer(),b.startOffset(),FM(c,d))}},Mca=function(a,b){return function(c,d){return EM.range(a,b,FM(c,d))}},FM=function(a,b){return function(c){n.add(c,a);return b(c)}},Dz={diagnose:function(a,b){var c=b.startContainer(),
d=b.endContainer(),e=A.owner(c);return ja.inBody(c)&&ja.inBody(d)&&Z.active(e).forall(ja.inBody)?b.collapsed()?Lca(a,b):Mca(a,b):Kca(a,b.startContainer())}},Qv={fold:function(a,b){return Eb(a,function(a,d){return a.bind(function(a){return b(d).map(function(b){return[b].concat(a)})})},J.value([]))}},GM=function(a,b,c){ic(a)&&b.hasOwnProperty(a.label)&&c(b[a.label]);return a},HM={mapGroup:function(a,b){return GM(a,b,function(b){return a.label=b})},mapMenu:function(a,b){return GM(a,b,function(b){b.hasOwnProperty("label")&&
(a.label=b.label);b.hasOwnProperty("menuLabel")&&(a.menuLabel=b.menuLabel)})}},Nca=function(a,b,c){b=b.groups();return b.hasOwnProperty(a)?J.value(b[a]):kf("Unknown group: "+a,["No binding for group: "+a+". Known groups: "+cb(b)])},Oca=function(a,b,c){a=HM.mapGroup(a,c.groupMappings());a=Mb(a)?{label:"",items:a}:a;return J.value(a)},Pca=function(a,b,c,d,e,f){return Qv.fold(b,function(a){return e.item(a,c,d,e,f)}).map(function(b){return{category:a,items:b}})},Qca=function(a,b,c,d,e){b=b.commands();
return b.hasOwnProperty(a)?J.value(b[a]):kf("Unknown command: "+a,["No binding for command: "+a+". Known commands: "+cb(b)])},Sca=function(a,b,c,d,e){return(void 0===a.items?Rca:d.menu)(a,b,c,d,e)},Rca=function(a,b,c,d,e){return void 0===c?kf("You need a custom action factory to use this",[]):c(a)},Tca=function(a){return ob(a,Mb)?J.value(a):Xa(a,Mb)?kf("Menu items must be a single array or an array where every element is an array",["Menu items must be a single array or an array where every element is an array.",
"Contents of menu: "+Nb.stringify(a)]):J.value([a])},IM=eb({group:function(a,b,c,d,e){return(xa(a)?Nca:Oca)(a,b,e).bind(function(a){return Pca(a.label,a.items,b,c,d,e)})},item:function(a,b,c,d,e){return(xa(a)?Qca:Sca)(a,b,c,d,e)},menu:function(a,b,c,d,e){if(void 0===a.label||void 0===a.items||0===a.items.length)return kf("Invalid toolbar configuration for menu",["Invalid menu. Must be an object containing label and items.","Contents of menu: "+Nb.stringify(a)]);var f=HM.mapMenu(a,e.menuMappings()),
h=f.menuLabel?f.menuLabel:f.label;return Tca(f.items).bind(function(a){return Qv.fold(a,function(a){return d.group(a,b,c,d,e)})}).map(function(b){return{name:a.id,textkey:a.label,menuTextkey:h,type:"submenu",contentFocus:!1,enabled:!0,icon:a.icon,commands:b}})}},function(a,b){return function(){if(5!==arguments.length)throw"Incorrect usage of builder ["+b+"]. Only given: "+arguments.length;return a.apply(null,arguments)}}),Uca=function(a){if(void 0===a.items)return kf("Invalid group, no items specified",
["Invalid group, no items specified: "+a.label]);var b=a.items;return Mb(b)?(a=ia(b,function(a,b){return xa(a)||Mb(a)||void 0!==a.label&&Mb(a.items)?[]:["Invalid group at index: "+b+". Must be either a string, an array or an object containing label and items. Was: "+Nb.stringify(a)]}),0===a.length?J.value(b):kf("Invalid toolbar configuration for groups",a)):kf("Invalid toolbar, items is not an array",["Invalid toolbar, items is not an array: "+Nb.stringify(a)])},JM={build:function(a,b,c,d){return Uca(a).bind(function(a){return Qv.fold(a,
function(a){return IM.group(a,b,c,IM,d)})})}},KM=function(){return xc.isSmallTouch()},LM=function(a,b){return{feature:a.feature,command:a.command,type:"pre_flatmenu",items:b}},ir={shouldFlatten:KM,never:k("never_flatten"),streamline:function(a){var b=function(a){return ia(a,function(a){return"never_flatten"===a.flatten?[a]:"submenu"===a.type?ia(a.commands,function(a){return b(a.items)}):"pre_flatmenu"===a.type?E(a.items,function(b){return{feature:a.feature,type:"general",command:b}}):[a]})};return E(a,
function(a){var c=b(a.items);return{category:a.category,items:c}})},setup:function(a,b){b=LM(a,b);return xc.choice([{predicate:KM,value:k(b)}],a)},make:LM},zj=function(a,b){return{predicate:a,value:k(b)}},MM=function(){return{make:function(a){var b=function(b){return kf(x.translate("errors.toolbar.missing.custom.string",b),['The required property "'+b+'" for a custom command must be a string. It was: '+Nb.stringify(a[b]),"Properties specified in custom command: "+cb(a).join(", "),"Definition specified for custom command: "+
Nb.stringify(a)])};if(!xa(a.id))return b("id");if(!xa(a.text))return b("text");b={};b[a.id]=k({general:function(){return{toggle:!1,value:Hn.cssSanitise(a.id),textkey:x.raw(a.text),action:a.action,updateGeneral:ca,icon:void 0!==a.icon?a.icon:!1}}});return J.value({feature:g.some(b),command:a.id,type:"general"})}}}(),Vca=function(a,b){return a.bind(function(a){return b.map(function(b){return a.concat(b)})})},NM={groupMappings:k({"group.undo":"category.undo","group.insert":"category.insert","group.style":"category.style",
"group.language":"category.language","group.emphasis":"category.emphasis","group.align":"category.align","group.listindent":"category.listindent","group.format":"category.format","group.tools":"category.tools","group.table":"category.table","group.image":"category.image"}),menuMappings:k({"menu.insert":{label:"insert.menu-button",menuLabel:"insert.menu"},"menu.font":{label:"font.menu-button",menuLabel:"font.menu"}})},Aj={config:function(a,b,c){return function(d,e,f,h){d=fW(d,e,f,h,c);d=oa(d,b);h=
{"table-tools":{feature:h.table().ui(),command:"cell",type:"palette"},"image-tools":{feature:h.imageEdit().ui(),command:"edit",type:"palette"},"crop-tools":{feature:h.imageEdit().ui(),command:"crop",type:"palette"}};d={forItems:k({commands:k(d),groups:Gz}),forContextual:k({commands:k(h),groups:Gz})};h=JM.build({items:a.items},d.forItems(),MM.make,NM);d=JM.build({items:a.contextual},d.forContextual(),MM.make,NM);e=aa.detect().deviceType.isTouch()?ir.streamline:ca;return Vca(h,d).map(e)}}},Wca=function(a){return function(a){setTimeout(function(){a()},
0)}},Xca={resume:function(a){a.focus();var b=r.fromDom(a.document.body);(Z.active().exists(function(a){return U(["input","textarea"],D.name(a))})?Wca(b):xb)(function(){Z.active().each(Z.blur);Z.focus(b)})}},vp={safeParse:function(a,b){a=parseInt(m.get(a,b),10);return isNaN(a)?0:a}},Yca=function(a){return{left:a.left,top:a.top,width:2,height:a.height}},Zca=function(a){if(a.collapsed){var b=r.fromDom(a.startContainer);return A.parent(b).bind(function(c){c=Lc.exact(b,a.startOffset,c,wa.getEnd(c));return Wa.getFirstRect(a.startContainer.ownerDocument.defaultView,
c).map(function(a){return eb(a,xb)}).map(Yca).map(HB)}).getOr([])}return a.getClientRects()},lr={getRectangles:function(a){a=a.getSelection();return void 0!==a&&0<a.rangeCount?Zca(a.getRangeAt(0)):[]}},ue={resolve:Lb.create("ephox-nomad").resolve},Rv="data-"+ue.resolve("last-outer-height"),$ca=function(a){return{top:k(a.top),bottom:k(a.top+a.height)}},ada=function(a){a=lr.getRectangles(a);return 0<a.length?g.some(a[0]).map($ca):g.none()},bda=function(a){a=vp.safeParse(a,Rv);var b=window.innerHeight;
return a>b?g.some(a-b):g.none()},jW={setup:function(a,b){var c=r.fromDom(b.document.body),d=K.bind(r.fromDom(a),"resize",function(){bda(c).each(function(a){ada(b).each(function(c){c=c.top()>b.innerHeight||c.bottom()>b.innerHeight?Math.min(a,c.bottom()-b.innerHeight+50):0;0!==c&&b.scrollTo(b.pageXOffset,b.pageYOffset+c)})});m.set(c,Rv,window.innerHeight)});m.set(c,Rv,window.innerHeight);return{toEditing:function(){Xca.resume(b)},destroy:function(){d.unbind()}}}},OM=function(a){var b=new (Kc.getOrDie("Event"))("Event");
b.initEvent(a,!0,!0);return b},Hz={event:function(a,b){b=OM(b);a.target().dom().dispatchEvent(b)},target:function(a,b){b=OM(b);a.dom().dispatchEvent(b)}},PM=function(){var a=window.matchMedia("(orientation: portrait)").matches;return{isPortrait:k(a)}},Jh={get:PM,onChange:function(){var a=H.create({ready:p(["orientation"]),change:p(["orientation"])}),b=r.fromDom(window),c=null,d=K.bind(b,"orientationchange",function(){clearInterval(c);var b=PM();a.trigger.change(b);e(function(){a.trigger.ready(b)})}),
e=function(a){clearInterval(c);var b=window.innerHeight,d=0;c=setInterval(function(){b!==window.innerHeight?(clearInterval(c),a(g.some(window.innerHeight))):20<d&&(clearInterval(c),a(g.none()));d++},50)};return{onAdjustment:e,events:a.registry,destroy:function(){d.unbind()}}}},Jz={tag:function(){var a=L.first("head").getOrDie(),b=L.first('meta[name="viewport"]').getOrThunk(function(){var b=r.fromTag("meta");m.set(b,"name","viewport");y.append(a,b);return b}),c=m.get(b,"content");return{maximize:function(){m.set(b,
"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){void 0!==c&&null!==c&&0<c.length?m.set(b,"content",c):m.remove(b,"content")}}}},QM=function(a,b){a=Ia.get(a);return Math.floor(b/100*a)},RM=function(a,b){return L.ancestor(b,"td,th").fold(function(){return QM(a,98)},function(a){return QM(a,94)})},cda=function(a,b,c){var d=b.dom().width;a=RM(a,b);return Math.max(0,Math.min(a,d+c))},dda=function(a,b,c){return b.dom().height+c},jr={compare:function(a,
b){var c=b.deltaX()-a.deltaX(),d=b.deltaY()-a.deltaY();a=b.deltaDistance()-a.deltaDistance();return{deltaX:k(c),deltaY:k(d),deltaDistance:k(a)}},extract:function(a){var b=a.raw().touches;if(2>b.length)return g.none();a=Math.abs(b[0].clientX-b[1].clientX);b=Math.abs(b[0].clientY-b[1].clientY);var c=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));return g.some({deltaX:k(a),deltaY:k(b),deltaDistance:k(c)})},resize:function(a,b,c){var d=v.getRaw(b,"height"),e=v.getRaw(b,"width"),f=0<c.deltaDistance()?1:-1,h=f*
Math.abs(c.deltaX()),g=f*Math.abs(c.deltaY());c=cda(a,b,h);f=dda(a,b,g);h=Math.abs(h)>Math.abs(g);v.setAll(b,{height:h?"auto":f+"px",width:h?c+"px":"auto",transform:"translate3d(0, 0, 0)"});Ia.get(b)>RM(a,b)&&(d.each(function(a){v.set(b,"height",a)}),e.each(function(a){v.set(b,"width",a)}))}},iW=6<=aa.detect().os.version.major,eda=function(a){return a.body().map(function(a){a=v.get(a,"background-color");return void 0!==a&&""!==a?"background-color:"+a+"!important":"background-color:rgb(255,255,255)!important;"}).getOr("background-color:rgb(255,255,255)!important;")},
Mz={clobberStyles:function(a,b){var c=function(a){return function(b){var c=m.get(b,"style");c=void 0===c?"no-styles":c.trim();c!==a&&(m.set(b,"data-ephox-mobile-fullscreen-style",c),m.set(b,"style",a))}};a=Y.ancestors(a,"*");var d=ia(a,function(a){return Y.siblings(a,"*")});b=eda(b);z(d,c("display:none!important;"));z(a,c("position:absolute!important;top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;"+b))},
restoreStyles:function(){var a=Y.all("[data-ephox-mobile-fullscreen-style]");z(a,function(a){var b=m.get(a,"data-ephox-mobile-fullscreen-style");"no-styles"!==b?m.set(a,"style",b):m.remove(a,"style");m.remove(a,"data-ephox-mobile-fullscreen-style")})}},SM={input:function(a,b){var c=r.fromTag("input");v.setAll(c,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"});y.append(a,c);Z.focus(c);b(c);G.remove(c)}},rr={refreshInput:function(a){var b=a.dom().selectionStart,c=a.dom().selectionEnd,
d=a.dom().selectionDirection;setTimeout(function(){a.dom().setSelectionRange(b,c,d);Z.focus(a)},50)},refresh:function(a){var b=a.getSelection();if(0<b.rangeCount){var c=b.getRangeAt(0);a=a.document.createRange();a.setStart(c.startContainer,c.startOffset);a.setEnd(c.endContainer,c.endOffset);b.removeAllRanges();b.addRange(a)}}},kr={resume:function(a,b){Z.active().each(function(a){N.eq(a,b)||Z.blur(a)});a.focus();Z.focus(r.fromDom(a.document.body));rr.refresh(a)}},tW={stubborn:function(a,b,c,d,e){var f=
rm(e),h=function(){kr.resume(a,c)},g=K.bind(b,"keydown",function(a){U(["input","textarea"],D.name(a.target()))||(f.closeMenus(void 0),h())});return{toReading:function(){SM.input(ja.body(),Z.blur)},toEditing:h,onToolbarTouch:function(a){},destroy:function(){g.unbind()}}},timid:function(a,b,c,d,e){return{toReading:function(){Z.blur(c)},toEditing:function(){kr.resume(a,c)},onToolbarTouch:function(){Z.blur(c)},destroy:t}}},fda={touch:function(a){var b=H.create({touchstart:p(["raw"]),touchend:p(["raw"])}),
c=!1,d=g.none(),e=K.capture(a,"touchstart",function(e){c=!0;d=g.some(K.capture(a,"touchend",function(a){c=!1;b.trigger.touchend(a.raw());f()}));b.trigger.touchstart(e.raw())}),f=function(){d.each(function(a){a.unbind()})};return{isTouching:function(){return c},events:b.registry,destroy:function(){e.unbind();f()}}}},gda=function(a){a=A.documentElement(a);var b=ue.resolve("unfocused-selection");return L.descendant(a,"."+b).map(function(a){return bb.absolute(a).top})},Sv={toFake:function(a,b,c){var d=
c.isActive,e=!1;return{on:function(){d()||(e=!1,c.update(),b.save(),Wa.clear(a))},off:function(){d()&&!e&&(c.clear(),b.restore())},fakeOut:function(){e=!0;SM.input(ja.body(),b.restore)}}},inView:function(a,b,c){return function(){return gda(b).map(function(b){var c=a.dom().scrollTop;return 0<b()-c})}},onScroll:function(a,b,c,d){var e=function(){a()||f()},f=function(){d.events.touchend.unbind(e);d.isTouching()?d.events.touchend.bind(e):(c().getOr(!0)?b.off:b.fakeOut)()};return{start:function(){d.events.touchend.unbind(e);
b.on()},stop:f,destroy:function(){d.events.touchend.unbind(e)}}}},TM=function(a,b){return yc([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(c){return a<=c.width&&b<=c.height?
g.some(c.keyboard):g.none()}).getOr({portrait:b/5,landscape:a/4})}(window.screen.width,window.screen.height),UM=function(a){a=sa.get(a);var b=Jh.get().isPortrait(),c=b?TM.portrait:TM.landscape;return a-((b?window.screen.height:window.screen.width)-window.innerHeight>c?0:c)},Tv={getGreenzone:UM,updatePadding:function(a,b){var c=UM(b);b=sa.get(b)-c;v.set(a,"padding-bottom",b+"px")}},VM=ta.generate([{fixed:["element","offsetY"]},{scroller:["element","offsetY"]}]),yg="data-"+ue.resolve("position-y-fixed"),
Uv="data-"+ue.resolve("scrolling"),WM="data-"+ue.resolve("last-window-height"),XM=function(a){return vp.safeParse(a,yg)},hda=function(a){var b=XM(a);return("true"===m.get(a,Uv)?VM.scroller:VM.fixed)(a,b)},ida=function(a){var b=m.get(a,"style");v.setAll(a,{position:"absolute",top:"0px"});m.set(a,yg,"0px");return{restore:function(){m.set(a,"style",b||"");m.remove(a,yg)}}},jda=function(a,b,c){var d=m.get(c,"style");Vc.register(c);v.setAll(c,{position:"absolute",height:b+"px",width:"100%",top:a+"px"});
m.set(c,yg,a+"px");m.set(c,Uv,"true");return{restore:function(){Vc.deregister(c);m.set(c,"style",d||"");m.remove(c,yg);m.remove(c,Uv)}}},YM=function(a,b){var c=window.innerHeight;m.set(a,WM,c+"px");return c-b},Vv={findFixtures:function(a){a=Y.descendants(a,"["+yg+"]");return E(a,hda)},takeover:function(a,b,c){var d=ida(c),e=sa.get(c),f=YM(a,e),h=jda(e,f,a);e=function(){var b=window.innerHeight,c=vp.safeParse(a,WM);return b>c};var g=function(){var d=sa.get(c),e=YM(a,d);m.set(a,yg,d+"px");v.set(a,"height",
e+"px");Tv.updatePadding(b,a)};Tv.updatePadding(b,a);return{setViewportOffset:function(b){m.set(a,yg,b+"px");g()},isExpanding:e,isShrinking:zf(e),refresh:g,restore:function(){d.restore();h.restore()}}},getYFixedData:XM},kda=function(a,b,c){return Math.abs(a-b)<=c?g.none():a<b?g.some(a+c):g.some(a-c)},wp=function(){var a=null;return{animate:function(b,c,d,e,f,h){clearInterval(a);var g=function(b){clearInterval(a);f(b)};a=setInterval(function(){var h=b();kda(h,c,d).fold(function(){clearInterval(a);
f(c)},function(d){e(d,g);var k=b();if(k!==d||Math.abs(k-c)>Math.abs(h-c))clearInterval(a),f(c)})},h)}}}(),xp="data-"+ue.resolve("last-scroll-top"),ZM=function(a){return v.getRaw(a,"top").map(function(a){return parseInt(a,10)}).getOr(0)},$M=function(a){return parseInt(a.dom().scrollTop,10)},aN=function(a,b){b=b+Vv.getYFixedData(a)+"px";v.set(a,"top",b)},il={moveScrollAndTop:function(a,b,c){return Ga.nu(function(d){var e=u($M,a);wp.animate(e,b,15,function(b){a.dom().scrollTop=b;v.set(a,"top",ZM(a)+
15+"px")},function(e){a.dom().scrollTop=b;v.set(a,"top",c+"px");d(b)},10)})},moveOnlyScroll:function(a,b){return Ga.nu(function(c){var d=u($M,a);m.set(a,xp,d());var e=Math.abs(b-d());wp.animate(d,b,Math.ceil(e/10),function(b,c){vp.safeParse(a,xp)!==a.dom().scrollTop?c(a.dom().scrollTop):(a.dom().scrollTop=b,m.set(a,xp,b))},function(d){a.dom().scrollTop=b;m.set(a,xp,b);c(b)},10)})},moveOnlyTop:function(a,b){return Ga.nu(function(c){var d=u(ZM,a),e=function(b){v.set(a,"top",b+"px")},f=Math.abs(b-d());
wp.animate(d,b,Math.ceil(f/10),e,function(a){e(b);c(b)},10)})},moveWindowScroll:function(a,b,c){return Ga.nu(function(d){var e=function(c){aN(a,c);aN(b,c);window.scrollTo(0,c)};wp.animate(function(){return window.pageYOffset},c,15,e,function(a){e(a);d(a)},10)})}},lda={scrollIntoView:function(a,b,c,d){var e=Tv.getGreenzone(b);a=u(rr.refresh,a);c>e||d>e?il.moveOnlyScroll(b,b.dom().scrollTop-e+d).get(a):0>c&&il.moveOnlyScroll(b,b.dom().scrollTop+c).get(a)}},mda=function(a,b){return a.fold(function(a,
d){v.set(a,"top",b+d+"px");return Ga.pure(d)},function(a,d){var c=b+d;d=v.getRaw(a,"top").getOr(d);d=c-parseInt(d,10);d=a.dom().scrollTop+d;return il.moveScrollAndTop(a,d,c)})},bN={updatePositions:function(a,b){a=Vv.findFixtures(a);a=E(a,function(a){return mda(a,b)});return Rl(a,Ga.nu)}},nda=function(a,b,c,d,e,f){var h=pW(function(c){return il.moveWindowScroll(a,b,c)}),l=function(){var a=lr.getRectangles(f);return g.from(a[0]).bind(function(a){var c=a.top-b.dom().scrollTop;return c>window.innerHeight+
5||-5>c?g.some({top:k(c),bottom:k(c+a.height)}):g.none()})},q=jf(function(){h.idle(function(){bN.updatePositions(c,d.pageYOffset).get(function(a){l().each(function(a){b.dom().scrollTop=b.dom().scrollTop+a.top()});h.start(0);e.refresh()})})},1E3),m=K.bind(r.fromDom(d),"scroll",function(){0>d.pageYOffset||q.throttle()});bN.updatePositions(c,d.pageYOffset).get(ca);return{unbind:m.unbind}},sW={setup:function(a){var b=a.cWin(),c=a.ceBody(),d=a.socket(),e=a.toolstrip(),f=a.toolbar(),h=a.contentElement(),
g=a.cursor(),k=a.keyboardType();a=a.isScrolling();var m=Vv.takeover(d,c,e),w=k(b,ja.body(),h,e,f),n=Jh.onChange();n.events.ready.bind(m.refresh);n.onAdjustment(function(){m.refresh()});var p=K.bind(r.fromDom(window),"resize",function(){m.isExpanding()&&m.refresh()}),u=nda(e,d,ja.body(),window,m,b),x=oW(b,h),y=function(){x.clear()};e=Sv.toFake(b,g,x);c=Sv.inView(d,c,f);var z=fda.touch(r.fromDom(b)),A=Sv.onScroll(a,e,c,z);return{toEditing:function(){w.toEditing();y()},toReading:function(){w.toReading()},
onToolbarTouch:function(a){w.onToolbarTouch(a)},refreshSelection:function(){x.isActive()&&x.update()},clearSelection:y,highlightSelection:function(){x.update()},scrollIntoView:function(a,c){lda.scrollIntoView(b,d,a,c)},updateToolbarPadding:t,setViewportOffset:function(a){m.setViewportOffset(a);il.moveOnlyTop(d,a).get(ca)},syncHeight:function(){v.set(h,"height",h.dom().contentWindow.document.body.scrollHeight+"px")},selectionScrollStarted:function(){A.start()},selectionScrollStopped:function(){A.stop()},
destroy:function(){m.restore();n.destroy();u.unbind();p.unbind();w.destroy();A.destroy();z.destroy();x.destroy()}}}},cN="data-"+ue.resolve("horizontal-scroll"),oda=function(a){var b;(b=0<a.dom().scrollTop)||(a.dom().scrollTop=1,b=0!==a.dom().scrollTop,a.dom().scrollTop=0);return b},pda=function(a){var b;(b=0<a.dom().scrollLeft)||(a.dom().scrollLeft=1,b=0!==a.dom().scrollLeft,a.dom().scrollLeft=0);return b},dN={markAsHorizontal:function(a){m.set(a,cN,"true")},hasScroll:function(a){return"true"===m.get(a,
cN)?pda:oda}},qda=function(a){var b=a.dom().scrollTop,c=a.dom().scrollHeight;a=a.dom().offsetHeight;return 0>=b?g.some(1):b+a>=c?g.some(c-a-1):g.none()},eN=function(a){qda(a).each(function(b){a.dom().scrollTop=b})},Wv=function(a,b){return K.bind(a,"touchstart",function(a){b(a.target()).each(eN)})},Oz={fixEdges:eN,exclusive:function(a,b){return K.bind(a,"touchmove",function(a){L.closest(a.target(),b).filter(dN.hasScroll).fold(function(){a.raw().preventDefault()},t)})},link:function(a,b){return Wv(a,
k(b))},ancestor:function(a,b){return Wv(a,function(a){return L.closest(a,b)})},indirect:Wv,markAsHorizontal:function(a){dN.markAsHorizontal(a)}},fN=function(a){return r.fromText(mb(),a.dom())},gN={runAndRemove:function(a,b){var c=A.owner(a),d=r.fromTag("span",c.dom());y.append(d,fN(c));y.prepend(a,d);a=b(d);G.remove(d);return a},enrichAndRemove:function(a,b){var c=fN(A.owner(a));y.append(a,c);a=b(a);G.remove(c);return a}},yp=O("left","top","width","height","direction","absolute"),hN=function(a){return{position:k(pk.find(a)),
width:k(Ia.getOuter(a)),height:k(sa.getOuter(a))}},rda=function(a){var b=v.get(a,"display");return{backup:function(){v.set(a,"display","inline-block")},restore:function(){v.set(a,"display",b)}}},sda={backup:t,restore:t},tda=function(a){return D.isElement(a.startContainer())?g.some(a.startContainer()):D.isElement(a.endContainer())?g.some(a.endContainer()):A.parent(a.startContainer()).filter(D.isElement).orThunk(function(){return A.parent(a.endContainer()).filter(D.isElement)})},uda=function(a,b){return tda(b).fold(function(){return yp(0,
0,0,a.uiDirection(),Ra(0,0))},function(b){var c=pk.find(b),e=Ia.get(b),f=sa.get(b),h=bb.absolute(b);return yp(c.left(),c.top(),e,f,a.directionAt(b),h)})},vda=function(a,b,c,d){return Dz.diagnose(a,c)(d,function(a){var d=sc.isVisible(a)||"br"===D.name(a)?sda:rda(a);d.backup();if(ja.inBody(a)){var e=gN.enrichAndRemove(a,hN);var g=e.position();var k=e.width();e=e.height();var m=b.directionAt(a);a=bb.absolute(a);g=yp(g.left(),g.top(),k,e,m,a)}else g=uda(b,c);d.restore();return g})},wda=function(a,b,c,
d){var e=c.startContainer(),f=c.startOffset();if("body"===D.name(e)&&0===f){var h=c.startContainer();a=parseInt(v.get(h,"padding-top"),10);d=parseInt(v.get(h,"padding-left"),10);var k=gN.runAndRemove(h,hN);e=k.position();f=k.width();k=k.height();b=b.directionAt(h);h=bb.absolute(h);c=Ov(yp(e.left()+d,e.top()+a,f,k,b,h),g.some(c))}else c=vda(a,b,c,d);return c},iN=function(a,b,c,d,e){b.focus();a=wda(b.isRoot,a,c,e);a.cursor().each(function(a){b.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),
a.endOffset())});a=a.result();d(a)},Nz={insertAt:iN,insertAtCursor:function(a,b,c,d){b.getSelection().each(function(e){iN(a,b,e,c,d)})}},Qz=aa.detect(),jN=function(){try{var a=Xf.localStorage;a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return g.some(a)}catch(b){return g.none()}}().fold(function(){var a={};return{getItem:function(b){return a[b]},setItem:function(b,c){a[b]=c}}},function(a){return{getItem:function(b){return a.getItem("ephox.textboxio."+b)},setItem:function(b,
c){a.setItem("ephox.textboxio."+b,c)}}}),kN=function(a,b){return g.from(jN.getItem(a)).map(Nb.parse).getOr(b)},lN=function(a){return kN(a,{})},mN=function(a,b){b=Nb.stringify(b);jN.setItem(a,b)},um={read:lN,readOr:kN,write:mN,access:function(a){return{read:u(lN,a),write:u(mN,a)}}},nN=function(a,b,c){b.body().each(function(d){c.save();var e=r.fromHtml(mb());a(d,e);b.setSelection(e,0,e,0)})},Rz={upOrLeft:function(a,b,c){a.setRelativeSelection(la.before(c),la.before(c));a.getSelection().fold(function(){nN(y.prepend,
a,b)},t)},right:function(a,b,c){a.setRelativeSelection(la.after(c),la.after(c));a.getSelection().fold(function(){nN(y.append,a,b)},t)}},Cj={left:function(a,b,c){return a(b)&&wa.isStart(b,c)?g.none():wa.isStart(b,c)?wc.before(b,a).filter(function(a){return!Db.ancestor(a,"head")}):a(b)&&0<c?A.child(b,c-1):g.none()},right:function(a,b,c){return a(b)&&wa.isEnd(b,c)?g.none():wa.isEnd(b,c)?wc.after(b,a).filter(function(b){return a(b)||Db.ancestor(b,"body")}):a(b)&&c<wa.getEnd(b)?A.child(b,c+1):g.none()},
isFirstInContent:function(a,b){return a.body().map(function(a){a=A.children(a);return N.eq(a[0],b)}).getOr(!1)},isLastInContent:function(a,b){return a.body().map(function(a){a=A.children(a);return 0<a.length&&N.eq(a[a.length-1],b)}).getOr(!1)}},xda=function(a,b){return a.getSelection().bind(function(c){return c.collapsed()?b(a.isRoot,c.startContainer(),c.startOffset()):g.none()})},yda=function(a,b){return Eb(a,function(a,d){return d(b).or(a)},g.none())},mr={get:function(a,b,c){return xda(a,c).bind(function(a){return yda(b,
a)})}},Ni={response:O("selection","kill")},Oi=function(a){return function(b){return b===a}},zda=Oi(38),Ada=Oi(40),Nd={ltr:{isBackward:Oi(37),isForward:Oi(39)},rtl:{isBackward:Oi(39),isForward:Oi(37)},isUp:zda,isDown:Ada,isNavigation:function(a){return 37<=a&&40>=a}},Kh={convertToRange:function(a,b){a=Le.asLtrRange(a,b);return{start:k(r.fromDom(a.startContainer)),soffset:k(a.startOffset),finish:k(r.fromDom(a.endContainer)),foffset:k(a.endOffset)}},makeSitus:function(a,b,c,d){return{start:k(la.on(a,
b)),finish:k(la.on(c,d))}}},oN=function(a,b){return b.column()>=a.startCol()&&b.column()+b.colspan()-1<=a.finishCol()&&b.row()>=a.startRow()&&b.row()+b.rowspan()-1<=a.finishRow()},pN={inSelection:function(a,b){var c=b.column(),d=b.column()+b.colspan()-1,e=b.row();b=b.row()+b.rowspan()-1;return c<=a.finishCol()&&d>=a.startCol()&&e<=a.finishRow()&&b>=a.startRow()},isWithin:oN,isRectangular:function(a,b){for(var c=!0,d=u(oN,b),e=b.startRow();e<=b.finishRow();e++)for(var f=b.startCol();f<=b.finishCol();f++)c=
c&&Ib.getAt(a,e,f).exists(d);return c?g.some(b):g.none()}},qN=function(a,b,c){b=Ib.findItem(a,b,N.eq);var d=Ib.findItem(a,c,N.eq);return b.bind(function(a){return d.map(function(b){return Oa.bounds(Math.min(a.row(),b.row()),Math.min(a.column(),b.column()),Math.max(a.row()+a.rowspan()-1,b.row()+b.rowspan()-1),Math.max(a.column()+a.colspan()-1,b.column()+b.colspan()-1))})})},rN={getAnyBox:qN,getBox:function(a,b,c){return qN(a,b,c).bind(function(b){return pN.isRectangular(a,b)})}},jl={moveBy:function(a,
b,c,d){return Ib.findItem(a,b,N.eq).bind(function(b){var e=0<c?b.row()+b.rowspan()-1:b.row();b=0<d?b.column()+b.colspan()-1:b.column();return Ib.getAt(a,e+c,b+d).map(function(a){return a.element()})})},intercepts:function(a,b,c){return rN.getAnyBox(a,b,c).map(function(b){b=Ib.filterItems(a,u(pN.inSelection,b));return E(b,function(a){return a.element()})})},parentCell:function(a,b){return Ib.findItem(a,b,function(a,b){return N.contains(b,a)}).bind(function(a){return a.element()})}},zp=function(a){a=
hg.fromTable(a);return Ib.generate(a)},Pi={moveBy:function(a,b,c){return sb.table(a).bind(function(d){d=zp(d);return jl.moveBy(d,a,b,c)})},intercepts:function(a,b,c){a=zp(a);return jl.intercepts(a,b,c)},nestedIntercepts:function(a,b,c,d,e){var f=zp(a);b=N.eq(a,c)?b:jl.parentCell(f,b);a=N.eq(a,e)?d:jl.parentCell(f,d);return jl.intercepts(f,b,a)},getBox:function(a,b,c){a=zp(a);return rN.getBox(a,b,c)}},Xv=function(a,b){return L.ancestor(a,"table")},kl=Aa(["boxes","start","finish"],[]),sN=function(a,
b,c){var d=function(a){return function(b){return c(b)||N.eq(b,a)}};return N.eq(a,b)?g.some(kl({boxes:g.some([a]),start:a,finish:b})):Xv(a,c).bind(function(e){return Xv(b,c).bind(function(f){if(N.eq(e,f))return g.some(kl({boxes:Pi.intercepts(e,a,b),start:a,finish:b}));if(N.contains(e,f)){var h=Y.ancestors(b,"td,th",d(e));h=0<h.length?h[h.length-1]:b;return g.some(kl({boxes:Pi.nestedIntercepts(e,a,e,b,f),start:a,finish:h}))}return N.contains(f,e)?(h=Y.ancestors(a,"td,th",d(f)),h=0<h.length?h[h.length-
1]:a,g.some(kl({boxes:Pi.nestedIntercepts(f,a,e,b,f),start:a,finish:h}))):nf.ancestors(a,b).shared().bind(function(h){return L.closest(h,"table",c).bind(function(c){var h=Y.ancestors(b,"td,th",d(c));h=0<h.length?h[h.length-1]:b;var k=Y.ancestors(a,"td,th",d(c));k=0<k.length?k[k.length-1]:a;return g.some(kl({boxes:Pi.nestedIntercepts(c,a,e,b,f),start:k,finish:h}))})})})})},Bda=function(a,b){return qa(a,function(a){return Fa.is(a,b)})},Cda=function(a,b){return L.ancestor(a,"table").bind(function(c){return L.descendant(c,
b).bind(function(b){return sN(b,a).bind(function(a){return a.boxes().map(function(b){return{boxes:k(b),start:k(a.start()),finish:k(a.finish())}})})})})},Sf={identify:sN,retrieve:function(a,b){a=Y.descendants(a,b);return 0<a.length?g.some(a):g.none()},shiftSelection:function(a,b,c,d,e){return Bda(a,e).bind(function(a){return Pi.moveBy(a,b,c).bind(function(a){return Cda(a,d)})})},getEdges:function(a,b,c){return L.descendant(a,b).bind(function(b){return L.descendant(a,c).bind(function(a){return nf.sharedOne(Xv,
[b,a]).map(function(c){return{first:k(b),last:k(a),table:k(c)}})})})}},tN=function(a,b,c,d,e){return N.eq(c,d)?g.none():Sf.identify(c,d,b).bind(function(b){var d=b.boxes().getOr([]);return 0<d.length?(e(a,d,b.start(),b.finish()),g.some(Ni.response(g.some(Kh.makeSitus(c,0,c,wa.getEnd(c))),!0))):g.none()})},Yv={sync:function(a,b,c,d,e,f,h){return N.eq(c,e)&&d===f?g.none():L.closest(c,"td,th",b).bind(function(c){return L.closest(e,"td,th",b).bind(function(d){return tN(a,b,c,d,h)})})},detect:tN,update:function(a,
b,c,d,e){return Sf.shiftSelection(d,a,b,e.firstSelectedSelector(),e.lastSelectedSelector()).map(function(a){e.clear(c);e.selectRange(c,a.boxes(),a.start(),a.finish());return a.boxes()})}},Qi=Aa(["left","top","right","bottom"],[]),Ed={nu:Qi,moveUp:function(a,b){return Qi({left:a.left(),top:a.top()-b,right:a.right(),bottom:a.bottom()-b})},moveDown:function(a,b){return Qi({left:a.left(),top:a.top()+b,right:a.right(),bottom:a.bottom()+b})},moveBottomTo:function(a,b){var c=a.bottom()-a.top();return Qi({left:a.left(),
top:b-c,right:a.right(),bottom:b})},moveTopTo:function(a,b){var c=a.bottom()-a.top();return Qi({left:a.left(),top:b,right:a.right(),bottom:b+c})},getTop:function(a){return a.top()},getBottom:function(a){return a.bottom()},translate:function(a,b,c){return Qi({left:a.left()+b,top:a.top()+c,right:a.right()+b,bottom:a.bottom()+c})},toString:function(a){return"("+a.left()+", "+a.top()+") -> ("+a.right()+", "+a.bottom()+")"}},Ap=function(a){return Ed.nu({left:a.left,top:a.top,right:a.right,bottom:a.bottom})},
Bp={getBoxAt:function(a,b,c){return D.isElement(b)?g.some(a.getRect(b)).map(Ap):D.isText(b)?(a=0<=c&&c<wa.getEnd(b)?a.getRangedRect(b,c,b,c+1):0<c?a.getRangedRect(b,c-1,b,c):g.none(),a.map(Ap)):g.none()},getEntireBox:function(a,b){return D.isElement(b)?g.some(a.getRect(b)).map(Ap):D.isText(b)?a.getRangedRect(b,0,b,wa.getEnd(b)).map(Ap):g.none()}},Qe=ta.generate([{none:[]},{retry:["caret"]}]),uN=function(a,b,c){return Ja.closest(b,pa.isBlock).fold(k(!1),function(b){return Bp.getEntireBox(a,b).exists(function(a){return c.left()<
a.left()||1>Math.abs(a.right()-c.left())||c.left()>a.right()})})},Dda={point:Ed.getBottom,adjuster:function(a,b,c,d,e){var f=Ed.moveDown(e,5);return 1>Math.abs(c.bottom()-d.bottom())?Qe.retry(f):c.top()>e.bottom()?Qe.retry(f):c.top()===e.bottom()?Qe.retry(Ed.moveDown(e,1)):uN(a,b,e)?Qe.retry(Ed.translate(f,5,0)):Qe.none()},move:Ed.moveDown,gather:wc.after},Eda=function(a,b,c){return a.elementFromPoint(b,c).filter(function(a){return"table"===D.name(a)}).isSome()},Fda=function(a,b,c,d,e){return Zv(a,
b,c,b.move(d,5),e)},Zv=function(a,b,c,d,e){return 0===e?g.some(d):Eda(a,d.left(),b.point(d))?Fda(a,b,c,d,e-1):a.situsFromPoint(d.left(),b.point(d)).bind(function(f){return f.start().fold(g.none,function(f,k){return Bp.getEntireBox(a,f,k).bind(function(h){return b.adjuster(a,f,h,c,d).fold(g.none,function(d){return Zv(a,b,c,d,e-1)})}).orThunk(function(){return g.some(d)})},g.none)})},Gda=function(a,b,c){return a.point(b)>c.getInnerHeight()?g.some(a.point(b)-c.getInnerHeight()):0>a.point(b)?g.some(-a.point(b)):
g.none()},vN=function(a,b,c){var d=a.move(c,5),e=Zv(b,a,c,d,100).getOr(d);return Gda(a,e,b).fold(function(){return b.situsFromPoint(e.left(),a.point(e))},function(c){b.scrollBy(0,c);return b.situsFromPoint(e.left(),a.point(e)-c)})},ll={tryUp:u(vN,{point:Ed.getTop,adjuster:function(a,b,c,d,e){var f=Ed.moveUp(e,5);return 1>Math.abs(c.top()-d.top())?Qe.retry(f):c.bottom()<e.top()?Qe.retry(f):c.bottom()===e.top()?Qe.retry(Ed.moveUp(e,1)):uN(a,b,e)?Qe.retry(Ed.translate(f,5,0)):Qe.none()},move:Ed.moveUp,
gather:wc.before}),tryDown:u(vN,Dda),ieTryUp:function(a,b){return a.situsFromPoint(b.left(),b.top()-5)},ieTryDown:function(a,b){return a.situsFromPoint(b.left(),b.bottom()+5)},getJumpSize:k(5)},Cp=ta.generate([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Hda=function(a){return L.closest(a,"tr")},Ri={verify:function(a,b,c,d,e,f,h){return L.closest(d,"td,th",h).bind(function(c){return L.closest(b,"td,th",h).map(function(b){return N.eq(c,b)?N.eq(d,c)&&wa.getEnd(c)===e?
f(b):Cp.none("in same cell"):nf.sharedOne(Hda,[c,b]).fold(function(){var d=a.getRect(b),e=a.getRect(c);return e.right>d.left&&e.left<d.right?Cp.success():f(b)},function(a){return f(b)})})}).getOr(Cp.none("default"))},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},adt:Cp},Ida=O("ancestor","descendants","element","index"),wN=O("parent","children","element","index"),Dp=function(a,b){return Va(a,u(N.eq,b))},Jda={childOf:function(a,b){return Ja.closest(a,function(a){return A.parent(a).exists(function(a){return N.eq(a,
b)})})},indexOf:Dp,indexInParent:function(a){return A.parent(a).bind(function(b){var c=A.children(b);return Dp(c,a).map(function(d){return wN(b,c,a,d)})})},selectorsInParent:function(a,b){return A.parent(a).bind(function(c){var d=Y.children(c,b);return Dp(d,a).map(function(b){return wN(c,d,a,b)})})},descendantsInAncestor:function(a,b,c){return L.closest(a,b).bind(function(b){var d=Y.descendants(b,c);return Dp(d,a).map(function(c){return Ida(b,d,a,c)})})}},$v=function(a){return"br"===D.name(a)},aw=
function(a,b,c){return b(a,c).bind(function(a){return D.isText(a)&&0===Ya.get(a).trim().length?aw(a,b,c):g.some(a)})},Kda=function(a,b,c){return c.traverse(b).orThunk(function(){return aw(b,c.gather,a)}).map(c.relative)},Lda=function(a,b){return A.child(a,b).filter($v).orThunk(function(){return A.child(a,b-1).filter($v)})},Mda=function(a,b,c,d){return Lda(b,c).bind(function(b){return d.traverse(b).fold(function(){return aw(b,d.gather,a).map(d.relative)},function(a){return Jda.indexInParent(a).map(function(a){return la.on(a.parent(),
a.index())})})})},xN={tryBr:function(a,b,c,d){return($v(b)?Kda(a,b,d):Mda(a,b,c,d)).map(function(a){return{start:k(a),finish:k(a)}})},process:function(a){return Ri.cata(a,function(a){return g.none()},function(){return g.none()},function(a){return g.some(W.point(a,0))},function(a){return g.some(W.point(a,wa.getEnd(a)))})}},ml=aa.detect(),Nda=function(a,b,c){return a.getSelection().bind(function(d){return xN.tryBr(b,d.finish(),d.foffset(),c).fold(function(){return g.some(W.point(d.finish(),d.foffset()))},
function(e){e=a.fromSitus(e);e=Ri.verify(a,d.finish(),d.foffset(),e.finish(),e.foffset(),c.failure,b);return xN.process(e)})})},bw=function(a,b,c,d,e,f){return 0===f?g.none():Oda(a,b,c,d,e).bind(function(h){var k=a.fromSitus(h);k=Ri.verify(a,c,d,k.finish(),k.foffset(),e.failure,b);return Ri.cata(k,function(){return g.none()},function(){return g.some(h)},function(h){return N.eq(c,h)&&0===d?yN(a,c,d,Ed.moveUp,e):bw(a,b,h,0,e,f-1)},function(h){return N.eq(c,h)&&d===wa.getEnd(h)?yN(a,c,d,Ed.moveDown,
e):bw(a,b,h,wa.getEnd(h),e,f-1)})})},yN=function(a,b,c,d,e){return Bp.getBoxAt(a,b,c).bind(function(b){return zN(a,e,d(b,ll.getJumpSize()))})},zN=function(a,b,c){return ml.browser.isChrome()||ml.browser.isSafari()||ml.browser.isFirefox()||ml.browser.isEdge()?b.otherRetry(a,c):ml.browser.isIE()?b.ieRetry(a,c):g.none()},Oda=function(a,b,c,d,e){return Bp.getBoxAt(a,c,d).bind(function(b){return zN(a,e,b)})},Pda={handle:function(a,b,c){return Nda(a,b,c).bind(function(d){return bw(a,b,d.element(),d.offset(),
c,20).map(a.fromSitus)})}},Qda=aa.detect(),Rda=function(a,b){return wd.ancestor(a,function(a){return A.parent(a).exists(function(a){return N.eq(a,b)})})},AN=function(a,b,c,d,e){return L.closest(d,"td,th",b).bind(function(d){return L.closest(d,"table",b).bind(function(f){return Rda(e,f)?Pda.handle(a,b,c).bind(function(a){return L.closest(a.finish(),"td,th",b).map(function(b){return{start:k(d),finish:k(b),range:k(a)}})}):g.none()})})},BN=function(a,b,c,d,e,f){return Qda.browser.isIE()?g.none():f(d,
b).orThunk(function(){return AN(a,b,c,d,e).map(function(a){a=a.range();return Ni.response(g.some(Kh.makeSitus(a.start(),a.soffset(),a.finish(),a.foffset())),!0)})})},CN=function(a,b,c,d,e,f,h){return AN(a,c,d,e,f).bind(function(a){return Yv.detect(b,c,a.start(),a.finish(),h)})},Sda=function(a,b){return L.closest(a,"tr",b).bind(function(a){return L.closest(a,"table",b).bind(function(c){var d=Y.descendants(c,"tr");return N.eq(a,d[0])?wc.seekLeft(c,function(a){return kc.last(a).isSome()},b).map(function(a){var b=
wa.getEnd(a);return Ni.response(g.some(Kh.makeSitus(a,b,a,b)),!0)}):g.none()})})},Tda=function(a,b){return L.closest(a,"tr",b).bind(function(a){return L.closest(a,"table",b).bind(function(c){var d=Y.descendants(c,"tr");return N.eq(a,d[d.length-1])?wc.seekRight(c,function(a){return kc.first(a).isSome()},b).map(function(a){return Ni.response(g.some(Kh.makeSitus(a,0,a,0)),!0)}):g.none()})})},Tz=function(a,b){return L.closest(a,"td,th",b)},DN={traverse:A.nextSibling,gather:wc.after,relative:la.before,
otherRetry:ll.tryDown,ieRetry:ll.ieTryDown,failure:Ri.adt.failedDown},EN={traverse:A.prevSibling,gather:wc.before,relative:la.before,otherRetry:ll.tryUp,ieRetry:ll.ieTryUp,failure:Ri.adt.failedUp},Si=O("rows","cols"),Wz={mouse:function(a,b,c,d){a=Sz(a);b=AW(a,b,c,d);return{mousedown:b.mousedown,mouseover:b.mouseover,mouseup:b.mouseup}},keyboard:function(a,b,c,d){var e=Sz(a),f=function(){d.clear(b);return g.none()};return{keydown:function(a,k,q,m,w,n){var h=a.raw().which,l=!0===a.raw().shiftKey;return Sf.retrieve(b,
d.selectedSelector()).fold(function(){return Nd.isDown(h)&&l?u(CN,e,b,c,DN,m,k,d.selectRange):Nd.isUp(h)&&l?u(CN,e,b,c,EN,m,k,d.selectRange):Nd.isDown(h)?u(BN,e,c,DN,m,k,Tda):Nd.isUp(h)?u(BN,e,c,EN,m,k,Sda):g.none},function(a){var c=function(c){return function(){return yc(c,function(c){return Yv.update(c.rows(),c.cols(),b,a,d)}).fold(function(){return Sf.getEdges(b,d.firstSelectedSelector(),d.lastSelectedSelector()).map(function(a){var c=Nd.isDown(h)||n.isForward(h)?la.after:la.before;e.setRelativeSelection(la.on(a.first(),
0),c(a.table()));d.clear(b);return Ni.response(g.none(),!0)})},function(a){return g.some(Ni.response(g.none(),!0))})}};return Nd.isDown(h)&&l?c([Si(1,0)]):Nd.isUp(h)&&l?c([Si(-1,0)]):n.isBackward(h)&&l?c([Si(0,-1),Si(-1,0)]):n.isForward(h)&&l?c([Si(0,1),Si(1,0)]):Nd.isNavigation(h)&&!1===l?f:g.none})()},keyup:function(a,e,f,k,m){return Sf.retrieve(b,d.selectedSelector()).fold(function(){var h=a.raw().which;return!0===a.raw().shiftKey===!1?g.none():Nd.isNavigation(h)?Yv.sync(b,c,e,f,k,m,d.selectRange):
g.none()},g.none)}}}},Uz={byClass:function(a){var b=yf.addClass(a.selected()),c=yf.removeClasses([a.selected(),a.lastSelected(),a.firstSelected()]),d=function(b){b=Y.descendants(b,a.selectedSelector());z(b,c)};return{clear:d,selectRange:function(c,f,h,g){d(c);z(f,b);n.add(h,a.firstSelected());n.add(g,a.lastSelected())},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}},byAttr:function(a){var b=function(b){m.remove(b,a.selected());
m.remove(b,a.firstSelected());m.remove(b,a.lastSelected())},c=function(b){m.set(b,a.selected(),"1")},d=function(c){c=Y.descendants(c,a.selectedSelector());z(c,b)};return{clear:d,selectRange:function(b,f,h,g){d(b);z(f,c);m.set(h,a.firstSelected(),"1");m.set(g,a.lastSelected(),"1")},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}}},Xz={retrieve:function(a,b){return Sf.retrieve(a,b)},retrieveBox:function(a,b,c){return Sf.getEdges(a,
b,c).bind(function(b){var c=function(b){return N.eq(a,b)},d=L.ancestor(b.first(),"thead,tfoot,tbody,table",c),h=L.ancestor(b.last(),"thead,tfoot,tbody,table",c);return d.bind(function(a){return h.bind(function(c){return N.eq(a,c)?Pi.getBox(b.table(),b.first(),b.last()):g.none()})})})}},DW={configure:function(a){z([a.output(),a.internal()],function(b){var c=[te.lastSelected(),te.firstSelected(),te.selected()],d=E(c,function(a){return"."+a}).join(",");a.addSelector(b,d,function(a){z(a,yf.removeClasses(c))})})}},
FN=function(a){return 0===a.button},Ep=function(a,b){return{bind:function(c,d){return ys.bind(c,a,b,d)}}},vm={realClick:Ep("click",function(a){return 6===a.mozInputSource||0===a.mozInputSource?!1:void 0!==a.isTrusted&&!0!==a.isTrusted?!1:!0}),leftDown:Ep("mousedown",FN),leftPressedOver:Ep("mouseover",function(a){return void 0===a.buttons?!0:0!==(a.buttons&1)}),leftUp:Ep("mouseup",FN)},Vz=aa.detect(),GW=function(a){var b=aa.detect(),c=b.os.isOSX(),d=b.os.isLinux(),e=c?R.META():R.CTRL();b=[[e,"Z"]];
var f=c?[[R.META(),R.SHIFT(),"Z"]]:d?[[R.CTRL(),"Y"],[R.CTRL(),R.SHIFT(),"Z"]]:[[R.CTRL(),"Y"]],h=[[R.SHIFT(),121]],g=c?[[R.ALT(),121]]:[[121]],k=[[e,R.SHIFT(),"F"]];d=c?[[R.META(),R.ALT(),"U"]]:d?[[R.CTRL(),R.ALT(),"U"]]:[[R.CTRL(),R.SHIFT(),"U"]];c=c?[[R.CTRL(),R.ALT(),"H"]]:[[R.CTRL(),R.SHIFT(),"H"]];var m=[[e,"B"]],w=[[e,"I"]],n=[[e,"U"]],p=[[e,221],[e,"M"]],r=[[e,219],[e,R.SHIFT(),"M"]],t=[[e,R.SHIFT(),"9"]],u=[[e,"K"]];e=[[e,"F"]];var v=O("keys","trigger");return{undo:v(b,a.trigger.undo),redo:v(f,
a.trigger.redo),context:v(h,a.trigger.context),toolbar:v(g,a.trigger.toolbar),bold:v(m,a.trigger.bold),italic:v(w,a.trigger.italic),underline:v(n,a.trigger.underline),indent:v(p,a.trigger.indent),outdent:v(r,a.trigger.outdent),link:v(u,a.trigger.link),search:v(e,a.trigger.search),blockquote:v(t,a.trigger.blockquote),help:v(c,a.trigger.help),fullscreen:v(k,a.trigger.fullscreen),plaincode:v(d,a.trigger.plaincode)}},HW=function(a,b){return function(c){return U(a,c)?g.some(b):g.none()}},GN=function(a){return function(b){return b.key()===
a}},Uda=O("key","value"),JW={put:function(a,b,c,d,e){var f=void 0!==d?d:Uda,h=void 0!==e?e:GN(b);a=hb(a,function(a,d){var e=h(d)?f(b,c):d;return{updated:h(d)||a.updated,acc:a.acc.concat([e])}},{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([f(b,c)])},get:function(a,b,c){b=void 0!==c?c:GN(b);return qa(a,b)}},KW=O("popup","anchor"),Yz={bind:function(a,b){var c=Za.get(a);return{unbind:K.bind(a,"scroll",function(d){d=Za.get(a);d.top()===c.top()&&d.left()===c.left()||b(d);c=d}).unbind}}},RW=
{isDefaultEmpty:function(a){return/^\s*<p>\s*<br\s?\/?>\s*<\/p>\s*$/.test(a)}},PW={fromInitial:function(a){return Zz({initial:a,undo:[],redo:[]})},fromState:function(a){return Zz(a)}},wm=O("raw","marked"),QW=function(a){return wm(a.raw,a.marked)},$z=function(a,b){return{initial:b(a.initial),undo:E(a.undo,b),redo:E(a.redo,b)}},SW=function(a){return{raw:a.raw(),marked:a.marked()}},cw=ta.generate([{aboveView:["item"]},{inView:["item"]},{belowView:["item"]}]),Rg={aboveView:cw.aboveView,inView:cw.inView,
belowView:cw.belowView,cata:function(a,b,c,d){return a.fold(b,c,d)}},D0=function(a,b,c){var d=oz(a),e=xW(c.profile),f=XV(c.filters),h=ZV(),l=jca(f,h,a.content,b,c.content),m=CW(b,f,l),n=FW(l,a.shortcuts),w=a.ui.layout.bounds(a.ui),p=LW(l,w,b,a.ui),r=!1!==a.fullscreen.bundled?YV(l,n,a.fullscreen):Ta.fullscreen(),t=wW(l,p,b,r,a.platform),u=NW(l,n,p,t,r,b,a.ui,c.ui),v=cW(l,u),y=OW(f,l,v,n,c.undo),A=PV(l,m,v,y),B=yW(l,v,y),D=eW(f,l),G=SV(l,y,a.editorcontext),E=TW(l,a.ui.autoresize),H=zW(u,a.registration),
J=NV(b,l,v,n,p,a.contextmenu),K=Az.onNodeChange(l,D),M=ey(c.laundry);y.events.changed.bind(function(){M.setDirty(!0)});M.events.clean.bind(function(){l.undoChanged()});l.events.interaction.bind(function(a){!M.isDirty()&&y.checkChanged()&&M.setDirty(!0)});var N=aa.detect(),O=N.deviceType.isTouch();w=n.isHelpShortcutEnabled();c=!l.isInline()&&!O&&a.ui.showHelpHint;a=qba.editor(a.ui.editorName,a.ui.isFullScreen);N=x.translate(N.os.isOSX()?"aria.help.mac":"aria.help.ctrl");w=w?g.some(N):g.none();var P=
(l.isInline()?S.inline:S.editor)(u.element(),l.element(),a,w,c),Q=g.none();l.runOrOnLoaded(function(a){var b=tm.handle(a,function(a){L.closest(a.target(),"a").each(function(b){L.closest(b,'[contenteditable="false"]').each(a.kill)})});Q=g.some(b);O&&(S.label(a,x.translate("aria.label.content")),S.region(u.viewport()),S.region(u.tabstrip.element()))});return{region:k(b),communication:k(d),profile:k(e),filter:k(f),internalevents:k(h),content:k(l),keyboard:k(v),shortcuts:k(n),smartview:k(p),undo:k(y),
del:k(A),proximity:k(B),operations:k(D),context:k(G),fullscreen:k(r),platform:k(t),registration:k(H),contextmenu:k(J),ui:k(u),selections:k(m),insertFilteredHtmlAtCursor:function(a){a=f.filterHtml(f.input(),a);l.insertHtmlAtCursor(a)},viewablearea:k(E),laundry:k(M),state:function(){return{ui:u.state(),undo:y.state(),content:l.state(),profile:e.state(),laundry:M.state()}},destroy:function(){Q.each(function(a){a.unbind()});z([l,E,K,J,H,t,r,G,D,B,y,A,p,n,v,m,f,e,d,u],function(a){a.destroy?a.destroy():
console.log("Feature missing destroy method: ",a)});P.destroy()}}},Sb={resolve:Lb.create("ephox-hermes").resolve},HN=function(){var a=H.create({upload:p(["files"])}),b=r.fromTag("input");n.add(b,Sb.resolve("hidden"));n.add(b,Sb.resolve("file-selector-input"));m.setAll(b,{type:"file",accept:"image/*"});var c=K.bind(b,"change",function(b){b=ve.toFiles(b);a.trigger.upload(b)});return{element:k(b),open:function(){fa.set(b,"");b.dom().click()},destroy:function(){c.unbind()},events:a.registry}},bA={single:HN,
multiple:function(){var a=HN();m.set(a.element(),"multiple","multiple");return{element:a.element,open:a.open,destroy:a.destroy,events:a.events}}},IN=function(a,b){return E(b,function(b){var c=r.fromTag("img"),e=K.bind(c,"load",function(){e.unbind();a.domChanged()});b=Qc.cata(b,function(a,b,c){return c},function(a,b,c){return b});m.set(c,"src",b);return c})},qr={insertMobileAssets:function(a,b,c,d){var e=IN(a,d);return a.undoOperation(function(){var f=sd.insertAt(a,b,e);c.uploadAssets(d);return f})},
insertAssets:function(a,b,c){var d=IN(a,c);a.focus();a.undoOperation(function(){sd.insertAtCursor(a,d).each(function(b){a.setSelection(b.element(),b.offset(),b.element(),b.offset())});b.uploadAssets(c)})}},lc={resolve:Lb.create("ephox-gel").resolve},XW=aa.detect().deviceType.isiOS(),YW=aa.detect(),JN=function(a){a.dom().click();return g.some(a)},Kb={setup:function(a,b,c){b=Ba.dialog({execute:function(a){a.dom().click()},ok:b.ok().element(),cancel:b.cancel().element()});a=ha.dialog(a.element(),c,b);
return{enter:a.enter,exit:a.exit,destroy:a.destroy}},button:function(a){return(Fa.is(a,".ephox-pastry-button")?g.some(a):L.descendant(a,".ephox-pastry-button")).bind(JN)},click:JN,radio:function(a,b,c){b={item:k(b),selected:k(c)};return ha.radio(a,b,Ba.radio({one:function(a,b){b.dom().click()}}))}},$W={previewAsset:function(a,b){Qc.cata(a,yb("asset should not be a file type"),function(a,d,e){n.add(b,Sb.resolve("fluid-image"));m.set(b,"src",d)})}},eA=aa.detect(),Sg=O("heading","renderer"),or={left:k("left"),
top:k("top")},Vda=["image"],Wda=function(a,b,c){return Xa(Vda,function(a){return xa(b.getType())&&-1<b.getType().indexOf(a)})},jX={validate:function(a){a=hb(a,function(a,c){return!1===Qc.cata(c,Wda,k(!0))?{assets:a.assets,failure:!0}:{assets:a.assets.concat([c]),failure:a.failure}},{assets:[],failure:!1});return{assets:k(a.assets),failure:k(a.failure)}}},Re={multiple:function(a){return ve.multiple(a)},single:function(a){return ve.single(a)},singleWithUrl:function(a,b){return ve.singleWithUrl(a,b)}},
dw=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],of={identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:pr,multiply:Tf,
adjustContrast:function(a,b){b=ge(b,-1,1);b*=100;if(0>b)var c=127+b/100*127;else c=b%1,c=0===c?dw[b]:dw[Math.floor(b)]*(1-c)+dw[Math.floor(b)+1]*c,c=127*c+127;return Tf(a,[c/127,0,0,0,.5*(127-c),0,c/127,0,0,.5*(127-c),0,0,c/127,0,.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(a,b){b=ge(255*b,-255,255);return Tf(a,[1,0,0,0,b,0,1,0,0,b,0,0,1,0,b,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(a,b){b=ge(b,-1,1);b=1+(0<b?3*b:b);return Tf(a,[.3086*(1-b)+b,.6094*(1-b),.082*(1-b),0,0,.3086*
(1-b),.6094*(1-b)+b,.082*(1-b),0,0,.3086*(1-b),.6094*(1-b),.082*(1-b)+b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(a,b){b=ge(b,-180,180)/180*Math.PI;var c=Math.cos(b);b=Math.sin(b);return Tf(a,[.213+.787*c+-.213*b,.715+-.715*c+-.715*b,.072+-.072*c+.928*b,0,0,.213+-.213*c+.143*b,.715+c*(1-.715)+.14*b,.072+-.072*c+-.283*b,0,0,.213+-.213*c+-.787*b,.715+-.715*c+.715*b,.072+.928*c+.072*b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(a,b,c,d){b=ge(b,0,2);c=ge(c,0,2);d=ge(d,0,2);return Tf(a,[b,0,0,
0,0,0,c,0,0,0,0,0,d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(a,b){b=ge(b,0,1);return Tf(a,pr([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],b))},adjustGrayscale:function(a,b){b=ge(b,0,1);return Tf(a,pr([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],b))}},Wd={invert:function(a){return function(b){return xm(b,a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:Mh(of.adjustBrightness),hue:Mh(of.adjustHue),saturate:Mh(of.adjustSaturation),
contrast:Mh(of.adjustContrast),grayscale:Mh(of.adjustGrayscale),sepia:Mh(of.adjustSepia),colorize:function(a,b,c,d){return xm(a,of.adjustColors(of.identity(),b,c,d))},sharpen:lA([0,-1,0,-1,5,-1,0,-1,0]),emboss:lA([-2,-1,0,-1,1,1,0,1,2]),gamma:kA(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:kA(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:xm,convoluteFilter:jA},Xda={scale:mA},Fp={rotate:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=b,f=Uc.create(c.width,
c.height),h=Uc.get2dContext(f),g=0,k=0;e=0>e?360+e:e;90!=e&&270!=e||Uc.resize(f,f.height,f.width);if(90==e||180==e)g=f.width;if(270==e||180==e)k=f.height;h.translate(g,k);h.rotate(e*Math.PI/180);h.drawImage(c,0,0);return xe.fromCanvas(f,d)})},flip:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=Uc.create(c.width,c.height),f=Uc.get2dContext(e);"v"==b?(f.scale(1,-1),f.drawImage(c,0,-e.height)):(f.scale(-1,1),f.drawImage(c,-e.width,0));return xe.fromCanvas(e,d)})},crop:function(a,
b,c,d,e){return a.toCanvas().then(function(f){var h=a.getType(),g=Uc.create(d,e);Uc.get2dContext(g).drawImage(f,-b,-c);return xe.fromCanvas(g,h)})},resize:function(a,b,c){return a.toCanvas().then(function(d){return Xda.scale(d,b,c).then(function(b){return xe.fromCanvas(b,a.getType())})})}},KN=function(){function a(a){this.littleEndian=!1;this._dv=new DataView(a)}a.prototype.readByteAt=function(a){return this._dv.getUint8(a)};a.prototype.read=function(a,c){if(a+c>this.length())return null;for(var b=
this.littleEndian?0:-8*(c-1),e=0,f=0;e<c;e++)f|=this.readByteAt(a+e)<<Math.abs(b+8*e);return f};a.prototype.BYTE=function(a){return this.read(a,1)};a.prototype.SHORT=function(a){return this.read(a,2)};a.prototype.LONG=function(a){return this.read(a,4)};a.prototype.SLONG=function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a};a.prototype.CHAR=function(a){return String.fromCharCode(this.read(a,1))};a.prototype.STRING=function(a,c){return this.asArray("CHAR",a,c).join("")};a.prototype.SEGMENT=
function(a,c){var b=this._dv.buffer;switch(arguments.length){case 2:return b.slice(a,a+c);case 1:return b.slice(a);default:return b}};a.prototype.asArray=function(a,c,d){for(var b=[],f=0;f<d;f++)b[f]=this[a](c+f);return b};a.prototype.length=function(){return this._dv?this._dv.byteLength:0};return a}(),Yda={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},Zda={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",
40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},$da={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},aea={513:"JPEGInterchangeFormat",
514:"JPEGInterchangeFormatLength"},LN={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",
18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",
29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},
Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},bea=function(){function a(a){this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null};this._tiffTags={};this._reader=new KN(a);this._idx=this._offsets.tiffHeader;if(65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw Error("Exif data cannot be read or not available.");this._reader.littleEndian=18761==this.SHORT(this._idx);
if(42!==this.SHORT(this._idx+=2))throw Error("Invalid Exif data.");this._offsets.IFD0=this._offsets.tiffHeader+this.LONG(this._idx+=2);this._tiffTags=this.extractTags(this._offsets.IFD0,Yda);"ExifIFDPointer"in this._tiffTags&&(this._offsets.exifIFD=this._offsets.tiffHeader+this._tiffTags.ExifIFDPointer,delete this._tiffTags.ExifIFDPointer);"GPSInfoIFDPointer"in this._tiffTags&&(this._offsets.gpsIFD=this._offsets.tiffHeader+this._tiffTags.GPSInfoIFDPointer,delete this._tiffTags.GPSInfoIFDPointer);
if(a=this.LONG(this._offsets.IFD0+12*this.SHORT(this._offsets.IFD0)+2))this._offsets.IFD1=this._offsets.tiffHeader+a}a.prototype.BYTE=function(a){return this._reader.BYTE(a)};a.prototype.SHORT=function(a){return this._reader.SHORT(a)};a.prototype.LONG=function(a){return this._reader.LONG(a)};a.prototype.SLONG=function(a){return this._reader.SLONG(a)};a.prototype.CHAR=function(a){return this._reader.CHAR(a)};a.prototype.STRING=function(a,c){return this._reader.STRING(a,c)};a.prototype.SEGMENT=function(a,
c){return this._reader.SEGMENT(a,c)};a.prototype.asArray=function(a,c,d){for(var b=[],f=0;f<d;f++)b[f]=this[a](c+f);return b};a.prototype.length=function(){return this._reader.length()};a.prototype.UNDEFINED=function(){return this.BYTE.apply(this,arguments)};a.prototype.RATIONAL=function(a){return this.LONG(a)/this.LONG(a+4)};a.prototype.SRATIONAL=function(a){return this.SLONG(a)/this.SLONG(a+4)};a.prototype.ASCII=function(a){return this.CHAR(a)};a.prototype.TIFF=function(){return this._tiffTags};
a.prototype.EXIF=function(){var a=null;if(this._offsets.exifIFD){try{a=this.extractTags(this._offsets.exifIFD,Zda)}catch(e){return null}if(a.ExifVersion&&Array.isArray(a.ExifVersion)){for(var c=0,d="";c<a.ExifVersion.length;c++)d+=String.fromCharCode(a.ExifVersion[c]);a.ExifVersion=d}}return a};a.prototype.GPS=function(){var a=null;if(this._offsets.gpsIFD){try{a=this.extractTags(this._offsets.gpsIFD,$da)}catch(c){return null}a.GPSVersionID&&Array.isArray(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join("."))}return a};
a.prototype.thumb=function(){if(this._offsets.IFD1)try{var a=this.extractTags(this._offsets.IFD1,aea);if("JPEGInterchangeFormat"in a)return this.SEGMENT(this._offsets.tiffHeader+a.JPEGInterchangeFormat,a.JPEGInterchangeFormatLength)}catch(c){}return null};a.prototype.extractTags=function(a,c){var b,e={},f={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},h={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};var g=this.SHORT(a);for(b=
0;b<g;b++){var k=a+2+12*b;var m=c[this.SHORT(k)];if(void 0!==m){var w=f[this.SHORT(k+=2)];var n=this.LONG(k+=2);var p=h[w];if(!p)throw Error("Invalid Exif data.");k+=4;4<p*n&&(k=this.LONG(k)+this._offsets.tiffHeader);if(k+p*n>=this.length())throw Error("Invalid Exif data.");"ASCII"===w?e[m]=this.STRING(k,n).replace(/\0$/,"").trim():(w=this.asArray(w,k,n),n=1==n?w[0]:w,LN.hasOwnProperty(m)&&"object"!=typeof n?e[m]=LN[m][n]:e[m]=n)}}return e};return a}(),cea=function(a){var b=[],c;for(c=2;c<=a.length();){var d=
a.SHORT(c);if(65488<=d&&65495>=d)c+=2;else{if(65498===d||65497===d)break;var e=a.SHORT(c+2)+2;65505<=d&&65519>=d&&b.push({hex:d,name:"APP"+(d&15),start:c,length:e,segment:a.SEGMENT(c,e)});c+=e}}return b},dea=function(a){return jd.blobToArrayBuffer(a).then(function(b){try{var c=new KN(b);if(65496===c.SHORT(0)){var d=cea(c),e=d.filter(function(a){return"APP1"===a.name});b={};if(e.length){var f=new bea(e[0].segment);b={tiff:f.TIFF(),exif:f.EXIF(),gps:f.GPS(),thumb:f.thumb()}}else return Md.reject("Headers did not include required information");
b.rawHeaders=d;return b}return Md.reject("Image was not a jpeg")}catch(h){return Md.reject("Unsupported format or not an image: "+a.type+" (Exception: "+h.message+")")}})},Gp=function(a,b){return Fp.rotate(a,b)},Ti={invert:function(a){return Wd.invert(a)},sharpen:function(a){return Wd.sharpen(a)},emboss:function(a){return Wd.emboss(a)},brightness:function(a,b){return Wd.brightness(a,b)},hue:function(a,b){return Wd.hue(a,b)},saturate:function(a,b){return Wd.saturate(a,b)},contrast:function(a,b){return Wd.contrast(a,
b)},grayscale:function(a,b){return Wd.grayscale(a,b)},sepia:function(a,b){return Wd.sepia(a,b)},colorize:function(a,b,c,d){return Wd.colorize(a,b,c,d)},gamma:function(a,b){return Wd.gamma(a,b)},exposure:function(a,b){return Wd.exposure(a,b)},flip:function(a,b){return Fp.flip(a,b)},crop:function(a,b,c,d,e){return Fp.crop(a,b,c,d,e)},resize:function(a,b,c){return Fp.resize(a,b,c)},rotate:Gp,exifRotate:function(a){return a.toBlob().then(dea).then(function(b){switch(b.tiff.Orientation){case 6:return Gp(a,
90);case 3:return Gp(a,180);case 8:return Gp(a,270);default:return a}},function(){return a})}},nl=function(a){return function(b){return Yc.blobToImageResult(b).then(function(b){return a(b)}).then(Yc.imageResultToOriginalBlob)}},MN=function(a){return nl(function(b){return Ti.rotate(b,a)})},NN=function(a){return nl(function(b){return Ti.flip(b,a)})},eea=function(a){return nl(function(b){return Ti.resize(b,a.width(),a.height())})},fea=Ua.pToFR(nl(Ti.sharpen)),gea=Ua.pToFR(MN(-90)),hea=Ua.pToFR(MN(90)),
iea=Ua.pToFR(NN("v")),jea=Ua.pToFR(NN("h")),Wg={rotateLeft:gea,rotateRight:hea,flipVertical:iea,flipHorizontal:jea,sharpen:fea,crop:function(a,b,c,d){return Ua.pToFR(nl(function(e){return Ti.crop(e,a,b,c,d)}))},resizeTo:function(a){return Ua.pToFR(eea(a))},doExifRotate:function(a){return Ua.fromPromise(Ti.exifRotate(a))}},ON={mapIfSet:function(a,b){return Ua.map(a,function(a){return a.map(b)})},applyIfSet:function(a){return function(b){return Ua.bind(a,function(a){return a.fold(function(){return Ua.pure(b)},
function(a){return a(b)})})}}},Rj={partition:function(a){var b=[],c=[];z(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,values:c}}},Hp=O("width","height"),PN=ta.generate([{special:["size"]},{regular:["value","size","unit"]}]),Ip={identify:function(a){a=a.match(/(\d*\.?\d*)(.*)/);return""!==a[1]?PN.regular(a[0],Number(a[1]),a[2]):PN.special(a[0])}},kea=function(a,b){return v.getRaw(a,b).orThunk(function(){return m.has(a,b)?g.some(m.get(a,b)):g.none()}).bind(function(a){return Ip.identify(a).fold(function(a){return g.none()},
function(a,b,c){switch(c){case "":case "px":return g.some(parseInt(b,10));default:return g.none()}})})},ew=function(a,b,c){b=b(a);return 0<b?g.some(b):kea(a,c)},lea={get:function(a){return ew(a,Ia.get,"width").bind(function(b){return ew(a,sa.get,"height").map(function(a){return Hp(b,a)})})},measure:ew},QN=function(a,b){a=b/a;return 1>a?a:1},mea=function(a,b){var c=QN(a.height,b.height);return 1===c?a:{width:a.width*c,height:b.height}},nea=function(a,b){var c=QN(a.width,b.width);return 1===c?a:{width:b.width,
height:a.height*c}},oea={max:function(a,b){var c=0<b.height?b.height:0;b=0<b.width?b.width:0;if(!(a.height>c||a.width>b)||c===b&&0===c)return a;c={width:b,height:c};b=a.width>a.height;var d=0<c.height,e=(d?a.height/c.height:0)>(0<c.width?a.width/c.width:0);return(c.width===c.height&&b||!d||!e?nea:mea)(a,c)}},pea=function(a){var b=dg.createObjectURL(a);return Ua.map(rp.load(b),function(a){a=RN(a);dg.revokeObjectURL(b);return a})},RN=function(a){return Hp(a.dom().naturalWidth,a.dom().naturalHeight)},
qea=function(a){var b=RN(a);return lea.get(a).filter(function(a){return a.width()!==b.width()||a.height()!==b.height()})},vr={restrain:function(a){var b=a.width(),c=a.height(),d=function(a){var d=oea.max({width:a.width(),height:a.height()},{width:b,height:c});return a.height()>c||a.width()>b?g.some(Hp(d.width,d.height)):g.none()};return function(a){a=pea(a);return Ua.map(a,d)}},changedBounds:function(a){return Ua.map(rp.loadIfNeeded(a),qea)}},rea=function(a){a=ON.mapIfSet(a,Wg.resizeTo);return ON.applyIfSet(a)},
SN=function(a,b,c){return Ua.fromChain([rea(a),c])(b)},Fj={instance:function(a){var b=vr.restrain(a);return function(a){return Qc.cata(a,function(c,e,f){c=Ua.fromPromise(Yc.imageResultToOriginalBlob(e));return Ua.bind(c,function(c){var d=b(c);return SN(d,c,function(b){if(b===c)return Ua.pure(a);dg.revokeObjectURL(f);return Ua.fromFuture(Re.single(b))})})},function(){return Ua.pure(a)})}},processResults:function(a){return function(b){b=Rj.partition(b);0<b.errors.length&&(a("imageedit.generic"),console.error("Image resample errors: ",
b.errors));return b.values}},resampleAction:SN},nA={maybeDoRotate:function(a){return Ce(a,function(a){return a.fold(function(a){return Ua.error(a)},function(a){return Qc.cata(a,function(b,c,f){b=Wg.doExifRotate(c);return Ua.bind(b,function(b){if(b===c)return Ua.pure(a);b=Ua.fromPromise(Yc.imageResultToOriginalBlob(b));return Ua.bind(b,function(a){URL.revokeObjectURL(f);return Ua.fromFuture(Re.single(a))})})},function(){return Ua.pure(a)})})})}},TN=B.resolve("find-match"),UN=B.resolve("find-mark"),
fw="."+TN+", ."+UN,Od={configure:function(a){a.addSelector(a.output(),fw,Na.unwrap);a.addSelector(a.history(),fw,Na.unwrap);a.addSelector(a.internal(),fw,Na.unwrap)},matchClass:k(TN),markClass:k(UN),findIdAttr:k("data-ephox-find-id"),shiftKeyState:function(a){return{isShift:k(a)}}},Jp={created:function(a){return{fold:function(b,c){return c(a)}}},preserved:function(a){return{fold:function(b,c){return b(a)}}}},sea=O("id","match","current"),gw={resolve:Lb.create("data.ephox.cram").resolve},hw={resolve:Lb.create("ephox-cram").resolve},
VN=gw.resolve("highlight-id"),tea=hw.resolve("highlight-wrap"),WN=function(a,b){return L.closest(a,"."+b)},XN=function(a){return g.from(m.get(a,VN))},zg={marker:WN,idMarker:function(a){return WN(a,tea)},id:XN,set:function(a,b){m.set(a,VN,b);n.add(a,b)},all:function(a){return XN(a).fold(k([a]),function(b){var c=A.owner(a);return Y.descendants(c,"."+b)})}},iw=O("word","pattern"),uea={separate:function(a,b,c){var d=ia(c,function(a){return[a.start(),a.finish()]}),e=Rd.splits(b,d,function(b,c){return pH.subdivide(a,
b.element(),c)});return E(c,function(b){var c=Rd.sublist(e,b.start(),b.finish());c=E(c,function(a){return a.element()});var d=E(c,a.property().getText).join("");return{elements:k(c),word:b.word,exact:k(d)}})}},vea=function(a,b){return Rd.generate(b,function(b,d){var c=d+a.property().getText(b).length;return g.from(W.range(b,d,c))})},jw=function(a,b,c,d){b=qH.group(a,b,d);return ia(b,function(b){b=nn.justText(b);var d=E(b,a.property().getText).join("");d=Mo.findmany(d,c);b=vea(a,b);return uea.separate(a,
b,d)})},kw={safeWords:function(a,b,c,d){c=E(c,function(a){var b=Cb.safeword(a);return iw(a,b)});return jw(a,b,c,d)},safeToken:function(a,b,c,d){c=iw(c,Cb.safetoken(c));return jw(a,b,[c],d)},run:jw},lw={safeWords:function(a,b,c,d){return kw.safeWords(a,b,c,d)},safeToken:function(a,b,c,d){return kw.safeToken(a,b,c,d)},run:function(a,b,c,d){return kw.run(a,b,c,d)}},mw=nb(),Kp={safeWords:function(a,b,c){return lw.safeWords(mw,a,b,c)},safeToken:function(a,b,c){return lw.safeToken(mw,a,b,c)},run:function(a,
b,c){return lw.run(mw,a,b,c)}},wea=function(a,b){var c=ia(a.elements(),function(a){return zg.marker(a,b).fold(k([]),function(a){return[a]})}),d=Ha("ephox-cram");return sea(d,a,g.from(c[0]))},ol={matchWords:function(a,b,c){return Kp.safeWords(a,b,c)},matchToken:function(a,b,c){return Kp.safeToken(a,b,c)},matchPattern:function(a,b,c){return Kp.run(a,[b],c)},annotates:function(a,b){return E(a,function(a){return wea(a,b)})}},YN=function(a,b,c,d){b=ol.annotates(d,c.label());return ia(b,function(b){return b.current().fold(function(){var d=
b.match();if(a.ignore(d))return[];d=wi.wrapper(d.elements(),c.nu)||[];z(d,u(c.tag,b));return[Jp.created(d)]},function(a){return[Jp.preserved(a)]})})},xea={highlight:function(a,b,c,d){c=ol.matchToken(b,c,a.optimise);return YN(a,b,d,c)},highlightPattern:function(a,b,c,d){c=ol.matchPattern(b,c,a.optimise);return YN(a,b,d,c)}},yea=function(a,b){return D.isElement(b)&&pa.isBlock(b)?0>Vb.get(b).toLowerCase().indexOf(a):!1},zea=function(a){return{ignore:k(!1),optimise:u(yea,a.toLowerCase())}},Lp=k("."+Od.matchClass()),
Aea={label:Od.matchClass,tag:function(a,b){n.add(b,Od.matchClass());m.set(b,Od.findIdAttr(),a.id())},nu:function(){var a=r.fromTag("span");return{element:k(a),wrap:u(y.append,a)}}},ZN=function(a){z(a,function(a){n.add(a,Od.markClass())})},Bea=function(a){z(a,function(a){n.remove(a,Od.markClass())})},nw=function(a,b){a=hm(Y.descendants(a,b),function(a){return m.get(a,Od.findIdAttr())});return 0===a.length?g.none():g.some(a)},$N=function(a,b){b=Cb.custom(Cb.sanitise(a),k(0),k(0),b);return iw(a,b)},
ow=function(a,b,c){return nw(a,Lp()).map(function(d){var e=ka(d,function(a){return n.has(a[0],Od.markClass())}),f=Va(d,function(a){return U(e,a)}).getOr(-1);return{pos:c(d,Qb(e),f,b(f,d.length)),all:nw(a,Lp())}})},pw=function(a,b,c,d){Bea(b);ZN(a[d]);return d},aO=function(a,b){return a===b-1?0:a+1},Cea=function(a,b){return 0===a?b-1:a-1},bO=function(a,b){return ow(a,aO,function(a,d,e,f){pw(a,d,e,f);y.before(d[0],r.fromText(b));z(d,G.remove);return 0===f?f:e})},pf={search:function(a,b,c){if(0===b.length)return g.none();
var d=zea(b),e=A.children(a);b=!0===c?$N(b,g.none()):$N(b,g.some("gi"));xea.highlightPattern(d,e,b,Aea);return nw(a,Lp()).map(function(a){ZN(a[0]);return{all:g.some(a),pos:0}})},clear:function(a){a=Y.descendants(a,Lp());z(a,G.unwrap);return g.none()},next:function(a){return ow(a,aO,pw)},prev:function(a){return ow(a,Cea,pw)},replace:bO,replaceAll:function(a,b){for(;bO(a,b).isSome(););return g.none()}},qA=aa.detect().deviceType.isiOS(),qw=function(a,b,c){a=a();var d=a.element();ma.add(d,b);S.button(d,
c);m.set(d,"tabindex","-1");a.events.click.bind(function(){Z.focus(d)});return a},rw=function(a,b){a=qw(Oc,a,b);m.set(a.element(),"title",b);return a},cO=function(a,b){var c=B.resolve("inline-main-button");a=a.concat([c]);a=qw(Oc,a,b);a.content(Rc(b));return a},dO=function(a,b,c){var d=B.resolve("inline-main-button-toggle");a=a.concat([d]);c=qw($d,a,c);m.set(c.element(),"title",b);return c},sw=function(a,b,c){var d=r.fromTag("input");ma.add(d,a);m.set(d,"placeholder",b);S.label(d,c);return{element:k(d),
destroy:u(G.remove,d)}},ym={counter:function(a){var b=T.div(),c=T.span();n.add(b,B.resolve("search-widget-counter"));n.add(c,B.resolve("search-widget-counter-text"));y.append(b,c);return{element:k(b),update:function(a,b){a=x.translate("units.amount-of-total",a,b);G.empty(c);y.append(c,r.fromText(a));sc.isVisible(c)&&ib.speak(ja.body(),a)},hide:function(){v.set(b,"display","none")},show:function(){v.remove(b,"display")},destroy:function(){G.remove(c);G.remove(b)}}},dummyCounter:function(a){a=T.div();
n.add(a,B.resolve("search-widget-counter"));return{element:k(a),update:t,hide:t,show:t,destroy:u(G.remove,a)}},searchField:function(){var a=T.span(),b=rw([B.resolve("stepper-button"),B.resolve("search-widget-previous")],x.translate("search.previous")),c=rw([B.resolve("stepper-button"),B.resolve("search-widget-next")],x.translate("search.next")),d=dO([B.resolve("search-widget-more")],x.translate("aria.label.more"),x.translate("aria.label.more"));n.add(a,B.resolve("search-widget-searchField"));var e=
sw([B.resolve("search-widget-input"),B.resolve("search-widget-input-search")].concat(xc.isSmallTouch()?[B.resolve("search-widget-small-touch")]:[]),x.translate("search.search"),x.translate("search.field.search")),f=H.create({next:Q([],c.events.click),previous:Q([],b.events.click),more:Q([],d.events.click),input:p(["raw"])}),h=K.bind(e.element(),"input",f.trigger.input);P.append(a,[e.element(),b.element(),c.element(),d.element()]);return{events:f.registry,element:k(a),input:e.element,focus:function(){Z.focus(e.element())},
previous:b.element,next:c.element,moreToggle:d,destroy:function(){h.unbind();e.destroy();b.destroy();c.destroy();d.destroy()}}},replaceDrawer:function(){var a=sw([B.resolve("search-widget-input"),B.resolve("search-widget-input-replace")],x.translate("search.replace"),x.translate("search.field.replace")),b=dO([B.resolve("search-widget-matchcase")],x.translate("search.matchcase"),x.translate("search.matchcase")),c=cO([B.resolve("search-widget-replace")],x.translate("search.replace")),d=cO([B.resolve("search-widget-replace-all")],
x.translate("search.replace-all")),e=r.fromTag("div");S.group(e);var f=T.div();n.add(e,B.resolve("search-widget-replace-drawer"));n.add(f,B.resolve("search-widget-replace-drawer-tools"));P.append(f,[b.element(),c.element(),d.element()]);P.append(e,[a.element(),f]);return{element:k(e),replace:c,replaceAll:d,input:a,matchcase:b,destroy:function(){b.destroy();c.destroy();d.destroy();G.remove(f);G.remove(e)}}},button:rw,input:sw},sA=function(a,b,c){a?(ra.expanded(b),S.hidden(c,!1)):(ra.collapsed(b),S.hidden(c,
!0))},Gj={text:ta.generate([{text:["field","input"]}]).text,cata:function(a,b){return a.fold(b)}},nX=aa.detect(),mX=kn("element addEscape open close execute type events destroy".split(" "),oD.isFunctionOrEvents(["toEditor"])),eO=B.resolve("toolbar-dialog"),Dea=function(a){var b=kX(a);return Py(a,b,"search",eO)},Eea=function(a){var b=lX(a);return zm(a,b,eO)},pX=function(a){return(aa.detect().deviceType.isTouch()?Eea:Dea)(a)},Fea=function(a){return se.isAnnotation(a)||m.has(a,Rb.overrideSpan())},fO=
function(a,b,c,d,e,f){var h=function(b){a(b,e,Fea)};Zb.cata(d.get(),t,Po.multiple(b,c,h,f),Po.single(b,c,h,f))},Mp=function(a,b,c,d,e){fO(a,b,c,d,e,b.toEditing)},Uf={face:u(Mp,Bi.face),background:u(Mp,Bi.background),foreground:u(Mp,Bi.foreground),size:u(Mp,Bi.size),partialSize:u(function(a,b,c,d,e){fO(a,b,c,d,e,t)},Bi.size)},Oh={color:O("hex","name"),face:O("textkey","value","icon"),size:O("name","size")},qc=Oh.color,Se=Oh.face,wA={colors:function(){return[qc("#FFF",x.key("color.white")),qc("#000",
x.key("color.black")),qc("#444",x.key("color.gray")),qc("#777",x.key("color.metal")),qc("#CCC",x.key("color.smoke")),qc("#FC1D00",x.key("color.red")),qc("#C81500",x.key("color.darkred")),qc("#FF8C00",x.key("color.darkorange")),qc("#FEBE00",x.key("color.orange")),qc("#FFFC00",x.key("color.yellow")),qc("#22AE50",x.key("color.green")),qc("#006400",x.key("color.darkgreen")),qc("#3CB371",x.key("color.mediumseagreen")),qc("#8FCD4E",x.key("color.lightgreen")),qc("#00FF00",x.key("color.lime")),qc("#0000CD",
x.key("color.mediumblue")),qc("#002360",x.key("color.navy")),qc("#0173C1",x.key("color.blue")),qc("#14B2F2",x.key("color.lightblue")),qc("#ee82ee",x.key("color.violet"))]},faces:function(){return[Se(x.key("font.arial"),"Arial",g.none()),Se(x.key("font.comicsans"),"Comic Sans MS",g.none()),Se(x.key("font.consolas"),"Consolas",g.none()),Se(x.key("font.courier"),"Courier",g.none()),Se(x.key("font.georgia"),"Georgia",g.none()),Se(x.key("font.impact"),"Impact",g.none()),Se(x.key("font.tahoma"),"Tahoma",
g.none()),Se(x.key("font.timesnr"),"Times New Roman",g.none()),Se(x.key("font.trebuchet"),"Trebuchet MS",g.none()),Se(x.key("font.verdana"),"Verdana",g.none())]}},Am={configuration:k({i18nNamespace:"font",cssNamespace:"font",property:"font-size",tag:"span",specials:["xx-small x-small small medium large x-large xx-large".split(" ")]})},Gea=function(a){var b=!isNaN(parseFloat(a))&&isFinite(a);return a+(b?"px":"")},Hea=function(a,b,c){return(v.isValidValue(a,b,c)?g.some(c):g.none()).fold(function(){return J.error("Invalid value: "+
c)},function(a){return a===c?J.value(c):J.error("Invalid value: "+c)})},gO=function(a){return Ip.identify(a).fold(function(a){return a},function(a,c,d){return Math.round(10*c)/10+d})},Vf={identify:Ip.identify,validate:function(a,b,c){return(xf.isEmpty(a)?J.error("can not use empty value for font size."):J.value(a)).map(Gea).map(gO).bind(u(Hea,b,c))},sanitise:function(a){return gO(a)}},Np={px:1,em:.1,"%":10,pt:1,rem:"0.1"},Iea=function(a,b,c){return qa(b,function(a){return U(a,c)}).bind(function(b){return Gc(b,
c).bind(function(c){return g.from(b[a(c,b)])})}).getOr(c)},hO=function(a,b,c,d){return Vf.identify(d).fold(function(b){return Iea(a,c,b)},function(a,c,d){a=void 0!==Np[d]?Np[d]:1;var e=b*(void 0!==Np[d]?Np[d]:1);return($e(c)&&0<=c?Math.max(a,c+e):a)+d})},Bm={decrease:u(hO,function(a,b){return Math.max(0,a-1)},-1),increase:u(hO,function(a,b){return Math.min(b.length-1,a+1)},1)},rX=Aa(["i18nNamespace","cssNamespace","property","tag","specials"],[]),Jea=O("size"),Lea=function(a){a=Zb.toSelection(a.get()).fold(Da.off,
function(a){a=U(["td","th"],D.name(a.startContainer()))?kb.freefallLtr(a.startContainer()).element():a.startContainer();a=Kea(a);return Da.on(a)});return Jea(a)},Mea=function(a){return a.body().bind(function(a){a=v.get(a,"font-size");return g.from(a)})},iO=function(a){var b=a.dom();if(!b.style)return!1;b=b.style.fontSize;return"body"!==D.name(a)&&!xf.isEmpty(b)},Kea=function(a){var b=D.isText(a)?A.parent(a).getOrDie():a;return(iO(b)?g.some(b):Ja.ancestor(b,iO)).fold(function(){return v.get(b,"font-size")},
function(a){return a.dom().style.fontSize})},Cm={getState:function(a,b){return{readState:Lea(a),fallbackSize:Mea(b).getOr("12px")}}},Nea=function(a){a.dom().click();return g.some(a)},Oea=function(a,b){var c=Y.descendants(a,b);if(0<sa.get(a)&&0<c.length){var d=bb.absolute(c[0]).top();return Va(c.slice(1),function(a){return bb.absolute(a).top()!==d}).map(function(a){return{rows:k(Math.ceil(c.length/(a+1))),columns:k(a+1)}})}return g.none()},Pea=function(a){return E(a,function(a){var b=a.text;b=x.has("color."+
b)?x.key("color."+b):x.raw(b);return Oh.color(a.value,b)})},Ij={create:function(a){var b=0<a.length?Pea(a):wA.colors();a=tX();var c=E(b,function(a){var b=tA(a);m.set(b.element(),"tabIndex","-1");n.add(b.element(),B.resolve("palette-color-option"));v.set(b.element(),"background-color",a.hex());return b});z(c,a.add);b=b.length%5;if(0!==b%5)for(b=5-b,c=0;c<b;c++){var d=tA(Oh.color("#FFF",x.key("color.white")));n.add(d.element(),B.resolve("palette-color-option"));n.add(d.element(),B.resolve("palette-color-option-spacer"));
a.add(d)}return a},makeLayout:function(a,b,c){c=Ba.grid(oa({trigger:Nea},c));var d=ha.grid(a,{cell:k(b)},4,5,c);return{layout:k(d),refresh:function(){d.clear();Oea(a,b).each(function(a){d.resize(a.rows(),a.columns())})}}}},Qea="."+B.resolve("palette-detail-active"),uA=function(a){return Db.closest(a,Qea)},vX=aa.detect().deviceType.isTouch,Rea=function(a){var b=na(g.none());return{clear:function(){b.get().each(a);b.set(g.none())},isSet:function(){return b.get().isSome()},set:function(c){b.get().each(a);
b.set(g.some(c))}}},Sea=function(){return Rea(function(a){a.destroy()})},pl=k("touchstart"),tw=k("touchmove"),uw=k("touchend"),ql=k("mousedown"),vw=k("mousemove"),jO=k("mouseup"),Tea=k("keydown");k("click");var Uea=k("alloy.tap"),yh=k("alloy.focus"),Vea=k("alloy.blur.post"),kO=k("alloy.receive"),lO=k("alloy.execute");aa.detect().deviceType.isTouch();var Wea=k("alloy.longpress"),ww=k("alloy.system.init"),Xea=k("alloy.system.scroll"),mO=k("alloy.system.attached"),nO=k("alloy.system.detached"),Tg=function(a){a=
Pc.shallow(a);return Ea.getOuter(a)},oO=[],Yea=["alloy/data/Fields","alloy/debugging/Debugging"],Zea=function(){var a=Error();return void 0!==a.stack?(a=a.stack.split("\n"),qa(a,function(a){return 0<a.indexOf("alloy")&&!Xa(Yea,function(b){return-1<a.indexOf(b)})}).getOr("unknown")):"unknown"},$ea={logEventCut:t,logEventStopped:t,logNoParent:t,logEventNoHandlers:t,logEventResponse:t,write:t},xw=function(a,b,c){var d="*"===oO||U(oO,a)?function(){var c=[];return{logEventCut:function(a,b,d){c.push({outcome:"cut",
target:b,purpose:d})},logEventStopped:function(a,b,d){c.push({outcome:"stopped",target:b,purpose:d})},logNoParent:function(a,b,d){c.push({outcome:"no-parent",target:b,purpose:d})},logEventNoHandlers:function(a,b){c.push({outcome:"no-handlers-left",target:b})},logEventResponse:function(a,b,d){c.push({outcome:"response",purpose:d,target:b})},write:function(){U(["mousemove","mouseover","mouseout",ww()],a)||ld.log(a,{event:a,target:b.dom(),sequence:E(c,function(a){return U(["cut","stopped","response"],
a.outcome)?"{"+a.purpose+"} "+a.outcome+" at ("+Tg(a.target)+")":a.outcome})})}}}():$ea;c=c(d);d.write();return c},pO=function(a){a=a.raw();return void 0===a.touches||1!==a.touches.length?g.none():g.some(a.touches[0])},afa=function(a){var b=na(g.none()),c=wX(function(c){b.set(g.none());a.triggerEvent(Wea(),c)},400),d=pb([{key:pl(),value:function(a){pO(a).each(function(d){c.cancel();d={x:k(d.clientX),y:k(d.clientY),target:a.target};c.schedule(a);b.set(g.some(d))});return g.none()}},{key:tw(),value:function(a){c.cancel();
pO(a).each(function(a){b.get().each(function(c){var d=Math.abs(a.clientX-c.x());c=Math.abs(a.clientY-c.y());(5<d||5<c)&&b.set(g.none())})});return g.none()}},{key:uw(),value:function(d){c.cancel();return b.get().filter(function(a){return N.eq(a.target(),d.target())}).map(function(b){return a.triggerEvent(Uea(),d)})}}]);return{fireIfReady:function(a,b){return zc(d,b).bind(function(b){return b(a)})}}},qO=aa.detect().browser.isFirefox(),bfa=od([gp("triggerEvent",fL),gp("broadcastEvent",fL),da("stopBackspace",
!0)]),cfa=function(a,b){return qO?K.capture(a,"focus",b):K.bind(a,"focusin",b)},dfa=function(a,b){return qO?K.capture(a,"blur",b):K.bind(a,"focusout",b)},efa=function(a,b){var c=Oe("Getting GUI events settings",bfa,b);b=aa.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:"mousedown mouseup mouseover mousemove mouseout click".split(" ");var d=afa(c),e=E(b.concat("selectstart input contextmenu change transitionend drag dragstart dragend dragenter dragleave dragover drop".split(" ")),
function(b){return K.bind(a,b,function(a){d.fireIfReady(a,b).each(function(b){b&&a.kill()});c.triggerEvent(b,a)&&a.kill()})}),f=K.bind(a,"keydown",function(a){if(c.triggerEvent("keydown",a))a.kill();else{var b;if(b=!0===c.stopBackspace)b=8===a.raw().which&&!U(["input","textarea"],D.name(a.target()));b&&a.prevent()}}),h=cfa(a,function(a){c.triggerEvent("focusin",a)&&a.kill()}),g=dfa(a,function(a){c.triggerEvent("focusout",a)&&a.kill();Kf(function(){c.triggerEvent(Vea(),a)},0)});b=A.defaultView(a);
var k=K.bind(b,"scroll",function(a){c.broadcastEvent(Xea(),a)&&a.kill()});return{unbind:function(){z(e,function(a){a.unbind()});f.unbind();h.unbind();g.unbind();k.unbind()}}},yw=function(a,b){a=zc(a,"target").map(function(a){return a()}).getOr(b);return na(a)},ffa=function(a,b){var c=na(!1),d=na(!1);return{stop:function(){c.set(!0)},cut:function(){d.set(!0)},isStopped:c.get,isCut:d.get,event:k(a),setSource:b.set,getSource:b.get}},gfa=function(a){var b=na(!1);return{stop:function(){b.set(!0)},cut:t,
isStopped:b.get,isCut:k(!1),event:k(a),setSource:yb("Cannot set source of a broadcasted event"),getSource:yb("Cannot get source of a broadcasted event")}},rl=ta.generate([{stopped:[]},{resume:["element"]},{complete:[]}]),rO=function(a,b,c,d,e,f){a=a(b,d);var h=ffa(c,e);return a.fold(function(){f.logEventNoHandlers(b,d);return rl.complete()},function(a){var c=a.descHandler(),d=c.cHandler;d(h);return h.isStopped()?(f.logEventStopped(b,a.element(),c.purpose()),rl.stopped()):h.isCut()?(f.logEventCut(b,
a.element(),c.purpose()),rl.complete()):A.parent(a.element()).fold(function(){f.logNoParent(b,a.element(),c.purpose());return rl.complete()},function(d){f.logEventResponse(b,a.element(),c.purpose());return rl.resume(d)})})},zw=function(a,b,c,d,e,f){return rO(a,b,c,d,e,f).fold(function(){return!0},function(d){return zw(a,b,c,d,e,f)},function(){return!1})},hfa=function(a,b,c){var d=gfa(b);z(a,function(a){a=a.descHandler().cHandler;a(d)});return d.isStopped()},zX=function(a,b,c){return Ja.closest(a,
function(a){return b(a).isSome()},c).bind(b)},ifa=k("alloy-id-"),sO=k("data-alloy-id"),BX=ifa(),vA=sO(),Jj=function(a){a=D.isElement(a)?m.get(a,vA):null;return g.from(a)},yX=O("element","descHandler"),sl=function(a){if(!ye(a,"can")&&!ye(a,"abort")&&!ye(a,"run"))throw Error("EventHandler defined by: "+Nb.stringify(a,null,2)+" does not have can, abort, or run!");return Oe("Extracting event.handler",od([da("can",k(!0)),da("abort",k(!1)),da("run",t)]),a)},jfa=function(a,b){return function(){for(var c=
[],d=0;d<arguments.length;d++)c[d]=arguments[d];return hb(a,function(a,d){return a&&b(d).apply(void 0,c)},!0)}},kfa=function(a,b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];return hb(a,function(a,d){return a||b(d).apply(void 0,c)},!1)}},lfa=function(a){return vb(a)?{can:k(!0),abort:k(!1),run:a}:a},mfa=function(a){var b=jfa(a,function(a){return a.can}),c=kfa(a,function(a){return a.abort});return sl({can:b,abort:c,run:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=
arguments[c];z(a,function(a){a.run.apply(void 0,b)})}})},Te=function(a,b,c){Op(a,a.element(),b,c)},Op=function(a,b,c,d){d=oa({target:b},d);a.getSystem().triggerEvent(c,b,eb(d,k))},Yb=function(a,b){return{key:a,value:sl({run:b})}},Aw=function(a,b,c){return{key:a,value:sl({run:function(a){b.apply(void 0,[a].concat(c))}})}},Bw=function(a){return function(b){return{key:a,value:sl({run:function(a,d){N.eq(a.element(),d.event().target())&&b(a,d)}})}}},nfa=function(a,b){return Yb(a,function(c,d){c.getSystem().getByUid(b).each(function(b){var c=
b.element();b.getSystem().triggerEvent(a,c,d.event())})})},Ui=function(a,b,c){b=b.partUids()[c];return nfa(a,b)},Pp=Bw(mO()),ofa=Bw(nO()),pfa=Bw(ww());(function(a){return function(b){return Yb(a,b)}})(lO());var qfa=pb([function(a,b){return{key:a,value:sl({can:b})}}(yh(),function(a,b){var c=b.event().originator();b=b.event().target();return N.eq(c,a.element())&&!N.eq(c,b)?(ld.warn(yh()+" did not get interpreted by the desired target. \nOriginator: "+Tg(c)+"\nTarget: "+Tg(b)+"\nCheck the "+yh()+" event handlers"),
!1):!0})]),rfa=Object.freeze({events:qfa}),sfa=ca,tO=xd("debugInfo triggerFocus triggerEvent triggerEscape addToWorld removeFromWorld addToGui removeFromGui build getByUid getByDom broadcast broadcastOn isConnected".split(" ")),uO=function(a){var b=function(b){return function(){throw Error("The component must be in a context to send: "+b+"\n"+Tg(a().element())+" is not in context.");}};return tO({debugInfo:k("fake"),triggerEvent:b("triggerEvent"),triggerFocus:b("triggerFocus"),triggerEscape:b("triggerEscape"),
build:b("build"),addToWorld:b("addToWorld"),removeFromWorld:b("removeFromWorld"),addToGui:b("addToGui"),removeFromGui:b("removeFromGui"),getByUid:b("getByUid"),getByDom:b("getByDom"),broadcast:b("broadcast"),broadcastOn:b("broadcastOn"),isConnected:k(!1)})},tfa=function(a,b,c){c=c.toString();var d=c.indexOf(")")+1,e=c.indexOf("("),f=c.substring(e+1,d-1).split(/,\s*/);a.toFunctionAnnotation=function(){return{name:b,parameters:Cw(f.slice(0,1).concat(f.slice(3)))}};return a},Cw=function(a){return E(a,
function(a){return je(a,"/*")?a.substring(0,a.length-2):a})},Dw=function(a,b){var c=a.toString(),d=c.indexOf(")")+1,e=c.indexOf("("),f=c.substring(e+1,d-1).split(/,\s*/);a.toFunctionAnnotation=function(){return{name:b,parameters:Cw(f)}};return a},ufa=function(a,b){b=b.toString();var c=b.indexOf(")")+1,d=b.indexOf("("),e=b.substring(d+1,c-1).split(/,\s*/);a.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Cw(e.slice(1))}};return a},vfa=Ha("alloy-premade"),vO=Ha("api"),Ew=function(a){return ufa(function(b){for(var c=
[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];d=b.config(vO);return a.apply(void 0,[d].concat([b].concat(c)))},a)},wfa=k(vO),me={init:function(){return tl({readState:function(){return"No State required"}})}},tl=function(a){eh(fh,["readState"])(a);return a},xfa=function(a,b){var c=E(b,function(a){return fl(a.name(),[za("config"),da("state",me)])});c=tg("component.behaviours",Cc(c),a.behaviours).fold(function(b){throw Error(bp(b)+"\nComplete spec:\n"+Nb.stringify(a,null,2));},function(a){return a});
return{list:b,data:eb(c,function(a){var b=a().map(function(a){return{config:a.config(),state:a.state().init(a.config())}});return function(){return b}})}},wO=function(a,b){var c={};Ma(a,function(a,e){Ma(a,function(a,d){var f=WK(d,[])(c);c[d]=f.concat([b(e,a)])})});return c},Fw=Aa(["tag"],"classes attributes styles value innerHtml domChildren defChildren".split(" ")),zfa=function(a){a=yfa(a);return Nb.stringify(a,null,2)},yfa=function(a){return{tag:a.tag(),classes:a.classes().getOr([]),attributes:a.attributes().getOr({}),
styles:a.styles().getOr({}),value:a.value().getOr("<none>"),innerHtml:a.innerHtml().getOr("<none>"),defChildren:a.defChildren().fold(function(){return"<none>"},function(a){return Nb.stringify(a,null,2)}),domChildren:a.domChildren().fold(function(){return"<none>"},function(a){return 0===a.length?"0 children, but still specified":String(a.length)})}},Vi=Aa([],"classes attributes styles value innerHtml defChildren domChildren".split(" ")),xO=function(a,b,c){return b.fold(function(){return c.fold(function(){return{}},
function(b){return fc(a,b)})},function(b){return c.fold(function(){return fc(a,b)},function(b){return fc(a,b)})})},Afa=function(a,b){a=oa({tag:a.tag(),classes:b.classes().getOr([]).concat(a.classes().getOr([])),attributes:ua(a.attributes().getOr({}),b.attributes().getOr({})),styles:ua(a.styles().getOr({}),b.styles().getOr({}))},b.innerHtml().or(a.innerHtml()).map(function(a){return fc("innerHtml",a)}).getOr({}),xO("domChildren",b.domChildren(),a.domChildren()),xO("defChildren",b.defChildren(),a.defChildren()),
b.value().or(a.value()).map(function(a){return fc("value",a)}).getOr({}));return Fw(a)},Qp=function(a,b){return 1<a.length?J.error('Multiple behaviours have tried to change DOM "'+b+'". The guilty behaviours are: '+Nb.stringify(E(a,function(a){return a.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===a.length?J.value({}):J.value(a[0].modification().fold(function(){return{}},function(a){return fc(b,a)}))},Bfa=function(a,b,c,d){return J.error("Mulitple behaviours have tried to change the _"+
b+'_ "'+a+'". The guilty behaviours are: '+Nb.stringify(ia(d,function(a){return void 0!==a.modification().getOr({})[b]?[a.name()]:[]}),null,2)+". This is not currently supported.")},yO=function(a,b){return hb(a,function(c,d){var e=d.modification().getOr({});return c.bind(function(c){var d=Nf(e,function(d,f){return void 0!==c[f]?Bfa(b,f,e,a):J.value(fc(f,d))});return rv(d,c)})},J.value({})).map(function(a){return fc(b,a)})},Cfa={classes:function(a,b){a=ia(a,function(a){return a.modification().getOr([])});
return J.value(fc(b,a))},attributes:yO,styles:yO,domChildren:Qp,defChildren:Qp,innerHtml:Qp,value:Qp},Dfa=function(a,b,c,d){var e=oa({},b);z(c,function(b){e[b.name()]=b.exhibit(a,d)});b=wO(e,function(a,b){return{name:function(){return a},modification:b}});b=eb(b,function(a,b){return ia(a,function(a){return a.modification().fold(function(){return[]},function(b){return[a]})})});b=Nf(b,function(a,b){return zc(Cfa,b).fold(function(){return J.error("Unknown field type: "+b)},function(c){return c(a,b)})});
return rv(b,{}).map(Vi)},Efa=function(a,b,c,d){c=c.slice(0);try{var e=c.sort(function(c,e){c=c[b]();e=e[b]();var f=d.indexOf(c),h=d.indexOf(e);if(-1===f)throw Error("The ordering for "+a+" does not have an entry for "+c+".\nOrder specified: "+Nb.stringify(d,null,2));if(-1===h)throw Error("The ordering for "+a+" does not have an entry for "+e+".\nOrder specified: "+Nb.stringify(d,null,2));return f<h?-1:h<f?1:0});return J.value(e)}catch(f){return J.error([f])}},Ffa=function(a,b){return{name:k(a),handler:k(b)}},
Gfa=function(a,b){var c={};z(a,function(a){c[a.name()]=a.handlers(b)});return c},Hfa=function(a){var b=lfa(a);return function(a,d){for(var c=[],f=2;f<arguments.length;f++)c[f-2]=arguments[f];c=[a,d].concat(c);b.abort.apply(void 0,c)?d.stop():b.can.apply(void 0,c)&&b.run.apply(void 0,c)}},Ifa=function(a,b){return J.error(["The event ("+a+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+
Nb.stringify(E(b,function(a){return a.name()}),null,2)])},Jfa=function(a,b,c){return(b=b[c])?Efa("Event: "+c,"name",a,b).map(function(a){a=E(a,function(a){return a.handler()});return mfa(a)}):Ifa(c,a)},Kfa=function(a,b){a=Nf(a,function(a,d){return(1===a.length?J.value(a[0].handler()):Jfa(a,b,d)).map(function(c){c=Hfa(c);var e=1<a.length?ka(b,function(b){return U(a,function(a){return a.name()===b})}).join(" > "):a[0].name();return qv(d,{handler:c,purpose:k(e)})})});return rv(a,{})},Lfa=k([za("menu"),
za("selectedMenu")]),zO=k([za("item"),za("selectedItem")]);k(od(zO().concat(Lfa())));k(od(zO()));var Mfa=el("initSize",[za("numColumns"),za("numRows")]),Gw=function(a,b,c){Zea();return Dc(b,b,c,bL(function(a){return J.value(function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a.apply(void 0,b)})}))},Ag=function(a){return Gw("onHandler",a,Ne.defaultedThunk(k(t)))},Xd=function(a){return Gw("onKeyboardHandler",a,Ne.defaultedThunk(k(g.none)))},Bg=function(a,b){return ug(a,k(b))},
Nfa=k(Mfa),Ofa=function(a){return tg("custom.definition",od([Dc("dom","dom",sg(),od([za("tag"),da("styles",{}),da("classes",[]),da("attributes",{}),Dd("value"),Dd("innerHtml")])),za("components"),za("uid"),da("events",{}),da("apis",k({})),Dc("eventOrder","eventOrder",Ne.mergeWithThunk(k({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour",
"representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"],mousedown:["focusing","alloy.base.behaviour","item-type-events"]})),cp()),Dd("domModification"),al("originalSpec",ca),da("debug.sketcher","unknown")]),a)},Pfa=function(a){return qv(sO(),a.uid())},Qfa=function(a){var b={tag:a.dom().tag(),classes:a.dom().classes(),attributes:oa(Pfa(a),a.dom().attributes()),styles:a.dom().styles(),domChildren:E(a.components(),function(a){return a.element()})};return Fw(oa(b,
a.dom().innerHtml().map(function(a){return fc("innerHtml",a)}).getOr({}),a.dom().value().map(function(a){return fc("value",a)}).getOr({})))},Rfa=function(a){return a.domModification().fold(function(){return Vi({})},Vi)},Tfa=function(a){if(a.domChildren().isSome()&&a.defChildren().isSome())throw Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+zfa(a));return a.domChildren().fold(function(){var b=a.defChildren().getOr([]);return E(b,Sfa)},function(a){return a})},AO=
function(a){var b=r.fromTag(a.tag());m.setAll(b,a.attributes().getOr({}));ma.add(b,a.classes().getOr([]));v.setAll(b,a.styles().getOr({}));Ea.set(b,a.innerHtml().getOr(""));var c=Tfa(a);P.append(b,c);a.value().each(function(a){fa.set(b,a)});return b},Sfa=function(a){a=Fw(a);return AO(a)},Ufa=function(a){var b=zc(a,"behaviours").getOr({});a=ka(cb(b),function(a){return void 0!==b[a]});return E(a,function(a){return b[a].me})},Vfa=function(a){var b=Ufa(a);return xfa(a,b)},Wfa=xd("getSystem config hasConfigured spec connect disconnect element syncComponents readState components events".split(" ")),
Xfa=function(a,b,c){var d=Qfa(a);a={"alloy.base.modification":Rfa(a)};b=Dfa(c,a,b,d).getOrDie();return Afa(d,b)},Yfa=function(a,b,c){var d={"alloy.base.behaviour":a.events()};a=a.eventOrder();b=oa(d,Gfa(b,c));b=wO(b,Ffa);return Kfa(b,a).getOrDie()},Zfa=function(a){var b=function(){return n},c=na(uO(b)),d=Ki(Ofa(oa(a,{behaviours:void 0}))),e=Vfa(a),f=e.list,h=e.data;e=Xfa(d,f,h);var g=AO(e);f=Yfa(d,f,h);var m=na(d.components()),n=Wfa({getSystem:c.get,config:function(b){if(b===wfa())return d.apis();
if(xa(b))throw Error("Invalid input: only API constant is allowed");return(vb(h[b.name()])?h[b.name()]:function(){throw Error("Could not find "+b.name()+" in "+Nb.stringify(a,null,2));})()},hasConfigured:function(a){return vb(h[a.name()])},spec:k(a),readState:function(a){return h[a]().map(function(a){return a.state.readState()}).getOr("not enabled")},connect:function(a){c.set(a)},disconnect:function(){c.set(uO(b))},element:k(g),syncComponents:function(){var a=A.children(g);a=ia(a,function(a){return c.get().getByDom(a).fold(function(){return[]},
function(a){return[a]})});m.set(a)},components:m.get,events:k(f)});return n},Em=function(a){return zc(a,vfa).fold(function(){var b=oa({uid:Ha("")},a);b=sfa(b);var c=WK("components",[])(b);c=E(c,Em);b=oa(rfa,b,fc("components",c));return J.value(Zfa(b)).getOrDie()},function(a){return a})},ul=function(a,b){return eba(a,{},E(b,function(b){return dba(b.name(),"Cannot configure "+b.name()+" for "+a)}).concat([al("dump",ca)]))},Rp=ta.generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),
$fa=function(a,b,c,d){return a.exists(function(a){return a!==c.owner})?Rp.single(!0,k(c)):zc(d,c.name).fold(function(){throw Error("Unknown placeholder component: "+c.name+"\nKnown: ["+cb(d)+"]\nNamespace: "+a.getOr("none")+"\nSpec: "+Nb.stringify(c,null,2));},function(a){return a.replace()})},aga=function(a,b,c,d){return"placeholder"===c.uiType?$fa(a,b,c,d):Rp.single(!1,k(c))},BO=function(a,b,c,d){return aga(a,b,c,d).fold(function(e,f){e=f(b,c.config,c.validated);f=zc(e,"components").getOr([]);f=
ia(f,function(c){return BO(a,b,c,d)});return[oa(e,{components:f})]},function(a,d){return d(b,c.config,c.validated)})},bga=function(a,b,c,d){return ia(c,function(c){return BO(a,b,c,d)})},cga=function(a,b){var c=!1;return{name:k(a),required:function(){return b.fold(function(a,b){return a},function(a,b){return a})},used:function(){return c},replace:function(){if(!0===c)throw Error("Trying to use the same placeholder more than once: "+a);c=!0;return b}}},dga=function(a,b,c,d){d=eb(d,function(a,b){return cga(b,
a)});c=bga(a,b,c,d);Ma(d,function(c){if(!1===c.used()&&c.required())throw Error("Placeholder: "+c.name()+" was not found in components list\nNamespace: "+a.getOr("none")+"\nComponents: "+Nb.stringify(b.components(),null,2));});return c},CO=Rp.single,ega=Rp.multiple,DO=k("placeholder"),EO=ta.generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Hw=da("factory",{sketch:ca}),Iw=da("schema",[]),Jw=za("name"),Kw=Dc("pname","pname",Gaa(function(a){return"<alloy."+Ha(a.name)+
">"}),cp()),Lw=da("defaults",k({})),Mw=da("overrides",k({})),fga=Cc([Hw,Iw,Jw,Kw,Lw,Mw]),gga=Cc([Hw,Iw,Jw,Kw,Lw,Mw]);Cc([Hw,Iw,Jw,za("unit"),Kw,Lw,Mw]);var hga=function(a){var b=function(a){return a.name()};return a.fold(b,b,b,b)},FO=function(a,b){return function(c){c=Ki(tg("Converting part type",b,c));return a(c)}},Sp=FO(EO.required,fga),Nw=FO(EO.optional,gga),GO=k("entirety"),Ow=function(a,b,c,d){return oa(b.defaults()(a,c,d),c,{uid:a.partUids()[b.name()]},b.overrides()(a,c,d),{"debug.sketcher":qv("part-"+
b.name(),c)})},iga=function(a,b,c){var d={},e={};z(c,function(a){a.fold(function(a){d[a.pname()]=CO(!0,function(b,c,d){return a.factory().sketch(Ow(b,a,c,d))})},function(a){var c=b.parts()[a.name()]();e[a.name()]=k(Ow(b,a,c[GO()]()))},function(a){d[a.pname()]=CO(!1,function(b,c,d){return a.factory().sketch(Ow(b,a,c,d))})},function(a){d[a.pname()]=ega(!0,function(b,c,d){c=b[a.name()]();return E(c,function(c){return a.factory().sketch(oa(a.defaults()(b,c),c,a.overrides()(b,c)))})})})});return{internals:k(d),
externals:k(e)}},kga=function(a,b){var c={};z(b,function(b){b.fold(g.some,g.none,g.some,g.some).each(function(b){var d=jga(a,b.pname());c[b.name()]=function(c){var e=Oe("Part: "+b.name()+" in "+a,Cc(b.schema()),c);return oa(d,{config:c,validated:e})}})});return c},jga=function(a,b){return{uiType:DO(),owner:a,name:b}},lga=function(a){return ia(a,function(a){return a.fold(g.none,g.some,g.none,g.none).map(function(a){return el(a.name(),a.schema().concat([al(GO(),ca)]))}).toArray()})},ne=function(a,b,
c){b=b.partUids()[c];return a.getSystem().getByUid(b).toOption()},HO=function(a,b,c){return ne(a,b,c).getOrDie("Could not find part: "+c)},mga=function(a,b,c){var d={},e=b.partUids(),f=a.getSystem();z(c,function(a){d[a]=f.getByUid(e[a])});return eb(d,k)},nga=function(a,b){var c=a.getSystem();return eb(b.partUids(),function(a,b){return k(c.getByUid(a))})},oga=function(a,b){b=E(b,hga);return pb(E(b,function(b){return{key:b,value:a+"-"+b}}))},pga=function(a){return Dc("partUids","partUids",Haa(function(b){return oga(b.uid,
a)}),cp())},IO=function(a,b,c,d,e){d=(0<d.length?[el("parts",d)]:[]).concat([za("uid"),da("dom",{}),da("components",[]),al("originalSpec",ca),da("debug.sketcher",{})]).concat(e);b=od(d.concat(b));return Ki(tg(a+" [SpecSchema]",b,c))},KO=function(a,b,c,d,e){var f=JO(e),h=lga(c),k=pga(c);b=IO(a,b,f,h,[k]);c=iga(a,b,c);h=c.internals();h=dga(g.some(a),b,b.components(),h);return oa(d(b,h,f,c.externals()),{"debug.sketcher":fc(a,e)})},JO=function(a){return oa({uid:Ha("uid")},a)},qga=od([za("name"),za("factory"),
za("configFields"),da("apis",{}),da("extraApis",{})]),rga=od([za("name"),za("factory"),za("configFields"),za("partFields"),da("apis",{}),da("extraApis",{})]),vl=function(a){var b=Oe("Sketcher for "+a.name,qga,a);a=eb(b.apis,Ew);var c=eb(b.extraApis,function(a,b){return Dw(a,b)});return oa({name:k(b.name),partFields:k([]),configFields:k(b.configFields),sketch:function(a){var c=b.name,d=b.configFields,h=b.factory,g=JO(a);d=IO(c,d,g,[],[]);return oa(h(d,g),{"debug.sketcher":fc(c,a)})}},a,c)},LO=function(a){var b=
Oe("Sketcher for "+a.name,rga,a);a=kga(b.name,b.partFields);var c=eb(b.apis,Ew),d=eb(b.extraApis,function(a,b){return Dw(a,b)});return oa({name:k(b.name),partFields:k(b.partFields),configFields:k(b.configFields),sketch:function(a){return KO(b.name,b.configFields,b.partFields,b.factory,a)},parts:k(a)},c,d)},sga=vl({name:"Container",factory:function(a){return{uid:a.uid(),dom:oa({tag:"div",attributes:{role:"presentation"}},a.dom()),components:a.components(),behaviours:a.containerBehaviours().dump(),
events:a.events(),domModification:a.domModification(),eventOrder:a.eventOrder()}},configFields:[da("components",[]),ul("containerBehaviours",[]),da("events",{}),da("domModification",{}),da("eventOrder",{})]}),MO=function(a){var b=nO();Op(a,a.element(),b,{});a=a.components();z(a,MO)},Pw=function(a){var b=a.components();z(b,Pw);b=mO();Op(a,a.element(),b,{})},tga=function(a){MO(a);G.remove(a.element());a.getSystem().removeFromWorld(a)},NO=function(a){var b=A.parent(a.element()).bind(function(b){return a.getSystem().getByDom(b).fold(g.none,
g.some)});tga(a);b.each(function(a){a.syncComponents()})},FX=function(a,b){y.append(a,b.element());a=A.children(b.element());z(a,function(a){b.getByDom(a).each(Pw)})},DX=function(){var a=Em(sga.sketch({dom:{tag:"div"}}));return uga(a)},uga=function(a){var b=function(b){return A.parent(a.element()).fold(function(){return!0},function(a){return N.eq(b,a)})},c=AX(),d=function(a,d){return c.find(b,a,d)},e=efa(a.element(),{triggerEvent:function(a,b){return xw(a,b.target(),function(c){var e=b.target(),f=
yw(b,e);return zw(d,a,b,e,f,c)})},broadcastEvent:function(a,b){a=c.filter(a);return hfa(a,b)}}),f=tO({debugInfo:k("real"),triggerEvent:function(a,b,c){xw(a,b,function(e){var f=yw(c,b);zw(d,a,c,b,f,e)})},triggerFocus:function(a,b){Jj(a).fold(function(){Z.focus(a)},function(c){xw(yh(),a,function(c){var e=yh(),f={originator:k(b),kill:t,prevent:t,target:k(a)},h=yw(f,a);rO(d,e,f,a,h,c)})})},triggerEscape:function(a,b){f.triggerEvent("keydown",a.element(),b.event())},getByUid:function(a){return r(a)},getByDom:function(a){return u(a)},
build:Em,addToGui:function(a){m(a)},removeFromGui:function(a){NO(a)},addToWorld:function(a){h(a)},removeFromWorld:function(a){g(a)},broadcast:function(a){w(a)},broadcastOn:function(a,b){p(a,b)},isConnected:k(!0)}),h=function(a){a.connect(f);D.isText(a.element())||(c.register(a),z(a.components(),h),f.triggerEvent(ww(),a.element(),{target:k(a.element())}))},g=function(a){D.isText(a.element())||(z(a.components(),g),c.unregister(a));a.disconnect()},m=function(b){var c=y.append;a.getSystem().addToWorld(b);
c(a.element(),b.element());ja.inBody(a.element())&&Pw(b);a.syncComponents()},n=function(a){var b=c.filter(kO());z(b,function(b){b=b.descHandler().cHandler;b(a)})},w=function(a){n({universal:k(!0),data:k(a)})},p=function(a,b){n({universal:k(!1),channels:k(a),data:k(b)})},r=function(a){return c.getById(a).fold(function(){return J.error(Error('Could not find component with uid: "'+a+'" in system.'))},J.value)},u=function(a){a=Jj(a).getOr("not found");return r(a)};h(a);return{root:k(a),element:a.element,
destroy:function(){e.unbind();G.remove(a.element())},add:m,remove:function(a){NO(a)},getByUid:r,getByDom:u,addToWorld:h,removeFromWorld:g,broadcast:w,broadcastOn:p}},vga=function(a,b,c){return pfa(function(d,e){c(d,a,b)})},wga=function(a,b,c){return tfa(function(d){for(var e=[],f=1;f<arguments.length;f++)e[f-1]=arguments[f];var h=[d].concat(e);return d.config({name:k(a)}).fold(function(){throw Error("We could not find any behaviour configuration for: "+a+". Using API: "+c);},function(a){var c=Array.prototype.slice.call(h,
1);return b.apply(void 0,[d,a.config,a.state].concat(c))})},c,b)},xga=function(a){return{key:a,value:void 0}},OO=function(a,b,c,d,e,f,h){var k=function(a){return ye(a,c)?a[c]():g.none()};e=eb(e,function(a,b){return wga(c,a,b)});f=eb(f,function(a,b){return Dw(a,b)});var m=oa(f,e,{revoke:u(xga,c),config:function(b){var d=Ki(tg(c+"-config",a,b));return{key:c,value:{config:d,me:m,configAsRaw:gc(function(){return Oe(c+"-config",a,b)}),initialConfig:b,state:h}}},schema:function(){return b},exhibit:function(a,
b){return k(a).bind(function(a){return zc(d,"exhibit").map(function(c){return c(b,a.config,a.state)})}).getOr(Vi({}))},name:function(){return c},handlers:function(a){return k(a).bind(function(a){return zc(d,"events").map(function(b){return b(a.config,a.state)})}).getOr({})}});return m},yga=od([za("fields"),za("name"),da("active",{}),da("apis",{}),da("state",me),da("extra",{})]),Cg=function(a){var b=Oe("Creating behaviour: "+a.name,yga,a),c=b.fields;a=b.name;var d=b.active,e=b.apis,f=b.extra;b=b.state;
var h=od(c);c=Dc("config","config",Yk(),od(c));c=fl(a,[c]);return OO(h,c,a,d,e,f,b)},zga=od([za("branchKey"),za("branches"),za("name"),da("active",{}),da("apis",{}),da("state",me),da("extra",{})]),Aga=function(a,b,c){var d=kd(a.slice(0,b));a=kd(a.slice(b+1));return qa(d.concat(a),c)},Bga=function(a,b,c){a=kd(a.slice(0,b));return qa(a,c)},Cga=function(a,b,c){var d=a.slice(0,b);a=a.slice(b+1);return qa(a.concat(d),c)},Dga=function(a,b,c){a=a.slice(b+1);return qa(a,c)},Qa=function(a){return function(b){b=
b.raw();return U(a,b.which)}},oe=function(a){return function(b){return ob(a,function(a){return a(b)})}},Wi=function(a){return!0===a.raw().shiftKey},Ega=function(a){return!0===a.raw().ctrlKey},wl=zf(Wi),Sa=function(a,b){return{matches:a,classification:b}},Fga=function(a,b){return qa(a,function(a){return a.matches(b)}).map(function(a){return a.classification})},Xi=function(a,b,c,d){a+=b;return a>d?c:a<c?d:a},xl=function(a,b,c){return a<=b?b:a>=c?c:a},PO=function(a,b,c){c=Y.descendants(a.element(),"."+
b.highlightClass());z(c,function(c){n.remove(c,b.highlightClass());a.getSystem().getByDom(c).each(function(c){b.onDehighlight()(a,c)})})},yl=function(a,b,c,d){var e=Qw(a,b,c,d);PO(a,b,c);n.add(d.element(),b.highlightClass());e||b.onHighlight()(a,d)},Qw=function(a,b,c,d){return n.has(d.element(),b.highlightClass())},Gga=function(a,b,c,d){b=Y.descendants(a.element(),"."+b.itemClass());return g.from(b[d]).fold(function(){return J.error("No element found with index "+d)},a.getSystem().getByDom)},QO=function(a,
b,c){return L.descendant(a.element(),"."+b.itemClass()).bind(function(b){return a.getSystem().getByDom(b).toOption()})},RO=function(a,b,c){b=Y.descendants(a.element(),"."+b.itemClass());return(0<b.length?g.some(b[b.length-1]):g.none()).bind(function(b){return a.getSystem().getByDom(b).toOption()})},SO=function(a,b,c,d){var e=Y.descendants(a.element(),"."+b.itemClass());return Va(e,function(a){return n.has(a,b.highlightClass())}).bind(function(b){b=Xi(b,d,0,e.length-1);return a.getSystem().getByDom(e[b]).toOption()})},
TO=function(a,b,c){b=Y.descendants(a.element(),"."+b.itemClass());return ee(E(b,function(b){return a.getSystem().getByDom(b).toOption()}))},Hga=Object.freeze({dehighlightAll:PO,dehighlight:function(a,b,c,d){c=Qw(a,b,c,d);n.remove(d.element(),b.highlightClass());c&&b.onDehighlight()(a,d)},highlight:yl,highlightFirst:function(a,b,c){QO(a,b,c).each(function(d){yl(a,b,c,d)})},highlightLast:function(a,b,c){RO(a,b,c).each(function(d){yl(a,b,c,d)})},highlightAt:function(a,b,c,d){Gga(a,b,c,d).fold(function(a){throw Error(a);
},function(d){yl(a,b,c,d)})},highlightBy:function(a,b,c,d){var e=TO(a,b,c);qa(e,d).each(function(d){yl(a,b,c,d)})},isHighlighted:Qw,getHighlighted:function(a,b,c){return L.descendant(a.element(),"."+b.highlightClass()).bind(function(b){return a.getSystem().getByDom(b).toOption()})},getFirst:QO,getLast:RO,getPrevious:function(a,b,c){return SO(a,b,c,-1)},getNext:function(a,b,c){return SO(a,b,c,1)},getCandidates:TO}),Iga=[za("highlightClass"),za("itemClass"),Ag("onHighlight"),Ag("onDehighlight")];Cg({fields:Iga,
name:"highlighting",apis:Hga});var Jga=function(){return{get:function(a){return Z.search(a.element())},set:function(a,b){a.getSystem().triggerFocus(b,a.element())}}},zh=function(a,b,c,d,e,f){var h=function(a,b,d,e){var f=c(a,b,d,e);return Fga(f,b.event()).bind(function(c){return c(a,b,d,e)})},g={schema:function(){return a.concat([da("focusManager",Jga()),Bg("handler",g),Bg("state",b)])},processKey:h,toEvents:function(a,b){var c=d(a,b),e=pb(f.map(function(c){return Yb(yh(),function(d,e){c(d,a,b,e);
e.stop()})}).toArray().concat([Yb(Tea(),function(c,d){h(c,d,a,b).each(function(a){d.stop()})})]));return oa(c,e)},toApis:e};return g},UO=function(a){a=[Dd("onEscape"),Dd("onEnter"),da("selector",'[data-alloy-tabstop="true"]'),da("firstTabstop",0),da("useTabstopAt",k(!0)),Dd("visibilitySelector")].concat([a]);var b=function(a,b){a=a.visibilitySelector().bind(function(a){return L.closest(b,a)}).getOr(b);return 0<sa.get(a)},c=function(a,c){a=Y.descendants(a.element(),c.selector());a=ka(a,function(a){return b(c,
a)});return g.from(a[c.firstTabstop()])},d=function(a,b){return b.focusManager().get(a).bind(function(a){return L.closest(a,b.selector())})},e=function(a,c,d,e,f){return f(c,d,function(a){return b(e,a)&&e.useTabstopAt()(a)}).fold(function(){return e.cyclic()?g.some(!0):g.none()},function(b){e.focusManager().set(a,b);return g.some(!0)})},f=function(a,b,c,f){var h=Y.descendants(a.element(),c.selector());return d(a,c).bind(function(b){return Va(h,u(N.eq,b)).bind(function(b){return e(a,h,b,c,f)})})},
h=k([Sa(oe([Wi,Qa([9])]),function(a,b,c,d){d=c.cyclic()?Aga:Bga;return f(a,b,c,d)}),Sa(Qa([9]),function(a,b,c,d){d=c.cyclic()?Cga:Dga;return f(a,b,c,d)}),Sa(Qa([27]),function(a,b,c,d){return c.onEscape().bind(function(c){return c(a,b)})}),Sa(oe([wl,Qa([13])]),function(a,b,c,d){return c.onEnter().bind(function(c){return c(a,b)})})]),l=k({}),m=k({});return zh(a,me.init,h,l,m,g.some(function(a,b){c(a,b).each(function(c){b.focusManager().set(a,c)})}))},Kga=UO(ug("cyclic",k(!1))),Lga=UO(ug("cyclic",k(!0))),
VO=function(a){return"input"===D.name(a)&&"radio"!==m.get(a,"type")||"textarea"===D.name(a)},zl=function(a,b,c){VO(c)&&Qa([32])(b.event())?a=g.none():(b=lO(),Op(a,c,b,{}),a=g.some(!0));return a},Mga=[da("execute",zl),da("useSpace",!1),da("useEnter",!0),da("useControlEnter",!1),da("useDown",!1)],WO=function(a,b,c){return c.execute()(a,b,a.element())},Nga=k({}),Oga=k({}),Pga=zh(Mga,me.init,function(a,b,c,d){a=c.useSpace()&&!VO(a.element())?[32]:[];b=c.useEnter()?[13]:[];d=c.useDown()?[40]:[];a=a.concat(b).concat(d);
return[Sa(Qa(a),WO)].concat(c.useControlEnter()?[Sa(oe([Ega,Qa([13])]),WO)]:[])},Nga,Oga,g.none()),XO=function(a){var b=na(g.none());return tl({readState:k({}),setGridSize:function(a,d){b.set(g.some({numRows:k(a),numColumns:k(d)}))},getNumRows:function(){return b.get().map(function(a){return a.numRows()})},getNumColumns:function(){return b.get().map(function(a){return a.numColumns()})}})},Qga=Object.freeze({flatgrid:XO,init:function(a){return a.state()(a)}}),ZO=function(a){return function(b,c,d,e){var f=
a(b.element());return YO(f,b,c,d,e)}},Rw=function(a,b){a=ae.onDirection(a,b);return ZO(a)},Sw=function(a,b){a=ae.onDirection(b,a);return ZO(a)},Dg=function(a){return function(b,c,d,e){return YO(a,b,c,d,e)}},YO=function(a,b,c,d,e){return d.focusManager().get(b).bind(function(c){return a(b.element(),c,d,e)}).map(function(a){d.focusManager().set(b,a);return!0})},Rga=Aa(["index","candidates"],[]),Sga=function(a,b){return Va(a,b).map(function(b){return Rga({index:b,candidates:a})})},$O=function(a,b,c){b=
u(N.eq,b);a=Y.descendants(a,c);a=ka(a,sc.isVisible);return Sga(a,b)},aP=function(a,b){return Va(a,function(a){return N.eq(b,a)})},bP=function(a,b,c,d){return d(Math.floor(b/c),b%c).bind(function(b){b=b.row()*c+b.column();return 0<=b&&b<a.length?g.some(a[b]):g.none()})},cP=function(a,b,c,d,e){return bP(a,b,d,function(b,h){h=Xi(h,e,0,(b===c-1?a.length-b*d:d)-1);return g.some({row:k(b),column:k(h)})})},dP=function(a,b,c,d,e){return bP(a,b,d,function(b,h){b=Xi(b,e,0,c-1);h=xl(h,0,(b===c-1?a.length-b*
d:d)-1);return g.some({row:k(b),column:k(h)})})},Tga=[za("selector"),da("execute",zl),Xd("onEscape"),da("captureTab",!1),Nfa()],Uga=function(a,b){return b.focusManager().get(a).bind(function(a){return L.closest(a,b.selector())})},Tp=function(a){return function(b,c,d,e){return $O(b,c,d.selector()).bind(function(b){return a(b.candidates(),b.index(),e.getNumRows().getOr(d.initSize().numRows()),e.getNumColumns().getOr(d.initSize().numColumns()))})}},eP=function(a,b,c,d){return c.captureTab()?g.some(!0):
g.none()},fP=Tp(function(a,b,c,d){return cP(a,b,c,d,-1)}),gP=Tp(function(a,b,c,d){return cP(a,b,c,d,1)}),Vga=Tp(function(a,b,c,d){return dP(a,b,c,d,-1)}),Wga=Tp(function(a,b,c,d){return dP(a,b,c,d,1)}),Xga=k([Sa(Qa([37]),Rw(fP,gP)),Sa(Qa([39]),Sw(fP,gP)),Sa(Qa([38]),Dg(Vga)),Sa(Qa([40]),Dg(Wga)),Sa(oe([Wi,Qa([9])]),eP),Sa(oe([wl,Qa([9])]),eP),Sa(Qa([27]),function(a,b,c,d){return c.onEscape()(a,b)}),Sa(Qa([32].concat([13])),function(a,b,c,d){return Uga(a,c).bind(function(d){return c.execute()(a,b,
d)})})]),Yga=k({}),Zga=zh(Tga,XO,Xga,Yga,{},g.some(function(a,b,c){L.descendant(a.element(),b.selector()).each(function(c){b.focusManager().set(a,c)})})),Up=function(a,b,c,d){return $O(a,c,b).bind(function(a){var b=a.index();a=a.candidates();b=Xi(b,d,0,a.length-1);return g.from(a[b])})},$ga=[za("selector"),da("getInitial",g.none),da("execute",zl),Xd("onEscape"),da("executeOnMove",!1),da("allowVertical",!0)],aha=function(a,b){return b.focusManager().get(a).bind(function(a){return L.closest(a,b.selector())})},
Tw=function(a,b,c){return aha(a,c).bind(function(d){return c.execute()(a,b,d)})},hP=function(a,b,c){return Up(a,c.selector(),b,-1)},iP=function(a,b,c){return Up(a,c.selector(),b,1)},jP=function(a){return function(b,c,d){return a(b,c,d).bind(function(){return d.executeOnMove()?Tw(b,c,d):g.some(!0)})}},bha=function(a,b,c,d){return c.onEscape()(a,b)},cha=k({}),dha=k({}),eha=zh($ga,me.init,function(a,b,c,d){a=[37].concat(c.allowVertical()?[38]:[]);c=[39].concat(c.allowVertical()?[40]:[]);return[Sa(Qa(a),
jP(Rw(hP,iP))),Sa(Qa(c),jP(Sw(hP,iP))),Sa(Qa([13]),Tw),Sa(Qa([32]),Tw),Sa(Qa([27]),bha)]},cha,dha,g.some(function(a,b){b.getInitial()(a).or(L.descendant(a.element(),b.selector())).each(function(c){b.focusManager().set(a,c)})})),fha=Aa(["rowIndex","columnIndex","cell"],[]),Vp=function(a,b,c){return g.from(a[b]).bind(function(a){return g.from(a[c]).map(function(a){return fha({rowIndex:b,columnIndex:c,cell:a})})})},kP=function(a,b,c,d){c=Xi(c,d,0,a[b].length-1);return Vp(a,b,c)},lP=function(a,b,c,d){c=
Xi(c,d,0,a.length-1);b=xl(b,0,a[c].length-1);return Vp(a,c,b)},mP=function(a,b,c,d){c=xl(c+d,0,a[b].length-1);return Vp(a,b,c)},nP=function(a,b,c,d){c=xl(c+d,0,a.length-1);b=xl(b,0,a[c].length-1);return Vp(a,c,b)},gha=[el("selectors",[za("row"),za("cell")]),da("cycles",!0),da("previousSelector",g.none),da("execute",zl)],hha=function(a,b){return E(a,function(a){return Y.descendants(a,b.selectors().cell())})},Wp=function(a,b){return function(c,d,e){var f=e.cycles()?a:b;return L.closest(d,e.selectors().row()).bind(function(a){var b=
Y.descendants(a,e.selectors().cell());return aP(b,d).bind(function(b){var d=Y.descendants(c,e.selectors().row());return aP(d,a).bind(function(a){var c=hha(d,e);return f(c,a,b).map(function(a){return a.cell()})})})})}},oP=Wp(function(a,b,c){return kP(a,b,c,-1)},function(a,b,c){return mP(a,b,c,-1)}),pP=Wp(function(a,b,c){return kP(a,b,c,1)},function(a,b,c){return mP(a,b,c,1)}),iha=Wp(function(a,b,c){return lP(a,c,b,-1)},function(a,b,c){return nP(a,c,b,-1)}),jha=Wp(function(a,b,c){return lP(a,c,b,1)},
function(a,b,c){return nP(a,c,b,1)}),kha=k([Sa(Qa([37]),Rw(oP,pP)),Sa(Qa([39]),Sw(oP,pP)),Sa(Qa([38]),Dg(iha)),Sa(Qa([40]),Dg(jha)),Sa(Qa([32].concat([13])),function(a,b,c){return Z.search(a.element()).bind(function(d){return c.execute()(a,b,d)})})]),lha=k({}),mha=k({}),nha=zh(gha,me.init,kha,lha,mha,g.some(function(a,b){b.previousSelector()(a).orThunk(function(){var c=b.selectors();return L.descendant(a.element(),c.cell())}).each(function(c){b.focusManager().set(a,c)})})),oha=[za("selector"),da("execute",
zl),da("moveOnTab",!1)],qP=function(a,b,c){return c.focusManager().get(a).bind(function(d){return c.execute()(a,b,d)})},rP=function(a,b,c){return Up(a,c.selector(),b,-1)},sP=function(a,b,c){return Up(a,c.selector(),b,1)},pha=k([Sa(Qa([38]),Dg(rP)),Sa(Qa([40]),Dg(sP)),Sa(oe([Wi,Qa([9])]),function(a,b,c){return c.moveOnTab()?Dg(rP)(a,b,c):g.none()}),Sa(oe([wl,Qa([9])]),function(a,b,c){return c.moveOnTab()?Dg(sP)(a,b,c):g.none()}),Sa(Qa([13]),qP),Sa(Qa([32]),qP)]),qha=k({}),rha=k({}),sha=zh(oha,me.init,
pha,qha,rha,g.some(function(a,b){L.descendant(a.element(),b.selector()).each(function(c){b.focusManager().set(a,c)})})),tha=[Xd("onSpace"),Xd("onEnter"),Xd("onShiftEnter"),Xd("onLeft"),Xd("onRight"),Xd("onTab"),Xd("onShiftTab"),Xd("onUp"),Xd("onDown"),Xd("onEscape"),Dd("focusIn")],uha=zh(tha,me.init,function(a,b,c){return[Sa(Qa([32]),c.onSpace()),Sa(oe([wl,Qa([13])]),c.onEnter()),Sa(oe([Wi,Qa([13])]),c.onShiftEnter()),Sa(oe([Wi,Qa([9])]),c.onShiftTab()),Sa(oe([wl,Qa([9])]),c.onTab()),Sa(Qa([38]),
c.onUp()),Sa(Qa([40]),c.onDown()),Sa(Qa([37]),c.onLeft()),Sa(Qa([39]),c.onRight()),Sa(Qa([32]),c.onSpace()),Sa(Qa([27]),c.onEscape())]},function(){return{}},function(){return{}},g.some(function(a,b){return b.focusIn().bind(function(c){return c(a,b)})})),vha=Kga.schema(),wha=Lga.schema(),xha=eha.schema(),yha=Zga.schema(),zha=nha.schema(),Aha=Pga.schema(),Bha=sha.schema(),Cha=uha.schema(),Al=function(a){var b=Oe("Creating behaviour: "+a.name,zga,a);a=aL(b.branchKey,b.branches);var c=b.name,d=b.active,
e=b.apis,f=b.extra;b=b.state;var h=fl(c,[pL("config",a)]);return OO(a,h,c,d,e,f,b)}({branchKey:"mode",branches:Object.freeze({acyclic:vha,cyclic:wha,flow:xha,flatgrid:yha,matrix:zha,execution:Aha,menu:Bha,special:Cha}),name:"keying",active:{events:function(a,b){return a.handler().toEvents(a,b)}},apis:{focusIn:function(a){a.getSystem().triggerFocus(a.element(),a.element())},setGridSize:function(a,b,c,d,e){ye(c,"setGridSize")?c.setGridSize(d,e):ld.error("Layout does not support setGridSize")}},state:Qga}),
Dha=Object.freeze({getCurrent:function(a,b,c){return b.find()(a)}}),Eha=[za("find")],ze=Cg({fields:Eha,name:"composing",apis:Dha}),tP=function(a,b){b.ignore()||(Z.focus(a.element()),b.onFocus()(a))},Fha=Object.freeze({focus:tP,blur:function(a,b){b.ignore()||Z.blur(a.element())},isFocused:function(a){return Z.hasFocus(a.element())}}),Gha=Object.freeze({exhibit:function(a,b){a=b.ignore()?{}:{attributes:{tabindex:"-1"}};return Vi(a)},events:function(a){return pb([Yb(yh(),function(b,c){tP(b,a);c.stop()})].concat(a.stopMousedown()?
[Yb(ql(),function(a,c){c.event().prevent()})]:[]))}}),Hha=[Ag("onFocus"),da("stopMousedown",!1),da("ignore",!1)],Yi=Cg({fields:Hha,name:"focusing",active:Gha,apis:Fha}),Uw=aa.detect().deviceType.isTouch(),Eg=function(a){return Nw({name:""+a+"-edge",overrides:function(b){return b.model().manager().edgeActions()[a].fold(function(){return{}},function(a){var c=pb([Aw(pl(),a,[b])]),e=pb([Aw(ql(),a,[b]),Aw(vw(),function(b,c){c.mouseIsDown().get()&&a(b,c)},[b])]);return{events:Uw?c:e}})}})},Iha=Eg("top-left"),
Jha=Eg("top"),Kha=Eg("top-right"),Lha=Eg("right"),Mha=Eg("bottom-right"),Nha=Eg("bottom"),Oha=Eg("bottom-left"),Pha=Eg("left"),Qha=Sp({name:"thumb",defaults:k({dom:{styles:{position:"absolute"}}}),overrides:function(a){return{events:pb([Ui(pl(),a,"spectrum"),Ui(tw(),a,"spectrum"),Ui(uw(),a,"spectrum"),Ui(ql(),a,"spectrum"),Ui(vw(),a,"spectrum"),Ui(jO(),a,"spectrum")])}}}),Rha=Sp({schema:[ug("mouseIsDown",function(){return na(!1)})],name:"spectrum",overrides:function(a){var b=a.model().manager(),c=
function(c,d){return b.getValueFromEvent(d).map(function(d){return b.setValueFrom(c,a,d)})},d=pb([Yb(pl(),c),Yb(tw(),c)]),e=pb([Yb(ql(),c),Yb(vw(),function(b,d){a.mouseIsDown().get()&&c(b,d)})]);return{behaviours:pb(Uw?[]:[Al.config({mode:"special",onLeft:function(c){return b.onLeft(c,a)},onRight:function(c){return b.onRight(c,a)},onUp:function(c){return b.onUp(c,a)},onDown:function(c){return b.onDown(c,a)}}),Yi.config({})]),events:Uw?d:e}}}),Sha=[Pha,Lha,Jha,Nha,Iha,Kha,Oha,Mha,Qha,Rha],Vw=function(a,
b,c){b.store().manager().onLoad(a,b,c)},uP=function(a,b,c){b.store().manager().onUnload(a,b,c)},Tha=Object.freeze({onLoad:Vw,onUnload:uP,setValue:function(a,b,c,d){b.store().manager().setValue(a,b,c,d)},getValue:function(a,b,c){return b.store().manager().getValue(a,b,c)},getState:function(a,b,c){return c}}),Uha=Object.freeze({events:function(a,b){var c=a.resetOnDom()?[Pp(function(c,e){Vw(c,a,b)}),ofa(function(c,e){uP(c,a,b)})]:[vga(a,b,Vw)];return pb(c)}}),vP=function(){var a=na(null);return tl({set:a.set,
get:a.get,isNotSet:function(){return null===a.get()},clear:function(){a.set(null)},readState:function(){return{mode:"memory",value:a.get()}}})},wP=function(){var a=na({}),b=na({});return tl({readState:function(){return{mode:"dataset",dataByValue:a.get(),dataByText:b.get()}},lookup:function(c){return XK(a.get(),c).orThunk(function(){return XK(b.get(),c)})},update:function(c){var d=a.get(),e=b.get(),f={},h={};z(c,function(a){f[a.value]=a;h[a.text]=a});a.set(oa(d,f));b.set(oa(e,h))},clear:function(){a.set({});
b.set({})}})},Vha=Object.freeze({memory:vP,dataset:wP,manual:function(){return tl({readState:function(){}})},init:function(a){return a.store().manager().state(a)}}),xP=function(a,b,c,d){var e=b.store();c.update([d]);e.setValue()(a,d);b.onSetValue()(a,d)},Wha=[Dd("initialValue"),za("getFallbackEntry"),za("getDataKey"),za("setValue"),Bg("manager",{setValue:xP,getValue:function(a,b,c){var d=b.store(),e=d.getDataKey()(a);return c.lookup(e).fold(function(){return d.getFallbackEntry()(e)},function(a){return a})},
onLoad:function(a,b,c){b.store().initialValue().each(function(d){xP(a,b,c,d)})},onUnload:function(a,b,c){c.clear()},state:wP})],Xha=[za("getValue"),da("setValue",t),Dd("initialValue"),Bg("manager",{setValue:function(a,b,c,d){b.store().setValue()(a,d);b.onSetValue()(a,d)},getValue:function(a,b,c){return b.store().getValue()(a)},onLoad:function(a,b,c){b.store().initialValue().each(function(c){b.store().setValue()(a,c)})},onUnload:t,state:me.init})],Yha=[Dd("initialValue"),Bg("manager",{setValue:function(a,
b,c,d){c.set(d);b.onSetValue()(a,d)},getValue:function(a,b,c){return c.get()},onLoad:function(a,b,c){b.store().initialValue().each(function(a){c.isNotSet()&&c.set(a)})},onUnload:function(a,b,c){c.clear()},state:vP})],Zha=[function(a,b,c){return Dc(a,a,Ne.defaultedThunk(k(b)),c)}("store",{mode:"memory"},dL("mode",{memory:Yha,manual:Xha,dataset:Wha})),Ag("onSetValue"),da("resetOnDom",!1)],Wb=Cg({fields:Zha,name:"representing",active:Uha,apis:Tha,extra:{setValueFrom:function(a,b){b=Wb.getValue(b);Wb.setValue(a,
b)}},state:Vha}),$ha=aa.detect().deviceType.isTouch(),Bl=k("slider.change.value"),Ww=function(a){a=a.event().raw();return $ha?void 0!==a.touches&&1===a.touches.length?g.some(a.touches[0]).map(function(a){return Ra(a.clientX,a.clientY)}):g.none():void 0!==a.clientX?g.some(a).map(function(a){return Ra(a.clientX,a.clientY)}):g.none()},Xw=function(a,b,c,d){return a<b?a:a>c?c:a===b?b-1:Math.max(b,a-d)},Yw=function(a,b,c,d){return a>c?a:a<b?b:a===c?c+1:Math.min(c,a+d)},aia=function(a,b,c,d,e){return e.fold(function(){return Math.max(b-
1,Math.min(c+1,b+Math.round((a-b)/d)*d))},function(b){return Math.max(b,b+Math.min(Math.floor((c-b)/d),Math.floor((a-b)/d)+Math.round((a-b)%d/d))*d)})},yP=function(a){var b=a.min,c=a.max,d=a.value,e=a.step,f=a.snapStart,h=a.rounded,g=a.minBound,k=a.maxBound,m=a.hasMinEdge?b-1:b,n=a.hasMaxEdge?c+1:c;if(d<g)return m;if(d>k)return n;d=Math.max(m,Math.min(n,(Math.min(k,Math.max(d,g))-g)/a.screenRange*a.range+b));return a.snap&&d>=b&&d<=c?aia(d,b,c,e,f):h?Math.round(d):d},zP=function(a){var b=a.min,c=
a.max,d=a.range,e=a.value,f=a.hasMinEdge,h=a.hasMaxEdge,g=a.maxBound,k=a.maxOffset,m=a.centerMinEdge;a=a.centerMaxEdge;return e<b?f?0:m:e>c?h?g:a:(e-b)/d*k},Ue=function(a){return a.model().minX()},Ve=function(a){return a.model().minY()},We=function(a){return a.model().maxX()},Xe=function(a){return a.model().maxY()},Fg=function(a,b,c){return b(a)-c(a)},Gg=function(a,b){return void 0!==a[b+"-edge"]},If=function(a){return a.model().value().get()},Hg=function(a,b){return{x:k(a),y:k(b)}},Yd=function(a,
b){Te(a,Bl(),{value:b})},rc=function(a){return a.element().dom().getBoundingClientRect()},AP=function(a,b){a=rc(a);b=rc(b);return(a.left+a.right)/2-b.left},BP=function(a,b){a=rc(a);b=rc(b);return(a.top+a.bottom)/2-b.top},Xp=function(a,b){Te(a,Bl(),{value:b})},Zw=function(a,b,c){a={min:Ue(b),max:We(b),range:Fg(b,We,Ue),value:c,step:b.stepSize(),snap:b.snapToGrid(),snapStart:b.snapStart(),rounded:b.rounded(),hasMinEdge:Gg(b,"left"),hasMaxEdge:Gg(b,"right"),minBound:rc(a).left,maxBound:rc(a).right,screenRange:rc(a).width};
return yP(a)},bia=function(a,b,c){a=(0<a?Yw:Xw)(If(c).x(),Ue(c),We(c),c.stepSize());Xp(b,{x:k(a)});return g.some(a)},CP=function(a){return function(b,c){return bia(a,b,c).map(function(){return!0})}},cia=function(a,b,c,d,e){var f=rc(a).width;d=d.bind(function(b){return g.some(AP(b,a))}).getOr(0);e=e.bind(function(b){return g.some(AP(b,a))}).getOr(f);b={min:Ue(b),max:We(b),range:Fg(b,We,Ue),value:c,hasMinEdge:Gg(b,"left"),hasMaxEdge:Gg(b,"right"),minBound:rc(a).left,minOffset:0,maxBound:rc(a).right,
maxOffset:f,centerMinEdge:d,centerMaxEdge:e};return zP(b)},$w=function(a,b,c,d,e,f){c=cia(b,f,c,d,e);return rc(b).left-rc(a).left+c},dia=CP(-1),eia=CP(1),fia=g.none,gia=g.none,hia=k({"top-left":g.none(),top:g.none(),"top-right":g.none(),right:g.some(function(a,b){Yd(a,{x:k(b.model().maxX()+1)})}),"bottom-right":g.none(),bottom:g.none(),"bottom-left":g.none(),left:g.some(function(a,b){Yd(a,{x:k(b.model().minX()-1)})})}),iia=Object.freeze({setValueFrom:function(a,b,c){b=Zw(a,b,c);c={x:k(b)};Xp(a,c);
return b},setToMin:function(a,b){b=Ue(b);Xp(a,{x:k(b)})},setToMax:function(a,b){b=We(b);Xp(a,{x:k(b)})},findValueOfOffset:Zw,getValueFromEvent:function(a){return Ww(a).map(function(a){return a.left()})},findPositionOfValue:$w,setPositionFromValue:function(a,b,c,d){var e=If(c);a=$w(a,d.getSpectrum(a),e.x(),d.getLeftEdge(a),d.getRightEdge(a),c);c=Ia.get(b.element())/2;v.set(b.element(),"left",a-c+"px")},onLeft:dia,onRight:eia,onUp:fia,onDown:gia,edgeActions:hia}),Yp=function(a,b){Te(a,Bl(),{value:b})},
ax=function(a,b,c){a={min:Ve(b),max:Xe(b),range:Fg(b,Xe,Ve),value:c,step:b.stepSize(),snap:b.snapToGrid(),snapStart:b.snapStart(),rounded:b.rounded(),hasMinEdge:Gg(b,"top"),hasMaxEdge:Gg(b,"bottom"),minBound:rc(a).top,maxBound:rc(a).bottom,screenRange:rc(a).height};return yP(a)},jia=function(a,b,c){a=(0<a?Yw:Xw)(If(c).y(),Ve(c),Xe(c),c.stepSize());Yp(b,{y:k(a)});return g.some(a)},DP=function(a){return function(b,c){return jia(a,b,c).map(function(){return!0})}},kia=function(a,b,c,d,e){var f=rc(a).height;
d=d.bind(function(b){return g.some(BP(b,a))}).getOr(0);e=e.bind(function(b){return g.some(BP(b,a))}).getOr(f);b={min:Ve(b),max:Xe(b),range:Fg(b,Xe,Ve),value:c,hasMinEdge:Gg(b,"top"),hasMaxEdge:Gg(b,"bottom"),minBound:rc(a).top,minOffset:0,maxBound:rc(a).bottom,maxOffset:f,centerMinEdge:d,centerMaxEdge:e};return zP(b)},bx=function(a,b,c,d,e,f){c=kia(b,f,c,d,e);return rc(b).top-rc(a).top+c},lia=g.none,mia=g.none,nia=DP(-1),oia=DP(1),pia=k({"top-left":g.none(),top:g.some(function(a,b){Yd(a,{y:k(b.model().minY()-
1)})}),"top-right":g.none(),right:g.none(),"bottom-right":g.none(),bottom:g.some(function(a,b){Yd(a,{y:k(b.model().maxY()+1)})}),"bottom-left":g.none(),left:g.none()}),qia=Object.freeze({setValueFrom:function(a,b,c){b=ax(a,b,c);c={y:k(b)};Yp(a,c);return b},setToMin:function(a,b){b=Ve(b);Yp(a,{y:k(b)})},setToMax:function(a,b){b=Xe(b);Yp(a,{y:k(b)})},findValueOfOffset:ax,getValueFromEvent:function(a){return Ww(a).map(function(a){return a.top()})},findPositionOfValue:bx,setPositionFromValue:function(a,
b,c,d){var e=If(c);a=bx(a,d.getSpectrum(a),e.y(),d.getTopEdge(a),d.getBottomEdge(a),c);c=sa.get(b.element())/2;v.set(b.element(),"top",a-c+"px")},onLeft:lia,onRight:mia,onUp:nia,onDown:oia,edgeActions:pia}),Zp=function(a,b){Te(a,Bl(),{value:b})},$p=function(a,b){return{x:k(a),y:k(b)}},ria=function(a,b,c,d){var e=0<a?Yw:Xw;a=b?If(d).x():e(If(d).x(),Ue(d),We(d),d.stepSize());b=b?e(If(d).y(),Ve(d),Xe(d),d.stepSize()):If(d).y();Zp(c,$p(a,b));return g.some(a)},aq=function(a,b){return function(c,d){return ria(a,
b,c,d).map(function(){return!0})}},sia=aq(-1,!1),tia=aq(1,!1),uia=aq(-1,!0),via=aq(1,!0),wia=k({"top-left":g.some(function(a,b){Yd(a,Hg(b.model().minX()-1,b.model().minY()-1))}),top:g.some(function(a,b){Yd(a,Hg(Fg(b,We,Ue)/2,b.model().minY()-1))}),"top-right":g.some(function(a,b){Yd(a,Hg(b.model().maxX()+1,b.model().minY()-1))}),right:g.some(function(a,b){Yd(a,Hg(b.model().maxX()+1,Fg(b,Xe,Ve)/2))}),"bottom-right":g.some(function(a,b){Yd(a,Hg(b.model().maxX()+1,b.model().maxY()+1))}),bottom:g.some(function(a,
b){Yd(a,Hg(Fg(b,We,Ue)/2,b.model().maxY()+1))}),"bottom-left":g.some(function(a,b){Yd(a,Hg(b.model().minX()-1,b.model().maxY()+1))}),left:g.some(function(a,b){Yd(a,Hg(b.model().minX()-1,Fg(b,Xe,Ve)/2))})}),xia=Object.freeze({setValueFrom:function(a,b,c){var d=Zw(a,b,c.left());b=ax(a,b,c.top());d=$p(d,b);Zp(a,d);return d},setToMin:function(a,b){var c=Ue(b);b=Ve(b);Zp(a,$p(c,b))},setToMax:function(a,b){var c=We(b);b=Xe(b);Zp(a,$p(c,b))},getValueFromEvent:function(a){return Ww(a)},setPositionFromValue:function(a,
b,c,d){var e=If(c),f=$w(a,d.getSpectrum(a),e.x(),d.getLeftEdge(a),d.getRightEdge(a),c);a=bx(a,d.getSpectrum(a),e.y(),d.getTopEdge(a),d.getBottomEdge(a),c);c=Ia.get(b.element())/2;d=sa.get(b.element())/2;v.set(b.element(),"left",f-c+"px");v.set(b.element(),"top",a-d+"px")},onLeft:sia,onRight:tia,onUp:uia,onDown:via,edgeActions:wia}),yia=aa.detect().deviceType.isTouch(),zia=[da("stepSize",1),da("onChange",t),da("onInit",t),da("onDragStart",t),da("onDragEnd",t),da("snapToGrid",!1),da("rounded",!0),Dd("snapStart"),
gp("model",dL("mode",{x:[da("minX",0),da("maxX",100),ug("value",function(a){return na(a.mode.minX)}),za("getInitialValue"),Bg("manager",iia)],y:[da("minY",0),da("maxY",100),ug("value",function(a){return na(a.mode.minY)}),za("getInitialValue"),Bg("manager",qia)],xy:[da("minX",0),da("maxX",100),da("minY",0),da("maxY",100),ug("value",function(a){return na({x:k(a.mode.minX),y:k(a.mode.minY)})}),za("getInitialValue"),Bg("manager",xia)]})),ul("sliderBehaviours",[Al,Wb])].concat(yia?[]:[ug("mouseIsDown",
function(){return na(!1)})]),Aia=function(a,b){return b.universal()?a:ka(a,function(a){return U(b.channels(),a)})},Bia=Object.freeze({events:function(a){return pb([Yb(kO(),function(b,c){var d=a.channels(),e=cb(d);e=Aia(e,c);z(e,function(a){var e=d[a](),f=e.schema();a="channel["+a+"] data\nReceiver: "+Tg(b.element());var g=c.data();f=Ki(tg(a,f,g));e.onReceive()(b,f)})})])}}),Cia=[gp("channels",function(a,b){var c=function(b,c){return $K(Ji(a)).extract(b,ca,c)};return{extract:function(a,e,f){var d=
cb(f);return c(a,d).bind(function(c){c=E(c,function(a){return tv.field(a,a,sg(),b)});return Cc(c).extract(a,e,f)})},toString:function(){return"setOf("+b.toString()+")"},toDsl:function(){return Zk.setOf(a,b)}}}(J.value,od([Gw("onHandler","onReceive",sg()),da("schema",cp())])))],Dia=Cg({fields:Cia,name:"receiving",active:Bia}),EP=aa.detect().deviceType.isTouch(),Zi=LO({name:"Slider",configFields:zia,partFields:Sha,factory:function(a,b,c,d){var e=function(b){return HO(b,a,"thumb")},f=function(b){return HO(b,
a,"spectrum")},h=function(b){return ne(b,a,"left-edge")},l=function(b){return ne(b,a,"right-edge")},m=function(b){return ne(b,a,"top-edge")},n=function(b){return ne(b,a,"bottom-edge")},w=a.model(),p=w.manager(),r=function(b,c){p.setPositionFromValue(b,c,a,{getLeftEdge:h,getRightEdge:l,getTopEdge:m,getBottomEdge:n,getSpectrum:f})},t=function(b,c){w.value().set(c);var d=e(b);r(b,d);a.onChange()(b,d,c);return g.some(!0)};c=[Yb(pl(),function(b,c){a.onDragStart()(b,e(b))}),Yb(uw(),function(b,c){a.onDragEnd()(b,
e(b))})];d=[Yb(ql(),function(b,c){c.stop();a.onDragStart()(b,e(b));a.mouseIsDown().set(!0)}),Yb(jO(),function(b,c){a.onDragEnd()(b,e(b));a.mouseIsDown().set(!1)})];c=EP?c:d;return{uid:a.uid(),dom:a.dom(),components:b,behaviours:oa(pb(Qb([EP?[]:[Al.config({mode:"special",focusIn:function(b){return ne(b,a,"spectrum").map(Al.focusIn).map(k(!0))}})],[Wb.config({store:{mode:"manual",getValue:function(b){return a.model().value().get()}}}),Dia.config({channels:{"mouse.released":{onReceive:function(b,c){a.mouseIsDown().set(!1)}}}})]])),
a.sliderBehaviours().dump()),events:pb([Yb(Bl(),function(a,b){t(a,b.event().value())}),Pp(function(b,c){c=w.getInitialValue();w.value().set(c());c=e(b);r(b,c);var d=f(b);a.onInit()(b,c,d,w.value().get())})].concat(c)),apis:{resetToMin:function(b){p.setToMin(b,a)},resetToMax:function(b){p.setToMax(b,a)},changeValue:t,refresh:r},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(a,b){a.resetToMin(b)},resetToMax:function(a,b){a.resetToMax(b)},refresh:function(a,b){a.refresh(b)}}}),
FP=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,GP=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Eia=function(a){return FP.test(a)||GP.test(a)},Fia=function(a){a=a.value().replace(FP,function(a,c,d,e){return c+c+d+d+e+e});return{value:k(a)}},cx=function(a){a=a.toString(16);return 1==a.length?"0"+a:a},dx=function(a){a=cx(a.red())+cx(a.green())+cx(a.blue());return{value:k(a)}},HP=Math.min,IP=Math.max,bq=Math.round,Cl=function(a,b,c,d){return{red:k(a),green:k(b),blue:k(c),alpha:k(d)}},ex=function(a){var b=parseInt(a,
10);return b.toString()===a&&0<=b&&255>=b},JP=function(a){var b;var c=(a.hue()||0)%360;var d=a.saturation()/100;a=a.value()/100;d=IP(0,HP(d,1));a=IP(0,HP(a,1));if(0===d){var e=b=d=bq(255*a);return Cl(e,b,d,1)}e=c/60;d*=a;c=d*(1-Math.abs(e%2-1));a-=d;switch(Math.floor(e)){case 0:e=d;b=c;d=0;break;case 1:e=c;b=d;d=0;break;case 2:e=0;b=d;d=c;break;case 3:e=0;b=c;break;case 4:e=c;b=0;break;case 5:e=d;b=0;d=c;break;default:e=b=d=0}e=bq(255*(e+a));b=bq(255*(b+a));d=bq(255*(d+a));return Cl(e,b,d,1)},fx=
function(a){a=Fia(a);var b=GP.exec(a.value());a=parseInt(b[1],16);var c=parseInt(b[2],16);b=parseInt(b[3],16);return Cl(a,c,b,1)},KP=function(a){return"rgba("+a.red()+","+a.green()+","+a.blue()+","+a.alpha()+")"},LP=k(Cl(255,0,0,1)),Gia=k(Ha("rgb-hex-update")),MP=k(Ha("slider-update")),NP=k(Ha("palette-update")),Hia={paletteFactory:function(a,b){var c=Zi.parts().spectrum({dom:{tag:"canvas",attributes:{role:"presentation"},classes:[b("sv-palette-spectrum")]}}),d=Zi.parts().thumb({dom:{tag:"div",attributes:{role:"presentation"},
classes:[b("sv-palette-thumb")],innerHtml:"<div class="+b("sv-palette-inner-thumb")+' role="presentation"></div>'}}),e=function(a,b){var c=a.width,d=a.height;a=a.getContext("2d");a.fillStyle=b;a.fillRect(0,0,c,d);b=a.createLinearGradient(0,0,c,0);b.addColorStop(0,"rgba(255,255,255,1)");b.addColorStop(1,"rgba(255,255,255,0)");a.fillStyle=b;a.fillRect(0,0,c,d);b=a.createLinearGradient(0,0,0,d);b.addColorStop(0,"rgba(0,0,0,0)");b.addColorStop(1,"rgba(0,0,0,1)");a.fillStyle=b;a.fillRect(0,0,c,d)};return vl({factory:function(a){a=
k({x:k(0),y:k(0)});var f=pb([ze.config({find:g.some}),Yi.config({})]);return Zi.sketch({dom:{tag:"div",attributes:{role:"presentation"},classes:[b("sv-palette")]},model:{mode:"xy",getInitialValue:a},rounded:!1,components:[c,d],onChange:function(a,b,c){Te(a,NP(),{value:c})},onInit:function(a,b,c,d){e(c.element().dom(),KP(LP()))},sliderBehaviours:f})},name:"SaturationBrightnessPalette",configFields:[],apis:{setRgba:function(a,b,c){a=b.components()[0].element().dom();e(a,KP(c))}},extraApis:{}})}},Iia=
{sliderFactory:function(a,b){a=Zi.parts().spectrum({dom:{tag:"div",classes:[b("hue-slider-spectrum")],attributes:{role:"presentation"}}});var c=Zi.parts().thumb({dom:{tag:"div",classes:[b("hue-slider-thumb")],attributes:{role:"presentation"}}});return Zi.sketch({dom:{tag:"div",classes:[b("hue-slider")],attributes:{role:"presentation"}},rounded:!1,model:{mode:"y",getInitialValue:k({y:k(0)})},components:[a,c],sliderBehaviours:pb([Yi.config({})]),onChange:function(a,b,c){Te(a,MP(),{value:c})}})}},gx=
function(a){var b=void 0!==a.uid&&ye(a,"uid")?a.uid:Ha("memento");return{get:function(a){return a.getSystem().getByUid(b).getOrDie()},getOpt:function(a){return a.getSystem().getByUid(b).fold(g.none,g.some)},asSpec:function(){return oa(a,{uid:b})}}},OP=function(a,b){b=pb(b);b=Cg({fields:[za("enabled")],name:a,active:{events:k(b)}});return{key:a,value:{config:{},me:b,configAsRaw:k({}),initialConfig:{},state:me}}},Jia=[ul("formBehaviours",[Wb])],Kia=function(a,b){return a.fold(function(){return J.error(b)},
J.value)},Lia=function(a,b,c){return oa({"debug.sketcher":{Form:c},uid:a.uid(),dom:a.dom(),components:b,behaviours:oa(pb([Wb.config({store:{mode:"manual",getValue:function(b){b=nga(b,a);return eb(b,function(a,b){return a().bind(function(a){a=ze.getCurrent(a);return Kia(a,"missing current")}).map(Wb.getValue)})},setValue:function(b,c){Ma(c,function(c,d){ne(b,a,d).each(function(a){ze.getCurrent(a).each(function(a){Wb.setValue(a,c)})})})}}})]),a.formBehaviours().dump()),apis:{getField:function(b,c){return ne(b,
a,c).bind(ze.getCurrent)}}})},PP={getField:Ew(function(a,b,c){return a.getField(b,c)}),sketch:function(a){var b=function(){var a=[];return{field:function(b,c){a.push(b);b="<alloy.field."+b+">";return{uiType:DO(),owner:"form",name:b,config:c,validated:{}}},record:function(){return a}}}();a=a(b);b=b.record();b=E(b,function(a){return Sp({name:a,pname:"<alloy.field."+a+">"})});return KO("form",Jia,b,Lia,a)}},Mia=k([da("prefix","form-field"),ul("fieldBehaviours",[ze,Wb])]),Nia=k([Nw({schema:[za("dom")],
name:"label"}),Nw({factory:{sketch:function(a){return{uid:a.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:a.text}}}},schema:[za("text")],name:"aria-descriptor"}),Sp({factory:{sketch:function(a){var b=Iaa(a,["factory"]);return a.factory.sketch(b)}},schema:[za("factory")],name:"field"})]),Ah=LO({name:"FormField",configFields:Mia(),partFields:Nia(),factory:function(a,b,c,d){c=oa(pb([ze.config({find:function(b){return ne(b,a,"field")}}),Wb.config({store:{mode:"manual",
getValue:function(a){return ze.getCurrent(a).bind(Wb.getValue)},setValue:function(a,b){ze.getCurrent(a).each(function(a){Wb.setValue(a,b)})}}})]),a.fieldBehaviours().dump());d=pb([Pp(function(b,c){var d=mga(b,a,["label","field","aria-descriptor"]);d.field().each(function(b){var c=Ha(a.prefix());d.label().each(function(a){m.set(a.element(),"for",c);m.set(b.element(),"id",c)});d["aria-descriptor"]().each(function(c){var d=Ha(a.prefix());m.set(c.element(),"id",d);m.set(b.element(),"aria-labelledby",
d)})})})]);return{uid:a.uid(),dom:a.dom(),components:b,behaviours:c,events:d,apis:{getField:function(b){return ne(b,a,"field")},getLabel:function(b){return ne(b,a,"label")}}}},apis:{getField:function(a,b){return a.getField(b)},getLabel:function(a,b){return a.getLabel(b)}}}),Oia=k([Dd("data"),da("inputAttributes",{}),da("inputStyles",{}),da("type","input"),da("tag","input"),da("inputClasses",[]),Ag("onSetValue"),da("styles",{}),Dd("placeholder"),da("eventOrder",{}),ul("inputBehaviours",[Wb,Yi]),da("selectOnFocus",
!0)]),Pia=function(a){return pb([Yi.config({onFocus:!1===a.selectOnFocus()?t:function(a){a=a.element();var b=fa.get(a);a.dom().setSelectionRange(0,b.length)}})])},Qia=function(a){return oa(pb([Wb.config({store:{mode:"manual",initialValue:a.data().getOr(void 0),getValue:function(a){return fa.get(a.element())},setValue:function(a,c){fa.get(a.element())!==c&&fa.set(a.element(),c)}},onSetValue:a.onSetValue()})]),Pia(a),a.inputBehaviours().dump())},Ria=function(a){return{tag:a.tag(),attributes:oa(pb([{key:"type",
value:a.type()}].concat(a.placeholder().map(function(a){return{key:"placeholder",value:a}}).toArray())),a.inputAttributes()),styles:a.inputStyles(),classes:a.inputClasses()}},Sia=vl({name:"Input",configFields:Oia(),factory:function(a,b){return{uid:a.uid(),dom:Ria(a),components:[],behaviours:Qia(a),eventOrder:a.eventOrder()}}}),Tia=aa.detect().browser.isFirefox(),Uia={position:"absolute",left:"-9999px"},Via=function(a,b){var c=r.fromTag("span",a.dom());m.set(c,"role","presentation");a=r.fromText(b,
a.dom());y.append(c,a);return c},Wia=function(a,b){var c=Ha("ephox-alloy-aria-voice");m.set(b,"id",c);m.set(a,"aria-describedby",c)},Xia=function(a,b,c){var d=A.owner(b),e=Via(d,c);Tia&&Wia(b,e);m.setAll(e,a(c));v.setAll(e,Uia);y.append(b,e);Kf(function(){m.remove(e,"aria-live");G.remove(e)},1E3)},Yia=function(a){return{"aria-live":"assertive","aria-atomic":"true",role:"alert"}},Zia=function(a,b){return Xia(Yia,a,b)},$ia=["input","textarea"],QP=function(a){a=D.name(a);return U($ia,a)},RP=function(a,
b){var c=b.getRoot()(a).getOr(a.element());n.remove(c,b.invalidClass());b.notify().each(function(b){QP(a.element())&&m.remove(c,"title");b.getContainer()(a).each(function(a){Ea.set(a,b.validHtml())});b.onValid()(a)})},SP=function(a,b,c,d){c=b.getRoot()(a).getOr(a.element());n.add(c,b.invalidClass());b.notify().each(function(b){QP(a.element())&&m.set(a.element(),"title",d);Zia(ja.body(),d);b.getContainer()(a).each(function(a){Ea.set(a,d)});b.onInvalid()(a,d)})},TP=function(a,b,c){return b.validator().fold(function(){return Ga.pure(J.value(!0))},
function(b){return b.validate()(a)})},hx=function(a,b,c){b.notify().each(function(b){b.onValidate()(a)});return TP(a,b,c).map(function(d){return a.getSystem().isConnected()?d.fold(function(d){SP(a,b,c,d);return J.error(d)},function(c){RP(a,b);return J.value(c)}):J.error("No longer in system")})},aja=Object.freeze({markValid:RP,markInvalid:SP,query:TP,run:hx,isInvalid:function(a,b){a=b.getRoot()(a).getOr(a.element());return n.has(a,b.invalidClass())}}),bja=Object.freeze({events:function(a,b){return a.validator().map(function(c){return pb([Yb(c.onEvent(),
function(c){hx(c,a,b).get(ca)})].concat(c.validateOnLoad()?[Pp(function(c){hx(c,a,b).get(t)})]:[]))}).getOr({})}}),cja=[za("invalidClass"),da("getRoot",g.none),fl("notify",[da("aria","alert"),da("getContainer",g.none),da("validHtml",""),Ag("onValid"),Ag("onInvalid"),Ag("onValidate")]),fl("validator",[za("validate"),da("onEvent","input"),da("validateOnLoad",!0)])],cq=Cg({fields:cja,name:"invalidating",active:bja,apis:aja,extra:{validation:function(a){return function(b){b=Wb.getValue(b);return Ga.pure(a(b))}}}}),
dja=Object.freeze({exhibit:function(a,b){return Vi({attributes:pb([{key:b.tabAttr(),value:"true"}])})}}),eja=[da("tabAttr","data-alloy-tabstop")],fja=Cg({fields:eja,name:"tabstopping",active:dja}),UP=Ha("valid-input"),VP=Ha("invalid-input"),WP=Ha("validating-input"),gja={rgbFormFactory:function(a,b,c,d){var e=function(c,d){return cq.config({invalidClass:b("invalid"),notify:{onValidate:function(a){Te(a,WP,{type:c})},onValid:function(a){Te(a,UP,{type:c,value:Wb.getValue(a)})},onInvalid:function(a){Te(a,
VP,{type:c,value:Wb.getValue(a)})}},validator:{validate:function(b){b=Wb.getValue(b);b=d(b)?J.value(!0):J.error(a("aria.input.invalid"));return Ga.pure(b)},validateOnLoad:!1}})},f=function(b,c,d,f,h){var g=a("colorcustom.rgb.range");d=Ah.parts().label({dom:{tag:"label",innerHtml:d,attributes:{"aria-label":f}}});b=Ah.parts().field({data:h,factory:Sia,inputAttributes:{type:"text"},inputBehaviours:pb([e(c,b),fja.config({})]),onSetValue:function(a){cq.isInvalid(a)&&cq.run(a).get(t)}});b=[d,b];c="hex"!==
c?[Ah.parts()["aria-descriptor"]({text:g})]:[];return{dom:{tag:"div",attributes:{role:"presentation"}},components:b.concat(c)}},h=function(a,b){var c=dx(b);PP.getField(a,"hex").each(function(b){Yi.isFocused(b)||Wb.setValue(a,{hex:c.value()})});return c},l=function(a,b){var c=b.red(),d=b.green();b=b.blue();Wb.setValue(a,{red:c,green:d,blue:b})},m=gx({dom:{tag:"div",classes:[b("rgba-preview")],styles:{"background-color":"white"},attributes:{role:"presentation"}}}),n=function(a,b){m.getOpt(a).each(function(a){v.set(a.element(),
"background-color","#"+b.value())})};return vl({factory:function(e){var q={red:k(na(g.some(255))),green:k(na(g.some(255))),blue:k(na(g.some(255))),hex:k(na(g.some("ffffff")))},p=function(a,b){q[a]().set(b)},w=function(){return q.red().get().bind(function(a){return q.green().get().bind(function(b){return q.blue().get().map(function(c){return Cl(a,b,c,1)})})})},r=function(a){var b=a.red(),c=a.green();a=a.blue();p("red",g.some(b));p("green",g.some(c));p("blue",g.some(a))},t=function(a,b){b=b.event();
"hex"!==b.type()?p(b.type(),g.none()):d(a)},C=function(a,b,c){c=parseInt(c,10);p(b,g.some(c));w().each(function(b){b=h(a,b);n(a,b)})},u=function(a,b){b=b.event();if("hex"===b.type()){var d=b.value();c(a);b={value:k(d)};p("hex",g.some(d));d=fx(b);l(a,d);r(d);Te(a,Gia(),{hex:b});n(a,b)}else C(a,b.type(),b.value())};e=function(b){return{label:a("colorcustom.rgb."+b+".label"),description:a("colorcustom.rgb."+b+".description")}};var v=e("red"),y=e("green"),x=e("blue"),z=e("hex");return oa(PP.sketch(function(c){return{dom:{tag:"form",
classes:[b("rgb-form")],attributes:{"aria-label":a("aria.color.picker")}},components:[c.field("red",Ah.sketch(f(ex,"red",v.label,v.description,255))),c.field("green",Ah.sketch(f(ex,"green",y.label,y.description,255))),c.field("blue",Ah.sketch(f(ex,"blue",x.label,x.description,255))),c.field("hex",Ah.sketch(f(Eia,"hex",z.label,z.description,"ffffff"))),m.asSpec()],formBehaviours:pb([cq.config({invalidClass:b("form-invalid")}),OP("rgb-form-events",[Yb(UP,u),Yb(VP,t),Yb(WP,t)])])}}),{apis:{updateHex:function(a,
b){Wb.setValue(a,{hex:b.value()});var c=fx(b);l(a,c);r(c);n(a,b)}}})},name:"RgbForm",configFields:[],apis:{updateHex:function(a,b,c){a.updateHex(b,c)}},extraApis:{}})}},dq=function(a,b,c){return{hue:k(a),saturation:k(b),value:k(c)}},EX={makeFactory:function(a,b){return vl({name:"ColourPicker",configFields:[da("onValidHex",t),da("onInvalidHex",t),pL("formChangeEvent",Xaa)],factory:function(c){var d=gja.rgbFormFactory(a,b,c.onValidHex(),c.onInvalidHex()),e=Hia.paletteFactory(a,b),f={paletteRgba:k(na(LP()))},
h=gx(e.sketch({})),g=gx(d.sketch({})),m=function(a,b){h.getOpt(a).each(function(a){var c=fx(b);f.paletteRgba().set(c);e.setRgba(a,c)})},n=function(a,b){g.getOpt(a).each(function(a){d.updateHex(a,b)})},p=function(a,b,c){z(c,function(c){c(a,b)})};return{uid:c.uid(),dom:c.dom(),components:[h.asSpec(),Iia.sliderFactory(a,b),g.asSpec()],behaviours:pb([OP("colour-picker-events",[Yb(NP(),function(){var a=[n];return function(b,c){c=c.event().value();var d=f.paletteRgba().get();var e=d.red()/255;var h=d.green()/
255;d=d.blue()/255;var g=Math.min(e,Math.min(h,d));var k=Math.max(e,Math.max(h,d));e=g===k?dq(0,0,100*g):dq(Math.round(60*((e===g?3:d===g?1:5)-(e===g?h-d:d===g?e-h:d-e)/(k-g))),Math.round((k-g)/k*100),Math.round(100*k));c=dq(e.hue(),c.x(),100-c.y());c=JP(c);c=dx(c);p(b,c,a)}}()),Yb(MP(),function(){var a=[m,n];return function(b,c){c=c.event().value().y();c=dq(360*(100-c/100),100,100);c=JP(c);c=dx(c);p(b,c,a)}}())]),ze.config({find:function(a){return g.getOpt(a)}}),Al.config({mode:"acyclic"})])}}})}},
XP=function(a){var b=$e(a)?a:10,c=um.access("local.customColors");a=c.read();var d=function(){return m1(b,function(){return"#ffffff"})},e=function(a){return 0>b-a.length?a.slice(0,b):a}(Mb(a)?a:d()),f=function(a){e.splice(a,1)};return{add:function(a){Gc(e,a).each(f);e.unshift(a);e.length>=b&&e.pop();c.write(e)},state:function(){return e.slice(0)}}}(10),Fm={create:function(a,b){var c=H.create({selected:p(["color"]),menuDone:p([])}),d=r.fromTag("div"),e=Oc(),f=x.translate("font.colorcustom");S.button(e.element(),
f);e.events.click.bind(function(){c.trigger.menuDone();a.hideInlineSelection();var d=GX(a,b);d.events.color.bind(function(a){XP.add(a.color());c.trigger.selected(a.color());d.destroy()});d.show()});e.content(Rc(f));n.add(e.element(),B.resolve("color-picker-custom"));S.presentation(d);var h=Dm(d),g=ha.button(e.element(),Ba.button({execute:Kb.click})),k=Sea();return{elements:[e.element(),d],layouts:[g,h.grid],events:c.registry,refresh:function(){var a=E(XP.state(),function(a){return{text:a,value:a}});
a=Ij.create(a);k.set(a);G.empty(d);y.append(d,a.element());a.events.selected.bind(function(a){c.trigger.selected(a.value())});a.show();h.refresh()},destroy:function(){h.destroy();g.destroy();k.clear()}}},stub:function(a,b){return{elements:[],layouts:[],events:H.create({selected:p([]),menuDone:p([])}).registry,refresh:t,destroy:t}}},QX={widget:function(a,b){var c=a.content(),d=a.undo(),e=a.selections(),f=a.smartview().uiContainer(),h=HX(c,f,b),g=H.create({color:Q(["value"],h.events.color),highlight:Q(["value"],
h.events.highlight),done:p([]),abort:Q([],h.events.abort)});h.events.color.bind(function(a){g.trigger.done();Uf.foreground(c,d,e,a.value());c.toEditing()});h.events.highlight.bind(function(a){g.trigger.done();Uf.background(c,d,e,a.value());c.toEditing()});h.events.menuDone.bind(function(){return g.trigger.done()});return{element:h.element,name:k("color"),textkey:k(x.key("font.coloroption")),menuTextkey:k(x.key("aria.color.menu")),open:h.open,close:h.close,updateWidget:function(b){lj.isHighContrast(a.smartview())?
b.disable():h.open()},ability:t,destroy:h.destroy,events:g.registry,label:k(!1)}}},KX=Aa(["i18nNamespace","cssNamespace","property","tag","specials"],[]),OX={widget:function(a,b){b=Mq.cata(b,k(t),k(function(a){a.initLayout()}));var c=a.content(),d=a.undo(),e=Gm(Am.configuration());b(e);var f=H.create({done:p([]),abort:Q([],e.events.abort)});e.events.close.bind(function(a){f.trigger.done()});e.events.action.bind(function(b){var e=Z.active();c.focus();Uf.size(c,d,a.selections(),b.value());e.each(Z.focus)});
return{element:e.element,item:e.item,name:k("size"),textkey:k(x.key("font.size")),open:e.open,close:e.close,updateInlineWidget:function(){var b=Cm.getState(a.selections(),c);e.updateInlineWidget(b.readState,b.fallbackSize)},ability:t,destroy:e.destroy,events:f.registry}}},NX={widget:function(a,b){var c=a.content(),d=a.smartview().uiContainer();b=a.ui().tabstrip.element;var e=a.undo(),f=Gm(Am.configuration()),h=f.input(),g=rm(b());m.set(h,"disabled","true");var q=K.bind(h,"touchstart",function(b){b.kill();
g.closeMenus();var f=LX(c,d,u(Gm,Am.configuration()));f.show();b=f.contents;var h=Cm.getState(a.selections(),c),k=function(){f.destroy();c.cursorIntoView()};b.updateInlineWidget(h.readState,h.fallbackSize);b.events.close.bind(k);b.events.action.bind(function(b){Uf.size(c,e,a.selections(),b.value())});f.events.close.bind(f.destroy);f.events.ok.bind(function(b){Uf.size(c,e,a.selections(),b.value());k()})}),n=H.create({done:p([]),abort:Q([],f.events.abort)});f.events.close.bind(function(a){n.trigger.done()});
f.events.action.bind(function(b){Uf.size(c,e,a.selections(),b.value())});return{element:f.element,item:f.item,name:k("size"),textkey:k(x.key("font.size")),open:f.open,close:f.close,updateInlineWidget:function(){var b=Cm.getState(a.selections(),c);f.updateInlineWidget(b.readState,b.fallbackSize)},ability:t,destroy:function(){q.unbind();f.destroy()},events:n.registry}}},PX={face:function(a){return Zb.toSelection(a.get()).map(function(a){a=U(["td","th"],D.name(a.startContainer()))?kb.freefallLtr(a.startContainer()).element():
a.startContainer();a=vj.value(a,"font-family");return xf.isEmpty(a)?Da.off():Da.on(a)}).getOrThunk(Da.unchanged)}},SX=function(a){var b=a.baseUrl;!0===a.source&&(b+="/licenses");return b+"/textbox-licenses.html"},Dl=function(a,b){return a.map(function(a){return a.bind(function(a){var c=a[b];return void 0===c?J.error("Cannot find method "+b+" in help article list: "+cb(a)):vb(c)?J.value(c()):J.error("Key "+b+" in help article list was not a function")})})},UX=function(a){a=gn.addScript(a,ca);a.get(function(a){a.each(function(a){Wf.weakMatch(a.version,
"Help articles").each(function(a){console.warn(a)})})});return{about:Dl(a,"about"),accessibility:Dl(a,"accessibility"),a11ycheck:Dl(a,"a11ycheck"),markdown:Dl(a,"markdown"),shortcuts:Dl(a,"shortcuts")}},Mj=function(a,b){return a?g.some(b):g.none()},WX=function(a){var b={item:k(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=Ba.flow({trigger:Kb.button,executeOnArrow:!0});return ha.flow(a.menu(),b,c)},XX=function(a){var b={stops:k(["a"])},c=Ba.page({trigger:Kb.click,first:".ephox-pastry-tablayout-active"});
return ha.page(a.body(),b,c)},aY=O("prefix","suffix","style"),yA={rehighlight:function(a,b,c){var d=A.children(c),e=E(d,function(a){return D.isText(a)?Ya.get(a):""}).join("");qa(b,function(a){return Gb(e,a.prefix())&&je(e,a.suffix())}).fold(function(){a.preserve(function(){G.unwrap(c)})},function(b){var e=r.fromTag("span");ma.add(e,[rf.highlightClass()]);v.setAll(e,b.style());a.preserve(function(){y.before(c,e);P.append(e,d);G.remove(c)})})},unhighlight:function(a,b){var c=A.children(b),d=r.fromTag("span");
ma.add(d,[rf.placeholderClass()]);a.preserve(function(){y.before(b,d);G.unwrap(b);P.append(d,c)})}},hja=function(a,b){b=E(b,function(a){var b=Cb.sanitise(a.prefix()),c=Cb.sanitise(a.suffix());b=Cb.unsafetoken(b+"[^"+c+"]*"+c);return{pattern:k(b),style:a.style}});return Mo.findmany(a,b)},ija=hr("."+rf.highlightClass(),Na.unwrap),bY={run:function(a,b){a.body().each(function(a){qm.filterDom(a,[ija]);a=ed.descendants(a,D.isText);z(a,function(a){var c=Ya.get(a);c=hja(c,b);var d=ia(c,function(a){return[a.start(),
a.finish()]}),h=ti.subdivide(a,d);z(c,function(a){var b=Rd.sublist(h,a.start(),a.finish());b=E(b,function(a){return a.element()});wi.wrapper(b,function(){var b=r.fromTag("span");ma.add(b,[rf.highlightClass()]);v.setAll(b,a.style());return wi.nu(b)})})})})}},ix=B.resolve("input-invalid-field"),jja=function(a){return parseInt(a,10).toString()===a&&0<=parseInt(a,10)},YP=function(a,b,c){var d=fa.get(a);if(""===d)return J.value("");var e=r.fromTag("img");c=jja(d)?d+c.getOr(""):d;v.set(e,b,c);c=v.getRaw(e,
b);v.remove(e,b);return c.fold(function(){return J.error(a)},J.value)},ZP=function(a){n.remove(a,ix)},Mc={highlight:function(a){ib.shout(a,x.translate("aria.input.invalid"));n.add(a,ix)},dehighlight:ZP,clearHighlights:function(a){a=Y.descendants(a,"."+ix);z(a,ZP)},validate:function(a){return Eb(a,function(a,c){return a.bind(function(a){return YP(c.input(),c.property(),c.defaultUnit()).map(function(b){fa.set(c.input(),b);var d={};d[c.property()]=k(b);return oa(d,a)})})},J.value({}))},validateField:YP,
rule:O("input","property","defaultUnit")},kja=O("size","unit"),eq=function(a){return Ip.identify(a).fold(g.none,function(a,c,d){return g.some(kja(c,d))})},tr={fromHeight:function(a,b){return eq(b).map(function(b){return Math.ceil(a*b.size())+b.unit()})},fromWidth:function(a,b){return eq(b).map(function(b){return Math.ceil(1/a*b.size())+b.unit()})},calculate:function(a,b){return eq(a).fold(g.none,function(a){return eq(b).fold(g.none,function(b){return g.some((a.size()+0)/(b.size()+0))})})}},lja=aa.detect(),
$P=O("value","text","attrs"),aQ=function(a){return"img"===D.name(a)},bQ=function(a){return 0===a.length?Jb:function(b){return vc.allowedForEditing(b,a)}},AA={image:function(a){var b=bQ(a.imageExcludes),c=g.none(),d=H.create({properties:p(["image"]),contextmenu:p(["image"])});return{situation:function(a){a=c.map(function(a){return[$P("imagemenu-properties",x.translate("image.context.properties"),{})]}).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},handle:function(a){c.each(function(a){d.trigger.properties(a)})},
assign:function(e){c=e.filter(aQ).filter(b);c.each(function(b){lja.browser.isFirefox()||ie.select(a,b);d.trigger.contextmenu(b)})},events:d.registry}},imageEdit:function(a,b,c,d){var e=bQ(d),f=g.none(),h=function(a){return E(a,function(a){return $P(a.spec.value,x.get(a.spec.textkey),{})})};return{situation:function(a){a=f.map(h).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},handle:function(a){f.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value");qa(b,function(a){return a.spec.value===
c}).each(function(a){a.spec.action()})})},assign:function(d){f=a()?g.some(b):d.filter(aQ).filter(e).map(k(c))}}}},BA={generate:function(a,b,c){a=function(){e();d.trigger.close()};var d=H.create({ok:Q(c,b.events.ok),close:p([])});b.events.close.bind(a);var e=function(){b.destroy()};return{open:function(){b.open()},hide:a,destroy:e,represent:b.represent,events:d.registry}}},cQ=ta.generate([{html:["key","value"]},{css:["key","value"]}]),dQ=function(a,b){return Qb(Nf(a,function(a,d){var c=[];if(m.has(b,
d)){var f=m.get(b,d);c.push(cQ.html(a,f))}v.getRaw(b,d).each(function(b){c.push(cQ.css(a,b))});return c}))},mja=function(a){v.remove(a,"width");v.remove(a,"height");m.remove(a,"width");m.remove(a,"height")},nja=u(dQ,{width:"width",height:"height"}),oja=u(dQ,{width:"height",height:"width"}),eQ=k([]),sf={keepCrop:eQ,keepFlip:nja,keepRotate:oja,keepResample:eQ,updater:function(a,b){var c=a(b);return Ua.effect(function(){mja(b);z(c,function(a){a.fold(function(a,c){m.set(b,a,c)},function(a,c){v.set(b,
a,c)})})})}},fQ=function(a){return""!==a.trim()&&!Bb(a,"://")},ur={local:function(a){return Gb(a,"data:")||Gb(a,"blob:")||Gb(a,"file:")},relative:fQ,sameDomain:function(a,b){if(""===a.trim()||""===b.trim())return!1;if(fQ(a))return!0;b=Sh.parse(b);a=Sh.parse(a);return b.host===a.host&&b.port===a.port}},pja=O("bannerMessage","consoleMessage"),gQ=function(a){return vb(a.message)&&vb(a.status)&&vb(a.responseText)},hQ=function(a){if(gQ(a)){var b=a.responseText();return a.message()+". Response code "+a.status()+
(0===b.length?".":". Error details: "+b)}return a},wr={diagnoseImageEdit:function(a,b){var c=18===a.code||"SecurityError"===a.name?"imageedit.needsproxy":gQ(a)&&0===a.status()?"imageedit.proxyerror":"imageedit.generic",d=Sh.parse(b);b=""===d.host||ur.relative(b)?b:""===d.port?d.host:d.host+":"+d.port;c=mf.get(c,[b]);return pja(c,hQ(a))},consoleMessage:hQ},Ph={make:function(a,b,c){return{type:"general",spec:{value:a,textkey:x.key(b),action:c,updateGeneral:t,icon:!0,hasPopup:!1,toggle:!1,tooltip:qb.get}}}},
qja=k(4),tb={resolve:Lb.create("ephox-clipper").resolve,CORNER_SIZE:qja},rja=function(a,b){a={left:"0px",top:"0px",width:a.width()+"px",height:a.height()+"px"};b={left:v.get(b,"left"),top:v.get(b,"top"),width:v.get(b,"width"),height:v.get(b,"height")};return{outside:k(a),inside:k(b)}},sja={snap:function(a,b){var c=rja(a,b),d=r.fromTag("div");n.add(d,tb.resolve("dynamic-box"));v.setAll(d,c.outside());var e=r.fromTag("div");n.add(e,tb.resolve("opaque-box"));v.setAll(e,c.outside());var f=function(a,
b){return 2<Math.abs(parseInt(a,10)-parseInt(b,10))},h=function(a){return Ga.nu(function(b){b(a)})},g=function(a,b){return Ga.nu(function(c){var d=K.bind(a,"transitionend",function(){d.unbind();c(a)});v.setAll(a,b.inside())})};return{prepare:function(a,c,f){var h=m.get(c,"src"),g=v.get(c,"width");c=v.get(c,"height");v.setAll(b,{"background-image":"url("+h+")","background-size":g+" "+c,"background-position-x":-f.left()+"px","background-position-y":-f.top()+"px"});n.add(b,tb.resolve("snapshot"));n.add(d,
tb.resolve("dynamic-box-animate"));P.append(a,[d,e]);v.reflow(a)},showcase:function(){var a=c.outside(),b=c.inside();return f(a.left,b.left)||f(a.top,b.top)||f(a.right,b.right)||f(a.bottom,b.bottom)?g(d,c):h(d)}}}},tY={slide:function(){return{animate:function(a,b,c,d){c=sja.snap(c.box(),c.shade());c.prepare(a,b,{left:d.cropX,top:d.cropY,width:d.cropWidth,height:d.cropHeight});return c.showcase().map(k(d))}}},none:function(){return{animate:function(a,b,c,d){return Ga.pure(d)}}}},rY=Aa("displayWidth displayHeight cropX cropY cropWidth cropHeight".split(" "),
[]),oY={bind:function(a,b){return K.bind(a,"mousedown",function(a){a.kill();var c=a.target(),e=!1,f=K.bind(c,"mouseup",function(){e=!0;f.unbind()});setTimeout(function(){e||(f.unbind(),b(c))},250)})}},tja=Aa(["top","left","width","height"],[]),uja=Aa(["top","left"],[]),vja=Aa(["top","left"],[]),Fb={boxModel:tja,delta:uja,cornersMovements:vja},jx=function(a,b){b=Math.min(a.top()+a.height(),Math.max(0,a.top()+b.top()));var c=b-a.top();a=a.height()-c;return{top:b,height:a}},kx=function(a,b,c){a=Math.min(a.width(),
Math.max(b.left(),b.left()+b.width()+c.left()))-b.left()-b.width();return{width:b.width()+a}},lx=function(a,b,c){return Math.min(a.height(),Math.max(b.top(),b.top()+c.top()+b.height()))-b.top()},mx=function(a,b){b=Math.min(a.width()+a.left(),Math.max(0,a.left()+b.left()));var c=b-a.left();a=a.width()-c;return{left:b,width:a}},Lm={nw:function(a,b,c){a=jx(b,c);b=mx(b,c);return Fb.boxModel({left:b.left,width:b.width,top:a.top,height:a.height})},n:function(a,b,c){a=jx(b,c);return Fb.boxModel({left:b.left(),
width:b.width(),top:a.top,height:a.height})},ne:function(a,b,c){var d=jx(b,c);a=kx(a,b,c);return Fb.boxModel({left:b.left(),width:a.width,top:d.top,height:d.height})},e:function(a,b,c){a=kx(a,b,c);return Fb.boxModel({left:b.left(),width:a.width,top:b.top(),height:b.height()})},se:function(a,b,c){var d=kx(a,b,c);a=lx(a,b,c);return Fb.boxModel({left:b.left(),width:d.width,top:b.top(),height:a})},s:function(a,b,c){a=lx(a,b,c);return Fb.boxModel({left:b.left(),width:b.width(),top:b.top(),height:a})},
sw:function(a,b,c){a=lx(a,b,c);c=mx(b,c);return Fb.boxModel({left:c.left,width:c.width,top:b.top(),height:a})},w:function(a,b,c){a=mx(b,c);return Fb.boxModel({left:a.left,width:a.width,top:b.top(),height:b.height()})},translate:function(a,b,c){var d=Math.min(Math.max(0,b.top()+c.top()),Math.max(0,a.height()-b.height()));a=Math.min(Math.max(0,b.left()+c.left()),Math.max(0,a.width()-b.width()));return Fb.boxModel({top:d,left:a,width:b.width(),height:b.height()})}},Oj={navigation:function(a,b){var c=
function(a,c,f){return function(){b(a,Ra(c,f));return g.some(!0)}};return[ea.rule(ea.and([ea.isShift,ea.inSet(R.LEFT())]),c(a,-1,0)),ea.rule(ea.and([ea.isShift,ea.inSet(R.RIGHT())]),c(a,1,0)),ea.rule(ea.and([ea.isShift,ea.inSet(R.UP())]),c(a,0,-1)),ea.rule(ea.and([ea.isShift,ea.inSet(R.DOWN())]),c(a,0,1)),ea.basic(R.LEFT()[0],c(a,-10,0)),ea.basic(R.RIGHT()[0],c(a,10,0)),ea.basic(R.UP()[0],c(a,0,-10)),ea.basic(R.DOWN()[0],c(a,0,10))]}},iQ=function(a,b,c){var d=b.top(),e=b.left()+b.width()/2-c.middle(),
f=d+b.height()/2-c.middle(),h=b.left()+b.width()-c.right();a=b.left()-c.left();c=d+b.height()-c.bottom();b=Fb.cornersMovements({top:d,left:e});e=Fb.cornersMovements({top:c,left:e});var g=Fb.cornersMovements({top:f,left:h});f=Fb.cornersMovements({top:f,left:a});var m=Fb.cornersMovements({top:d,left:a});d=Fb.cornersMovements({top:d,left:h});h=Fb.cornersMovements({top:c,left:h});a=Fb.cornersMovements({top:c,left:a});return{n:k(b),s:k(e),e:k(g),w:k(f),nw:k(m),ne:k(d),se:k(h),sw:k(a)}},CA={calculate:function(a,
b){var c={middle:k(2*tb.CORNER_SIZE()+1),right:k(tb.CORNER_SIZE()),left:k(0),bottom:k(tb.CORNER_SIZE())};return iQ(a,b,c)},limitBounds:function(a,b){var c={};if(20>b.width()){var d=20-b.width();c.width=b.width()+d;c.left=b.left()===a.left()?a.left():b.left()-d}20>b.height()&&(d=20-b.height(),c.height=b.height()+d,c.top=b.top()===a.top()?a.top():b.top()-d);return ua(b,eb(c,k))},doCalculate:iQ},nx=function(a){return Fb.boxModel({left:parseInt(m.get(a,"data-"+tb.resolve("image-left")),10),top:parseInt(m.get(a,
"data-"+tb.resolve("image-top")),10),width:parseInt(m.get(a,"data-"+tb.resolve("image-width")),10),height:parseInt(m.get(a,"data-"+tb.resolve("image-height")),10)})},jQ=function(a,b){m.set(a,"data-"+tb.resolve("image-left"),b.left());m.set(a,"data-"+tb.resolve("image-top"),b.top());m.set(a,"data-"+tb.resolve("image-width"),b.width());m.set(a,"data-"+tb.resolve("image-height"),b.height())},Ug={readPosition:nx,writePosition:jQ,updatePosition:function(a,b){var c=nx(a);b=b(c);c=CA.limitBounds(c,b);jQ(a,
c);return c},drawAtOrigin:function(a){var b=nx(a);v.setAll(a,{left:b.left()+"px",top:b.top()+"px",width:b.width()+"px",height:b.height()+"px"})}},wja=tb.resolve("magic-box"),EA={magicBox:k(wja)},Km={grab:function(a,b){m.set(a,"aria-grabbed",b)},effect:function(a,b){m.set(a,"aria-dropeffect",b)}},xja=O("help","ids"),kQ=function(a){m.set(a,"role","gridcell")},Vg={base:function(a,b){m.setAll(a,{role:"grid","aria-label":b})},row:function(a){m.set(a,"role","row")},cell:function(a,b){kQ(a);m.set(a,"aria-label",
b)},gridcell:kQ,createHelp:function(a,b,c){var d=r.fromTag("div");S.presentation(d);n.add(d,nk.resolve("aria-help"));for(var e=[],f=0;f<b;f++){var h=Ha("ephox-aria"),g=r.fromTag("span");S.presentation(g);m.set(g,"id",h);n.add(g,nk.resolve("aria-help"));y.append(g,r.fromText(c.col(f+1)));y.append(d,g);e[f]=h}f=[];for(h=0;h<a;h++){g=Ha("ephox-aria");var k=r.fromTag("span");S.presentation(k);m.set(k,"id",g);n.add(k,nk.resolve("aria-help"));y.append(k,r.fromText(c.row(h+1)));y.append(d,k);f[h]=[];for(k=
0;k<b;k++)f[h][k]=e[k]+" "+g}return xja(d,f)}},Yf=function(a,b,c){var d=r.fromTag("div");v.set(d,"position","absolute");var e=r.fromTag("div");y.append(d,e);c.each(function(a){Vg.cell(d,a);Km.grab(d,!1)});ma.add(d,[tb.resolve("corner-wrapper"),tb.resolve("corner-wrapper-"+b)]);ma.add(e,[tb.resolve("corner-element"),tb.resolve("corner-"+a)]);m.set(d,"data-"+tb.resolve("direction"),b);return d},Zf=function(a,b){v.setAll(a,{top:b.top()+"px",left:b.left()+"px"})},DA=function(a,b,c){var d=b()<c()?0:1;
z(a,function(a){v.set(a,"opacity",String(d))})},kY={derive:function(a,b){return{leftRim:function(){var c=b.left(),d=a.height();return Fb.boxModel({top:0,left:0,width:c,height:d})},topRim:function(){var c=b.left(),d=a.width()-b.left(),e=b.top();return Fb.boxModel({top:0,left:c,width:d,height:e})},rightRim:function(){return Fb.boxModel({top:b.top(),left:b.left()+b.width(),width:a.width()-b.width()-b.left(),height:a.height()-b.top()})},bottomRim:function(){return Fb.boxModel({top:b.top()+b.height(),
left:b.left(),width:b.width(),height:a.height()-b.height()-b.top()})},shadeBox:k(b)}}},Im=function(a){var b=r.fromTag("div");ma.add(b,[tb.resolve("panel-"+a),tb.resolve("side-panel")]);return b},Jm=function(a,b){v.setAll(a,{top:b.top()+"px",left:b.left()+"px",width:b.width()+"px",height:b.height()+"px"})},nY=function(a){var b=a.width();a=a.height();var c=Math.floor(.125*a),d=Math.floor(.125*b);return Fb.boxModel({top:c,left:d,width:b-2*d,height:a-2*c})},qY=function(a){var b=bb.absolute(a),c=b.top(),
d=sa.get(a);b=b.left();a=Ia.get(a);return Fb.boxModel({top:c,left:b,width:a,height:d})},uY=function(a,b){vc.detect(a.getSelection()).fold(function(){a.setRelativeSelection(la.before(b),la.before(b))},function(b){a.setRelativeSelection(la.on(b.image(),0),la.on(b.image(),0))})},lQ=function(a,b,c,d){return a(function(a){var e=K.bind(b,c,function(b){sr(h);e.unbind();a(J.value(b))}),h=Kf(function(){e.unbind();a(J.error("Event "+c+" did not fire within "+d+"ms"))},d)})},yja={cWaitFor:function(a,b,c){return lQ(lf.nu,
a,b,c)},waitFor:function(a,b,c){return lQ(Ga.nu,a,b,c)}},zja=Ua.fToFR(Re.single),xr={run:function(a,b,c){return Ua.fromChain([a.getImage,b,zja,c])},applyEdit:function(a){return function(b){var c=Qc.cata(b,function(a,b,c){return c},function(a,b,c){return b});m.set(a,"src",c);b=Ua.pure(b);return a.dom().loaded?b:Ua.bind(yja.waitFor(a,"load",1E3),k(b))}}},Aja=function(a){return 20<=a},ox=function(a){return g.from(a).filter(Aja)},wY={ensureMin:ox,parse:function(a,b){a=ox(a).getOr(0);b=ox(b).getOr(0);
return 0===a&&0===b?g.none():g.some(Hp(a,b))}},zY=function(a){return function(b){var c=b.image(),d=b.asset(),e=function(a){a.fold(function(){m.remove(c,"src")},function(a){Qc.cata(a,function(a,b,d){m.set(c,"src",d)},t)})};return rp.loadIfNeeded(c).bind(function(){return a(d).map(function(a){e(a);return a})})}},xY=k(Ua.pure),yY=k(function(a){return Ua.pure(a.asset())}),FA={edit:function(a,b,c,d){return{items:d,updatePalette:function(d){if(c())d.hide(g.none())&&a();else{var e=u(d.show,g.some(x.translate("image.context.palette.show")));
d=u(d.hide,g.some(x.translate("image.context.palette.hide")));(b().isSome()?e:d)()&&a()}}}},crop:function(a,b,c){return{items:c,updatePalette:function(c){(b()?c.show:c.hide)(g.none())&&a()}}}},mQ=function(a){var b=Gb(a,"www.")?"http://"+a:a;return{text:k(a),href:k(b)}},px={preprocess:mQ,auto:function(a){return mQ(a).href()}},nQ=function(a,b){a.setRelativeSelection(la.after(b),la.after(b))},Bja=function(a,b,c,d){var e=a.getSelection();return vc.detect(e).fold(function(){return e.fold(function(){return[]},
function(a){return(a.collapsed()?c:d)(a)})},function(a){return b(a.image())})},Cja=function(a,b,c){var d=r.fromTag("a");fq(d,oa(b,{text:k(g.none())}));y.wrap(c,d);ie.select(a,c);return[d]},fq=function(a,b){b.url().each(function(b){b=px.auto(b);ri.attr(a,"href",b)});b.title().each(function(b){ri.attr(a,"title",b)});b.target().each(function(b){ri.attr(a,"target",b)});b.action().each(function(b){b(a)});return b.text().filter(b.textChanged).map(function(b){Vb.set(a,b);return!0}).getOr(!1)},Dja=function(a){return function(b){return{link:b,
properties:a}}},Eja=function(a){return function(b){return{link:b,properties:oa(a,{text:k(g.some(Vb.get(b)))})}}},Fja=function(a){return function(b){var c=xj.findDescendants(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),"a");b=0<c.length?c:xj.findAncestors(b.startContainer(),b.endContainer(),"a");return E(b,1===b.length?Dja(a):Eja(a))}},Gja=function(a,b){return Bja(a,u(Cja,a,b),function(c){var d=r.fromTag("a");fq(d,b);sd.insertAtCursor(a,[d]);b.action().each(function(a){a(d)});
nQ(a,d);return[d]},function(c){a.execCommand("CreateLink",!1,px.auto(b.url().getOr("")));c=a.getSelection().map(Fja(b)).getOr([]);z(c,function(c){fq(c.link,c.properties);b.action().each(function(a){a(c.link)});nQ(a,c.link)});return E(c,function(a){return a.link})})},qx={hyperlink:function(a,b){var c=b.text().fold(k(b),function(a){return oa(b,{text:k(g.some(0<a.trim().length?a:b.url().getOr(""))),textChanged:0<a.trim().length?b.textChanged:k(!0)})});a.focus();return c.url().fold(k([]),function(b){return 0<
b.trim().length?Gja(a,c):[]})},setProperties:fq},oQ=function(a,b){var c=wa.getEnd(b);a.setSelection(b,c,b,c)},pQ=function(a,b){a.setSelection(b,0,b,0)},oB={selectEnd:oQ,moveToEnd:function(a){a.getSelection().each(function(b){oQ(a,b.endContainer());a.focus()})},selectStart:pQ,moveToStart:function(a){a.getSelection().each(function(b){pQ(a,b.endContainer());a.focus()})}},qQ=function(a,b){return a.getSelection().bind(function(c){return Ld.sharedLinkOrClosest(c,a.isRoot).map(function(a){b(a);return a})})},
Br={insert:qx.hyperlink,update:function(a,b){return qQ(a,function(c){b.text().fold(function(){qx.setProperties(c,b)},function(d){""===d&&""!==Vb.get(c)?(a.setRelativeSelection(la.before(c),la.before(c)),G.remove(c)):qx.setProperties(c,b)&&(d=A.children(c).length,a.setRelativeSelection(la.on(c,d),la.on(c,d)))});a.focus()})},unlink:function(a){qQ(a,function(b){a.setSelection(b,0,b,A.children(b).length);var c=A.lastChild(b);G.unwrap(b);c.each(function(b){oB.selectEnd(a,b)});a.focus()})}},Hja=function(a){return a.getSelection().bind(function(b){return a.win().bind(function(a){var c=
Lc.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());return Wa.getFirstRect(a,c).map(function(a){a={left:a.left(),top:a.top(),right:a.right(),bottom:a.bottom(),width:a.width(),height:a.height()};return{bounds:k(a),element:k(b.startContainer())}})})})},rQ=function(a,b,c){Hja(b).fold(function(){Nz.insertAtCursor(a,b,c)},function(d){var e=d.bounds();d=d.element();(D.isText(d)?A.parent(d):g.some(d)).each(function(d){d=a.directionAt(d);var f=b.translateScreen(e.left,e.top);c({left:f.left,
top:f.top,height:k(e.height),width:k(e.width),direction:k(d)})})})},sQ=function(a,b,c,d,e,f,h){var g=e.direction();a=Pm.makeshift(a,b,e.left(),e.top(),e.width(),e.height(),g,f,h);b.show(c,a);c.setComponents([d.element()])},Ar={show:function(a,b,c,d,e){rQ(a,b,function(a){sQ(b,c,d,e,a,Fh(0,0))})},showExpandable:function(a,b,c,d,e){rQ(a,b,function(a){n.add(d.panel(),B.resolve("expandable-popup"));var f=Fh(22,14),g={maxHeightFunction:cf.expandable()};sQ(b,c,d,e,a,f,g)})}},rx=function(a,b,c){a=Oc(a);b=
x.translate(b);a.content(Rc(b));n.add(a.element(),B.resolve(c));S.button(a.element(),b);return a},tQ=function(a){var b=T.div();n.add(b,B.resolve("main-controls"));P.append(b,a);return b},uQ=function(a,b,c){var d=rx("remove","link.dialog.remove","link-remove"),e=rx("cancel","button.cancel","link-cancel"),f=rx(a,b,c);a=H.create({remove:Q([],d.events.click),cancel:Q([],e.events.click),execute:Q([],f.events.click)});b=[ha.button(d.element(),Ba.button({execute:Kb.click})),ha.button(e.element(),Ba.button({execute:Kb.click})),
ha.button(f.element(),Ba.button({execute:Kb.click}))];return{remove:d,cancel:e,execute:f,keylayouts:b,events:a.registry,destroy:function(){d.destroy();e.destroy();f.destroy()}}},KA={insert:function(){var a=uQ("insert","link.dialog.insert","link-insert"),b=tQ([a.cancel.element(),a.execute.element()]);a.remove.disable();ra.disable(a.remove.element());return{dialogTitle:k(x.key("link.dialog.aria.insert")),elements:k([a.remove.element(),b]),events:k(a.events),keylayouts:k(a.keylayouts),execute:a.execute,
destroy:a.destroy}},update:function(){var a=uQ("update","link.dialog.update","link-update"),b=tQ([a.cancel.element(),a.execute.element()]);return{dialogTitle:k(x.key("link.dialog.aria.update")),elements:k([a.remove.element(),b]),events:k(a.events),keylayouts:k(a.keylayouts),execute:a.execute,destroy:a.destroy}}},vQ=B.resolve("link-validation-highlight"),wQ=B.resolve("link-validation-invalid"),xQ=B.resolve("link-validation-unknown"),yQ=k([vQ,wQ,xQ]),De={configure:function(a){z(yQ(),function(b){a.add(a.output(),
b,Na.removeClass(b));a.add(a.internal(),b,Na.removeClass(b))})},allClasses:yQ,invalidLink:k(wQ),unknownLink:k(xQ),validationHighlight:k(vQ)},JA={enabled:function(a){var b=g.none(),c=O("value","text","attrs"),d=H.create({properties:p(["link"]),follow:p(["link"]),ignore:p(["link"]),remove:p(["link"])}),e={"linkmenu-properties":d.trigger.properties,"linkmenu-follow":d.trigger.follow,"linkmenu-ignore":d.trigger.ignore,"linkmenu-remove":d.trigger.remove};return{situation:function(a){a=b.map(function(a){var b=
[c("linkmenu-properties",x.translate("link.context.edit"),{}),c("linkmenu-follow",x.translate("link.context.follow"),{}),c("linkmenu-remove",x.translate("link.context.remove"),{})];a=n.has(a,De.validationHighlight())?[c("linkmenu-ignore",x.translate("link.context.ignore"),{})]:[];return b.concat(a)}).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},handle:function(a){b.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value");c=e[c];void 0!==c&&c(b)})},assign:function(c){b=c.bind(function(b){return L.closest(b,
"a[href]",a.isRoot)})},events:d.registry}},disabled:function(){var a=Jg.noSituation(),b=H.create({properties:p(["link"])});return{situation:a,handle:t,assign:t,events:b.registry}}},gq=B.resolve("link-eph-cursor"),Ija=function(a){z(a,G.remove)},Jja=function(a,b){zQ("textbox-bookmark-top",a,y.prepend,b,rb.top())},Kja=function(a,b){zQ("textbox-bookmark-bottom",a,y.append,b,rb.bottom())},zQ=function(a,b,c,d,e){var f=jm.generate(a);z(b,function(a){m.set(a,"href","#"+f)});a=Y.children(d,"["+rb.bookmarkDataAttr()+
'="'+e+'"]');z(a,G.remove);0<b.length&&(b=r.fromTag("span"),m.setAll(b,{id:f,style:"visibility: hidden;"}),m.set(b,rb.bookmarkDataAttr(),e),c(d,b))},Rh={configure:function(a){a.add(a.internal(),gq,Na.remove);a.add(a.output(),gq,Na.remove);a.addExcludedContext(["."+gq]);a.addSelector(a.input(),"["+rb.bookmarkDataAttr()+"]",Ija);a.addSelector(a.output(),"["+rb.bookmarkAnchorDataAttr()+'="'+rb.top()+'"]',Jja);a.addSelector(a.output(),"["+rb.bookmarkAnchorDataAttr()+'="'+rb.bottom()+'"]',Kja)},properties:Aa("url textChanged text title target action invalid".split(" "),
[]),insertCursor:k(gq)},Pj=B.resolve("inline-popup-expanded"),Lja={setValue:function(a,b,c){a=a.dom();a.value=b;a.text=c}},AQ=function(a,b){a.dom().add(b.dom())},zr={getValue:function(a){var b=a.dom();a=b.selectedIndex;b=b.options[a];return void 0===b||-1===a?g.none():g.from(b.value)},add:AQ,addAll:function(a,b){z(b,function(b){AQ(a,b)})},setSelected:function(a,b){a.dom().selectedIndex=b}},BQ=[{value:"",i18nKey:"link.properties.target.none"},{value:"_blank",i18nKey:"link.properties.target.blank"},
{value:"_top",i18nKey:"link.properties.target.top"},{value:"_self",i18nKey:"link.properties.target.self"},{value:"_parent",i18nKey:"link.properties.target.parent"}],FY={target:function(a){var b=Wc.common("select","target-container","link.properties.target.label"),c=E(BQ,function(a){var b=r.fromTag("option");Lja.setValue(b,a.value,x.translate(a.i18nKey));return b});zr.addAll(b.field(),c);var d=a.target().getOr("");a=Va(BQ,function(a){return a.value===d}).getOr(0);zr.setSelected(b.field(),a);return{element:b.element,
input:b.field}}},EY=function(){var a=T.div();n.add(a,B.resolve("invalid-link-info"));var b=Wc.comboBox("href-url-value","link.properties.url.label",g.some(a));m.setAll(b.input(),{placeholder:x.translate("link.properties.url.placeholder"),autocomplete:"off",autocorrect:"off"});var c=n.toggler(b.element(),B.resolve("link-is-invalid"));return{input:b.input,element:b.element,dropArrow:b.dropArrow,showInvalid:function(){c.on();var d=T.span();ma.add(d,[B.resolve("icon"),B.resolve("invalid-link-icon")]);
y.append(a,d);var e=x.translate("link.properties.url.invalid");m.set(d,"title",e);d=ib.describe(b.input(),e);m.set(d,"aria-live","assertive");y.append(a,d)},hideInvalid:function(){c.off();G.empty(a);m.remove(b.input(),"aria-describedby")}}},JY=function(a){var b={};z(a,function(a){b[a]={}});return cb(b)},Qj={url:function(a){return g.some(a.url())},title:function(a){return a.title()},innerText:function(a){a=a.innerText();return 0<a.length?g.some(a):g.none()}},Ec={resolve:Lb.create("ephox-tarot").resolve},
CQ=function(a,b,c,d,e){var f=r.fromText(a.substr(0,b));b=r.fromText(a.substr(b,c));a=r.fromText(a.substr(d));e=r.fromTag(e);y.append(e,b);return[f,e,a]},DQ=function(a,b,c,d){var e=T.tag(b);P.append(e,c);d.each(function(a){n.add(e,a)});return{item:k(a),marked:k(g.some(e))}},EQ=function(a,b,c,d){var e=a.text,f=a.marker.start(),h=a.marker.length(),k=0;0<d-(f+h)||0===f||(k=h>d?f-10:f-Math.floor((d-h)/2));d=e.substr(k);f-=k;b=CQ(d,f,h,f+h,b);e=d.length===e.length?g.none():g.some(Ec.resolve("anchor-before"));
return DQ(a.item(),c,b,e)},sx=function(a,b){var c=T.span();n.add(c,b);P.append(c,a);return c},FQ=function(a,b,c){var d=[];b=sx(b,Ec.resolve("content-innertext"));0<a.length&&(a=sx([r.fromText(a)],Ec.resolve("anchor-before")),d.push(a));d.push(b);0<c.length&&(c=sx([r.fromText(c)],Ec.resolve("anchor-after")),d.push(c));return d},tx={contentMarker:function(a,b,c,d){var e=a.item().before(),f=a.item().after(),h=a.text;if(0===e.length&&0===f.length&&h.length>d)return EQ(a,b,c,d);d=a.marker.start();var k=
a.marker.length();b=CQ(h,d,k,d+k,b);e=FQ(e,b,f);return DQ(a.item(),c,e,g.none())},contentUnderlined:FQ,attrMarker:EQ},GQ=function(a,b,c){a=T.tag(b);y.append(a,r.fromText(c));return a},HA={anchors:function(a,b){var c=b.item(),d=c.url(),e=T.div();n.add(e,Ec.resolve("item-line"));var f=c.title().getOr(d);m.set(e,"title",f);b=b.marked().fold(function(){return GQ(a,"div",f)},function(a){return a});n.add(b,Ec.resolve("item-main-label"));d=g.from(d).map(function(b){return b!==f?(b=GQ(a,"div",b),n.add(b,
Ec.resolve("item-secondary-label")),[b]):[]}).getOr([]);d=[b].concat(d);P.append(e,d);return e},standard:function(a,b){var c=b.item();a=T.div();n.add(a,Ec.resolve("item-line"));n.add(a,Ec.resolve("bookmark-icon"));var d=[c.before(),c.innerText(),c.after()].join("");m.set(a,"title",d);b=b.marked().fold(function(){var a=tx.contentUnderlined(c.before(),[r.fromText(c.innerText())],c.after()),b=T.div();P.append(b,a);return b},function(a){return a});n.add(b,Ec.resolve("item-main-label"));c.indent()&&n.add(b,
Ec.resolve("indent"));y.append(a,b);return a},error:function(a,b){a=T.span();b=r.fromText(b);y.append(a,b);return a}},Mja=O("matchFunction","start","length"),Nja=function(a,b,c){for(var d=0,e=[],f=function(a){e.push(a);d++},h=0,g=a.length;h<g&&d<b;h++)c(a[h]).each(f);return e},ux={unmarked:function(a,b){b=b.getOr(1E3);a=a.length>b?a.slice(0,b):a;return E(a,function(a){return{item:k(a),marked:g.none}})},match:function(a,b,c,d){var e=c.toLowerCase();c=d.getOr(1E3);return Nja(a,c,function(a){return yc(b,
function(b){return b(a).bind(function(c){var d=c.toLowerCase().indexOf(e);if(-1<d){var f=e.length;return g.some({item:k(a),marked:g.none,text:c,marker:Mja(b,d,f)})}return g.none()})})})},mark:function(a,b,c,d){return E(a,function(a){return(a.marker.matchFunction()===Qj.innerText?tx.contentMarker:tx.attrMarker)(a,b,c,d)})}},HQ="data"+Ec.resolve("section-id"),vx={create:function(a,b){var c=r.fromTag("ol");m.set(c,HQ,b.id());var d=function(){G.empty(c)};return{element:k(c),clear:d,add:function(a){var b=
r.fromTag("li");y.append(b,a);y.append(c,b);return b},spec:k(b),destroy:function(){d()}}},dataIdAttribute:k(HQ)},Oja=Aa(["container","sections","translate"],["doc"]),Pja=Aa("id highlight contentLimit items render extractors".split(" "),["itemLimit"]),wx="data"+Ec.resolve("item-id"),Nm={init:function(a,b){var c=b.doc().getOr(r.fromDom(document)),d=b.translate(),e={},f=Ej(),h=T.div();n.add(h,Ec.resolve("predictive-menu"));S.hidden(h,!0);var l=HY(a,h),q=function(){z(f.state(),function(a){u(a,[])})},
u=function(a,b){G.remove(a.element());a.clear();var d={};0<b.length&&(z(b,function(b){var e=a.spec().render()(c,b);e=a.add(e);var f=Ha("");m.set(e,wx,f);d[f]={gui:k(e),item:k(b.item())}}),y.append(h,a.element()));e[a.spec().id()]=d},w=function(){return A.parent(h).isSome()},v=function(a){n.add(a,Ec.resolve("selected"));J().bind(P).each(function(a){ib.speak(ja.body(),a.item().url())})},x=function(a){v(a);Za.intoViewIfNeeded(a,h)},B=function(a){n.remove(a,Ec.resolve("selected"))},D=function(){L.descendant(h,
"li").each(x)},E=function(){Fa.one("ol:last-child li:last-child",h).each(x)},J=function(){return L.descendant(h,"li."+Ec.resolve("selected"))},M=function(){return J().bind(P).map(function(a){a=a.item();ib.speak(ja.body(),d("link.dialog.autocomplete.accept",a.url()));return a})},N=function(a){0===A.children(a).length?A.nextSibling(a).fold(D,N):A.firstChild(a).fold(E,x)},O=function(a){0===A.children(a).length?A.prevSibling(a).fold(E,O):A.lastChild(a).fold(D,x)},P=function(a){a=L.closest(a,"["+wx+"]");
var b=a.bind(function(a){return L.closest(a,"["+vx.dataIdAttribute()+"]")}),c=a.map(function(a){return m.get(a,wx)});return b.map(function(a){return m.get(a,vx.dataIdAttribute())}).bind(function(a){return g.from(e[a])}).bind(function(a){return c.bind(function(b){return g.from(a[b])})})},Q=K.capture(h,"mouseover",function(a){a=a.target();Db.closest(a,"li."+Ec.resolve("selected"))||P(a).fold(t,function(a){J().each(function(a){B(a)});v(a.gui())})}),R=K.capture(h,"click",function(a){M().each(U.trigger.click)}),
U=H.create({click:p(["item"])}),W=eh(fh,["url","indent"]);z(b.sections(),function(a){z(a.items(),W);a=vx.create(c,a);f.push(a)});q();return{element:k(h),events:U.registry,reset:q,resetFull:function(){z(f.state(),function(a){a.clear();var b=a.spec().items(),c=a.spec().itemLimit();b=ux.unmarked(b,c);u(a,b)})},filter:function(a){0<a.length?(e={},z(f.state(),function(b){var c=b.spec(),d=ux.match(c.items(),c.extractors(),a,c.itemLimit());c=ux.mark(d,c.highlight(),"div",c.contentLimit());u(b,c)})):q()},
show:function(a){var c=b.container();y.append(c,h);l.position(a,Lh.relativeOrigin(c));ib.speak(ja.body(),d("link.dialog.autocomplete.open"))},isShowing:w,hide:function(){w()&&ib.speak(ja.body(),d("link.dialog.autocomplete.close"));G.remove(h);J().each(B)},getSelectedData:M,moveup:function(){J().fold(E,function(a){B(a);A.prevSibling(a).fold(function(){A.parent(a).bind(A.prevSibling).fold(E,O)},x)})},movedown:function(){J().fold(D,function(a){B(a);A.nextSibling(a).fold(function(){A.parent(a).bind(A.nextSibling).fold(D,
N)},x)})},destroy:function(){Q.unbind();R.unbind();z(f,function(a){a.destroy()});G.remove(h)}}},config:Oja,section:Pja},LY=aa.detect().browser.isSafari(),yr=O("url","indent","action","before","innerText","after"),KY=O("url","indent","title","action"),IA=O("url","action"),GA=O("url","indent","action"),xx=ta.generate([{invalid:["invalidUrl"]},{unknown:["unknownUrl"]},{valid:["validUrl"]}]),MA={cata:function(a,b,c,d){return a.fold(b,c,d)},derive:function(a,b){return"VALID"===b?xx.valid(a):"INVALID"===
b?xx.invalid(a):xx.unknown(a)}},IQ=[za("url"),da("fresh",!1)],Qja=Cc(IQ),Rja=Cc([Dc("urls","urls",sg(),Uaa(IQ))]),LA={one:k(Qja),many:k(Rja)},UY=O("href","resolved"),WY={generate:function(a){var b={};z(a,function(a){var c=a.resolved();a=a.href();b.hasOwnProperty(c)?U(b[c],a)||b[c].push(a):b[c]=[a]});return b}},Sja={rules:[{current:Ca.backtrack,next:Ca.sidestep,fallback:g.none()},{current:Ca.sidestep,next:Ca.sidestep,fallback:g.some(Ca.backtrack)},{current:Ca.advance,next:Ca.sidestep,fallback:g.some(Ca.sidestep)}],
inclusion:function(a,b,c){return!a.property().parent(c).exists(function(c){return a.eq(c,b.item())})}},Tja=Ca.walkers(),JQ=function(a,b,c,d){return Ca.walk(a,b,c,Tja.left(),d.rules).map(function(c){return a.property().isEmptyTag(c.item())||a.property().isBoundary(c.item())?[]:(d.inclusion(a,c,b)?[c.item()]:[]).concat(JQ(a,c.item(),c.mode(),d))}).getOr([])},KQ=function(a,b,c){a=JQ(b,c,Ca.sidestep,a);return kd(a).concat([c])},LQ={top:u(KQ,Sja),all:u(KQ,{rules:void 0,inclusion:function(a,b,c){return a.property().isText(b.item())}})},
MQ=nb(),NQ={top:function(a){return LQ.top(MQ,a)},all:function(a){return LQ.all(MQ,a)}},Uja=function(a,b){b=Rd.generate(b,function(b,c){return a.property().isText(b)?g.some(W.range(b,c,c+a.property().getText(b).length)):g.none()});var c=Eb(b,function(b,c){return a.property().getText(c.element())+b},"");return{list:k(b),text:k(c)}},Vja=function(a,b,c,d){var e=Rd.find(b.list(),function(b){return a.eq(b.element(),c)}).map(function(a){return a.start()+d});return{list:b.list,text:b.text,cursor:k(e)}},Wja=
{from:function(a,b,c,d){b=Uja(a,b);return Vja(a,b,c,d)}},Xja=nb(),Yja={from:function(a,b,c){return Wja.from(Xja,a,b,c)}},cZ={get:function(a,b){var c=NQ.all(a),d=Yja.from(c,a,b);b=d.cursor().orThunk(function(){return D.isText(a)?g.none():g.some(d.text().length)});return{list:d.list,text:d.text,cursor:k(b)}}},OQ=function(a,b){return{patterns:function(){return[new RegExp("^("+a+")(.+)","gi")]},useCursor:fd,generate:function(a,d){a=r.fromTag(b,a.dom());P.append(a,d.clones());return Zd.species({elements:k([a]),
cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){var b=a[1];return g.some({startIndex:k(a.index),finishIndex:k(a.index+b.length)})}}},Th={normal:function(a,b){a=Cb.sanitise(a);return OQ(a,b)},spaced:function(a,b){a=Cb.sanitise(a)+"\\s";return OQ(a,b)}},PQ=function(a,b){return Zd.species({elements:k([r.fromText(b.text())]),cursor:g.none,dictation:g.none,notify:g.none})},Zja=function(){return{patterns:function(){return[/([^.?!][.?!]\s+)([a-z][^\s]*)/g,/^()([a-z][^\s]*)/g]},useCursor:k(!0),
generate:PQ,derive:function(a){var b=a.index,c=b+a[0].length;a=a[1]+ns(a[2]);return g.some({startIndex:k(b),finishIndex:k(c),text:k(a)})}}}(),$ja=function(){return{patterns:function(){return[/([A-Z][A-Z]+)([a-z]+)/g]},useCursor:k(!1),generate:PQ,derive:function(a){var b=a[2];b=ns(a[1].toLowerCase())+b.toLowerCase();var c=a.index;a=c+a[0].length;return g.some({startIndex:k(c),finishIndex:k(a),text:k(b)})}}}(),NA={capitalise:k(Zja),normalise:k($ja)},aZ={patterns:function(){return[In.autolink()]},useCursor:k(!0),
generate:function(a,b){a=r.fromTag("a");m.set(a,"href",b.href());y.append(a,r.fromText(b.text()));return Zd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:u(g.some,[a])})},derive:function(a){var b=px.preprocess(a[1]),c=b.text();b=b.href();return-1<c.indexOf("@")?g.none():g.some({startIndex:k(a.index),finishIndex:k(a.index+c.length),text:k(c),href:k(b)})}},$Y=k(function(a,b){return b}),aka={cloneAfter:function(a,b,c){var d=b;return E(a,function(a){var b=Pc.deep(a);D.isText(a)&&N.eq(c.endContainer(),
a)&&Ya.get(a).length>c.endOffset()&&Ya.set(b,Ya.get(b).substring(0,c.endOffset()));if(D.isText(b)&&0<d){var e=Ya.get(b);a=Math.min(e.length,d);e=e.substring(a);Ya.set(b,e);d-=a}return b})}},QQ={matcher:function(a,b,c){var d=function(a){return c.fold(function(){return a&&1<a.length},function(b){return a&&0<a.length&&a.index+a[0].length===b})};return yc(a,function(a){a:{if(!a.global)throw"Macro matching only works with global regexes: "+a;for(var c=a.exec(b);c;){if(d(c)){a=g.some(c);break a}c=a.exec(b)}a=
g.none()}return a})}},bka=function(a,b,c,d){b=aka.cloneAfter(b,d.finishIndex(),c);var e=ua(d,{clones:k(b)});return{build:function(b){b=a.generate(b,e);return Zd.applicator({elements:b.elements,cursor:b.cursor,range:k(c),dictation:b.dictation,notify:b.notify})}}},cka=function(a,b,c){b=Rd.get(a,b);var d=Rd.get(a,c);return b.bind(function(a){return d.map(function(b){return{start:k(a),finish:k(b)}})})},dka=function(a,b){return b(a.start().element())&&b(a.finish().element())?g.some(a):g.none()},eka=function(a,
b,c){return b.doc().bind(function(d){d=a.build(d);var e=d.elements();E(e,rg.doNotMerge);var f=Ez.handle(d.range());sd.insertAt(b,f,e);E(e,rg.clear);d.dictation().each(function(a){ib.shout(ja.body(),a())});d.notify().each(function(){c.input(e)});return d.cursor()})},RQ=function(a,b,c,d,e){return a.detect(b,c,d,e).map(function(a){return{execute:u(eka,a)}})},Er={block:u(RQ,{detect:function(a,b,c,d){var e=b.patterns(),f=a.cursor().filter(b.useCursor);return QQ.matcher(e,a.text(),f).bind(b.derive).bind(function(a){var e=
NQ.top(c);if(0<e.length){var f=au(e[0],0,c,d);return g.some(bka(b,e,f,a))}return g.none()})}}),inline:u(RQ,{detect:function(a,b,c,d){c=b.patterns();d=a.cursor().filter(b.useCursor);return QQ.matcher(c,a.text(),d).bind(b.derive).bind(function(c){return cka(a.list(),c.startIndex(),c.finishIndex()).bind(function(a){return dka(a,b.allowed).map(function(a){var d=c.startIndex()-a.start().start(),e=c.finishIndex()-a.finish().start(),f=au(a.start().element(),d,a.finish().element(),e);return{build:function(a){a=
b.generate(a,c);return Zd.applicator({elements:a.elements,cursor:a.cursor,range:k(f),dictation:a.dictation,notify:a.notify})}}})})})}})},fZ=aa.detect().deviceType.isTouch(),PA=function(a){a.disable();ra.disable(a.element())},iZ=aa.detect().deviceType.isiOS(),fka=O("rawData","extra"),QA=function(a,b,c){if(Mb(b)&&Mb(c))return J.value(fka(b,c));console.error(a+" callback parameters were not both arrays",b,c);return J.error(a+" callback parameters were not both arrays")},Fr=function(a,b){if(ck.isPrototypeOf(b))return J.value(r.fromDom(b));
console.error(a+" was not a DOM element",b);return J.error(a+" was not a DOM element")},vZ={configure:function(a){var b=[a.internal(),a.history(),a.output()];z(b,function(b){a.addSelector(b,"span.ephox-polish-incomplete-mention",Na.unwrap)});a.addExcludedContext(["span.ephox-polish-incomplete-mention"])}},SA=B.resolve("no-results"),RA=B.resolve("loading-results"),Gr=ta.generate([{none:["item"]},{extra:["value","item"]},{fetched:["userId","name","rawname","info","item"]}]),Hr=ta.generate([{nothing:[]},
{refetch:["term"]},{open:["term"]}]),SQ=function(){return new RegExp(Cb.wordbreak(),"i")},gka=function(a,b,c){return uh.repeatLeft(a,c,function(a,b,c,h,g){return uh.previousChar(h,g).fold(function(){return b.kontinue()},function(a){return b.finish(a.ch())})}).fold(g.none,g.none,g.some)},hka=function(a,b,c,d){return 0<=d&&"@"===c.charAt(d)?a.finish(W.point(b,d)):a.abort()},ika=function(a,b,c,d){return a.finish(W.point(b,d))},jka=function(a){return g.some(W.point(a,wa.getEnd(a)))},UA={isValidMention:function(a,
b){return gka(a,Ca.sidestep,b).fold(k(!0),function(a){return null===a.match(/[0-9a-zA-Z]/)})},scan:function(a,b){return uh.expandLeft(a,b,{regex:SQ,attempt:hka}).fold(g.none,g.none,g.some).bind(function(c){return uh.expandRight(a,b,{regex:SQ,attempt:ika}).fold(g.none,jka,g.some).map(function(a){return{start:c.element,soffset:c.offset,finish:a.element,foffset:a.offset}})})}},$i=ta.generate([{none:[]},{bare:["text","start","soffset","finish","foffset"]},{incomplete:["text","element"]},{complete:["text",
"element"]}]),TQ=B.resolve("incomplete-mention"),kka=function(a,b){return UA.scan(a,b).map(function(a){return $i.bare("",a.start(),a.soffset(),a.finish(),a.foffset())})},UQ=function(a){if(D.isText(a))return Ya.get(a);a=ed.descendants(a,D.isText);return E(a,Ya.get).join("")},VQ=function(a,b){return a.collapsed()?L.closest(a.startContainer(),b.hoverSelector()).fold(function(){return L.closest(a.startContainer(),"."+TQ).fold(function(){return kka(a.startContainer(),a.startOffset())},function(a){return g.some($i.incomplete(UQ(a),
a))})},function(a){return g.some($i.complete(UQ(a),a))}).getOrThunk($i.none):$i.none()},Uh={detect:function(a,b){return a.getSelection().map(function(a){return VQ(a,b)}).getOrThunk($i.none)},detectOn:VQ,withinIncomplete:function(a){return L.closest(a,"."+TQ)}},WQ=function(a){n.remove(a,B.resolve("incomplete-mention"));G.unwrap(a)},Jr={cancel:WQ,create:function(){var a=r.fromTag("span");n.add(a,B.resolve("incomplete-mention"));var b=r.fromText("@");y.append(a,b);return a},validatePrevious:function(a,
b){Uh.withinIncomplete(a).filter(function(a){return Uh.withinIncomplete(b).forall(function(b){return!N.eq(a,b)})}).each(WQ)}},Ir="."+B.resolve("mentions-business-card"),sZ=function(a,b){return 1<arguments.length||/\{(\d+)\}/.test(a)?In.tokens.call(void 0,a,b):a},xZ=O("textkey","value","icon"),lka=function(){return{configure:function(a){var b=[a.internal(),a.history(),a.output(),a.paste()];z(b,function(b){a.addSelector(b,"[unselectable]",Na.removeAttr("unselectable"))})},clean:function(a){m.remove(a,
"unselectable")},disableNativeResize:function(a){m.set(a,"unselectable","on")}}},mka=function(){return{configure:t,clean:function(a){A.nextSibling(a).filter(se.isEmptyText).each(G.remove)},disableNativeResize:t}},XQ=aa.detect().browser,Kr=XQ.isIE()?lka():XQ.isFirefox()?mka():{configure:t,clean:t,disableNativeResize:t},nka=aa.detect().browser.isChrome(),YQ="data-"+B.resolve("resize-direction"),hq=function(a,b){var c=r.fromTag("span");ma.add(c,[B.resolve(a),B.resolve("resize-eph-resizer")]);m.set(c,
YQ,b);return c},FZ={create:function(){var a=hq("element-se-resize","1"),b=hq("element-ne-resize","1"),c=hq("element-sw-resize","-1"),d=hq("element-nw-resize","-1"),e=r.fromTag("div");n.add(e,B.resolve("resize-wrapper"));P.append(e,[a,b,c,d]);var f=function(){G.remove(e)},h=H.create({click:p(["multiplier"])}),g=K.bind(e,"mousedown",function(a){n.has(a.target(),B.resolve("resize-eph-resizer"))&&(nka||a.prevent(),a=m.get(a.target(),YQ),a=void 0!==a?parseInt(a,10):1,h.trigger.click(a))});return{refresh:function(f,
g){y.append(f,e);f=bb.absolute(g);var h=sa.get(g);g=Ia.get(g);g={top:f.top,height:k(h),left:f.left,width:k(g)};f=Ia.get(c)/2;v.setAll(c,{top:g.top()+g.height()-f+"px",left:g.left()-f+"px"});v.setAll(a,{top:g.top()+g.height()-f+"px",left:g.width()+g.left()-f+"px"});v.setAll(b,{top:g.top()-f+"px",left:g.width()+g.left()-f+"px"});v.setAll(d,{top:g.top()-f+"px",left:g.left()-f+"px"})},clear:f,events:h.registry,destroy:function(){g.unbind();f()}}}},ZQ=aa.detect().browser,IZ=ZQ.isChrome(),HZ=ZQ.isFirefox(),
oka=O("minRow","minCol","maxRow","maxCol"),pka=function(a,b){var c=a.grid().columns(),d=a.grid().rows(),e=c,f=0,g=0;Ma(a.access(),function(a){if(b(a)){var c=a.row(),h=c+a.rowspan()-1,k=a.column();a=k+a.colspan()-1;c<d?d=c:h>f&&(f=h);k<e?e=k:a>g&&(g=a)}});return oka(d,e,f,g)},qka=function(a,b,c,d){for(var e=b.grid().columns(),f=b.grid().rows(),g=0;g<f;g++)for(var k=!1,m=0;m<e;m++)if(!(g<c.minRow()||g>c.maxRow()||m<c.minCol()||m>c.maxCol()))if(Ib.getAt(b,g,m).filter(d).isNone()){var n=k,p=a[g].element(),
t=r.fromTag("td");y.append(t,r.fromTag("br"));(n?y.append:y.prepend)(p,t)}else k=!0},rka=function(a,b){var c=ka(uk.firstLayer(a,"tr"),function(a){return 0===a.dom().childElementCount});z(c,G.remove);b.minCol()!==b.maxCol()&&b.minRow()!==b.maxRow()||z(uk.firstLayer(a,"th,td"),function(a){m.remove(a,"rowspan");m.remove(a,"colspan")});m.remove(a,"width");m.remove(a,"height");v.remove(a,"width");v.remove(a,"height")},ska={extract:function(a,b){var c=function(a){return Fa.is(a.element(),b)},d=hg.fromTable(a),
e=Ib.generate(d),f=pka(e,c),g="th:not("+b+"),td:not("+b+")",k=uk.filterFirstLayer(a,"th,td",function(a){return Fa.is(a,g)});z(k,G.remove);qka(d,e,f,c);rka(a,f);return a}},MZ=function(a){z(a,function(a){G.empty(a);y.append(a,r.fromTag("br"))})},tka=function(a){return sb.table(a[0]).map(Pc.deep).map(function(a){return[ska.extract(a,te.selectedSelector())]})},KZ=function(a,b){var c=lz.register({doc:a.doc,win:a.win,body:a.body,baseURI:a.baseURI,getSelection:a.getSelection,setSelection:a.setSelection});
return function(b,e,f,g){f=Uj.injectEphemera(f);g();var d=Qm.fromSafe(a);d.begin();c.setClipboard(b,e,f,function(){d.end()})}},LZ=function(a,b){return tka(a).map(function(a){z(a,b);var c=u(rn.toText,a);a=u(rn.toHtml,a);return{text:c,html:a}})},NZ=function(a,b,c){return Mi.fragment(b.win(),a).map(function(a){var b=u(Mi.text,a);a=u(Mi.html,a,c);return{text:b,html:a}})},ud={resolve:Lb.create("ephox-cement").resolve},uka=ud.resolve("smartpaste-eph-bin"),iB={binStyle:k(uka)},$Q=function(a,b){return Zb.cata(b.get(),
k([]),ca,k([a]))},yx={mergable:function(a,b){return Zb.cata(b.get(),g.none,function(b,d){return 0===b.length?g.none():Xz.retrieveBox(a,te.firstSelectedSelector(),te.lastSelectedSelector()).bind(function(a){return 1<b.length?g.some({bounds:k(a),cells:k(b)}):g.none()})},g.none)},unmergable:function(a,b){var c=function(a){return m.has(a,"rowspan")&&1<parseInt(m.get(a,"rowspan"),10)||m.has(a,"colspan")&&1<parseInt(m.get(a,"colspan"),10)};a=$Q(a,b);return 0<a.length&&ob(a,c)?g.some(a):g.none()},selection:$Q},
aR=function(a){return{element:k(a),mergable:g.none,unmergable:g.none,selection:k([])}},vka=O("element","clipboard","generators"),Um={noMenu:aR,forMenu:function(a,b,c){return{element:k(c),mergable:k(yx.mergable(b,a)),unmergable:k(yx.unmergable(c,a)),selection:k(yx.selection(c,a))}},notCell:function(a){return aR(a)},paste:vka},wka=function(a){return"table"===D.name(a)||0===Vb.get(a).trim().length},bR=function(a){var b=ka(a,function(a){return"table"===D.name(a)});return 1!==b.length?g.none():ob(a,wka)?
g.from(b[0]):g.none()},z_={rules:function(a,b,c){var d=t,e=function(e,f){return sb.table(e,a.isRoot).bind(function(g){var h=a.doc().getOrDie();h=bF.paste(h);h=Um.paste(e,f,h);var l=k(c);return Ac.execute(b,nc.pasteCells,d,l)(a,g,h).map(function(a){return a.startContainer()})})},f=function(a){return bR(a).map(function(a){return{single:k(a)}})};return{collapsed:k(jb(function(a,b,c){return sb.cell(b,a)},f,function(a,b){return e(a.element(),b.single())},"custom arcade table insert collapsed")),ranged:k(jb(function(a,
b,c){return sb.cell(b.element(),a).map(function(a){return{left:k(a),right:k(a)}})},f,function(a,b){return e(a.left(),b.single())},"custom arcade table insert ranged"))}},extractTable:bR},cR="officeStyles htmlStyles isWord isGoogleDocs proxyBin isInternal backgroundAssets".split(" "),dR=Aa([],cR),Xb={nu:dR,merge:function(a,b){var c={};z(cR,function(d){b[d]().or(a[d]()).each(function(a){c[d]=a})});return dR(c)}},El=ta.generate([{error:["message"]},{paste:["elements","correlated"]},{cancel:[]},{incomplete:["elements",
"correlated","message"]}]),zx=function(a,b,c,d,e){return a.fold(b,c,d,e)},db={error:El.error,paste:El.paste,cancel:El.cancel,incomplete:El.incomplete,cata:zx,carry:function(a,b){return zx(a,g.none,g.none,g.none,function(a,d,e){return zx(b,g.none,function(a,b){return g.some(El.incomplete(a,b,e))},g.none,g.none)}).getOr(b)}},Ax=Aa(["response","bundle"],[]),Fl=function(a){return Bx(function(b){var c=Ax(a);b(c)})},Bx=function(a){var b=Bx;return{get:function(b){a(b)},map:function(c){return b(function(b){a(function(a){a=
c(a);b(a)})})},bind:function(c){return b(function(b){a(function(a){c(a).get(b)})})}}},La={call:function(a,b){a(Ax(b))},sync:Bx,pure:Fl,pass:function(a){return Fl({response:a.response(),bundle:a.bundle()})},done:Ax,error:function(a){return Fl({response:db.error(a),bundle:Xb.nu({})})},initial:function(){return Fl({response:db.paste([],[]),bundle:Xb.nu({})})},cancel:function(){return Fl({response:db.cancel(),bundle:Xb.nu({})})}},eR=O("steps","input","label","capture"),xka=function(a,b){return yc(a,function(a){return a.getAvailable(b).map(function(b){return eR(a.steps(),
b,a.label(),a.capture())})})},yka=function(a,b){var c=u(La.pass,a),d=function(){return b().map(function(b){var c=Xb.merge(a.bundle(),b.bundle());b=db.carry(a.response(),b.response());return La.done({response:b,bundle:c})})};return db.cata(a.response(),c,d,c,d)},aB={choose:function(a,b,c){return xka(a,c).getOrThunk(function(){var a=b.getAvailable(c);return eR(b.steps(),a,b.label(),b.capture())})},run:function(a,b){return hb(a,function(a,d){return a.bind(function(a){return yka(a,function(){return d(b,
a)})})},La.initial())}},zka=function(a,b){a=D.value(a);var c=r.fromTag("div"),d=a.indexOf("]>");c.dom().innerHTML=a.substr(d+2);return Ja.descendant(c,function(a){return D.name(a)===b})},Aka=function(a){return D.isComment(a)?zka(a,"v:shape"):g.none()},Bka=function(a){if("img"===D.name(a)){var b=m.get(a,"src");if(void 0!==b&&null!==b&&Gb(b,"file://"))return a=Pc.shallow(a),b=b.split(/[\/\\]/),m.set(a,"data-image-id",b[b.length-1]),m.remove(a,"src"),m.set(a,"data-image-type","local"),n.add(a,"rtf-data-image"),
g.some(a)}return g.none()},Cka=function(a){return Aka(a).map(function(a){var b=m.get(a,"o:spid");b=void 0===b?m.get(a,"id"):b;var d=r.fromTag("img");n.add(d,"rtf-data-image");m.set(d,"data-image-id",b.substr(7));m.set(d,"data-image-type","code");v.setAll(d,{width:v.get(a,"width"),height:v.get(a,"height")});return d})},fR={validStyles:function(){return/^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/},
specialInline:function(){return/^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/}},aj=ta.generate([{starts:["value","f"]},{pattern:["regex","f"]},{contains:["value","f"]},{exact:["value","f"]},{all:[]},{not:["stringMatch"]}]),gR=function(a,b){return a.fold(function(a,d){return 0===d(b).indexOf(d(a))},function(a,d){return a.test(d(b))},function(a,d){return 0<=d(b).indexOf(d(a))},function(a,d){return d(b)===d(a)},function(){return!0},function(a){return!gR(a,b)})},
M={starts:aj.starts,pattern:aj.pattern,contains:aj.contains,exact:aj.exact,all:aj.all,not:aj.not,cata:function(a,b,c,d,e,f,g){return a.fold(b,c,d,e,f,g)},matches:gR,caseSensitive:function(a){return a},caseInsensitive:function(a){return a.toLowerCase()}},iq={keyval:function(a,b,c,d){var e=d.name,f=void 0!==d.condition?d.condition:k(!0);d=void 0!==d.value?d.value:M.all();return M.matches(e,c)&&M.matches(d,b)&&f(a)},name:function(a,b){var c=D.name(a),d=b.name;b=void 0!==b.condition?b.condition:k(!0);
return M.matches(d,c)&&b(a)}},Dka=function(a,b,c){z(b,function(b){m.remove(a,b)});Ma(c,function(b,c){m.set(a,c,b)})},hR={filter:function(a,b){var c={};z(a.dom().attributes,function(a){b(a.value,a.name)||(c[a.name]=a.value)});return c},clobber:function(a,b,c){c=E(a.dom().attributes,function(a){return a.name});cb(b).length!==c.length&&Dka(a,c,b)},scan:k({})},Eka=function(a){var b={};a=void 0!==a&&null!==a?a.split(";"):[];z(a,function(a){a=a.split(":");2===a.length&&(b[Zh(a[0])]=Zh(a[1]))});return b},
iR=function(a){var b=cb(a);return E(b,function(b){return b+": "+a[b]}).join("; ")},Ig={filter:function(a,b){var c=a.dom().style,d={};z(void 0===c||null===c?[]:c,function(c){var e=a.dom().style.getPropertyValue(c);b(e,c)||(d[c]=e)});return d},clobber:function(a,b,c){m.set(a,"style","");var d=cb(b).length,e=cb(c).length;0===d&&0===e?m.remove(a,"style"):0===d?m.set(a,"style",iR(c)):(Ma(b,function(b,c){v.set(a,c,b)}),b=m.get(a,"style"),c=0<e?iR(c)+"; ":"",m.set(a,"style",c+b))},scan:function(a,b,c){a=
a.dom().getAttribute("style");var d=Eka(a),e={};z(b,function(a){var b=d[a];void 0===b||c(b,a)||(e[a]=b)});return e}},Fka=["mso-list"],jR=function(a,b){var c=Ig.scan(a,Fka,b);b=Ig.filter(a,b);Ig.clobber(a,b,c)},kR=function(a,b){b=hR.filter(a,b);hR.clobber(a,b,{})},jq={style:jR,attribute:kR,styleDom:function(a,b){jR(r.fromDom(a),b)},attributeDom:function(a,b){kR(r.fromDom(a),b)},validateStyles:function(a){var b=Ig.filter(a,k(!1));Ig.clobber(a,b,{})}},lR=function(a,b,c){a(c,function(a,e){return Xa(b,
function(b){return iq.keyval(c,a,e,b)})})},kq={remover:function(a,b){var c=ua({styles:[],attributes:[],classes:[],tags:[]},b);b=Y.descendants(a,"*");z(b,function(a){lR(jq.style,c.styles,a);lR(jq.attribute,c.attributes,a);z(c.classes,function(b){var c=m.has(a,"class")?ma.get(a):[];z(c,function(c){M.matches(b.name,c)&&n.remove(a,c)})})});a=Y.descendants(a,"*");z(a,function(a){Xa(c.tags,u(iq.name,a))&&G.remove(a)})},unwrapper:function(a,b){var c=ua({tags:[]},b);a=Y.descendants(a,"*");z(a,function(a){Xa(c.tags,
u(iq.name,a))&&G.unwrap(a)})},transformer:function(a,b){var c=ua({tags:[]},b);a=Y.descendants(a,"*");z(a,function(a){qa(c.tags,u(iq.name,a)).each(function(b){b.mutate(a)})})},validator:function(a){a=Y.descendants(a,"*");z(a,function(a){jq.validateStyles(a)})}},Gl=function(a,b,c){var d=r.fromDom(a);switch(a.nodeType){case 1:if(b)var e="endElement";else e="startElement",v.setAll(d,c||{});var f="HTML"!==a.scopeName&&a.scopeName&&a.tagName&&0>=a.tagName.indexOf(":")?(a.scopeName+":"+a.tagName).toUpperCase():
a.tagName;break;case 3:e="text";var g=a.nodeValue;break;case 8:e="comment";g=a.nodeValue;break;default:console.log("WARNING: Unsupported node type encountered: "+a.nodeType)}return{getNode:function(){return a},tag:function(){return f},type:function(){return e},text:function(){return g}}},mR=function(a,b){return Gl(b.createElement(a),!0)},Ab={START_ELEMENT_TYPE:"startElement",END_ELEMENT_TYPE:"endElement",TEXT_TYPE:"text",COMMENT_TYPE:"comment",FINISHED:mR("HTML",window.document),token:Gl,createStartElement:function(a,
b,c,d){var e=d.createElement(a);Ma(b,function(a,b){e.setAttribute(b,a)});return Gl(e,!1,c)},createEndElement:mR,createComment:function(a,b){return Gl(b.createComment(a),!1)},createText:function(a,b){return Gl(b.createTextNode(a))}},Gka={create:function(a){var b=a.createDocumentFragment(),c=b;return{dom:c,receive:function(d){var e=function(a){a=a.getNode().cloneNode(!1);b.appendChild(a);b=a},f=function(c,d){c=a.createTextNode(c.text());b.appendChild(c)};switch(d.type()){case Ab.START_ELEMENT_TYPE:e(d);
break;case Ab.TEXT_TYPE:f(d);break;case Ab.END_ELEMENT_TYPE:b=b.parentNode;null===b&&(b=c);break;case Ab.COMMENT_TYPE:break;default:throw{message:"Unsupported token type: "+d.type()};}},label:"SERIALISER"}}},Hka={tokenise:function(a,b){b=b||window.document;var c=b.createElement("div");b.body.appendChild(c);c.style.position="absolute";c.style.left="-10000px";c.innerHTML=a;var d=c.firstChild||Ab.FINISHED,e=[],f=!1;return{hasNext:function(){return void 0!==d},next:function(){var a=d,g=f;!f&&d.firstChild?
(e.push(d),d=d.firstChild):f||1!==d.nodeType?d.nextSibling?(d=d.nextSibling,f=!1):(d=e.pop(),f=!0):f=!0;a===Ab.FINISHED||d||(b.body.removeChild(c),d=Ab.FINISHED);a=a===Ab.FINISHED?a:a?Ab.token(a,g):void 0;return a}}}},nR=function(a,b,c){var d=c;for(c=b.length-1;0<=c;c--)d=b[c](d,{},a);return d},Ika={build:nR,run:function(a,b,c){var d=Gka.create(a);b=Hka.tokenise(b,a);for(a=nR(a,c,d);b.hasNext();)c=b.next(),a.receive(c);return d.dom}},gb={removal:function(a){return function(b){kq.remover(b,a)}},unwrapper:function(a){return function(b){kq.unwrapper(b,
a)}},transformer:function(a){return function(b){kq.transformer(b,a)}},validate:function(){return function(a){kq.validator(a)}},pipeline:function(a){return function(b){var c=Ea.get(b),d=A.owner(b);c=Ika.run(d.dom(),c,a);G.empty(b);b.dom().appendChild(c)}},isWordContent:function(a,b){return 0<=a.indexOf("<o:p>")||b.browser.isEdge()&&0<=a.indexOf('v:shapes="')||b.browser.isEdge()&&0<=a.indexOf("mso-")||0<=a.indexOf("mso-list")||0<=a.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal")||0<=a.indexOf("MsoListParagraphCxSpFirst")||
0<=a.indexOf("<w:WordDocument>")},go:function(a,b,c){var d=r.fromTag("div",a.dom());d.dom().innerHTML=b;z(c,function(a){a(d)});return Ea.get(d)}},Cx={getAttribute:function(a,b){a=r.fromDom(a.getNode());return m.get(a,b)},getStyle:function(a,b){a=r.fromDom(a.getNode());return v.get(a,b)},isWhitespace:function(a){return a.type()===Ab.TEXT_TYPE&&/^[\s\u00A0]*$/.test(a.text())},getMsoList:function(a){a=r.fromDom(a.getNode());return Ig.scan(a,["mso-list"],k(!1))["mso-list"]}},oR=function(a,b,c){return a===
b||a&&b&&a.tag===b.tag&&a.type===b.type&&(c||a.variant===b.variant)},pR={guessFrom:function(a,b){return qa(a,function(a){return"UL"===a.tag||b&&oR(a,b,!0)}).orThunk(function(){return 0===a.length?g.none():g.some(a[0])})},eqListType:oR},Dx=function(a,b){if(void 0===a||void 0===b)throw console.trace(),"brick";a.nextFilter.set(b)},qR=function(a,b,c){b.nextFilter.get()(a,b,c)},lq={next:Dx,go:qR,jump:function(a){return function(b,c,d){Dx(c,a);qR(b,c,d)}},isNext:function(a,b){return a.nextFilter.get()===
b},setNext:function(a){return function(b,c,d){Dx(c,a)}}},Jka=O("level","token","type"),Kka=function(a,b,c,d){a=c.getCurrentListType();c=c.getCurrentLevel()==d.level()?a:null;return pR.guessFrom(d.emblems(),c).filter(function(a){if(a="OL"===a.tag)a=!U(["P"],b.tag())||/^MsoHeading/.test(Cx.getAttribute(b,"class"));return!a})},rR={predicate:function(a,b){return m.has(r.fromDom(b.getNode()),"data-list-level")},action:function(a){return function(b,c,d){b=r.fromDom(d.getNode());var e=parseInt(m.get(b,"data-list-level"),
10),f=m.get(b,"data-list-emblems");f=JSON.parse(f);m.remove(b,"data-list-level");m.remove(b,"data-list-emblems");b={level:k(e),emblems:k(f)};b.level();c.originalToken.set(d);Kka(c.listType.get(),d,c.emitter,b).each(c.listType.set);d=Jka(b.level(),c.originalToken.get(),c.listType.get());c.emitter.openItem(d.level(),d.token(),d.type());lq.next(c,a.inside())}}},YA=function(a,b){return function(a,d,e){return b(a,d,e)}},sR={inside:function(a){return XA("Inside.List.Item",[Lr(function(a,c){return c.type()===
Ab.END_ELEMENT_TYPE&&a.originalToken.get()&&c.tag()===a.originalToken.get().tag()},function(b,c,d){lq.next(c,a.outside())},"Closing open tag")],function(a,c,d){a.emit(d)})},outside:function(a){return XA("Outside.List.Item",[Lr(rR.predicate,rR.action(a),"Data List ****"),Lr(function(a,c){return c.type()===Ab.TEXT_TYPE&&Cx.isWhitespace(c)},function(a,c,d){a.emit(d)},"Whitespace")],function(b,c,d){c.emitter.closeAllLists();b.emit(d);lq.next(c,a.outside())})}},Lka=O("state","result"),Mka=O("state","value"),
mc={state:O("level","type","types","items"),value:Mka,result:Lka},Ex={start:function(a,b){var c=a.items().slice(0);b=void 0!==b&&"P"!==b?g.some(b):g.none();b.fold(function(){c.push("P")},function(a){c.push(a)});a=mc.state(a.level(),a.type(),a.types(),c);return mc.value(a,b)},finish:function(a){var b=a.items().slice(0);if(0<b.length&&"P"!==b[b.length-1]){var c=b[b.length-1];b[b.length-1]="P";a=mc.state(a.level(),a.type(),a.types(),b);return mc.value(a,g.some(c))}return mc.value(a,g.none())}},Fx=function(a,
b,c){for(var d=[];b(a);){var e=c(a);a=e.state();d=d.concat(e.result())}return mc.result(a,d)},tR={moveRight:function(a,b,c){return Fx(a,function(a){return a.level()<b},c)},moveLeft:function(a,b,c){return Fx(a,function(a){return a.level()>b},c)},moveUntil:Fx},Nka={from:function(a){var b={"list-style-type":"none"};a?(a=Cx.getStyle(a,"margin-left"),a=void 0!==a&&"0px"!==a?{"margin-left":a}:{}):a=b;return a}},uR=function(a,b,c){var d=b.start&&1<b.start?{start:b.start}:{},e=a.level()+1,f=a.types().concat([b]);
c=[u(Ab.createStartElement,b.tag,d,c)];a=mc.state(e,b,f,a.items());return mc.result(a,c)},vR=function(a){var b=a.types().slice(0),c=[u(Ab.createEndElement,b.pop().tag)],d=a.level()-1;a=mc.state(d,b[b.length-1],b,a.items());return mc.result(a,c)},Oka=function(a,b){a=vR(a);b=uR(a.state(),b,b.type?{"list-style-type":b.type}:{});return mc.result(b.state(),a.result().concat(b.result()))},bj={open:uR,openItem:function(a,b,c){var d=Nka.from(b);a=a.type()&&!pR.eqListType(a.type(),c)?Oka(a,c):mc.result(a,
[]);d=[u(Ab.createStartElement,"LI",{},d)];c=Ex.start(a.state(),b&&b.tag());var e=c.value().map(function(a){jq.styleDom(b.getNode(),k(!0));return[k(b)]}).getOr([]);return mc.result(c.state(),a.result().concat(d).concat(e))},close:vR,closeItem:function(a){var b=u(Ab.createEndElement,"LI");a=Ex.finish(a);var c=a.value().fold(function(){return[b]},function(a){return[u(Ab.createEndElement,a),b]});return mc.result(a.state(),c)}},mq=function(a){if(0===a.length)throw"Compose must have at least one element in the list";
var b=a[a.length-1];a=ia(a,function(a){return a.result()});return mc.result(b.state(),a)},Pka=function(a){a=bj.closeItem(a);var b=bj.close(a.state());return mq([a,b])},Qka=function(a,b,c,d){return tR.moveRight(a,c,function(a){var e=a.level()===c-1&&b.type?{"list-style-type":b.type}:{};a=bj.open(a,b,e);e=bj.openItem(a.state(),a.state().level()==c?d:void 0,b);return mq([a,e])})},wR=function(a,b){return tR.moveLeft(a,b,Pka)},Rka=function(a,b,c,d){var e=1<c?Ex.finish(a):mc.value(a,g.none());a=e.value().map(function(a){return[u(Ab.createEndElement,
a)]}).getOr([]);e.state().level();b=Qka(e.state(),b,c,d);return mc.result(b.state(),a.concat(b.result()))},ZA={openItem:function(a,b,c,d){a=a.level()>b?wR(a,b):mc.result(a,[]);a.state().level()===b?(b=a.state(),b=0<b.level()?bj.closeItem(b):mc.result(b,[]),c=bj.openItem(b.state(),c,d),c=mq([b,c])):c=Rka(a.state(),d,b,c);return mq([a,c])},closeAllLists:wR},RZ=["disc","circle","square"],Ska={getCurrentListType:function(){return Hl().getCurrentListType()},getCurrentLevel:function(){return Hl().getCurrentLevel()},
closeAllLists:function(){return Hl().closeAllLists.apply(void 0,arguments)},openItem:function(){return Hl().openItem.apply(void 0,arguments)}},Hl=function(){return{getCurrentListType:k({}),getCurrentLevel:k(1),closeAllLists:ca,openItem:ca}},yR={inside:function(){return Tka},outside:function(){return xR}},Uka=function(){var a=!1,b="";return{check:function(c){return a&&c.type()===Ab.TEXT_TYPE?(b+=c.text(),!0):c.type()===Ab.START_ELEMENT_TYPE&&"STYLE"===c.tag()?a=!0:c.type()===Ab.END_ELEMENT_TYPE&&"STYLE"===
c.tag()?(a=!1,!0):!1}}}(),Tka=sR.inside(yR),xR=sR.outside(yR),zR=function(a){var b=na(a),c=na(null),d=na(null);return{reset:function(e){b.set(a);c.set(null);d.set(null);e=QZ(e,e.document);Hl=k(e)},nextFilter:b,originalToken:c,listType:d,emitter:Ska}}(xR),Vka=WA(function(a,b,c){Uka.check(b)||lq.go(a,zR,b)},zR.reset,"list.filters"),Wka=[{regex:/^\(?[dc][\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[DC][\.\)]$/,type:{tag:"OL",type:"upper-alpha"}},{regex:/^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/,
type:{tag:"OL",type:"upper-roman"}},{regex:/^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/,type:{tag:"OL",type:"lower-roman"}},{regex:/^\(?[0-9]+[\.\)]$/,type:{tag:"OL"}},{regex:/^([0-9]+\.)*[0-9]+\.?$/,type:{tag:"OL",variant:"outline"}},{regex:/^\(?[a-z]+[\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[A-Z]+[\.\)]$/,type:{tag:"OL",type:"upper-alpha"}}],AR={"\u2022":{tag:"UL",type:"disc"},"\u00b7":{tag:"UL",type:"disc"},"\u00a7":{tag:"UL",type:"square"}},BR={o:{tag:"UL",type:"circle"},
"-":{tag:"UL",type:"disc"},"\u25cf":{tag:"UL",type:"disc"},"\ufffd":{tag:"UL",type:"circle"}},Xka={extract:function(a,b){var c=BR[a]?[BR[a]]:[];b=b&&AR[a]?[AR[a]]:b?[{tag:"UL",variant:a}]:[];var d=ia(Wka,function(b){if(b.regex.test(a)){var c=b.type;var d=a.split(".");if(0===d.length)d=a;else{var e=d[d.length-1];d=0===e.length&&1<d.length?d[d.length-2]:e}d=parseInt(d,10);d=isNaN(d)?{}:{start:d};b=b.type;b=void 0!==b.variant?b.variant:"("===a.charAt(0)?"()":")"===a.charAt(a.length-1)?")":".";c=[ua(c,
d,{variant:b})]}else c=[];return c});c=c.concat(b).concat(d);return E(c,function(b){return void 0!==b.variant?b:ua(b,{variant:a})})}},CR=function(a){return Ig.scan(a,["mso-list"],k(!1))["mso-list"]},DR=function(a){return D.isElement(a)&&v.getRaw(a,"font-family").exists(function(a){return U(["wingdings","symbol"],a.toLowerCase())})},Fc={getMsoList:CR,extractLevel:function(a){a=CR(a);return(a=/ level([0-9]+)/.exec(a))&&a[1]?g.some(parseInt(a[1],10)):g.none()},extractEmblem:function(a,b){a=Vb.get(a).trim();
b=Xka.extract(a,b);return 0<b.length?g.some(b):g.none()},extractSymSpan:function(a){return Ja.child(a,DR)},extractMsoIgnore:function(a){return Ja.descendant(a,function(a){return!!(D.isElement(a)?Ig.scan(a,["mso-list"],k(!1)):[])["mso-list"]})},extractCommentSpan:function(a){return Ja.child(a,D.isComment).bind(A.nextSibling).filter(function(a){return"span"===D.name(a)})},isSymbol:DR,deduceLevel:function(a){return v.getRaw(a,"margin-left").bind(function(a){a=parseInt(a,10);return isNaN(a)?g.none():
g.some(Math.max(1,Math.ceil(a/18)))})}},ER=function(a){for(var b=[];null!==a.nextNode();)b.push(r.fromDom(a.currentNode));return b},Yka=function(a){try{return ER(a)}catch(b){return[]}},FR=aa.detect().browser,Zka=FR.isIE()||FR.isEdge()?Yka:ER,$ka=k(k(!0)),ala={find:function(a,b){b=b.fold($ka,function(a){return function(b){return a(b.nodeValue)}});b.acceptNode=b;a=Hb.createTreeWalker(a.dom(),Kc.getOrDie("NodeFilter").SHOW_COMMENT,b,!1);return Zka(a)}},Il=function(a,b,c,d){m.set(a,"data-list-level",
b);b=JSON.stringify(c);m.set(a,"data-list-emblems",b);b=ala.find(a,g.none());z(b,G.remove);z(d,G.remove);m.remove(a,"style");m.remove(a,"class")},bla=function(a){return Fc.extractLevel(a).bind(function(b){return Fc.extractSymSpan(a).bind(function(c){return Fc.extractEmblem(c,!0).map(function(d){return{mutate:function(){Il(a,b,d,[c])}}})})})},cla=function(a){return Fc.extractLevel(a).bind(function(b){return Fc.extractCommentSpan(a).bind(function(c){return Fc.extractEmblem(c,Fc.isSymbol(c)).map(function(d){return{mutate:function(){Il(a,
b,d,[c])}}})})})},dla=function(a){return Fc.extractLevel(a).bind(function(b){return Fc.extractCommentSpan(a).bind(function(c){return Fc.extractEmblem(c,Fc.isSymbol(c)).map(function(d){return{mutate:function(){Il(a,b,d,[c])}}})})})},ela=function(a){return"p"!==D.name(a)?g.none():Fc.extractLevel(a).bind(function(b){return Fc.extractMsoIgnore(a).bind(function(c){return Fc.extractEmblem(c,!1).map(function(d){return{mutate:function(){Il(a,b,d,[A.parent(c).getOr(c)])}}})})})},fla=function(a){return"p"!==
D.name(a)?g.none():Fc.extractMsoIgnore(a).bind(function(b){var c=A.parent(b).getOr(b),d=Fc.isSymbol(c);return Fc.extractEmblem(b,d).bind(function(b){return Fc.deduceLevel(a).map(function(d){return{mutate:function(){Il(a,d,b,[c])}}})})})},gla={find:function(a){return bla(a).orThunk(function(){return cla(a)}).orThunk(function(){return dla(a)}).orThunk(function(){return ela(a)}).orThunk(function(){return fla(a)})}},hla=gb.transformer({tags:[{name:M.pattern(/^(p|h\d+)$/,M.caseInsensitive),mutate:function(a){gla.find(a).each(function(a){a.mutate()})}}]}),
ila=function(a){var b=a.dom().attributes;b=void 0!==b&&null!==b&&0<b.length;return"span"===D.name(a)?b:!0},Gx=function(a){return void 0===a.dom().attributes||null===a.dom().attributes?!0:0===a.dom().attributes.length||1===a.dom().attributes.length&&"style"===a.dom().attributes[0].name},GR=function(a,b){var c=r.fromTag(a);y.before(b,c);a=b.dom().attributes;z(a,function(a){c.dom().setAttribute(a.name,a.value)});a=A.children(b);P.append(c,a);G.remove(b);return c},HR=function(a){return A.prevSibling(a).bind(function(a){return D.isText(a)&&
0===Ya.get(a).trim().length?HR(a):"li"===D.name(a)?g.some(a):g.none()})},Bh={changeTag:GR,addBrTag:function(a){0===Ea.get(a).length&&y.append(a,r.fromTag("br"))},properlyNest:function(a){A.parent(a).each(function(b){b=D.name(b);U(["ol","ul"],b)&&HR(a).fold(function(){var b=r.fromTag("li");v.set(b,"list-style-type","none");y.wrap(a,b)},function(b){y.append(b,a)})})},fontToSpan:function(a){var b=GR("span",a),c={"font-size":{1:"8pt",2:"10pt",3:"12pt",4:"14pt",5:"18pt",6:"24pt",7:"36pt"}};Ma({face:"font-family",
size:"font-size",color:"color"},function(a,e){if(m.has(b,e)){var d=m.get(b,e);v.set(b,a,void 0!==c[a]&&void 0!==c[a][d]?c[a][d]:d);m.remove(b,e)}})}},jla=gb.unwrapper({tags:[{name:M.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i,M.caseInsensitive)}]}),kla=gb.removal({attributes:[{name:M.exact("id",M.caseInsensitive),value:M.starts("docs-internal-guid",M.caseInsensitive)}]}),lla=[gb.pipeline([Vka])],mla=gb.removal({attributes:[{name:M.pattern(/^v:/,M.caseInsensitive)},{name:M.exact("href",M.caseInsensitive),
value:M.contains("#_toc",M.caseInsensitive)},{name:M.exact("href",M.caseInsensitive),value:M.contains("#_mso",M.caseInsensitive)},{name:M.pattern(/^xmlns(:|$)/,M.caseInsensitive)},{name:M.exact("type",M.caseInsensitive),condition:function(a){return"ol"===D.name(a)||"ul"===D.name(a)}}]}),nla=gb.removal({tags:[{name:M.exact("script",M.caseInsensitive)},{name:M.exact("link",M.caseInsensitive)},{name:M.exact("style",M.caseInsensitive),condition:function(a){return 0===Ea.get(a).length}}],attributes:[{name:M.starts("on",
M.caseInsensitive)},{name:M.exact('"',M.caseInsensitive)},{name:M.exact("lang",M.caseInsensitive)},{name:M.exact("language",M.caseInsensitive)}],styles:[{name:M.all(),value:M.pattern(/OLE_LINK/i,M.caseInsensitive)}]}),IR=gb.removal({tags:[{name:M.exact("meta",M.caseInsensitive)}]}),ola=gb.removal({tags:[{name:M.exact("style",M.caseInsensitive)}]}),pla=gb.removal({styles:[{name:M.not(M.pattern(/width|height|list-style-type/,M.caseInsensitive)),condition:function(a){return!n.has(a,"ephox-limbo-transform")}},
{name:M.pattern(/width|height/,M.caseInsensitive),condition:function(a){return"img"!==D.name(a)}}]}),qla=gb.removal({classes:[{name:M.not(M.exact("rtf-data-image",M.caseInsensitive))}]}),rla=gb.removal({styles:[{name:M.pattern(fR.validStyles(),M.caseInsensitive)}]}),sla=gb.removal({classes:[{name:M.pattern(/mso/i,M.caseInsensitive)}]}),tla=gb.unwrapper({tags:[{name:M.exact("img",M.caseInsensitive),condition:function(a){a=m.get(a,"src");return/^file:/.test(a)}}]}),ula=gb.unwrapper({tags:[{name:M.exact("a",
M.caseInsensitive),condition:Gx}]}),vla=gb.removal({attributes:[{name:M.exact("style",M.caseInsensitive),value:M.exact("",M.caseInsensitive),debug:!0}]}),wla=gb.removal({attributes:[{name:M.exact("class",M.caseInsensitive),value:M.exact("",M.caseInsensitive),debug:!0}]}),xla=gb.unwrapper({tags:[{name:M.pattern(fR.specialInline(),M.caseInsensitive),condition:zf(function(a){return Gx(a)?ila(a)&&wd.descendant(a,function(a){var b=!Gx(a),d=!U("font em strong samp acronym cite code dfn kbd tt b i u s sub sup ins del var span".split(" "),
D.name(a));return D.isText(a)||b||d}):!0})}]}),yla=gb.unwrapper({tags:[{name:M.exact("p",M.caseInsensitive),condition:function(a){return function(b){return A.parent(b).exists(function(b){return D.name(b)===a&&1===A.children(b).length})}}("li")}]}),zla=gb.transformer({tags:[{name:M.exact("p",M.caseInsensitive),mutate:Bh.addBrTag}]}),Ala=gb.transformer({tags:[{name:M.pattern(/ol|ul/,M.caseInsensitive),mutate:Bh.properlyNest}]}),Bla=gb.transformer({tags:[{name:M.exact("b",M.caseInsensitive),mutate:u(Bh.changeTag,
"strong")},{name:M.exact("i",M.caseInsensitive),mutate:u(Bh.changeTag,"em")},{name:M.exact("u",M.caseInsensitive),mutate:function(a){a=Bh.changeTag("span",a);n.add(a,"ephox-limbo-transform");v.set(a,"text-decoration","underline")}},{name:M.exact("s",M.caseInsensitive),mutate:u(Bh.changeTag,"strike")},{name:M.exact("font",M.caseInsensitive),mutate:Bh.fontToSpan,debug:!0}]}),Cla=gb.removal({classes:[{name:M.exact("ephox-limbo-transform",M.caseInsensitive)}]}),Dla=gb.removal({tags:[{name:M.exact("br",
M.caseInsensitive),condition:yf.hasClass("Apple-interchange-newline")}]}),Ela=gb.removal({styles:[{name:M.pattern(/^-/,M.caseInsensitive)},{name:M.all(),value:M.exact("initial",M.caseInsensitive)},{name:M.exact("background-color",M.caseInsensitive),value:M.exact("transparent",M.caseInsensitive)},{name:M.exact("font-style",M.caseInsensitive),value:M.exact("normal",M.caseInsensitive)},{name:M.pattern(/font-variant.*/,M.caseInsensitive)},{name:M.exact("letter-spacing",M.caseInsensitive)},{name:M.exact("font-weight",
M.caseInsensitive),value:M.pattern(/400|normal/,M.caseInsensitive)},{name:M.exact("orphans",M.caseInsensitive)},{name:M.exact("text-decoration",M.caseInsensitive),value:M.exact("none",M.caseInsensitive)},{name:M.exact("text-size-adjust",M.caseInsensitive)},{name:M.exact("text-indent",M.caseInsensitive),value:M.exact("0px",M.caseInsensitive)},{name:M.exact("text-transform",M.caseInsensitive),value:M.exact("none",M.caseInsensitive)},{name:M.exact("white-space",M.caseInsensitive),value:M.exact("normal",
M.caseInsensitive)},{name:M.exact("widows",M.caseInsensitive)},{name:M.exact("word-spacing",M.caseInsensitive),value:M.exact("0px",M.caseInsensitive)},{name:M.exact("text-align",M.caseInsensitive),value:M.pattern(/start|end/,M.caseInsensitive)},{name:M.exact("font-weight",M.caseInsensitive),value:M.pattern(/700|bold/,M.caseInsensitive),condition:function(a){return/^h\d$/.test(D.name(a))}}]}),Fla=function(){var a=function(a,b){return function(c){return a(c).filter(function(a){return D.isText(c)&&b(Vb.get(a),
" ")}).isSome()}},b=a(A.prevSibling,je),c=a(A.nextSibling,Gb);return gb.transformer({tags:[{name:M.exact("span",M.caseInsensitive),condition:yf.hasClass("Apple-converted-space"),mutate:function(a){"\u00a0"===Vb.get(a)&&(b(a)||c(a)?G.unwrap(a):(y.before(a,r.fromText(" ")),G.remove(a)))}}]})}(),Gla=function(){var a=/^file:\/\/\/[^#]+(#[^#]+)$/;return gb.transformer({tags:[{name:M.exact("a",M.caseInsensitive),condition:function(b){return(b=m.get(b,"href"))?a.test(b):!1},mutate:function(b){var c=m.get(b,
"href");m.set(b,"href",c.replace(a,"$1"))}}]})}(),Hla=gb.removal({attributes:[{name:M.exact("href",M.caseInsensitive),value:M.starts("file:///",M.caseInsensitive),debug:!0}]}),JR=function(){var a=function(a,c,d){return{name:M.exact(a,M.caseInsensitive),condition:function(a){return m.has(a,c)},mutate:function(a){var b=m.get(a,c);m.set(a,d,b);m.remove(a,c)}}};return gb.transformer({tags:[a("a","data-ephox-href","href"),a("img","data-ephox-src","src")]})}(),Ila=function(a){var b="table thead tbody tfoot th tr td ul ol li".split(" "),
c=ed.descendants(a,D.isComment),d=qa(c,function(a){return Bb(Dv.get(a),"StartFragment")}),e=qa(c,function(a){return Bb(Dv.get(a),"EndFragment")});d.each(function(c){e.each(function(d){var e=c,f=[];for(d=id.commonAncestorContainer(c,0,d,0);void 0!==d&&!N.eq(d,a);)U(b,D.name(d))?e=d:f.push(d),d=A.parent(d).getOr(void 0);z(f,G.unwrap);z(A.prevSiblings(e),G.remove)});G.remove(c)});e.each(G.remove)},nq=t,oq=function(a){return a.browser.isIE()&&11<=a.browser.version.major},Jla=function(a,b,c){var d=r.fromDom(a.getNode());
return b(d).fold(function(){return[a]},function(b){var d=a.type()===Ab.END_ELEMENT_TYPE,e=[Ab.token(b.dom(),d)];!d&&c&&e.push(Ab.token(b.dom(),!0));return e})},Kla=function(a,b){return WA(function(c,d){d=Jla(d,a,b);z(d,c.emit)},t,"image filters")},Lla={derive:function(a,b,c){var d=c.browser.isFirefox()||c.browser.isEdge();var e=d?Bka:Cka;var f=!d;e=oq(c)?nq:gb.pipeline([Kla(e,f)]);e=[a?e:nq];d=[d?nq:tla];f=oq(c)||!a?[]:[hla];var g=[Bla];if(a){var k=[jla];var m=oq(c)?[]:lla;k=k.concat(m).concat([mla])}else k=
[nq];m=[kla];var n=[Ala],p=[nla],r=[IR];var t=[rla,sla];var u=[pla,qla];t=b?t:u;u=[Gla,Hla,ula,JR];var v=[vla],x=[wla],y=[xla],z=[Dla];b=!a&&b?[Ela]:[];var A=[Fla],B=[zla];a=oq(c)&&a?[yla]:[];return Qb([d,f,e,g,k,m,n,p,r,t,u,v,x,y,z,b,A,B,a,[Cla],[ola]])}},Mla=In.link().source,Nla=function(a){var b=O("word","pattern"),c=Cb.unsafetoken(Mla);b=b("__INTERNAL__",c);return Kp.run(a,[b])},Ola=function(a){return!Db.closest(a,"a")},Pla=function(a){return g.from(a[0]).filter(Ola).map(function(b){var c=r.fromTag("a");
y.before(b,c);P.append(c,a);m.set(c,"href",Vb.get(c));return c})},Qla=function(a){a=Nla(a);z(a,function(a){var b=a.exact(),d;(d=0>b.indexOf("@"))||(b=b.indexOf("://"),d=3<=b&&9>=b);d&&Pla(a.elements())})},Rla=function(a){z(a,function(a){D.isElement(a)&&v.getRaw(a,"position").isSome()&&v.remove(a,"position")})},Sla=function(a){var b=ka(a,function(a){return"li"===D.name(a)});if(0<b.length){var c=A.prevSiblings(b[0]),d=r.fromTag("ul");y.before(a[0],d);0<c.length&&(a=r.fromTag("li"),y.append(d,a),P.append(a,
c));P.append(d,b)}},KR=function(a){var b=A.children(a);z([Qla,Rla,Sla],function(a){a(b)})},pq={go:function(a,b,c,d,e){KR(c);c=Ea.get(c);b=Lla.derive(e,d,b);return gb.go(a,c,b)},preprocess:KR,internal:function(a,b){b=Ea.get(b);return gb.go(a,b,[IR,JR])},clean:function(a,b){b=Ea.get(b);return gb.go(a,b,[Ila])}},Jl=Ha("simple-adt"),LR={generate:function(a){var b=function(a){return 0===a.indexOf(Jl)?a.substring(Jl.length+1):a},c=cb(a),d={};z(c,function(a){d["as"+ns(a)]=function(b){return b._simpleAdt===
Jl+"_"+a?g.some(b.data):g.none()}});var e={};Ma(a,function(a,b){e[b]=function(c){var d=Jl+"_"+b;var e=0===a.length?{}:Aa(a,[])(c);return{_simpleAdt:d,data:e,_simpleAdt_data:c}}});return oa(d,{constructors:e,match:function(a,d){var e=cb(d);if(e.length!==c.length)throw Error("Partial match");return yc(e,function(b){return a._simpleAdt===Jl+"_"+b?g.some(d[b]):g.none()}).getOrDie("Must find branch for constructor: "+b(a._simpleAdt))(a.data)}})}},qq=LR.generate({getFromFlash:[],disabled:[],fromClipboard:["rtf"]}),
Rm={getFromFlash:qq.constructors.getFromFlash,disabled:qq.constructors.disabled,fromClipboard:qq.constructors.fromClipboard,match:qq.match},MR=function(a,b){var c=new RegExp(b,"i");return yc(a,function(a){return null!==a.match(c)?g.some({type:a,flavor:b}):g.none()})},Hx={isValidData:function(a){return void 0!==a&&void 0!==a.types&&null!==a.types},getPreferredFlavor:function(a,b){return yc(a,function(a){return MR(b,a)})},getFlavor:MR},Xc=LR.generate({event:["nativeEvent"],html:["container"],word:["html",
"rtf"],text:["text"],images:["images"]}),Ix=aa.detect().browser,Tla=!(Ix.isIE()||Ix.isEdge()&&16>Ix.version.major),Ula=["^image/","file"],Vla=function(a){return Bb(a,"<html")&&(Bb(a,'xmlns:o="urn:schemas-microsoft-com:office:office"')||Bb(a,'xmlns:x="urn:schemas-microsoft-com:office:excel"'))},Wla=function(a){return Bb(a,"<meta")&&Bb(a,'id="docs-internal-guid')},Xla=function(a){return 0<a.length},NR=function(a,b){return Hx.getFlavor(a.types,b).map(function(b){return a.getData(b.type)}).filter(Xla)},
Jx=function(a){return NR(a,"html")},Yla=function(a){return Jx(a).filter(Wla)},cj=function(a){return Tla?g.some(a.clipboardData).filter(Hx.isValidData):g.none()},OR=function(a){var b=r.fromTag("div");Ea.set(b,a);a=pq.clean(A.owner(b),b);b=r.fromTag("div");Ea.set(b,a);return Xc.constructors.html({container:b})},SZ={fromEvent:function(a){var b=function(a){return void 0===a.items?g.none():Hx.getPreferredFlavor(Ula,a.types).map(function(b){return Xc.constructors.images({images:a.items})})},c=function(a){return yc(a.types,
function(b){return"text/plain"===b?g.some(a.getData(b)).map(function(a){return Xc.constructors.text({text:a})}):g.none()})};return{getWordData:function(){return cj(a).bind(function(a){return Jx(a).filter(Vla).map(function(b){var c=NR(a,"rtf");return Xc.constructors.word({html:b,rtf:c.fold(Rm.getFromFlash,function(a){return Rm.fromClipboard({rtf:a})})})})})},getGoogleDocsData:function(){return cj(a).bind(Yla).map(OR)},getImage:function(){return cj(a).bind(b)},getText:function(){return cj(a).fold(function(){var a=
Zg.clipboardData;return void 0!==a?g.some(Xc.constructors.text({text:a.getData("text")})):g.none()},c)},getHtml:function(){return cj(a).bind(Jx).map(OR)},getOnlyText:function(){return cj(a).bind(function(a){var b=a.types;return 1===b.length&&"text/plain"===b[0]?c(a):g.none()})},getNative:function(){return Xc.constructors.event({nativeEvent:a})}}},fromHtml:function(a){return{getWordData:function(){return g.some(Xc.constructors.word({html:a,rtf:Rm.disabled()}))},getGoogleDocsData:g.none,getImage:g.none,
getHtml:g.none,getText:g.none,getNative:yb("There is no native event"),getOnlyText:g.none}},fromText:function(a){return{getWordData:g.none,getGoogleDocsData:g.none,getImage:g.none,getHtml:g.none,getText:function(){return g.some(Xc.constructors.text({text:a}))},getNative:yb("There is no native event"),getOnlyText:g.none}}},Zla={resolve:Lb.create("ephox-sloth").resolve}.resolve("bin"),cB={bin:k(Zla)},PR=aa.detect(),$la=function(a,b,c){b.control.block();a.dom().execCommand("paste");c();b.control.unblock()},
ama=function(a,b,c){setTimeout(c,1)},QR=PR.browser.isIE()&&10>=PR.browser.version.major,bma=QR?$la:ama,dB={willBlock:k(QR),run:function(a,b,c){return bma(a,b,c)}},bB=function(a){return E(a,function(a){return a.asset()})},Kl=O("asset","image"),RR=function(a,b){return Qc.cata(a,function(a,d,e,f){m.set(b,"src",e);return!0},fd)},tf={assetImage:Kl,createImages:function(a){var b=[],c=[];z(a,function(a){return Qc.cata(a,function(d,f,g,k){d=r.fromTag("img");m.set(d,"src",g);b.push(d);c.push(Kl(a,d))},function(a,
b,c){ld.error("Internal error: Paste operation produced an image URL instead of a Data URI: ",b)})});return db.paste(b,c)},findImages:function(a,b){var c=[],d=ia(a,function(a){return"img"===D.name(a)?[a]:Y.descendants(a,"img")});z(b,function(a){Qc.cata(a,function(b,e,g,k){z(d,function(b){m.get(b,"src")===g&&c.push(Kl(a,b))})},t)});return c},updateSource:RR,updateSources:function(a,b){var c=[];z(a,function(a,e){e=b[e];RR(a,e)&&c.push(Kl(a,e))});return c},browserBlobs:function(a){return Ce(a,function(a){return Ga.nu(function(b){var c=
a.dom();Yc.imageToImageResult(c).then(function(d){d.toBlob().then(function(e){e=Gb(c.src,"blob:")?c.src:D1.createObjectURL(e);var f=Ha("image");e=Qc.blob(f,d,e);b(Kl(e,a))})})})})}},cma=function(a){return Ga.nu(function(b){var c=Yc.imageResultToBlob(a,"image/png").then(function(a){Re.single(a).map(g.some).get(b)});return c["catch"].call(c,function(a){ld.warn(a);b(g.none())})})},TZ=function(a){var b=function(){return Ga.pure(a)};return Qc.cata(a.asset(),function(c,d,e){return/tiff$/.test(d.getType())?
cma(d).map(function(b){return b.map(function(b){var c=a.image();dg.revokeObjectURL(e);tf.updateSource(b,c);return tf.assetImage(b,c)}).getOr(a)}):b()},b)},ub={blocking:function(a){return function(b){return function(c,d){b.block();return a(c,d).map(function(a){b.unblock();return a})}}},normal:function(a){return k(a)}},dma={convert:function(a){var b=bh("window.clipboardData.files"),c=void 0!==a.convertURL?a.convertURL:void 0!==a.msConvertURL?a.msConvertURL:void 0;return void 0!==b&&void 0!==c&&0<b.length?
(b=Ce(b,function(b){var d=dg.createObjectURL(b);c.apply(a,[b,"specified",d]);return Re.singleWithUrl(b,d)}),g.some(b)):g.none()}},ema=function(){var a=g.none();return{convert:function(b){a=dma.convert(b)},listen:function(b){return a.fold(function(){return Ga.nu(function(a){a([])})},function(a){return a}).get(b)},clear:function(){a=g.none()}}},fma=function(a,b){return Nj.dataUriToBlobSync(b).map(function(b){return tf.assetImage(Re.single(b),a)})},gma=function(a,b){return Nj.uriToBlob(b).map(function(b){var c=
Ga.nu(function(a){b.then(function(b){Re.single(b).get(a)})});return tf.assetImage(c,a)})},eB=function(a){var b=r.fromTag("div");P.append(b,a);return Y.descendants(b,"img[src]")},SR=function(a){return 0===a.indexOf("data:")&&-1<a.indexOf("base64")},fB=function(a){a=m.get(a,"src");return SR(a)||0===a.indexOf("blob:")},UZ=function(a){return ia(eB(a),function(a){var b=m.get(a,"src");return SR(b)?fma(a,b).toArray():0===b.indexOf("blob:")?gma(a,b).toArray():[]})},VZ=function(a){a=ka(a,function(a){return"img"!==
D.name(a)||!fB(a)});return db.incomplete(a,[],"errors.local.images.disallowed")},hma={convert:function(a,b){if(0===a.length)throw"Zero length content passed to Hex conversion";for(var c=Array(a.length/2),d=0;d<a.length;d+=2){var e=a.substr(d,2);c[Math.floor(d/2)]=parseInt(e,16)}a=fz(c);return ez([a],{type:b})}},TR=ta.generate([{unsupported:["id","message","isEquation"]},{supported:["id","contentType","blob","isEquation"]}]),dj={unsupported:TR.unsupported,supported:TR.supported,cata:function(a,b,c){return a.fold(b,
c)}},UR=function(a,b,c,d,e,f){return-1===a||-1===b?g.none():g.some({start:a,end:b,bower:c,regex:d,idRef:e,isEquation:f})},rq=function(a,b){if(-1===b)return b;var c=0,d=a.length;do{var e=a.indexOf("{",b);var f=a.indexOf("}",b);f>e&&-1!==e?(b=e+1,++c):(e>f||0>e)&&-1!==f&&(b=f+1,--c);if(b>d||-1===f)return-1}while(0<c);return b},ima=function(a,b,c,d,e){a=a.substring(c,d);return UR(c,d,a,/[^a-fA-F0-9]([a-fA-F0-9]+)\}$/,"i",e)},jma=function(a,b,c,d,e){a=a.substring(c,d);return UR(c,d,a,/([a-fA-F0-9]{64,})(?:\}.*)/,
"s",e)},kma={identify:function(a,b){var c=a.indexOf("{\\pict{",b),d=rq(a,c),e=a.indexOf("{\\shp{",b),f=rq(a,e),h=a.indexOf("{\\mmathPict{",b),k=rq(a,h);k=-1!==h&&(h<c&&k>d||h<e&&k>f);h=u(jma,a,b,e,f,k);a=u(ima,a,b,c,d,k);return-1===c&&-1===e?g.none():-1===c?h():-1===e?a():e<c&&f>d?a():c<e&&d>f?h():c<e?a():e<c?h():g.none()},endBracket:rq},VR=function(a,b){return kma.identify(a,b)},WR=function(a){return 0<=a.indexOf("\\pngblip")?J.value("image/png"):0<=a.indexOf("\\jpegblip")?J.value("image/jpeg"):
J.error("errors.imageimport.unsupported")},XR=function(a,b){return(a=a.match(b))&&a[1]&&0===a[1].length%2?J.value(a[1]):J.error("errors.imageimport.invalid")},YR=function(a){a=a.match(/\\shplid(\d+)/);return null!==a?g.some(a[1]):g.none()},lma=function(a){var b=a.bower,c=a.regex,d=a.isEquation;return YR(b).map(function(e){var f=a.idRef+e;return WR(b).fold(function(a){return dj.unsupported(f,a,d)},function(a){return XR(b,c).fold(function(a){return dj.unsupported(f,a,d)},function(b){return dj.supported(f,
a,hma.convert(b,a),d)})})})},mma=function(a){for(var b=[],c=function(){return a.length},d=function(a){var c=lma(a);b=b.concat(c.toArray());return a.end},e=0;e<a.length;)e=VR(a,e).fold(c,d);return b},nma={nextBower:VR,extractId:YR,extractContentType:WR,extractHex:XR,images:function(a){a=a.replace(/\r/g,"").replace(/\n/g,"");return mma(a)}},uf={images:function(a){return nma.images(a)},toId:function(a){return dj.cata(a,function(a,c,d){return a},function(a,c,d,e){return a})},isEquation:function(a){return dj.cata(a,
function(a,c,d){return d},function(a,c,d,e){return e})},toBlob:function(a){return dj.cata(a,function(a,c,d){return J.error(c)},function(a,c,d,e){return J.value(d)})}},oma=function(a){return hb(a,function(a,c){var b=uf.toId(c),e=uf.isEquation(c);return Va(a,function(a){return uf.toId(a)===b&&uf.isEquation(a)===e}).fold(function(){return a.concat([c])},function(b){return uf.toBlob(a[b]).isValue()?a:a.slice(0,b).concat(a.slice(b+1)).concat([c])})},[])},WZ={convert:function(a,b,c,d){var e=oma(b),f=[],
g=!1;a=ia(a,function(a,b){var c=m.get(a,"data-image-id"),h="true"===m.get(a,"data-ms-equation");m.remove(a,"rtf-data-image");m.remove(a,"data-image-id");m.remove(a,"data-ms-equation");return"unsupported"===c?(g=!0,m.set(a,"alt",d("errors.imageimport.unsupported")),[]):qa(e,function(a){return uf.toId(a)===c&&uf.isEquation(a)===h}).fold(function(){ld.log("WARNING: unable to find data for image ",a.dom());return[]},function(b){return uf.toBlob(b).fold(function(b){g=!0;m.set(a,"alt",d(b));return[]},function(b){f.push(a);
return[b]})})});Re.multiple(a).get(function(a){a=tf.updateSources(a,f);c(a,g)})}},ZR=function(a){return Y.descendants(a,"[rtf-data-image]")},Tj={exists:function(a){return 0<ZR(a).length},find:ZR},$R=function(a){return a.officeStyles().getOr(!0)},aS=function(a){return a.htmlStyles().getOr(!1)},bS=function(a){return a.isWord().getOr(!1)},pe={proxyBin:function(a){return{handle:function(b,c){return a.proxyBin().fold(function(){ld.error(b);return La.pure({response:db.cancel(),bundle:Xb.nu({})})},c)}}},
backgroundAssets:function(a){return Ga.nu(function(b){a.backgroundAssets().fold(function(){b([])},function(a){a.listen(b)})})},merging:function(a){var b=bS(a);return b&&$R(a)||!b&&aS(a)},mergeOffice:$R,mergeNormal:aS,isWord:bS,isGoogleDocs:function(a){return a.isGoogleDocs().getOr(!1)},isInternal:function(a){return a.isInternal().getOr(!1)}},cS=function(a,b){var c=YZ(a,b);return function(a,b){var d=b.bundle(),e=b.response();return La.sync(function(a){c.get(pe.isWord(d),function(c){c=c.fold(function(){return{response:db.cancel(),
bundle:b.bundle()}},function(a){return{response:e,bundle:Xb.nu({officeStyles:a.officeStyles,htmlStyles:a.htmlStyles})}});La.call(a,c)})})}},Kx={fixed:function(a,b){return function(c,d){return La.pure({response:d.response(),bundle:Xb.nu({officeStyles:a,htmlStyles:b})})}},fromConfig:cS,fromConfigIfNotForced:function(a,b){return function(c,d){var e=function(a){return La.pure({response:d.response(),bundle:Xb.nu({officeStyles:a,htmlStyles:a})})};return pe.isInternal(d.bundle())?e(!0):pe.isGoogleDocs(d.bundle())?
e(!1):cS(a,b)(c,d)}}},pma={p:"p, li[data-converted-paragraph]"},qma=function(a){var b=function(){var b=r.fromTag("span");y.prepend(a,b);return b}();return{convertToPx:function(a){v.set(b,"margin-left",a);return parseFloat(v.get(b,"margin-left").match(/-?\d+\.?\d*/)[0])},destroy:function(){return G.remove(b)}}},rma=t,tma=function(a,b){var c=function(a){m.remove(a,"data-list-level");m.remove(a,"data-text-indent-alt");m.remove(a,"data-border-margin");v.remove(a,"margin-left");v.remove(a,"text-indent");
Ma(v.getAllRaw(a),function(b,c){!c.startsWith("border")||"border-image"!==c&&"none"!==b.trim()&&"initial"!==b.trim()||v.remove(a,c)})},d=Y.descendants(a,"li[data-converted-paragraph]");z(d,function(a){m.remove(a,"data-converted-paragraph")});b&&(b=Y.descendants(a,"li"),z(b,function(b){var d=qma(a);var e=m.has(a,"data-tab-interval")?m.get(a,"data-tab-interval"):"36pt";e=d.convertToPx(e);e=sma(b,e,d).getOr({});c(b);d.destroy();v.setAll(b,e)}),b=Y.descendants(a,"ol,ul"),z(b,function(a){var b=Y.descendants(a,
"li");v.getRaw(a,"margin-top").isNone()&&g.from(b[0]).each(function(b){v.set(a,"margin-top",v.get(b,"margin-top"))});v.getRaw(a,"margin-bottom").isNone()&&g.from(b[b.length-1]).each(function(b){v.set(a,"margin-bottom",v.get(b,"margin-bottom"))})}));m.remove(a,"data-tab-interval")},sma=function(a,b,c){var d=function(a){return m.has(a,"data-list-level")?parseInt(m.get(a,"data-list-level"),10):1};return v.getRaw(a,"text-indent").bind(function(e){return v.getRaw(a,"margin-left").map(function(f){var g=
v.getRaw(a,"list-style").exists(function(a){return Bb(a,"none")}),k=m.has(a,"data-border-margin")?m.get(a,"data-border-margin"):"0px";g=g?d(a)+1:d(a);f=c.convertToPx(f)+c.convertToPx(k);g*=b;var q=m.has(a,"data-text-indent-alt")?c.convertToPx(m.get(a,"data-text-indent-alt")):c.convertToPx(e);k={};q=b/2*-1-q;0<q&&(k["text-indent"]=q+"px");f=f-g-q;k["margin-left"]=0<f?f+"px":"0px";return k})})},uma={process:function(a,b,c){c=c.mergeInline();(c?nz.inlineStyles:rma)(a,b,pma);tma(b,c)}},vma=function(a){var b=
ZZ(r.fromDom(Hb.body));return function(c,d){b.play(c,function(b,c){uma.process(b,c,{mergeInline:k(a)});return Ea.get(c)},d)}},wma=function(a,b,c,d){var e=function(b){La.call(a,{response:b,bundle:Xb.nu({})})};vma(b)(c,function(a){var b=qe.fromHtml(a);a=function(a){e(db.paste(b,a))};var c=r.fromTag("div");P.append(c,b);var f=Fa.all("img[src]",c);0===f.length?a([]):d?tf.browserBlobs(f).get(a):(z(f,G.remove),a=A.children(c),e(db.incomplete(a,[],"errors.local.images.disallowed")))})},xma={handle:function(a,
b,c,d){var e=a.html();return La.sync(function(a){c.cleanDocument(e,b).get(function(c){c.fold(function(b){La.call(a,{response:db.error("errors.paste.process.failure"),bundle:Xb.nu({})})},function(c){void 0===c||null===c||0===c.length?La.call(a,{response:db.paste([],[]),bundle:Xb.nu({})}):wma(a,b,c,d)})})})}},yma={handle:function(a){a=ka(a,function(a){return"file"===a.kind&&/image/.test(a.type)});var b=E(a,function(a){return a.getAsFile()});return La.sync(function(a){Re.multiple(b).get(function(b){b=
tf.createImages(b);La.call(a,{response:b,bundle:Xb.nu({})})})})}},zma=aa.detect(),dS=function(a){try{var b=a(),c=void 0!==b&&null!==b&&0<b.length?qe.fromHtml(b):[];return J.value(c)}catch(d){return ld.error(d),J.error("errors.paste.process.failure")}},eS=function(a){return a.fold(function(a){return La.error(a)},function(a){return La.pure({response:db.paste(a,[]),bundle:Xb.nu({})})})},fS=function(a,b,c,d){return dS(function(){return pq.go(a,zma,b,c,d)})},sq={direct:function(a,b,c){a=fS(a,b,c,!1);return eS(a)},
internal:function(a,b){var c=dS(function(){return pq.internal(a,b)});return eS(c)},transfer:function(a,b,c,d,e){return fS(a,b,d,c).fold(function(a){return La.error(a)},function(a){return La.sync(function(b){e.get(function(c){c=tf.findImages(a,c);La.call(b,{response:db.paste(a,c),bundle:Xb.nu({})})})})})}},gS={internal:function(a,b,c){b=b.findClipboardTags(A.children(c)).getOr([]);z(b,G.remove);b=Ga.nu(function(a){a([])});return sq.transfer(a,c,!1,!0,b)},external:function(a,b,c,d,e){return sq.transfer(a,
b,d,c,e)}},hS={encode:function(a){var b=r.fromTag("div");Vb.set(b,a);return Ea.get(b)},convert:function(a){a=a.trim().split(/\n{2,}|(?:\r\n){2,}/);a=E(a,function(a){return a.split(/\n|\r\n/).join("<br />")});return 1===a.length?a[0]:E(a,function(a){return"<p>"+a+"</p>"}).join("")}},Ama={handle:function(a){var b=Xc.asText(a).getOrDie("Required text input for Text Handler");return La.sync(function(a){if(0<b.text().length){var c=b.text();c=hS.encode(c);c=hS.convert(c);c=qe.fromHtml(c);c=db.paste(c,[])}else c=
db.cancel();La.call(a,{response:c,bundle:Xb.nu({})})})}},dd={plain:function(a,b,c){return Ama.handle(a)},autolink:function(a,b){a=function(a,c){var d=r.fromTag("div");P.append(d,a);pq.preprocess(d);a=A.children(d);return La.pure({response:db.paste(a,c),bundle:b.bundle()})};var c=u(La.pass,b);return db.cata(b.response(),c,a,c,a)},noImages:function(){return function(a,b){return La.error("errors.local.images.disallowed")}},images:function(){return function(a,b){a=Xc.asImages(a).getOrDie("Must have image data for images handler");
return yma.handle(a.images())}},handleInternal:function(a){return function(b,c){b=Xc.asHtml(b).getOrDie("Wrong input type for HTML handler");b=a.findClipboardTags(A.children(b.container()));b.each(function(a){z(a,G.remove)});b=b.isSome();return La.pure({response:c.response(),bundle:Xb.nu({isInternal:b})})}},nativeHtml:function(a,b){return function(c,d){c=Xc.asHtml(c).getOrDie("Wrong input type for HTML handler").container();var e=A.owner(b);d=d.bundle();if(pe.isInternal(d))return sq.internal(e,c);
a(c);d=pe.merging(d);return sq.direct(e,c,d)}},external:function(a,b){return function(c,d){var e=d.bundle();return pe.proxyBin(e).handle("There was no proxy bin setup. Ensure you have run proxyStep first.",function(c){var d=pe.merging(e),f=pe.isWord(e),g=pe.isInternal(e),k=pe.backgroundAssets(e),m=A.owner(a);return g?gS.internal(m,b,c):gS.external(m,c,d,f,k)})}},wordimport:function(a,b){return function(c,d){c=Xc.asWord(c).getOrDie("Wrong input type for Word Import handler");d=pe.mergeOffice(d.bundle());
return xma.handle(c,d,a,b)}},setBundle:function(a){return function(b,c){b=Xb.merge(c.bundle(),Xb.nu(a));return La.pure({response:c.response(),bundle:b})}},none:function(a,b){return La.cancel()}},Bma=function(a,b){return wd.descendant(a,function(a){return m.has(a,"style")?-1<m.get(a,"style").indexOf("mso-"):!1})},Cma=function(a,b){a=Ea.get(a);return gb.isWordContent(a,b)},a_={isWord:function(a,b){var c=a.browser;return(c.isIE()&&11<=c.version.major?Bma:Cma)(b,a)}},Nr=aa.detect(),b_=function(a){return Xa(a,
function(a){return m.has(a,"id")&&Gb(m.get(a,"id"),"docs-internal-guid")})},Dma=function(a,b){return a.isSupported()?b.getWordData():g.none()},Ema=function(a){return a.getNative()},Fma=function(a){return a.getImage()},Gma=function(a){return a.getHtml()},Hma=function(a){return a.getText()},Ima=function(a){return a.getOnlyText()},Jma=function(a){return a.getGoogleDocsData()},Jf=function(a,b,c,d){return{_label:a,label:k(a),getAvailable:b,steps:k(c),capture:k(d)}},ag={wordimport:function(a,b,c,d){return Jf("Word Import pasting",
u(Dma,a),[ub.normal(dd.setBundle({isWord:!0})),ub.normal(Kx.fromConfig(b,c)),ub.normal(dd.wordimport(a,c.allowLocalImages)),ub.blocking(c_(c,hB(d,c))),ub.normal(Sj())],!0)},googledocs:function(a,b,c){return Jf(" pasting",Jma,[ub.normal(dd.setBundle({officeStyles:!1,htmlStyles:!1})),ub.normal(dd.nativeHtml(b,c)),ub.normal(Mr(a)),ub.normal(Sj())],!0)},image:function(a){return Jf("Image pasting",Fma,[ub.normal(!1===a.allowLocalImages?dd.noImages():dd.images()),ub.normal(Sj())],!0)},nativeHtml:function(a,
b,c,d){return Jf("Outside of Textbox.io pasting HTML5 API (could be internal)",Gma,[ub.normal(dd.handleInternal(b.intraFlag)),ub.normal(Kx.fromConfigIfNotForced(a,b)),ub.normal(dd.nativeHtml(c,d)),ub.normal(Mr(b)),ub.normal(Sj())],!0)},text:function(){return Jf("Plain text pasting",Hma,[ub.normal(dd.plain),ub.normal(dd.autolink)],!0)},onlyText:function(){return Jf("Only plain text is available to paste",Ima,[ub.normal(dd.plain),ub.normal(dd.autolink)],!0)},none:function(){return Jf("There is no valid way to paste",
g.some,[ub.normal(dd.none)],!1)},discard:function(){return Jf("There is no valid way to paste, discarding content",g.some,[ub.normal(dd.none)],!0)},fallback:function(a,b,c,d,e,f){return Jf("Outside of Textbox.io pasting offscreen (could be internal)",Ema,[ub.normal($Z(d,c,e,b.intraFlag,ema)),ub.normal(Kx.fromConfigIfNotForced(a,b)),ub.normal(dd.external(e,b.intraFlag)),ub.blocking(hB(f,b)),ub.normal(Mr(b)),ub.normal(Sj())],!1)}},f_={responsive:function(){var a=na(g.none()),b=H.create({crashed:p([]),
timeout:p([])});return{start:function(c,d,e,f){var h=d,k=Or(function(){e()?Vh(k):0>=h?(b.trigger.timeout(),Vh(k)):f()&&(Vh(k),b.trigger.crashed());h--},c);a.set(g.some(k))},stop:function(){a.get().each(function(a){Vh(a)})},events:b.registry}}},$f=lC.install("ephox.flash"),Pr=aa.detect(),g_=g.none(),iS=function(a){return r.fromHtml("<p>"+a("cement.dialog.flash.press-escape")+"</p>")},Lx={paste:function(a){var b=r.fromTag("div");n.add(b,ud.resolve("flashbin-helpcopy"));var c=aa.detect().os.isOSX()?
["\u2318"]:["Ctrl"];var d=r.fromHtml("<p>"+a("cement.dialog.flash.trigger-paste")+"</p>");c=r.fromHtml('<div><span class="ephox-polish-help-kbd">'+c+'</span> + <span class="ephox-polish-help-kbd">V</span></div>');n.add(c,ud.resolve("flashbin-helpcopy-kbd"));P.append(b,[d,c,iS(a)]);return b},noflash:function(a){var b=r.fromTag("div");n.add(b,ud.resolve("flashbin-helpcopy"));var c=r.fromHtml("<p>"+a("cement.dialog.flash.missing")+"</p>");P.append(b,[c,iS(a)]);return b},indicator:function(a){var b=r.fromTag("div");
n.add(b,ud.resolve("flashbin-loading"));var c=r.fromTag("div");n.add(c,ud.resolve("flashbin-loading-spinner"));var d=r.fromTag("p");a=a("loading.wait");Ea.set(d,a);m.set(d,"aria-label",a);P.append(b,[c,d]);return b}},i_=aa.detect(),l_=function(a,b,c,d){b=Lx.noflash(d);y.append(a,b);return{reset:t}},k_=function(a,b,c,d){var e=Lx.paste(d),f=Lx.indicator(d);P.append(a,[f,e,b.element()]);a=function(){v.set(e,"display","block");v.set(f,"display","none");c()};b.events.spin.bind(function(){v.set(e,"display",
"none");v.set(f,"display","block");v.remove(f,"height");v.remove(f,"padding");c()});b.events.reset.bind(a);b.events.hide.bind(function(){v.setAll(f,{height:"0",padding:"0"})});return{reset:a}},jS=aa.detect(),Kma=jS.deviceType.isiOS()||jS.deviceType.isAndroid(),Lma=function(a){var b=gn.addScript(a+"/wordimport.js",ca);b.get(function(a){a.fold(function(a){ld.error("Unable to load word import: ",a)},t)});return{isSupported:k(!0),cleanDocument:function(a,d){return b.map(function(b){return b.map(function(b){return b.cleanDocument(a,
d)})})}}},Mma=k({isSupported:k(!1),cleanDocument:k(bl.error("not supported"))}),Nma=Kma?Mma:Lma,Oma="b i u sub sup strike".split(" "),Pma=function(a){z(A.children(a),function(a){D.isElement(a)&&!A.hasChildNodes(a)&&U(Oma,D.name(a))&&G.remove(a)})},Qma=function(a,b){a=A.children(a);z(a,function(a){if(b(a)){var c=A.children(a),e=r.fromTag("div",A.owner(a).dom());P.append(e,c);y.before(a,e);G.remove(a)}})},q_={consolidate:function(a,b){A.nextSibling(a).filter(b).each(function(b){var c=A.children(b);
P.append(a,c);G.remove(b)});Qma(a,b);Pma(a)}},jB=cB.bin(),kB=jB+Ha(""),p_=ae.onDirection("-100000px","100000px"),Rma=function(a){return{startContainer:a.start,startOffset:a.soffset,endContainer:a.finish,endOffset:a.foffset}},t_={set:function(a,b){Wa.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())},get:function(a,b){return Wa.getExact(a).map(Rma)}},y_=function(a,b,c,d){var e=v_(a.uiContainer(),d),f=function(a){b.filterDom(b.paste(),a)},g=w_(x,Uj.intraFlag(),c);return function(a){var b=
Nma(g.baseUrl),c=u(m_,e),d=s_(void 0!==g.pasteBinAttrs?g.pasteBinAttrs:{});b=[ag.onlyText(),ag.wordimport(b,e,g,c),ag.googledocs(g,f,a),ag.nativeHtml(e,g,f,a),ag.image(g)];a=ag.fallback(e,g,f,d,a,c);return $A(b,a)}},C_=function(a){for(var b=[],c=a.start.charCodeAt(0);c<=a.finish.charCodeAt(0);c++)b.push(String.fromCharCode(c));return b},bg=function(a){return{start:a,finish:a}},F_={controls:function(a){var b=a+"-";a=T.div();n.add(a,B.resolve(b+"dialog-controls"));var c=td.button(b,"cancel","button.cancel"),
d=td.button(b,"insert","specialchar.insert");td.makeNormal(c.element());td.makeDefault(d.element());P.append(a,[c.element(),d.element()]);b=H.create({insert:Q([],d.events.click),cancel:Q([],c.events.click)});return{element:k(a),ok:k(d),cancel:k(c),destroy:function(){d.destroy();c.destroy()},events:b.registry}}},Sma=function(a){var b=r.fromTag("span");n.add(b,B.resolve("special-char"));var c=r.fromHtml(a);m.setAll(b,{"data-ephox-polish-special-char":a,"data-ephox-polish-char-code":a.charCodeAt(0).toString(16),
tabindex:"-1"});Vg.gridcell(b);y.append(b,c);return b},Tma=function(a,b){var c=r.fromTag("div");ma.add(c,[B.resolve("special-char-row"),B.resolve("special-char-row-"+b)]);Vg.row(c);z(a,function(a){y.append(c,Sma(a))});return c},Uma=function(a,b,c){var d=r.fromTag("div");n.add(d,B.resolve(b));Vg.base(d,x.translate("specialchar.grid"));a=n1(a,c);a=E(a,function(a){return Tma(a,b)});P.append(d,a);return d},E_={generateItems:function(a){var b=600>=Math.min(window.innerWidth,window.innerHeight)?12:16;return Nf(a,
function(a,d){a=Uma(a,d,b);return Sg(x.translate("specialchar."+d),iA(a))})}},G_=function(a){var b={item:k(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=Ba.flow({trigger:Kb.button,executeOnArrow:!0});return ha.flow(a.menu(),b,c)},Vma=function(a){return Db.closest(a,".ephox-pastry-tablayout-active")},H_=function(a){var b={row:k(".ephox-pastry-tablayout-active ."+B.resolve("special-char-row")),cell:k(".ephox-pastry-tablayout-active ."+B.resolve("special-char"))},c=Ba.tabular({trigger:Kb.click,
isValid:Vma});return ha.tabular(a.body(),b,c)},kS=ta.generate([{single:["element"]},{range:["start","soffset","finish","foffset"]}]),Sm={cata:function(a,b,c){return a.fold(b,c)},single:kS.single,range:function(a,b,c,d){var e=id.after(c,d,a,b),f=e?W.point(a,b):W.point(c,d);a=e?W.point(c,d):W.point(a,b);return kS.range(f.element(),f.offset(),a.element(),a.offset())}},lS=O("suggestions","ignore"),ej=function(a){var b=new RegExp(mb(),"g");return a.replace(b,"").replace(/[\u2018\u2019]/g,"'")},f0=function(a){var b=
{},c=function(a){return b.hasOwnProperty(a)&&void 0!==b[a]?b[a]:{}},d=function(a,d){var e=c(a);d(e);b[a]=e},e=function(a,b){a=c(a);return b(a)},f=function(a,b,c){d(a,function(a){var d=ej(b);a.hasOwnProperty(d)&&void 0!==a[d]||(a[d]=lS(g.some(c),!1))})},h=function(a,b){d(a,function(a){var c=ej(b),d=a.hasOwnProperty(c)?a[c]:void 0;d=void 0!==d?d.suggestions():g.none();d=lS(d,!0);a[c]=d})};Ma(void 0!==a?a:{},function(a,b){Ma(a,function(a,c){!0===a.ignore&&h(b,c);void 0!==a.suggestions&&f(b,c,a.suggestions)})});
return{add:f,get:function(a,b){return e(a,function(a){var c=ej(b);return a.hasOwnProperty(c)?g.from(a[c]):g.none()})},ignore:h,suggestions:function(a,b){return e(a,function(a){var c=ej(b);return(a.hasOwnProperty(c)?g.from(a[c]):g.none()).bind(function(a){return a.suggestions()})})},state:function(){return eb(b,function(a,b){return eb(a,function(a,b){return{ignore:a.ignore(),suggestions:a.suggestions().getOr([])}})})},destroy:function(){b={}}}},Tr={configure:function(a){a.add(a.internal(),"ephox-cram-annotation-wrap",
Na.unwrap);a.add(a.output(),"ephox-cram-annotation-wrap",Na.unwrap);a.add(a.paste(),"ephox-cram-annotation-wrap",Na.unwrap);a.addExcludedContext([".ephox-cram-annotation-wrap"])},isWrap:function(a){return n.has(a,"ephox-cram-annotation-wrap")}},Wma={en_au:"en_gb",en_bz:"en_gb",en_ca:"en_gb",en_gb:"en_gb",en_ie:"en_gb",en_in:"en_gb",en_jm:"en_gb",en_my:"en_gb",en_nz:"en_gb",en_ph:"en_gb",en_sg:"en_gb",en_tt:"en_gb",en_za:"en_gb",en_zw:"en_gb",en_us:"en_us",en:"en_us"},Xma="da de en en_au en_br en_gb en_uk en_us es fi fr it nb nl pt pt_pt sv".split(" "),
pd=function(a,b){return{value:k(a),textkey:k(b),icon:g.none}},Yma=function(a){var b=ua(Ks.localeList(),Wma);return Ks.determineFrom(a,b).filter(function(a){return U(Xma,a)})},vf={determine:function(a){return"no.language"===a?g.some(a):Yma(a)},get:function(){return[pd("no.language",x.key("spelling.none")),pd("en_us",x.key("parlance.en_us")),pd("en_gb",x.key("parlance.en_gb")),pd("da",x.key("parlance.da")),pd("de",x.key("parlance.de")),pd("es",x.key("parlance.es")),pd("fi",x.key("parlance.fi")),pd("fr",
x.key("parlance.fr")),pd("it",x.key("parlance.it")),pd("nb",x.key("parlance.no")),pd("nl",x.key("parlance.nl")),pd("pt",x.key("parlance.pt_br")),pd("pt_pt",x.key("parlance.pt_pt")),pd("sv",x.key("parlance.sv"))]},isOn:function(a){return"no.language"!==a},offKey:k("no.language")},M_=function(a,b){var c=vf.get();return{"spelling.dropdown":{name:"spellcheck",textkey:x.key("spelling.menu"),menuTextkey:"",updateDropdown:function(b){b.populate([{label:g.none,items:k(c)}]);var d=a.profile().spelling().get();
Da.on(d).fold(b.untick,t,b.tick)},action:function(c){a.profile().spelling().setAndCache(c);Gb(c,"en")||a.profile().autocorrect().set(!1);b.trigger.change(c)},values:c,render:g.none(),describe:function(a){return x.key("spelling.menu")},hasPopup:!0,toggle:!1}}},N_=function(a,b,c){var d=a.profile().spelling().get()!==vf.offKey();return{"spelling.general":{toggle:!0,value:"spellcheck",textkey:x.key("cog.spellcheck"),action:function(){var e=(d=!d)?b:vf.offKey();a.profile().spelling().setAndCache(e);c.trigger.change(e)},
updateGeneral:function(a){d?a.select():a.deselect()},icon:!1}}},P_=O("area","f"),Ll={stop:k("trampoline.stop"),run:function(a){for(;"trampoline.stop"!==a;)a=a()}},fj=ta.generate([{inline:["item","mode","lang"]},{text:["item","mode"]},{empty:["item","mode"]},{boundary:["item","mode","lang"]},{concluded:["item","mode"]}]),mS=function(a,b,c,d){var e=a.property().isElement(b)?g.from(a.attrs().get(b,"lang")):g.none();return a.property().isText(b)?fj.text(b,c):d(b,c)?fj.concluded(b,c):a.property().isBoundary(b)?
fj.boundary(b,c,e):a.property().isEmptyTag(b)?fj.empty(b,c):fj.inline(b,c,e)},Zma=function(a,b,c,d){return Ca.walk(a,b,c,Ca.walkers().right(),void 0).fold(function(){return fj.concluded(b,c)},function(b){return mS(a,b.item(),b.mode(),d)})},nS=function(a,b,c,d,e,f){return function(){return b.fold(function(b,g,k){(g===Ca.advance?d.openInline:d.closeInline)(k,b);return Ml(a,b,g,c,d,e,f)},function(b,g){var h=e(a,b);d.addDetail(h);return c(b,g)?Ll.stop():Ml(a,b,g,c,d,e,f)},function(b,g){d.addEmpty(b);
return Ml(a,b,g,c,d,e,f)},function(b,g,k){var h=f.assess(b);return Rg.cata(h,function(h){return g!==Ca.backtrack?Ml(a,b,Ca.sidestep,c,d,e,f):Ll.stop()},function(h){(g===Ca.advance?d.openBoundary:d.closeBoundary)(k,b);return Ml(a,b,g,c,d,e,f)},function(a){return Ll.stop()})},function(a,b){return Ll.stop()})}},Ml=function(a,b,c,d,e,f,g){b=Zma(a,b,c,d);return nS(a,b,d,e,f,g)},$ma={walk:function(a,b,c,d,e,f){var g=function(b,d){return a.eq(b,c)&&(d!==Ca.advance||a.property().isText(b)||0===a.property().children(b).length)},
k=zi.nu(d),m=mS(a,b,Ca.advance,g);Ll.run(function(){return nS(a,m,g,k,e,f)});return k.done()}},ana=Aa(["elements","lang","words"],[]),bna={fromWalking:function(a,b){a=E(b,function(a){var b=a.details();a=a.lang();var c=E(b,function(a){return a.text()}).join("");b=E(b,function(a){return a.item()});c=bM.words(c);return ana({lang:a,words:c,elements:b})});return{zones:k(a)}}},cna=function(a,b,c,d,e,f){return(a.eq(b,c)?g.some(b):a.property().parent(b)).map(function(g){g=zi.calculate(a,g).getOr(d);return $ma.walk(a,
b,c,g,e,f)})},tq=function(a,b,c,d,e,f){b=zd.subset(a,b,c).bind(function(b){return 0===b.length?g.none():cna(a,b[0],b[b.length-1],d,e,f)}).getOr([]);return bna.fromWalking(a,b)},Mx=function(a,b){return function(c,d){return c.eq(d,a.item())?a:c.eq(d,b.item())?b:Ff.detail(c,d)}},oS=function(){return{zones:k([])}},Ch={fromRange:function(a,b,c,d,e){b=Sk.getEdges(a,b,c,k(!1));c=Mx(b.left(),b.right());return tq(a,b.left().item(),b.right().item(),d,c,e)},transformEdges:Mx,fromBounded:function(a,b,c,d,e){return tq(a,
b,c,d,Ff.detail,e)},fromBoundedWith:tq,fromInline:function(a,b,c,d){b=Sk.byBoundary(a,b);var e=Mx(b.left(),b.right());return b.isEmpty()?oS():tq(a,b.left().item(),b.right().item(),c,e,d)},empty:oS},qS=function(a,b,c,d){return a.property().isBoundary(b)?Ch.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?pS():Ch.fromInline(a,b,c,d)},pS=function(){return Ch.empty()},Nx={single:qS,range:function(a,b,c,d,e,f,g){b=bd.toLeaf(a,b,c);d=bd.toLeaf(a,d,e);return a.eq(b.element(),d.element())?qS(a,b.element(),
f,g):Ch.fromRange(a,b.element(),d.element(),f,g)},empty:pS},rS=nb(),Tm={single:function(a,b,c){return Nx.single(rS,a,b,c)},range:function(a,b,c,d,e,f){return Nx.range(rS,a,b,c,d,e,f)},empty:function(){return Nx.empty()}},lB={update:function(a,b,c){var d=cb(c);z(d,function(d){a.add(b,d,c[d])});return d},getInCache:function(a,b,c){return ka(c,function(c){return a.get(b,c.word()).fold(k(!1),function(a){return a.suggestions().isSome()})})}},dna={anything:k({assess:Rg.inView})}.anything(),Ox=function(a,
b,c,d,e,f){a=Ch.fromBoundedWith(a,b,c,d,f,dna).zones();1===a.length?(a=a[0],e=a.lang()===e?g.some(a):g.none()):e=g.none();return e},sS=function(a,b,c,d,e){return Ox(a,b,c,d,e,Ff.detail)},uq={fromRange:function(a,b,c,d,e){var f=zi.strictBounder(d,e);b=Sk.getEdges(a,b,c,f);c=Ch.transformEdges(b.left(),b.right());return Ox(a,b.left().item(),b.right().item(),d,e,c)},fromBounded:sS,fromInline:function(a,b,c,d){var e=zi.strictBounder(c,d);e=Sk.getEdges(a,b,b,e);var f=Ch.transformEdges(e.left(),e.right());
e.isEmpty()?(f=a.property().isText(b)?a.property().getText(b):a.property().children(b).length,e=bd.toLeaf(a,b,0),b=bd.toLeaf(a,b,f),a=sS(a,e.element(),b.element(),c,d)):a=Ox(a,e.left().item(),e.right().item(),c,d,f);return a},empty:function(){return g.none()}},tS=function(a,b,c,d){return a.property().isBoundary(b)?uq.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?uq.empty():uq.fromInline(a,b,c,d)},uS={single:tS,range:function(a,b,c,d,e,f,g){b=bd.toLeaf(a,b,c);d=bd.toLeaf(a,d,e);return a.eq(b.element(),
d.element())?tS(a,b.element(),f,g):uq.fromRange(a,b.element(),d.element(),f,g)}},vS=nb(),ena={single:function(a,b,c){return uS.single(vS,a,b,c)},range:function(a,b,c,d,e,f){return uS.range(vS,a,b,c,d,e,f)}},wS=function(a){return ia(a,function(a){return ed.descendants(a,D.isText)})},vq={textnodes:wS,text:function(a){a=wS(a);return E(a,function(a){return D.isText(a)?Ya.get(a):""}).join("")},parsed:function(a,b,c){return g.from(a[0]).bind(function(a){return ena.single(a,b,c).bind(function(a){a=a.words();
return 1===a.length?g.some(a[0]).map(function(a){return a.word()}):g.none()})})},children:function(a){return ia(a,A.children)}},fna={clobber:function(a,b){var c=vq.children(a),d=vq.textnodes(a);return g.from(a[0]).bind(function(e){P.before(e,c);e=g.from(d[0]);e.each(function(a){Ya.set(a,b)});z(d.slice(1),function(a){Ya.set(a,"")});z(a,G.remove);return e})}},xS=gw.resolve("annotation"),yS=gw.resolve("lingo"),zS=hw.resolve("annotation-wrap"),gj={nu:function(){var a=r.fromTag("span");n.add(a,zS);m.set(a,
"aria-invalid","spelling");return wi.nu(a)},set:function(a,b,c){m.set(a,xS,c);m.set(a,yS,b)},label:k(zS),detail:function(a){return zg.id(a).bind(function(b){return g.from(m.get(a,xS)).bind(function(c){return g.from(m.get(a,yS)).map(function(a){return{id:k(b),word:k(c),lang:k(a)}})})})}},gna=hw.resolve("wrap-disabled"),hna=function(a){a=zg.all(a);z(a,function(a){n.remove(a,gna)})},ina=O("id","elements","word","lang"),AS={success:function(a){return{fold:function(b,c){c(a)}}},fail:function(a){return{fold:function(b,
c){b(a)}}}},jna=function(a,b){var c={};z(a,function(a){zg.marker(a,b.label()).filter(ja.inBody).each(function(a){b.detail(a).each(function(b){var d=b.id(),e=b.word();b=b.lang();var f=zg.all(a);0<f.length&&(c[d]=ina(d,f,e,b))})})});return c},BS=function(a,b,c,d){var e=vq.text(a);a=vq.parsed(a,c,d);return e===b&&a.is(b)},kna=function(a,b,c){a=Ze(a);return E(a,function(a){return a.lang()===c&&BS(a.elements(),a.word(),b,a.lang())?AS.success(a):AS.fail(a)})},lna={validate:BS,verify:function(a,b,c,d,e){b=
jna(a.elements(),b);a=kna(b,e,a.lang());z(a,function(a){var b=function(a){return function(b){z(b.elements(),a)}};a.fold(b(d),b(c))})}},CS=function(a){return zg.marker(a,gj.label())},Sr={highlight:function(a,b,c,d){lna.verify(b,gj,hna,G.unwrap,a.lang());c=ol.matchWords(b.elements(),c,d);c=ol.annotates(c,gj.label());return ia(c,function(c){return c.current().fold(function(){var d=c.match(),e=d.word();if(a.ignore(d))return[];d=wi.wrapper(d.elements(),gj.nu)||[];z(d,function(a){zg.set(a,c.id());gj.set(a,
b.lang(),e)});return[Jp.created(d)]},function(a){return[Jp.preserved(a)]})})},marker:CS,substitute:function(a,b){a=CS(a).fold(k([]),zg.all);return fna.clobber(a,b)},detail:function(a){return gj.detail(a)}},S_={highlight:function(a,b,c,d){var e={operation:a,internal:a,ignore:k(!1),lang:k(d)},f=E(c,function(a){return a.word()}),g=ka(f,function(a,b){return Gc(f,a).filter(function(a){return a===b}).isSome()});e.operation(function(){Sr.highlight(e,b,g,k(!1))})}},mna=function(a,b){return Ga.nu(function(c){var d=
{words:E(a.words(),function(a){return ej(a.word())})};b.correction(d,a.lang(),function(b){b=J.value({spelling:k(b),zone:k(a)});c(b)},function(a){a=J.error(Error(a));c(a)})})},T_={scan:function(a,b,c){var d=function(b){var c=b.zone(),d=lB.update(a,c.lang(),b.spelling());b=ka(c.words(),function(a){a=ej(a.word());return U(d,a)});return{zone:k(c),words:k(b)}};c=E(c,function(a){return mna(a,b)});return Rl(c,Ga.nu).map(function(a){a=ia(a,function(a){return a.fold(k([]),HB)});return E(a,d)})}},nB={active:function(a){var b=
{};a.autocorrect().get(function(a){a.fold(function(a){ld.log("Error loading autocorrect list")},function(a){b=C1(a.corrections,function(a,b){return 1===a.length&&1<b.length}).f})});return{lookup:function(a){return b.hasOwnProperty(a)?g.from(b[a]):g.none()}}},inactive:function(){return{lookup:g.none}}},nna=Cc([za("language"),za("words")]),V_={many:k(nna)},ona=function(a,b){return zc(a,b).getOrThunk(function(){return lm()})},Px=Ha("good-spelling"),mB={execute:function(a,b,c,d,e,f){var g=ona(b,c);f=
nm.multiple(function(b,d){return a.execute({language:c,words:b})},g,d,function(a){return a.spell},ca,e,void 0!==f?f:!1);b[c]=g;return hf.mapSync(f,function(a){z(d,function(b){ye(a,b)||g.set(b,Px,e)});var b={};Ma(a,function(a,c){g.get(e,c).is(Px)||(b[c]=a)});return b})},initCaches:function(a){var b={};Ma(void 0!==a?a:{},function(a,d){b[d]=lm(a)});return b},correct:k(Px)},pna={image:k("1"),spelling:k("1")},DS=function(a,b){return(je(a,"/")?a:a+"/")+b},X_={corsQuery:function(a){return DS(a,"version")},
spelling:function(a){return DS(a,pna.spelling())+"/"}},Nl=function(a){a="data-"+B.resolve(a);return k(a)},Ee={value:Nl("spelling-value"),type:Nl("spelling-type"),overflow:Nl("spelling-overflow"),overflowMenu:Nl("spelling-overflow-menu"),spelling:Nl("spelling-suggestion")},ES=O("primary","secondary","submenus"),qna=O("value","text","attrs"),rna=O("textkey","value","items"),b0={generate:function(a,b){if(a.length>b){var c=a.slice(0,b);var d=qna(Ee.overflow(),x.translate("spelling.context.more"),{});
b=a.slice(b);a={};a[Ee.overflow()]=Ee.overflowMenu();b=rna(x.key("spelling.context.morelabel"),Ee.overflowMenu(),b);c=ES(c.concat([d]),[b],a)}else c=ES(a,[],{});return c}},a0=O("value","text","attrs"),pB=aa.detect().browser,g0=Aa("communication profile content undo viewable cache url autocorrectOn language fromServiceState multilingual".split(" "),[]),FS=function(a){a=r.fromTag(a);var b=r.fromText(mb());y.append(a,b);n.add(a,Rb.styleSpan());return a},GS=function(a,b,c,d){var e=FS(d);A.firstChild(e).each(function(d){a(c,
e);b.setSelection(d,0,d,0)})},HS={nu:FS,insertAfter:u(GS,y.after),insertBefore:u(GS,y.before)},IS=aa.detect().browser,JS=function(a,b){return kb.toLeaf(a,b)},sna=function(a){return D.isText(a)&&0!==Ya.get(a).trim().length},tna=function(a){return D.isElement(a)&&"br"===D.name(a)},una=function(a){return Xa([sna,tna],function(b){return b(a)})},vna=function(a){return D.isText(a.element())&&0===a.offset()||D.isElement(a.element())},wna=function(a,b,c){var d=k(a);return(!1===b&&vna(a)?g.some(!0):g.none()).fold(d,
function(b){return wc.seekLeft(a.element(),una,c).fold(d,function(a){return W.point(a,D.isText(a)?Ya.get(a).length:0)})})},xna=function(a,b){return N.eq(a.element(),b.element())},wf={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed()){var c=b.startContainer();return sb.cell(c,a.isRoot).bind(function(d){return sb.table(c,a.isRoot).map(function(a){return{cell:k(d),table:k(a),start:k(c),selection:k(b)}})})}return g.none()})},selectedCells:function(a,b){return Zb.cata(a.get(),
k([]),ca,function(a){var c=IS.isFirefox()?JS(a.startContainer(),a.startOffset()):W.point(a.startContainer(),a.startOffset()),e=IS.isFirefox()?JS(a.endContainer(),a.endOffset()):W.point(a.endContainer(),a.endOffset());a=wna(e,a.collapsed()||xna(c,e),b);return nf.sharedOne(function(a){return sb.cell(a,b)},[c.element(),a.element()]).toArray()})}},hj={none:function(a){return{fold:function(b,c,d,e){return b(a)}}},first:function(a){return{fold:function(b,c,d,e){return c(a)}}},middle:function(a,b){return{fold:function(c,
d,e,f){return e(a,b)}}},last:function(a){return{fold:function(b,c,d,e){return e(a)}}}},KS=function(a,b){return sb.table(a,b).bind(function(b){var c=sb.cells(b);return Va(c,function(b){return N.eq(a,b)}).map(function(a){return{index:k(a),all:k(c)}})})},wq={next:function(a,b){return KS(a,b).fold(function(){return hj.none(a)},function(b){return b.index()+1<b.all().length?hj.middle(a,b.all()[b.index()+1]):hj.last(a)})},prev:function(a,b){return KS(a,b).fold(function(){return hj.none()},function(b){return 0<=
b.index()-1?hj.middle(a,b.all()[b.index()-1]):hj.first(a)})}},vB={upOrLeft:function(a){wf.context(a).each(function(b){wq.prev(b.cell()).fold(t,function(){Cj.isFirstInContent(a,b.table())&&Qg.isLeft(b.cell(),b.selection())&&HS.insertBefore(a,b.table(),"p")},t,t)})},right:function(a){wf.context(a).each(function(b){wq.next(b.cell()).fold(t,t,t,function(){Cj.isLastInContent(a,b.table())&&Qg.isRight(b.cell(),b.selection())&&HS.insertAfter(a,b.table(),"p")})})}},y0={widget:function(a){var b=a.content(),
c=O("value","icon","textkey"),d=c("aligntop",g.some(va.resolve("aligntop")),x.key("table.cell.alignment.top")),e=c("alignmiddle",g.some(va.resolve("alignmiddle")),x.key("table.cell.alignment.middle"));c=c("alignbottom",g.some(va.resolve("alignbottom")),x.key("table.cell.alignment.bottom"));var f=[d,e,c];d=function(a){return function(b){v.set(b,"vertical-align",a)}};var h={aligntop:d("top"),alignmiddle:d("middle"),alignbottom:d("bottom")},l=g.none(),m=function(a,b){a.enable();return v.getRaw(b,"vertical-align").fold(function(){return Da.on("aligntop")},
function(a){return"middle"===a?Da.on("alignmiddle"):"bottom"===a?Da.on("alignbottom"):Da.on("aligntop")})};return{name:"cell-alignment",textkey:x.key("table.cell.alignment.toolbar"),menuTextkey:x.key("table.cell.alignment.toolbar"),action:function(c){b.focus();var d=wf.selectedCells(a.selections(),b.isRoot);z(d,h[c]);b.uiChanged()},updateDropdown:function(c){var d=wf.selectedCells(a.selections(),b.isRoot);0<d.length?d=m(c,d[0]):(c.disable(),d=Da.off());c.populate([{label:g.none,items:k(f)}]);cm.updateMenu(c,
d,Da.on(),f,l)},values:f,render:l,tooltip:qb.get,toggle:!1,describe:function(a){return x.translate("alignment.describe",x.get(a.textkey()))}}}},yna={cssNamespace:"table-cell-border",i18nNamespace:"table.cell.border",property:"border-width",tag:"table",specials:[["thin","medium","thick"]]},x0={widget:function(a){var b=a.content(),c=Gm(yna);c.initLayout();S.dialog(c.element(),x.translate("aria.table.cell.border.size"));var d=H.create({done:p([]),abort:Q([],c.events.abort)});c.events.close.bind(function(a){d.trigger.done();
b.focus()});c.events.action.bind(function(c){var d=Z.active();b.focus();var e=wf.selectedCells(a.selections(),b.isRoot);z(e,function(a){v.set(a,"border-width",c.value());v.getRaw(a,"border-style").fold(function(){v.set(a,"border-style","solid")},t)});b.domChanged();d.each(Z.focus)});var e=function(){c.enter();c.open()};return{element:c.element,destroy:c.destroy,name:k("cellborderwidth"),textkey:k(x.key("table.cell.border.width")),tooltip:qb.get,label:k(!1),updateWidget:function(d){var f=wf.selectedCells(a.selections(),
b.isRoot);0<f.length?(d.enable(),d=v.getRaw(f[0],"border-width").fold(Da.off,Da.on),c.updateInlineWidget({size:k(d)},"1px")):d.disable();e()},events:d.registry,open:e,close:c.close}}},zna=Aa(["name","textkey","menuTextkey","action","shortname"],[]),tB={widget:function(a,b,c){var d=zna(c),e=a.content();c=T.div();S.label(c,x.translate(d.textkey()));ma.add(c,[B.resolve("palette-cell-colors"),B.resolve(d.shortname()+"-cell-colors")]);var f=Ij.create(b.colors.buttons);y.append(c,f.element());var g=function(b){var c=
wf.selectedCells(a.selections(),e.isRoot);d.action()(c,b);n.trigger.done()},l=Dm(f.element()),m=(b.colors.custom?Fm.create:Fm.stub)(e,a.smartview().uiContainer());P.append(c,m.elements);m.events.selected.bind(function(a){g(a.color())});var n=H.create({done:p([]),abort:p([])});f.events.selected.bind(function(a){a=a.value();g(a)});var r=function(){m.refresh();t.enter();l.refresh()},t=ha.multiple(c,[l.grid].concat(m.layouts));t.events.exit.bind(function(){n.trigger.abort()});return{element:k(c),destroy:function(){t.destroy();
f.destroy();m.destroy()},name:k(d.name()),textkey:k(x.key(d.textkey())),tooltip:qb.get,label:k(!1),updateWidget:function(b){lj.isHighContrast(a.smartview())?b.disable():(0===wf.selectedCells(a.selections(),e.isRoot).length?b.disable():b.enable(),r())},events:n.registry,open:r,close:function(){n.trigger.done()}}}},Ana={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},Bna=function(a,b,c,d,e){void 0===e&&(e=Ana);var f=r.fromTag("table");v.setAll(f,e.styles);
m.setAll(f,e.attributes);var g=r.fromTag("tbody");y.append(f,g);for(var k=[],n=0;n<a;n++){for(var p=r.fromTag("tr"),t=0;t<b;t++){var u=n<c||t<d?r.fromTag("th"):r.fromTag("td");t<d&&m.set(u,"scope","row");n<c&&m.set(u,"scope","col");y.append(u,r.fromTag("br"));e.percentages&&v.set(u,"width",100/b+"%");y.append(p,u)}k.push(p)}P.append(g,k);return f},Cna={insert:function(a,b,c,d,e){return a.getSelection().bind(function(f){var h=Bna(b,c,d,e);sd.insertAtCursor(a,[h]).each(function(b){sb.firstCell(h).each(function(b){a.setSelection(b,
0,b,0)})});return g.some(h)})}},Dna=vd.resolve("table-picker"),Ena=vd.resolve("table-picker-row"),Fna=vd.resolve("table-picker-cell"),Gna=vd.resolve("table-picker-button"),$g={table:k(Dna),row:k(Ena),cell:k(Fna),button:k(Gna)},Hna="."+$g.cell(),Ina="."+$g.row(),cg={cells:function(a){return Y.descendants(a,Hna)},rows:function(a){return Y.descendants(a,Ina)},grid:function(a,b,c){b=parseInt(m.get(a,b),10);a=parseInt(m.get(a,c),10);return Oa.grid(b,a)},button:function(a){return L.child(a,"."+$g.button()).getOr(a)}},
LS=function(a,b,c,d,e){d=Math.max(d,Math.min(e,a.row()));a=Math.max(b,Math.min(c,a.column()));return Oa.address(d,a)},MS=function(a,b){a=LS(a,1,b.maxCols,1,b.maxRows);var c=Oa.address(a.row()+1,a.column()+1);b=LS(c,b.minCols,b.maxCols,b.minRows,b.maxRows);return{selection:k(a),full:k(b)}},rB={resize:function(a,b){a=Oa.address(a.row()+1,a.column()+1);return MS(a,b)},grow:function(a,b,c,d){a=Oa.address(a.rows()+c,a.columns()+b);return MS(a,d)}},NS=function(a,b,c,d){var e=a.width()/b.columns();a=a.height()/
b.rows();return Oa.address(Math.floor(d/a),Math.floor(c/e))},Jna={pickerCell:function(a,b,c,d){var e=d.x()-a.x();a=d.y()-a.y();return NS(b,c,e,a)},isRtl:k(!1)},Kna={pickerCell:function(a,b,c,d){var e=a.x()+b.width()-d.x();a=d.y()-a.y();return NS(b,c,e,a)},isRtl:k(!0)},w0={widget:function(a,b){var c=a.content(),d=l0(a.region().uiDirection().isRtl()?Kna:Jna,b),e=a.undo();a=H.create({done:Q([],d.events.done),abort:Q([],d.events.abort)});d.events.select.bind(function(a){e.save();Cna.insert(c,a.rows(),
a.cols(),a.rowHeaders(),a.columnHeaders()).each(function(a){e.save();c.domChanged()});c.toEditing()});return{element:d.element,name:k("table"),textkey:k(x.key("insert.table")),menuTextkey:k(x.key("table.menu")),tooltip:qb.get,label:k(!1),updateWidget:function(a){c.getSelection().each(function(b){a.enable()});d.open()},destroy:d.destroy,events:a.registry,open:d.open,close:d.close}}},Vj={set:function(a,b){a.dom().checked=b},find:function(a){return L.descendant(a,"input:checked")}},OS=Aa(["floatval",
"caption","summary","border","dimensions"],[]),Lna=function(a){a=m.get(a,"border");return"0"===a||"1"===a?g.some(a):g.none()},Mna=function(a){var b=v.getRaw(a,"width");a=v.getRaw(a,"height");return{width:k(b),height:k(a)}},Ur={divine:function(a,b){var c=uu.divine(b),d=m.get(b,"summary"),e=L.child(b,"caption").map(function(b){b=Ea.get(b);return a.filterHtml(a.output(),b)}).getOr(""),f=Lna(b);b=Mna(b);return OS({floatval:c,caption:e,summary:d,border:f,dimensions:b})},properties:OS,apply:function(a,
b){b.floatval().each(function(b){oh.runFloat(a,b)});b.border().each(function(b){m.set(a,"border",b)});""===b.summary()?m.remove(a,"summary"):Qf.setSummary(a,b.summary());""===b.caption()?L.child(a,"caption").each(G.remove):Qf.setCaption(a,b.caption());Qf.setDimensions(a,b.dimensions())}},Vr={halve:function(a,b){pc.getGenericWidth(a).each(function(c){var d=c.width()/2;pc.setGenericWidth(a,d,c.unit());pc.setGenericWidth(b,d,c.unit())})}},PS=function(a,b,c,d){return c.fold(g.none,g.none,function(a,b){return kc.first(b).bind(function(a){return g.some(Sc(a,
0,a,0))})},function(c){return sb.table(c,b.isRoot).bind(function(e){Ac.execute(a,nc.insertRowAfter,t,d)(b,e,Um.noMenu(c));e=Y.descendants(e,"tr");if(0<e.length)return L.descendant(e[e.length-1],"td,th").map(function(a){return Sc(a,0,a,0)})})})},uB={forward:function(a,b,c,d){return PS(a,b,wq.next(c),d)},backward:function(a,b,c,d){return PS(a,b,wq.prev(c),d)}},sB={setBorderColor:function(a,b){v.set(a,"border-color",b);v.getRaw(a,"border-style").fold(function(){v.set(a,"border-style","solid")},t)},setBackgroundColor:function(a,
b){v.set(a,"background-color",b)},setHeight:function(a,b){v.set(a,"height",b)},setWidth:function(a,b){v.set(a,"width",b)},setType:function(a,b){b=Pc.copy(a,b);y.after(a,b);G.remove(a)},setScope:function(a,b){m.set(a,"scope",b)},setStyle:function(a,b){m.set(a,"style",b)},setClass:function(a,b){m.set(a,"class",b)}},t0=vd.resolve("resizer-bar-dragging"),Nna=O("withSpaces","withoutSpaces"),Ona=function(a){return ka(a.split(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s\u00A0]/gim),function(a){return 0<a.length}).length},
wB={count:function(a){return{words:k(Ona(a)),characters:k(Nna(a.length,a.replace(/[\s\u00A0]/gim,"").length))}}},E0=Aa("accessibility formatting alignindent bookmark directionality table font parlance media imageEdit blocktag specialchar wordcount link linkvalidator horizontalrule help fileupload findreplace plaincodeview macros spelling".split(" "),[]),xq=0,Qx=g.none(),Yr={add:function(){if(0===xq){var a=r.fromTag("style");Vb.set(a,'/*\n * Keep this file as small as possible.\n * It is injected into the JavaScript, so it needs to be tiny.\n */\n\n/*\n * Animate from 0 to 359, not 0 to 360, as they are the same and FireFox does nothing\n *\n * Until we have token replacement, manual shorthand for "ephox-polish-spin"\n */\n\n@keyframes e-p-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(359deg);\n  }\n}\n\n/* Until we have token replacement, manual shorthand for "ephox-polish-spinner-img" */\n\n.e-p-s-img {\n  animation: e-p-spin 2s infinite linear;\n  width: 30px;\n  height: 30px;\n  margin: 2px 2em 0 auto;\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAABAQEBDQ0NERERERERCQkJDQ0NERERDQ0NEREREREQTPu3mAAAACnRSTlMAENDPwGBwsKB/qy4kVgAAAFpJREFUCNdjAAImAwYI4FoApooFuBYwWgAZXoZMCsJLgAyhpQwMUYpABmMiA4OYAAMCaC2GklqLwIxFMAmoYkmQYmGQdkOQgYpMBkIgA4tAVmggLAU7QwFIAADjyQ3FWhtneAAAAABJRU5ErkJggg==") 0/cover;\n}');
y.append(ja.body(),a);Qx=g.some(a)}xq++},remove:function(){0!==xq&&0===--xq&&(Qx.each(G.remove),Qx=g.none())}},Pna=hc.pencil(),yq=hc.code(),QS=function(a){var b=a.old().toTransfer();a.nu().fromTransfer(b)},Qna={transition:QS,factory:gy,style:hc.pencil},Rna={transition:QS,factory:Vm,style:hc.code},Wm={goingToDesign:function(a){return a===yq},alternate:function(a){return a===yq?Pna:yq},detect:function(a){return a===yq?Qna:Rna}},I0=function(a,b){return{destroy:t,init:t,setMode:yb("Code view is not enabled, cannot switch modes"),
events:H.create({change:p([]),ready:p([])}).registry}},H0=function(a,b){var c=b.css+"/codemirror.css",d=H.create({change:p([]),ready:p(["type"])}),e=g.none(),f=function(){var a=Tl.load.codeview(b.js).map(function(a){return a.map(k(!0))});e=g.some(a)},h=function(a){a(J.value(!0))};return{init:function(a){e.fold(function(){gn.addStylesheet(c,h).get(function(b){b.fold(function(a){console.error(a);console.error("Code View disabled due to error loading stylesheet")},function(){f();d.trigger.ready(a)})})},
function(b){d.trigger.ready(a)})},setMode:function(b){return e.fold(function(){throw"Cannot set mode before Code View has loaded";},function(c){c.get(function(c){c.fold(function(a){d.trigger.ready(b);console.error(a);console.error("Code View non-functional due to error downloading script file")},function(){var c=Wm.detect(b),e=a.swap(c.factory,{},{});d.trigger.change();c.transition(e);e.destroy()})})})},events:d.registry,destroy:t}},yB=aa.detect().browser,M0={build:function(a,b,c,d,e,f,g,l){var h=
K0(a,b,c,f,g,l),m=d.full(h);m.init();return{element:h.element,socket:h.socket,viewport:h.viewport,uiContainerParent:h.uiContainerParent,init:function(b,d,g){d=m.config(a.isInline(),d,e,g);AE.setup(h,f,a,b,c,d);m.loaded()},connect:h.connect,destroy:function(){h.destroy();m.destroy()},displayBanner:h.displayBanner,hideBanner:h.hideBanner,position:t,refresh:h.refresh,tabstrip:h.toolbar,state:k(l),dialogContainer:h.dialogContainer}},bounds:function(){return Bf.view}},RS={blobTob64:function(a,b){var c=
m.get(b,uc.blobId());m.remove(b,uc.blobId());a.get(c).each(function(a){m.remove(b,uc.blobId());m.set(b,"src",Yc.imageResultToDataURL(a.imageresult()))})},b64ToBlob:function(a,b){var c=m.get(b,"src"),d=function(){return Nj.dataUriToBlobSync(c).map(function(b){var d=Yc.fromBlobAndUrlSync(b,c);b=dg.createObjectURL(b);var e=Ha("image");return a.add(e,d,b)})};try{a.lookupByData(c).fold(d,g.some).each(function(a){m.set(b,uc.blobId(),a.id());m.set(b,"src",a.objurl())})}catch(e){console.warn("Unable to read Base64 image data: ",
e,c)}}},$0={configure:function(a,b){var c=uc.blobId(),d="img["+c+"]";a.addSelector(a.internal(),d,Na.removeAttr(c));a.addSelector(a.output(),d,function(a){z(a,function(a){RS.blobTob64(b,a)})});a.addSelector(a.input(),"img:not(["+c+"])[src]",function(a){z(a,function(a){RS.b64ToBlob(b,a)})});c=Na.removeClass(uc.uploadInProgress());a.add(a.output(),uc.uploadInProgress(),c);a.add(a.history(),uc.uploadInProgress(),c);a.add(a.internal(),uc.uploadInProgress(),c);d=uc.trackedImage();c="img["+d+"]";d=Na.removeAttr(d);
a.addSelector(a.output(),c,d);a.addSelector(a.internal(),c,d)},blobId:uc.blobId},SS=O("image","blobInfo"),Rx=ta.generate([{failure:["error"]},{success:["result","images","blob"]}]),Tna=function(a,b,c,d){z(b,function(a){m.set(a,"src",d.location);m.remove(a,uc.blobId())});return Sna(a,c)},TS=function(a,b,c,d,e){var f=Yc.imageResultToDataURL(c);f=a.lookupByData(f).getOrThunk(function(){return a.add(b,c,d)});m.set(e,uc.blobId(),f.id());return SS(e,f)},Una=function(a,b){var c=m.get(b,uc.blobId());return a.get(c).fold(function(){return J.error(c)},
function(a){return J.value(SS(b,a))})},Sna=function(a,b){return a.get(b).fold(function(){return J.error("Internal error with blob cache")},function(c){a.remove(b);return J.value(c)})},Zj={prepareForUpload:function(a,b,c){var d=a.isActive(b);a.register(c,b);n.add(c,uc.uploadInProgress());return d?g.none():g.some(b)},handleUpload:function(a,b,c,d,e,f,g){var h=function(){console.error("Internal error with blob cache",e);g(Rx.failure({status:k(666)}))};a.upload(f,e,function(a){var f=b.findById(d,e);z(f,
yf.removeClass(uc.uploadInProgress()));a.fold(function(a){g(Rx.failure(a))},function(a){Tna(c,f,e,a).fold(h,function(b){g(Rx.success(a,f,b))})});b.report(e,f,a.isValue())})},registerAssets:function(a,b,c){return ia(c,function(c){return Qc.cata(c,function(c,d,g){return L.descendant(b,'img[src="'+g+'"]').fold(function(){return[J.error("Image that was just inserted could not be found: "+g)]},function(b){return[J.value(TS(a,c,d,g,b))]})},k([]))})},registerBlob:TS,findBlobs:function(a,b,c){c=a.findAll(c);
return a.inProgress()?[]:E(c,function(a){return Una(b,a)})}},Vna=function(a){var b=function(b){var c=b.image(),e=b.blobInfo(),f=vr.changedBounds(c);e=Ua.fromPromise(Yc.imageResultToOriginalBlob(e.imageresult()));return Ua.bind(e,function(d){return Fj.resampleAction(f,d,function(e){if(e===d)return Ua.pure(b);var f=sf.updater(sf.keepResample,c),g=xr.applyEdit(c);e=Re.single(e).bind(g).map(f);return Ua.map(e,function(d){return Qc.cata(d,function(b,d,e){return Zj.registerBlob(a,b,d,e,c)},function(a,c,
d){return b})})})})};return function(a){return Ce(a,b)}},Wna=function(a){a=E(a,J.value);return Ga.pure(a)},Z0={instance:function(a,b){return!0===a.immediate?Wna:Vna(b)}},Xna={400:"errors.http.400",401:"errors.http.401",403:"errors.http.403",404:"errors.http.404",407:"errors.http.407",409:"errors.http.409",413:"errors.http.413",415:"errors.http.415",500:"errors.http.500",501:"errors.http.501"},Yna={get:function(a,b){return g.from(Xna[a]).map(function(a){return x.translate(a,b)})}},Zna=function(a){return xa(a)&&
""!==a.trim()?{description:k(a),link:k(null)}:mf.get("error.imageupload.generic")},$na=function(a,b){var c=b.status();return Yna.get(c,a).fold(function(){var b=0===c?"error.imageupload.cors":400<=c&&500>c?"error.code.images.not.found":"error.imageupload";return mf.get(b,[a])},function(a){return{description:k(a),link:k(null)}})},US=function(a,b){return{instance:function(){return gc(function(c){c=b(c);a.show(c)})}}},VS={simple:function(a){return US(a,Zna)},url:function(a,b){return US(a,u($na,b))}},
aoa=["jpg","png","gif","jpeg"],Yj={failureObject:O("message","status","contents"),getFilename:function(a,b){xa(a.name)&&!je(a.name,".tmp")?b=a.name:xa(a.type)&&Gb(a.type,"image/")&&(a=a.type.substr(6),b=U(aoa,a)?b+"."+a:b);return b},buildData:function(a,b,c){var d=new (Kc.getOrDie("FormData"));d.append(a,b,c);return d}},Q0=O("id","filename","blob","base64"),WS={direct:function(a){return O0(a)},custom:function(a){return P0(a)}},Sx=O("uploader","errors"),Y0={choose:function(a,b,c){return!0!==a.bundled?
Sx({upload:yb},{instance:k(yb("Image Upload is disabled"))}):vb(a.handler)?Sx(WS.custom(a.handler),VS.simple(b)):Sx(WS.direct(a.direct),VS.url(b,a.direct.url))}},S0=O("id","imageresult","objurl"),Xm=uc.trackedImage(),V0=function(a,b){return Y.descendants(a,"img["+Xm+'="'+b+'"]')},W0=function(a){return Y.descendants(a,"img:not(["+Xm+"])["+uc.blobId()+"]")},boa={settings:function(a){var b={ui:{toolbar:{display:!1}},spelling:{bundled:!1},highlighter:{bundled:!1},table:{bundled:!1},resize:{bundled:!1},
codeview:{bundled:!1},imageEdit:{bundled:!1},imageupload:{immediate:!0},linkvalidator:{bundled:!1}};b=aa.detect().deviceType.isTouch()?b:{};return oa(b,void 0===a.content||void 0===a.content.inline?{}:{fullscreen:{bundled:!1},codeview:{bundled:!1},plaincodeview:{bundled:!1}})}},BB={isRtl:k(!1)},AB={isRtl:k(!0)},c1=function(a){return Xa(["ar","fa","he"],function(b){return Gb(a,b)})},e1=function(a){return oa(CB.settings(a.resources),a,boa.settings(a))},XS=function(a,b,c){var d=QC.withOptions(a,c);d.content&&
d.content.tabindex&&(0,m.remove)(a,"tabindex",d.content.tabindex);c=as(d,{});var e=Ea.get(a),f=m.get(a,"style");b(a);Ea.set(a,"");c.connect(a);Fd.set(c,e);return{polish:c,restore:function(b){Ea.set(a,b);null!==f&&void 0!==f&&0<f.length?m.set(a,"style",f):m.remove(a,"style");d.content&&d.content.tabindex&&(0,m.set)(a,"tabindex",d.content.tabindex);return a}}},YS={replace:function(a,b){return XS(a,b.content&&!0===b.content.autoresize?M2:L2,b)},takeover:function(a,b){return XS(a,t,b)}},Ob=function(a,
b){var c={};if(void 0===a)return c;z(b,function(b){var d=b.name();d=a[d];void 0!==d&&(b.validate(d),c[b.output()]=Mb(b.contents)?Ob(d,b.contents):d)});return c},coa=function(a){return E(void 0===a?[]:a,function(a){var b=Ob,d=ba.string("prefix"),e=ba.string("suffix");var f=[ba.string("color"),ba.string("background-color")];f=ua(ba.object("style"),{contents:f});return b(a,[d,e,f])})},doa=function(a){if(void 0===a||void 0===a.url)return{service:!1};var b=ZS(a,"autocorrect",!0);if(xa(a.url))return{url:a.url,
service:!0,autocorrect:b};throw Error("Spelling URL was not a string");},eoa=function(a){if(void 0===a||void 0===a.validation||void 0===a.validation.url)return{};if(xa(a.validation.url))return{url:a.validation.url,bundled:!0};throw Error("Link Validation URL was not a string");},foa=function(a){if(void 0===a||void 0===a.embed||void 0===a.embed.url)return{};if(xa(a.embed.url))return{url:a.embed.url,bundled:!0};throw Error("Link Embed URL was not a string");},goa=function(a,b){b=!1===b?!0:!1;a=(void 0===
a?{}:a).upload;if(void 0!==a){if(void 0!==a.handler){if(!vb(a.handler))throw Error("Image Upload Handler was not a function");return{handler:a.handler,immediate:b,bundled:!0}}if(!xa(a.url))throw Error("Image Upload URL was not a string");return{direct:Ob(a,[ba.string("url"),ba.string("basePath"),ba.bool("credentials")]),immediate:b,bundled:!0}}return{}},hoa=function(a){a=Ob((void 0===a?{}:a).editing,[ba.bool("enabled"),ba.string("proxy"),ba.number("preferredWidth"),ba.number("preferredHeight")]);
void 0!==a.enabled&&(a.bundled=a.enabled);return a},ZS=function(a,b,c){if(void 0===a[b])return c;ba.bool(b).validate(a[b]);return a[b]},ioa=function(a){return Ob((void 0===a?{}:a).toolbar,[ba.arrayOfToolbarGroups("items"),ba.arrayOfStrings("contextual")])},joa=function(a){if(void 0===a)return{};if(void 0===a.toolbar)var b={};else{var c=a.toolbar;if(void 0!==c.offset){c=c.offset;if(!ic(c)||void 0===c.top||void 0===c.left)throw Error("toolbar offset must be an object with left and top");if(!$e(c.top)&&
!$e(c.left))throw Error("toolbar offset values must be numbers");b={draggable:!0,offset:{left:c.left,top:c.top}}}else b={}}c=Ob(a.toolbar,[ba.bool("visible"),ba.bool("draggable"),ba.bool("sticky")]);b=oa(b,c);return void 0===c.sticky&&!0===a.autoresize?oa(b,{sticky:!0}):b},koa=function(a){if(void 0!==a){if(!xa(a))throw Error("The basePath configuration value was not a string");return ik(a,"/")}},loa=function(a){if(void 0===a||void 0===a.fonts)return[];a=a.fonts;if(!Mb(a))throw Error("The fonts configuration was not an array");
var b=function(a,b){console.error(a+" :",b);throw Error(a);};return E(a,function(a){if(xa(a))return{value:a,text:a};ic(a)||b("The fonts array value was not a string or object",a);void 0!==a.value&&xa(a.value)||b("The font value configuration was not a string or is undefined",a);void 0===a.text||xa(a.text)||b("The font text configuration was not a string",a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},noa=function(a){if(void 0===a||void 0===a.colors)return{};var b=Ob(a.colors,
[ba.bool("custom")]);void 0!==a.colors.buttons&&(b.buttons=moa(a.colors.buttons));return b},moa=function(a){if(!Mb(a))throw Error("The colors button configuration was not an array");var b=function(a,b){console.error(a+" :",b);throw Error(a);};return E(a,function(a){if(xa(a))return{value:a,text:a};ic(a)||b("A buttons array value was not a string or object",a);void 0!==a.value&&xa(a.value)||b("The color button value configuration was not a string or is undefined",a);void 0===a.text||xa(a.text)||b("The color button text configuration was not a string",
a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},ooa=function(a){a=Ob(void 0===a?{}:a,[ba.bool("enabled"),ba.bool("showButton")]);return{bundled:void 0===a.enabled||!0===a.enabled,showButton:void 0===a.showButton||!0===a.showButton}},poa=function(a){a=ua({allowLocal:!0},void 0===a?{}:a);ba.bool("allowLocal").validate(a.allowLocal);return a.allowLocal},qoa=function(a){a=Ob(void 0===a?{}:a,[ba.arrayOfStrings("languages")]);return void 0===a.languages?{}:{languages:E(a.languages,
function(a){return a.toLowerCase()})}},roa=function(a){void 0!==a.styles&&(a.styles=ka(a.styles,function(a){a=a.rule;return!(void 0===a||"."===a||0<=a.indexOf("..")||0<=a.indexOf("#"))}))},soa=function(a,b,c){return"plain"===a?{forceText:!0}:{officeStyles:"retain"===a?"merge":void 0!==a?a:"prompt",htmlStyles:"retain"===a?"merge":void 0!==a?a:"merge",allowLocalImages:c,enableFlashImport:!1===b?!1:!0}},toa=function(a){a=Ob(a.macros,[ba.arrayOfStrings("allowed")]);void 0!==a.allowed&&(a.allowed=g.some(a.allowed));
return a},i1=function(a){var b=Ob(a,[ba.arrayOfStrings("plugins")]);b=void 0===b.plugins?[]:b.plugins;var c=Ob(a.ui,[ba.string("locale","code")]),d=ZS(a,"autosubmit",!0),e=Ob(a.content,[ba.arrayOfObjects("highlighters")]),f=Ob(a.paste,[ba.string("style"),ba.bool("enableFlashImport")]),g=function(){var b=Ob(a.css,[ba.arrayOfStrings("stylesheets"),ba.string("documentStyles"),ba.bool("showDocumentStyles")]),c=Ob(a.ui,[ba.bool("autoresize")]);return ua(b,c)}(),k=Ob(a.css,[ba.arrayOfObjects("styles"),
ba.bool("showDocumentStyles")]);roa(k);var m=Ob(a.ui,[ba.bool("shortcuts","features")]),n=qoa(a.ui),p=ooa(a.codeview),r=doa(a.spelling),t=eoa(a.links),u=foa(a.links),v=poa(a.images),x=hoa(a.images),y=v?goa(a.images,x.bundled):{},z=ioa(a.ui),A=joa(a.ui),B=koa(a.basePath),D=loa(a.ui),E=noa(a.ui),G=function(){var b=Ob(a.ui,[ba.string("aria-label","editorName"),ba.bool("autoresize")]);return ua(b,{locale:c,toolbar:A})}(),H=toa(a);return{resources:B,plugins:b,spelling:r,linkvalidator:t,embed:u,font:{faces:D,
colors:E},table:{colors:E},macros:H,ui:G,shortcuts:m,autosubmit:d,highlighter:{external:coa(e.highlighters)},smartclipboard:{paste:soa(f.style,f.enableFlashImport,v)},parlance:n,content:g,imageEdit:x,imageupload:y,blocktag:k,fileupload:{allowLocalImages:v},platform:{toolbar:z,allowLocalImages:v},plaincodeview:{bundled:p.bundled},codeview:p}},uoa={getPath:function(a){var b=document.getElementsByTagName("script");return qa(ds(b),function(b){return b.src.indexOf(a)===b.src.length-a.length}).map(function(b){return b.src.substring(0,
b.src.indexOf(a))}).getOr(void 0)}},$S=gc(function(){return g.from(uoa.getPath("textboxio.js")).map(function(a){return ik(a,"/")})}),aT=function(a){return a+"/resources"},EB={setupResources:function(a){return g.from(a.resources).orThunk($S).map(aT).fold(yb("basePath auto detection failed, please provide one in the editor configuration"),function(b){b=ak.load(b);return oa(a,{resources:b})})},speculate:function(a){g.from(a).orThunk($S).map(aT).each(ak.load)}},voa=function(a,b,c){var d=function(){var a=
r.fromDom(Hb.activeElement);b(a)&&c()};return K.bind(a,"blur",function(){setTimeout(d,200)})},woa=function(a,b,c){return K.bind(a,"focusout",function(a){bT(a,b)&&c()})},xoa=function(a,b,c){return K.bind(a,"blur",function(a){bT(a,b)&&c()})},yoa=function(){var a=aa.detect();return a.browser.isFirefox()?voa:a.browser.isIE()?woa:xoa}(),bT=function(a,b){a=g.from(a.raw().relatedTarget).getOr(Hb.activeElement);return b(r.fromDom(a))},zoa={register:function(a,b,c,d){var e=K.bind(a,"focus",function(a){Z.hasFocus(a.target())&&
c()}),f=yoa(a,function(c){return!wd.closest(c,function(c){return N.eq(a,c)||N.eq(b(),c)||n.has(c,EA.magicBox())})},d);return{destroy:function(){e.unbind();f.unbind()}}}},Ye={replace:function(a,b){b=oa(b,{content:{inline:a}});var c=m.clone(a),d=as(b),e=f1(d.element,a,c),f=Cq(e.toolbarHide,e.toolbarShow,!1),g=function(){var a=e.isVisible();f.on();!1===a&&d.activateInline()},k=function(){d.deactivateInline();f.off()},n=zoa.register(a,d.element,g,k);b=function(){Z.active().each(function(b){N.eq(b,a)||
k()})};b();d.events.connected.bind(b);d.events.loaded.bind(function(){d.content().getSelection().bind(g)});var p=d.focus;b={polish:ua(d,{focus:function(){g();p()}}),restore:function(b){n.destroy();e.restore();Ea.set(a,b);return a}};d.connect(ja.body());Fd.set(d,Ea.get(a));return b}},Aoa={attach:function(a,b,c,d){if(4!==arguments.length)throw"requires 4 parameters";var e=function(b){return function(){var c=r.fromTag("input");m.setAll(c,{type:"hidden",name:b});a.append(c.dom());return function(a){c.val(a)}}},
f=c.getOrThunk(e(b)),g=d.getOrThunk(e(b+"_styles"));return function(a){f(a.content);g(a.styles)}}},cT=function(a,b){var c=a.onsubmit,d=g1(a);a.onsubmit=function(e){if(d.inprogress())return!0;b(function(){c&&!1===c.apply(a)||setTimeout(d.submit,0)});return!1};return{unbind:function(){a.onsubmit=c}}},Boa={attachToFormSubmit:cT,attachToParentFormSubmit:function(a,b,c,d,e){if(5!==arguments.length)throw"requires 5 parameters";var f=a.parents("form:first");if(0!==f.size()){var g=f.get(0),k=Aoa.attach(f,
b,d,e);cT(g,function(a){k(c());a()})}}},Doa=function(a,b,c,d){v.set(b,"display","none");var e=as(QC.withOptions(b,d)),f=fa.get(b);e.connect(a);Fd.set(e,f);var h=!0===d.autosubmit?Coa(b,e):g.none();return{polish:e,restore:function(d){h.each(function(a){a.unbind()});fa.set(b,d);c.fold(function(){v.remove(b,"display")},function(a){v.set(b,"display",a)});G.remove(a);return b}}},Coa=function(a,b){return L.closest(a,"form").map(function(c){return Boa.attachToFormSubmit(c.dom(),function(c){b.uploadImages(function(){fa.set(a,
Fd.get(b));c()})})})},j1={textarea:{replace:function(a,b){var c=v.getRaw(a,"display");return A.parent(a).fold(function(){return null},function(){var d=m.get(a,"id");d=d?"ephox_"+d:Ha("ephox");var e=r.fromTag("div");m.set(e,"id",d);v.copy(a,e);(b.content&&!0===b.content.autoresize?K2:J2)(a,e);y.before(a,e);return Doa(e,a,c,b)})}},div:YS,body:{replace:function(a,b){b=oa(b,{platform:{fillscreen:!0}});a=YS.takeover(a,b);return{polish:a.polish,restore:a.restore}}}},k1={div:Ye,blockquote:Ye,article:Ye,
aside:Ye,figure:Ye,figcaption:Ye,footer:Ye,header:Ye,nav:Ye,section:Ye},Ol=function(a){return{name:a.name,required:fd,validate:a.validate}},Ym={bool:Pb(Ol,ba.bool),func:Pb(Ol,ba.func),number:Pb(Ol,ba.number),object:Pb(Ol,ba.object),string:Pb(Ol,ba.string)},Tx=function(a){return J.error("ERROR: Textbox.io requires "+a+" or above")},Ux=aa.detect().os,Pl=aa.detect().browser,dT="CSS1Compat"===Hb.compatMode||Hb.doctype&&"html"===Hb.doctype.name,Eoa={supported:function(){if(Pl.isIE()&&11>Pl.version.major)return Tx("Internet Explorer 11");
if(Ux.isOSX()&&Pl.isSafari()&&9>Pl.version.major)return Tx("Safari 9");if(Ux.isiOS()&&9>Ux.version.major)return Tx("iOS 9");if(!dT&&Pl.isIE())return J.error("ERROR: Document is not in standards mode. Textbox.io requires standards mode on Internet Explorer.");dT||void 0===console.warn||console.warn("WARNING: Document is not in standards mode. Textbox.io may experience user interface issues.");return J.value(void 0)}},eT=function(a){Xf.textboxio=a},Foa=Pb(eT,function(a){a=yb(a);return{replace:a,replaceAll:a,
inline:a,inlineAll:a,get:a,getActiveEditor:a,definePlugin:a,version:Vx,isSupported:fd}});(function(){var a=Xf.install;Xf.install=function(b,c){Xf.install=a;Eoa.supported().fold(Foa,function(){var a=null===c||void 0===c?{onprem:!0}:c;a=null===b||void 0===b?a:oa(a,{resources:b});eT(l1(a));EB.speculate(a.resources)})}})()})();
install();
